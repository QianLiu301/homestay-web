import {
  deepClone,
  encrypt_exports,
  getPathName,
  init_encrypt,
  init_utils
} from "./chunk-UG3QWNPE.js";
import {
  __commonJS,
  __esm,
  __export,
  __toCommonJS,
  __toESM
} from "./chunk-V4OQ3NZ2.js";

// node_modules/@cloudbase/adapter-interface/dist/esm/types.js
var StorageType, AbstractSDKRequest, AbstractStorage;
var init_types = __esm({
  "node_modules/@cloudbase/adapter-interface/dist/esm/types.js"() {
    (function(StorageType2) {
      StorageType2["local"] = "local";
      StorageType2["none"] = "none";
      StorageType2["session"] = "session";
    })(StorageType || (StorageType = {}));
    AbstractSDKRequest = /* @__PURE__ */ function() {
      function AbstractSDKRequest2() {
      }
      return AbstractSDKRequest2;
    }();
    AbstractStorage = /* @__PURE__ */ function() {
      function AbstractStorage2() {
      }
      return AbstractStorage2;
    }();
  }
});

// node_modules/@cloudbase/adapter-interface/dist/esm/utils.js
function formatUrl(protocol, url2, query) {
  if (query === void 0) {
    query = {};
  }
  var urlHasQuery = /\?/.test(url2);
  var queryString = "";
  for (var key in query) {
    if (queryString === "") {
      !urlHasQuery && (url2 += "?");
    } else {
      queryString += "&";
    }
    queryString += key + "=" + encodeURIComponent(query[key]);
  }
  url2 += queryString;
  if (/^http(s)?\:\/\//.test(url2)) {
    return url2;
  }
  return "" + protocol + url2;
}
var init_utils2 = __esm({
  "node_modules/@cloudbase/adapter-interface/dist/esm/utils.js"() {
  }
});

// node_modules/@cloudbase/adapter-interface/dist/esm/index.js
var esm_exports = {};
__export(esm_exports, {
  AbstractSDKRequest: () => AbstractSDKRequest,
  AbstractStorage: () => AbstractStorage,
  StorageType: () => StorageType,
  formatUrl: () => formatUrl
});
var init_esm = __esm({
  "node_modules/@cloudbase/adapter-interface/dist/esm/index.js"() {
    init_types();
    init_utils2();
  }
});

// node_modules/@cloudbase/utilities/dist/cjs/constants/common.js
var require_common = __commonJS({
  "node_modules/@cloudbase/utilities/dist/cjs/constants/common.js"(exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.COMMUNITY_SITE_URL = exports.IS_DEBUG_MODE = exports.getProtocol = exports.setProtocol = exports.getSdkName = exports.setSdkName = void 0;
    var sdkName3 = "@cloudbase/js-sdk";
    function setSdkName3(name) {
      sdkName3 = name;
    }
    exports.setSdkName = setSdkName3;
    function getSdkName5() {
      return sdkName3;
    }
    exports.getSdkName = getSdkName5;
    var PROTOCOL2 = "https:";
    function setProtocol2(protocol) {
      PROTOCOL2 = protocol;
    }
    exports.setProtocol = setProtocol2;
    function getProtocol2() {
      return PROTOCOL2;
    }
    exports.getProtocol = getProtocol2;
    exports.IS_DEBUG_MODE = true;
    exports.COMMUNITY_SITE_URL = "https://support.qq.com/products/148793";
  }
});

// node_modules/@cloudbase/utilities/dist/cjs/constants/errors.js
var require_errors = __commonJS({
  "node_modules/@cloudbase/utilities/dist/cjs/constants/errors.js"(exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.ERRORS = void 0;
    exports.ERRORS = {
      INVALID_PARAMS: "INVALID_PARAMS",
      INVALID_SYNTAX: "INVALID_SYNTAX",
      INVALID_OPERATION: "INVALID_OPERATION",
      OPERATION_FAIL: "OPERATION_FAIL",
      NETWORK_ERROR: "NETWORK_ERROR",
      UNKOWN_ERROR: "UNKOWN_ERROR"
    };
  }
});

// node_modules/@cloudbase/utilities/dist/cjs/constants/index.js
var require_constants = __commonJS({
  "node_modules/@cloudbase/utilities/dist/cjs/constants/index.js"(exports) {
    "use strict";
    var __createBinding = exports && exports.__createBinding || (Object.create ? function(o2, m2, k2, k22) {
      if (k22 === void 0) k22 = k2;
      var desc = Object.getOwnPropertyDescriptor(m2, k2);
      if (!desc || ("get" in desc ? !m2.__esModule : desc.writable || desc.configurable)) {
        desc = { enumerable: true, get: function() {
          return m2[k2];
        } };
      }
      Object.defineProperty(o2, k22, desc);
    } : function(o2, m2, k2, k22) {
      if (k22 === void 0) k22 = k2;
      o2[k22] = m2[k2];
    });
    var __exportStar = exports && exports.__exportStar || function(m2, exports2) {
      for (var p2 in m2) if (p2 !== "default" && !Object.prototype.hasOwnProperty.call(exports2, p2)) __createBinding(exports2, m2, p2);
    };
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.OATUH_LOGINTYPE = void 0;
    __exportStar(require_common(), exports);
    __exportStar(require_errors(), exports);
    exports.OATUH_LOGINTYPE = "constants";
  }
});

// node_modules/@cloudbase/utilities/dist/cjs/libs/util.js
var require_util = __commonJS({
  "node_modules/@cloudbase/utilities/dist/cjs/libs/util.js"(exports) {
    "use strict";
    var __rest9 = exports && exports.__rest || function(s2, e3) {
      var t3 = {};
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e3.indexOf(p2) < 0)
        t3[p2] = s2[p2];
      if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
          if (e3.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
            t3[p2[i2]] = s2[p2[i2]];
        }
      return t3;
    };
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.parseCaptcha = exports.parseQueryString = exports.transformPhone = exports.sleep = exports.printGroupLog = exports.throwError = exports.printInfo = exports.printError = exports.printWarn = exports.execCallback = exports.createPromiseCallback = exports.removeParam = exports.getHash = exports.getQuery = exports.toQueryString = exports.formatUrl = exports.generateRequestId = exports.genSeqId = exports.isFormData = exports.isInstanceOf = exports.isNull = exports.isPalinObject = exports.isUndefined = exports.isString = exports.isArray = void 0;
    var constants_1 = require_constants();
    function isArray4(val) {
      return Object.prototype.toString.call(val) === "[object Array]";
    }
    exports.isArray = isArray4;
    function isString4(val) {
      return typeof val === "string";
    }
    exports.isString = isString4;
    function isUndefined2(val) {
      return typeof val === "undefined";
    }
    exports.isUndefined = isUndefined2;
    function isPalinObject3(val) {
      return Object.prototype.toString.call(val) === "[object Object]";
    }
    exports.isPalinObject = isPalinObject3;
    function isNull2(val) {
      return Object.prototype.toString.call(val) === "[object Null]";
    }
    exports.isNull = isNull2;
    function isInstanceOf2(instance, construct2) {
      return instance instanceof construct2;
    }
    exports.isInstanceOf = isInstanceOf2;
    function isFormData3(val) {
      return Object.prototype.toString.call(val) === "[object FormData]";
    }
    exports.isFormData = isFormData3;
    function genSeqId3() {
      return Math.random().toString(16).slice(2);
    }
    exports.genSeqId = genSeqId3;
    function generateRequestId3() {
      var d2 = (/* @__PURE__ */ new Date()).getTime();
      var d22 = (Date === null || Date === void 0 ? void 0 : Date.now) && Date.now() * 1e3 || 0;
      return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c2) {
        var r3 = Math.random() * 16;
        if (d2 > 0) {
          r3 = (d2 + r3) % 16 | 0;
          d2 = Math.floor(d2 / 16);
        } else {
          r3 = (d22 + r3) % 16 | 0;
          d22 = Math.floor(d22 / 16);
        }
        return (c2 === "x" ? r3 : r3 & 7 | 8).toString(16);
      });
    }
    exports.generateRequestId = generateRequestId3;
    function formatUrl4(PROTOCOL2, url2, query) {
      if (query === void 0) {
        query = {};
      }
      var urlHasQuery = /\?/.test(url2);
      var queryString = "";
      Object.keys(query).forEach(function(key) {
        if (queryString === "") {
          !urlHasQuery && (url2 += "?");
        } else {
          queryString += "&";
        }
        queryString += "".concat(key, "=").concat(encodeURIComponent(query[key]));
      });
      url2 += queryString;
      if (/^http(s)?:\/\//.test(url2)) {
        return url2;
      }
      return "".concat(PROTOCOL2).concat(url2);
    }
    exports.formatUrl = formatUrl4;
    function toQueryString2(query) {
      if (query === void 0) {
        query = {};
      }
      var queryString = [];
      Object.keys(query).forEach(function(key) {
        queryString.push("".concat(key, "=").concat(encodeURIComponent(query[key])));
      });
      return queryString.join("&");
    }
    exports.toQueryString = toQueryString2;
    function getQuery2(name, url2) {
      if (typeof window === "undefined") {
        return false;
      }
      var u2 = url2 || decodeURIComponent(window.location.search);
      var reg = new RegExp("(^|&)".concat(name, "=([^&]*)(&|$)"));
      var r3 = u2.substr(u2.indexOf("?") + 1).match(reg);
      return r3 !== null && r3 !== void 0 ? r3[2] : "";
    }
    exports.getQuery = getQuery2;
    var getHash2 = function(name) {
      if (typeof window === "undefined") {
        return "";
      }
      var matches = window.location.hash.match(new RegExp("[#?&/]".concat(name, "=([^&#]*)")));
      return matches ? matches[1] : "";
    };
    exports.getHash = getHash2;
    function removeParam2(key, sourceURL) {
      var rtn = sourceURL.split("?")[0];
      var param;
      var params = [];
      var queryString = sourceURL.indexOf("?") !== -1 ? sourceURL.split("?")[1] : "";
      if (queryString !== "") {
        params = queryString.split("&");
        for (var i2 = params.length - 1; i2 >= 0; i2 -= 1) {
          param = params[i2].split("=")[0];
          if (param === key) {
            params.splice(i2, 1);
          }
        }
        rtn = "".concat(rtn, "?").concat(params.join("&"));
      }
      return rtn;
    }
    exports.removeParam = removeParam2;
    function createPromiseCallback3() {
      var cb = {};
      if (!Promise) {
        cb = function() {
        };
        cb.promise = {};
        var throwPromiseNotDefined = function() {
          throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.');
        };
        Object.defineProperty(cb.promise, "then", { get: throwPromiseNotDefined });
        Object.defineProperty(cb.promise, "catch", { get: throwPromiseNotDefined });
        return cb;
      }
      var promise = new Promise(function(resolve, reject) {
        cb = function(err, data2) {
          if (err)
            return reject(err);
          return resolve(data2);
        };
      });
      cb.promise = promise;
      return cb;
    }
    exports.createPromiseCallback = createPromiseCallback3;
    function execCallback4(fn, err, data2) {
      if (data2 === void 0) {
        data2 = null;
      }
      if (fn && typeof fn === "function") {
        return fn(err, data2);
      }
      if (err) {
        throw err;
      }
      return data2;
    }
    exports.execCallback = execCallback4;
    function printWarn4(error, msg) {
      console.warn("[".concat((0, constants_1.getSdkName)(), "][").concat(error, "]:").concat(msg));
    }
    exports.printWarn = printWarn4;
    function printError2(error, msg) {
      console.error({
        code: error,
        msg: "[".concat((0, constants_1.getSdkName)(), "][").concat(error, "]:").concat(msg)
      });
    }
    exports.printError = printError2;
    function printInfo2(error, msg) {
      console.log("[".concat((0, constants_1.getSdkName)(), "][").concat(error, "]:").concat(msg));
    }
    exports.printInfo = printInfo2;
    function throwError3(error, msg) {
      throw new Error(JSON.stringify({
        code: error,
        msg: "[".concat((0, constants_1.getSdkName)(), "][").concat(error, "]:").concat(msg)
      }));
    }
    exports.throwError = throwError3;
    function printGroupLog2(options) {
      var _a3;
      var title = options.title, _b = options.subtitle, subtitle = _b === void 0 ? "" : _b, _c = options.content, content = _c === void 0 ? [] : _c, _d = options.printTrace, printTrace = _d === void 0 ? false : _d, _e2 = options.collapsed, collapsed = _e2 === void 0 ? false : _e2;
      if (collapsed) {
        (console.groupCollapsed || console.error)(title, subtitle);
      } else {
        (console.group || console.error)(title, subtitle);
      }
      for (var _i = 0, content_1 = content; _i < content_1.length; _i++) {
        var tip = content_1[_i];
        var type = tip.type, body = tip.body;
        switch (type) {
          case "info":
            console.log(body);
            break;
          case "warn":
            console.warn(body);
            break;
          case "error":
            console.error(body);
            break;
        }
      }
      if (printTrace) {
        (console.trace || console.log)("stack trace:");
      }
      (_a3 = console.groupEnd) === null || _a3 === void 0 ? void 0 : _a3.call(console);
    }
    exports.printGroupLog = printGroupLog2;
    var sleep3 = function(ms) {
      if (ms === void 0) {
        ms = 0;
      }
      return new Promise(function(r3) {
        return setTimeout(r3, ms);
      });
    };
    exports.sleep = sleep3;
    function transformPhone2(phoneNumber) {
      return "+86".concat(phoneNumber);
    }
    exports.transformPhone = transformPhone2;
    var parseQueryString3 = function(queryString) {
      queryString = queryString.replace(/^\?/, "");
      var params = {};
      var pairs = queryString.split("&");
      pairs.forEach(function(item) {
        var _a3 = item.split("="), key = _a3[0], value = _a3[1];
        key = decodeURIComponent(key);
        value = decodeURIComponent(value);
        if (key) {
          if (params[key]) {
            if (Array.isArray(params[key])) {
              params[key].push(value);
            } else {
              params[key] = [params[key], value];
            }
          } else {
            params[key] = value;
          }
        }
      });
      return params;
    };
    exports.parseQueryString = parseQueryString3;
    function parseCaptcha3(url2) {
      var queryObj = {};
      var matched = url2.match(/^(data:.*?)(\?[^#\s]*)?$/);
      if (matched) {
        url2 = matched[1];
        var search = matched[2];
        if (search) {
          queryObj = (0, exports.parseQueryString)(search);
        }
      }
      var token = queryObj.token, restQueryObj = __rest9(queryObj, ["token"]);
      if (/^data:/.test(url2) && !token) {
        return {
          error: "invalid_argument",
          error_description: "invalid captcha data: ".concat(url2)
        };
      }
      if (!token) {
        return {
          error: "unimplemented",
          error_description: "need to impl captcha data"
        };
      }
      return {
        state: restQueryObj.state,
        token,
        captchaData: url2
      };
    }
    exports.parseCaptcha = parseCaptcha3;
  }
});

// node_modules/@cloudbase/utilities/dist/cjs/libs/events.js
var require_events = __commonJS({
  "node_modules/@cloudbase/utilities/dist/cjs/libs/events.js"(exports) {
    "use strict";
    var __extends16 = exports && exports.__extends || /* @__PURE__ */ function() {
      var extendStatics4 = function(d2, b2) {
        extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
          d3.__proto__ = b3;
        } || function(d3, b3) {
          for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
        };
        return extendStatics4(d2, b2);
      };
      return function(d2, b2) {
        if (typeof b2 !== "function" && b2 !== null)
          throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
        extendStatics4(d2, b2);
        function __() {
          this.constructor = d2;
        }
        d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
      };
    }();
    var __spreadArray7 = exports && exports.__spreadArray || function(to2, from2, pack) {
      if (pack || arguments.length === 2) for (var i2 = 0, l2 = from2.length, ar2; i2 < l2; i2++) {
        if (ar2 || !(i2 in from2)) {
          if (!ar2) ar2 = Array.prototype.slice.call(from2, 0, i2);
          ar2[i2] = from2[i2];
        }
      }
      return to2.concat(ar2 || Array.prototype.slice.call(from2));
    };
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.removeEventListener = exports.activateEvent = exports.addEventListener = exports.CloudbaseEventEmitter = exports.IErrorEvent = exports.CloudbaseEvent = void 0;
    var util_1 = require_util();
    function customeAddEventListener2(name, listener, listeners) {
      listeners[name] = listeners[name] || [];
      listeners[name].push(listener);
    }
    function customRemoveEventListener2(name, listener, listeners) {
      if (listeners === null || listeners === void 0 ? void 0 : listeners[name]) {
        var index = listeners[name].indexOf(listener);
        if (index !== -1) {
          listeners[name].splice(index, 1);
        }
      }
    }
    var CloudbaseEvent2 = /* @__PURE__ */ function() {
      function CloudbaseEvent3(name, data2) {
        this.data = data2 || null;
        this.name = name;
      }
      return CloudbaseEvent3;
    }();
    exports.CloudbaseEvent = CloudbaseEvent2;
    var IErrorEvent2 = function(_super) {
      __extends16(IErrorEvent3, _super);
      function IErrorEvent3(error, data2) {
        var _this = _super.call(this, "error", { error, data: data2 }) || this;
        _this.error = error;
        return _this;
      }
      return IErrorEvent3;
    }(CloudbaseEvent2);
    exports.IErrorEvent = IErrorEvent2;
    var CloudbaseEventEmitter5 = function() {
      function CloudbaseEventEmitter6() {
        this.listeners = {};
      }
      CloudbaseEventEmitter6.prototype.on = function(name, listener) {
        customeAddEventListener2(name, listener, this.listeners);
        return this;
      };
      CloudbaseEventEmitter6.prototype.off = function(name, listener) {
        customRemoveEventListener2(name, listener, this.listeners);
        return this;
      };
      CloudbaseEventEmitter6.prototype.fire = function(event, data2) {
        if ((0, util_1.isInstanceOf)(event, IErrorEvent2)) {
          console.error(event.error);
          return this;
        }
        var ev = (0, util_1.isString)(event) ? new CloudbaseEvent2(event, data2 || {}) : event;
        var name = ev.name;
        if (this.listens(name)) {
          ev.target = this;
          var handlers = this.listeners[name] ? __spreadArray7([], this.listeners[name], true) : [];
          for (var _i = 0, handlers_1 = handlers; _i < handlers_1.length; _i++) {
            var fn = handlers_1[_i];
            fn.call(this, ev);
          }
        }
        return this;
      };
      CloudbaseEventEmitter6.prototype.listens = function(name) {
        return this.listeners[name] && this.listeners[name].length > 0;
      };
      return CloudbaseEventEmitter6;
    }();
    exports.CloudbaseEventEmitter = CloudbaseEventEmitter5;
    var eventEmitter2 = new CloudbaseEventEmitter5();
    function addEventListener2(event, callback) {
      eventEmitter2.on(event, callback);
    }
    exports.addEventListener = addEventListener2;
    function activateEvent2(event, data2) {
      if (data2 === void 0) {
        data2 = {};
      }
      eventEmitter2.fire(event, data2);
    }
    exports.activateEvent = activateEvent2;
    function removeEventListener2(event, callback) {
      eventEmitter2.off(event, callback);
    }
    exports.removeEventListener = removeEventListener2;
  }
});

// node_modules/@cloudbase/utilities/dist/cjs/helpers/decorators.js
var require_decorators = __commonJS({
  "node_modules/@cloudbase/utilities/dist/cjs/helpers/decorators.js"(exports) {
    "use strict";
    var __awaiter41 = exports && exports.__awaiter || function(thisArg, _arguments, P2, generator) {
      function adopt(value) {
        return value instanceof P2 ? value : new P2(function(resolve) {
          resolve(value);
        });
      }
      return new (P2 || (P2 = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e3) {
            reject(e3);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e3) {
            reject(e3);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator41 = exports && exports.__generator || function(thisArg, body) {
      var _2 = { label: 0, sent: function() {
        if (t3[0] & 1) throw t3[1];
        return t3[1];
      }, trys: [], ops: [] }, f2, y2, t3, g2;
      return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
        return this;
      }), g2;
      function verb(n3) {
        return function(v2) {
          return step([n3, v2]);
        };
      }
      function step(op) {
        if (f2) throw new TypeError("Generator is already executing.");
        while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
          if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
          if (y2 = 0, t3) op = [op[0] & 2, t3.value];
          switch (op[0]) {
            case 0:
            case 1:
              t3 = op;
              break;
            case 4:
              _2.label++;
              return { value: op[1], done: false };
            case 5:
              _2.label++;
              y2 = op[1];
              op = [0];
              continue;
            case 7:
              op = _2.ops.pop();
              _2.trys.pop();
              continue;
            default:
              if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
                _2 = 0;
                continue;
              }
              if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
                _2.label = op[1];
                break;
              }
              if (op[0] === 6 && _2.label < t3[1]) {
                _2.label = t3[1];
                t3 = op;
                break;
              }
              if (t3 && _2.label < t3[2]) {
                _2.label = t3[2];
                _2.ops.push(op);
                break;
              }
              if (t3[2]) _2.ops.pop();
              _2.trys.pop();
              continue;
          }
          op = body.call(thisArg, _2);
        } catch (e3) {
          op = [6, e3];
          y2 = 0;
        } finally {
          f2 = t3 = 0;
        }
        if (op[0] & 5) throw op[1];
        return { value: op[0] ? op[1] : void 0, done: true };
      }
    };
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.catchErrorsDecorator = void 0;
    var util_1 = require_util();
    var constants_1 = require_constants();
    var isFirefox2 = false;
    if (typeof navigator !== "undefined" && navigator.userAgent) {
      isFirefox2 = navigator.userAgent.indexOf("Firefox") !== -1;
    }
    var REG_STACK_DECORATE2 = isFirefox2 ? /(\.js\/)?__decorate(\$\d+)?<@.*\d$/ : /(\/\w+\.js\.)?__decorate(\$\d+)?\s*\(.*\)$/;
    var REG_STACK_LINK2 = /https?:\/\/.+:\d*\/.*\.js:\d+:\d+/;
    function catchErrorsDecorator7(options) {
      var _a3 = options.mode, mode = _a3 === void 0 ? "async" : _a3, _b = options.customInfo, customInfo = _b === void 0 ? {} : _b, title = options.title, _c = options.messages, messages = _c === void 0 ? [] : _c;
      return function(target, methodName, descriptor) {
        if (!constants_1.IS_DEBUG_MODE) {
          return;
        }
        var className = customInfo.className || target.constructor.name;
        var fnName = customInfo.methodName || methodName;
        var fn = descriptor.value;
        var sourceLink = getSourceLink2(new Error());
        if (mode === "sync") {
          descriptor.value = function() {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
              args[_i] = arguments[_i];
            }
            var innerErr = getRewritedError2({
              err: new Error(),
              className,
              methodName: fnName,
              sourceLink
            });
            try {
              return fn.apply(this, args);
            } catch (err) {
              var failErr = err;
              var errMsg = err.message, error = err.error, errorDescription = err.error_description;
              var logs = {
                title: title || "".concat(className, ".").concat(fnName, " failed"),
                content: [{
                  type: "error",
                  body: err
                }]
              };
              if (errMsg && /^\{.*\}$/.test(errMsg)) {
                var msg = JSON.parse(errMsg);
                logs.subtitle = errMsg;
                if (msg.code) {
                  if (innerErr) {
                    innerErr.code = msg.code;
                    innerErr.msg = msg.msg;
                  } else {
                    err.code = msg.code;
                    err.message = msg.msg;
                  }
                  failErr = innerErr || err;
                  logs.content = messages.map(function(msg2) {
                    return {
                      type: "info",
                      body: msg2
                    };
                  });
                }
              }
              if (error && errorDescription) {
                logs.subtitle = errorDescription;
                if (innerErr) {
                  innerErr.code = error;
                  innerErr.msg = errorDescription;
                } else {
                  err.code = error;
                  err.message = errorDescription;
                }
                failErr = innerErr || err;
                logs.content = messages.map(function(msg2) {
                  return {
                    type: "info",
                    body: msg2
                  };
                });
              }
              (0, util_1.printGroupLog)(logs);
              throw failErr;
            }
          };
        } else {
          descriptor.value = function() {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
              args[_i] = arguments[_i];
            }
            return __awaiter41(this, void 0, void 0, function() {
              var innerErr, err_1, failErr, errMsg, error, errorDescription, logs, msg;
              return __generator41(this, function(_a4) {
                switch (_a4.label) {
                  case 0:
                    innerErr = getRewritedError2({
                      err: new Error(),
                      className,
                      methodName: fnName,
                      sourceLink
                    });
                    _a4.label = 1;
                  case 1:
                    _a4.trys.push([1, 3, , 4]);
                    return [4, fn.apply(this, args)];
                  case 2:
                    return [2, _a4.sent()];
                  case 3:
                    err_1 = _a4.sent();
                    failErr = err_1;
                    errMsg = err_1.message, error = err_1.error, errorDescription = err_1.error_description;
                    logs = {
                      title: title || "".concat(className, ".").concat(fnName, " failed"),
                      content: [{
                        type: "error",
                        body: err_1
                      }]
                    };
                    if (errMsg && /^\{.*\}$/.test(errMsg)) {
                      msg = JSON.parse(errMsg);
                      logs.subtitle = msg;
                      if (msg.code) {
                        if (innerErr) {
                          innerErr.code = msg.code;
                          innerErr.message = msg.msg;
                        } else {
                          err_1.code = msg.code;
                          err_1.message = msg.msg;
                        }
                        failErr = innerErr || err_1;
                        logs.content = messages.map(function(msg2) {
                          return {
                            type: "info",
                            body: msg2
                          };
                        });
                      }
                    }
                    if (error && errorDescription) {
                      logs.subtitle = errorDescription;
                      if (innerErr) {
                        innerErr.code = error;
                        innerErr.msg = errorDescription;
                      } else {
                        err_1.code = error;
                        err_1.message = errorDescription;
                      }
                      failErr = innerErr || err_1;
                      logs.content = messages.map(function(msg2) {
                        return {
                          type: "info",
                          body: msg2
                        };
                      });
                    }
                    (0, util_1.printGroupLog)(logs);
                    throw failErr;
                  case 4:
                    return [2];
                }
              });
            });
          };
        }
      };
    }
    exports.catchErrorsDecorator = catchErrorsDecorator7;
    function getSourceLink2(err) {
      var sourceLink = "";
      var outterErrStacks = err.stack.split("\n");
      var indexOfDecorator = outterErrStacks.findIndex(function(str) {
        return REG_STACK_DECORATE2.test(str);
      });
      if (indexOfDecorator !== -1) {
        var match2 = REG_STACK_LINK2.exec(outterErrStacks[indexOfDecorator + 1] || "");
        sourceLink = match2 ? match2[0] : "";
      }
      return sourceLink;
    }
    function getRewritedError2(options) {
      var err = options.err, className = options.className, methodName = options.methodName, sourceLink = options.sourceLink;
      if (!sourceLink) {
        return null;
      }
      var innerErrStack = err.stack.split("\n");
      var REG_STACK_INNER_METHOD = isFirefox2 ? /^catchErrorsDecorator\/<\/descriptor.value@.*\d$/ : new RegExp("".concat(className, "\\.descriptor.value\\s*\\[as\\s").concat(methodName, "\\]\\s*\\(.*\\)$"));
      var REG_STACK_INNER_METHOD_WITHOUT_LINK = isFirefox2 ? /^catchErrorsDecorator\/<\/descriptor.value/ : new RegExp("".concat(className, "\\.descriptor.value\\s*\\[as\\s").concat(methodName, "\\]"));
      var indexOfSource = innerErrStack.findIndex(function(str) {
        return REG_STACK_INNER_METHOD.test(str);
      });
      var innerErr;
      if (indexOfSource !== -1) {
        var realErrStack = innerErrStack.filter(function(v2, i2) {
          return i2 > indexOfSource;
        });
        realErrStack.unshift(innerErrStack[indexOfSource].replace(REG_STACK_INNER_METHOD_WITHOUT_LINK, "".concat(className, ".").concat(methodName)).replace(REG_STACK_LINK2, sourceLink));
        innerErr = new Error();
        innerErr.stack = "".concat(isFirefox2 ? "@debugger" : "Error", "\n").concat(realErrStack.join("\n"));
      }
      return innerErr;
    }
  }
});

// node_modules/@cloudbase/utilities/dist/cjs/helpers/index.js
var require_helpers = __commonJS({
  "node_modules/@cloudbase/utilities/dist/cjs/helpers/index.js"(exports) {
    "use strict";
    var __createBinding = exports && exports.__createBinding || (Object.create ? function(o2, m2, k2, k22) {
      if (k22 === void 0) k22 = k2;
      var desc = Object.getOwnPropertyDescriptor(m2, k2);
      if (!desc || ("get" in desc ? !m2.__esModule : desc.writable || desc.configurable)) {
        desc = { enumerable: true, get: function() {
          return m2[k2];
        } };
      }
      Object.defineProperty(o2, k22, desc);
    } : function(o2, m2, k2, k22) {
      if (k22 === void 0) k22 = k2;
      o2[k22] = m2[k2];
    });
    var __exportStar = exports && exports.__exportStar || function(m2, exports2) {
      for (var p2 in m2) if (p2 !== "default" && !Object.prototype.hasOwnProperty.call(exports2, p2)) __createBinding(exports2, m2, p2);
    };
    Object.defineProperty(exports, "__esModule", { value: true });
    __exportStar(require_decorators(), exports);
  }
});

// node_modules/@cloudbase/utilities/dist/cjs/libs/cache.js
var require_cache = __commonJS({
  "node_modules/@cloudbase/utilities/dist/cjs/libs/cache.js"(exports) {
    "use strict";
    var __extends16 = exports && exports.__extends || /* @__PURE__ */ function() {
      var extendStatics4 = function(d2, b2) {
        extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
          d3.__proto__ = b3;
        } || function(d3, b3) {
          for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
        };
        return extendStatics4(d2, b2);
      };
      return function(d2, b2) {
        if (typeof b2 !== "function" && b2 !== null)
          throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
        extendStatics4(d2, b2);
        function __() {
          this.constructor = d2;
        }
        d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
      };
    }();
    var __awaiter41 = exports && exports.__awaiter || function(thisArg, _arguments, P2, generator) {
      function adopt(value) {
        return value instanceof P2 ? value : new P2(function(resolve) {
          resolve(value);
        });
      }
      return new (P2 || (P2 = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e3) {
            reject(e3);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e3) {
            reject(e3);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator41 = exports && exports.__generator || function(thisArg, body) {
      var _2 = { label: 0, sent: function() {
        if (t3[0] & 1) throw t3[1];
        return t3[1];
      }, trys: [], ops: [] }, f2, y2, t3, g2;
      return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
        return this;
      }), g2;
      function verb(n3) {
        return function(v2) {
          return step([n3, v2]);
        };
      }
      function step(op) {
        if (f2) throw new TypeError("Generator is already executing.");
        while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
          if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
          if (y2 = 0, t3) op = [op[0] & 2, t3.value];
          switch (op[0]) {
            case 0:
            case 1:
              t3 = op;
              break;
            case 4:
              _2.label++;
              return { value: op[1], done: false };
            case 5:
              _2.label++;
              y2 = op[1];
              op = [0];
              continue;
            case 7:
              op = _2.ops.pop();
              _2.trys.pop();
              continue;
            default:
              if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
                _2 = 0;
                continue;
              }
              if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
                _2.label = op[1];
                break;
              }
              if (op[0] === 6 && _2.label < t3[1]) {
                _2.label = t3[1];
                t3 = op;
                break;
              }
              if (t3 && _2.label < t3[2]) {
                _2.label = t3[2];
                _2.ops.push(op);
                break;
              }
              if (t3[2]) _2.ops.pop();
              _2.trys.pop();
              continue;
          }
          op = body.call(thisArg, _2);
        } catch (e3) {
          op = [6, e3];
          y2 = 0;
        } finally {
          f2 = t3 = 0;
        }
        if (op[0] & 5) throw op[1];
        return { value: op[0] ? op[1] : void 0, done: true };
      }
    };
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.CloudbaseCache = void 0;
    var adapter_interface_1 = (init_esm(), __toCommonJS(esm_exports));
    var util_1 = require_util();
    var constants_1 = require_constants();
    var TcbCacheObject2 = function(_super) {
      __extends16(TcbCacheObject3, _super);
      function TcbCacheObject3(root) {
        var _this = _super.call(this) || this;
        _this.root = root;
        if (!root.tcbCacheObject) {
          root.tcbCacheObject = {};
        }
        return _this;
      }
      TcbCacheObject3.prototype.setItem = function(key, value) {
        this.root.tcbCacheObject[key] = value;
      };
      TcbCacheObject3.prototype.getItem = function(key) {
        return this.root.tcbCacheObject[key];
      };
      TcbCacheObject3.prototype.removeItem = function(key) {
        delete this.root.tcbCacheObject[key];
      };
      TcbCacheObject3.prototype.clear = function() {
        delete this.root.tcbCacheObject;
      };
      return TcbCacheObject3;
    }(adapter_interface_1.AbstractStorage);
    function createStorage2(persistence, adapter2) {
      switch (persistence) {
        case "local":
          if (!adapter2.localStorage) {
            (0, util_1.printWarn)(constants_1.ERRORS.INVALID_PARAMS, "localStorage is not supported on current platform");
            return new TcbCacheObject2(adapter2.root);
          }
          return adapter2.localStorage;
        case "none":
          return new TcbCacheObject2(adapter2.root);
        default:
          if (!adapter2.localStorage) {
            (0, util_1.printWarn)(constants_1.ERRORS.INVALID_PARAMS, "localStorage is not supported on current platform");
            return new TcbCacheObject2(adapter2.root);
          }
          return adapter2.localStorage;
      }
    }
    var CloudbaseCache4 = function() {
      function CloudbaseCache5(config) {
        this.keys = {};
        var persistence = config.persistence, _a3 = config.platformInfo, platformInfo = _a3 === void 0 ? {} : _a3, _b = config.keys, keys4 = _b === void 0 ? {} : _b;
        this.platformInfo = platformInfo;
        if (!this.storage) {
          this.persistenceTag = this.platformInfo.adapter.primaryStorage || persistence;
          this.storage = createStorage2(this.persistenceTag, this.platformInfo.adapter);
          this.keys = keys4;
        }
      }
      Object.defineProperty(CloudbaseCache5.prototype, "mode", {
        get: function() {
          return this.storage.mode || "sync";
        },
        enumerable: false,
        configurable: true
      });
      Object.defineProperty(CloudbaseCache5.prototype, "persistence", {
        get: function() {
          return this.persistenceTag;
        },
        enumerable: false,
        configurable: true
      });
      CloudbaseCache5.prototype.setStore = function(key, value, version3) {
        if (this.mode === "async") {
          (0, util_1.printWarn)(constants_1.ERRORS.INVALID_OPERATION, "current platform's storage is asynchronous, please use setStoreAsync insteed");
          return;
        }
        if (!this.storage) {
          return;
        }
        try {
          var val = {
            version: version3 || "localCachev1",
            content: value
          };
          this.storage.setItem(key, JSON.stringify(val));
        } catch (e3) {
          throw new Error(JSON.stringify({
            code: constants_1.ERRORS.OPERATION_FAIL,
            msg: "[".concat((0, constants_1.getSdkName)(), "][").concat(constants_1.ERRORS.OPERATION_FAIL, "]setStore failed"),
            info: e3
          }));
        }
        return;
      };
      CloudbaseCache5.prototype.setStoreAsync = function(key, value, version3) {
        return __awaiter41(this, void 0, void 0, function() {
          var val, e_1;
          return __generator41(this, function(_a3) {
            switch (_a3.label) {
              case 0:
                if (!this.storage) {
                  return [2];
                }
                _a3.label = 1;
              case 1:
                _a3.trys.push([1, 3, , 4]);
                val = {
                  version: version3 || "localCachev1",
                  content: value
                };
                return [4, this.storage.setItem(key, JSON.stringify(val))];
              case 2:
                _a3.sent();
                return [3, 4];
              case 3:
                e_1 = _a3.sent();
                return [2];
              case 4:
                return [2];
            }
          });
        });
      };
      CloudbaseCache5.prototype.getStore = function(key, version3) {
        var _a3;
        if (this.mode === "async") {
          (0, util_1.printWarn)(constants_1.ERRORS.INVALID_OPERATION, "current platform's storage is asynchronous, please use getStoreAsync insteed");
          return;
        }
        try {
          if (typeof process !== "undefined" && ((_a3 = process.env) === null || _a3 === void 0 ? void 0 : _a3.tcb_token)) {
            return process.env.tcb_token;
          }
          if (!this.storage) {
            return "";
          }
        } catch (e3) {
          return "";
        }
        version3 = version3 || "localCachev1";
        var content = this.storage.getItem(key);
        if (!content) {
          return "";
        }
        if (content.indexOf(version3) >= 0) {
          var d2 = JSON.parse(content);
          return d2.content;
        }
        return "";
      };
      CloudbaseCache5.prototype.getStoreAsync = function(key, version3) {
        var _a3;
        return __awaiter41(this, void 0, void 0, function() {
          var content, d2;
          return __generator41(this, function(_b) {
            switch (_b.label) {
              case 0:
                try {
                  if (typeof process !== "undefined" && ((_a3 = process.env) === null || _a3 === void 0 ? void 0 : _a3.tcb_token)) {
                    return [2, process.env.tcb_token];
                  }
                  if (!this.storage) {
                    return [2, ""];
                  }
                } catch (e3) {
                  return [2, ""];
                }
                version3 = version3 || "localCachev1";
                return [4, this.storage.getItem(key)];
              case 1:
                content = _b.sent();
                if (!content) {
                  return [2, ""];
                }
                if (content.indexOf(version3) >= 0) {
                  d2 = JSON.parse(content);
                  return [2, d2.content];
                }
                return [2, ""];
            }
          });
        });
      };
      CloudbaseCache5.prototype.removeStore = function(key) {
        if (this.mode === "async") {
          (0, util_1.printWarn)(constants_1.ERRORS.INVALID_OPERATION, "current platform's storage is asynchronous, please use removeStoreAsync insteed");
          return;
        }
        this.storage.removeItem(key);
      };
      CloudbaseCache5.prototype.removeStoreAsync = function(key) {
        return __awaiter41(this, void 0, void 0, function() {
          return __generator41(this, function(_a3) {
            switch (_a3.label) {
              case 0:
                return [4, this.storage.removeItem(key)];
              case 1:
                _a3.sent();
                return [2];
            }
          });
        });
      };
      return CloudbaseCache5;
    }();
    exports.CloudbaseCache = CloudbaseCache4;
  }
});

// node_modules/@cloudbase/utilities/dist/cjs/adapters/platforms/web.js
var require_web = __commonJS({
  "node_modules/@cloudbase/utilities/dist/cjs/adapters/platforms/web.js"(exports) {
    "use strict";
    var __extends16 = exports && exports.__extends || /* @__PURE__ */ function() {
      var extendStatics4 = function(d2, b2) {
        extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
          d3.__proto__ = b3;
        } || function(d3, b3) {
          for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
        };
        return extendStatics4(d2, b2);
      };
      return function(d2, b2) {
        if (typeof b2 !== "function" && b2 !== null)
          throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
        extendStatics4(d2, b2);
        function __() {
          this.constructor = d2;
        }
        d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
      };
    }();
    var __assign43 = exports && exports.__assign || function() {
      __assign43 = Object.assign || function(t3) {
        for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
          s2 = arguments[i2];
          for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
            t3[p2] = s2[p2];
        }
        return t3;
      };
      return __assign43.apply(this, arguments);
    };
    var __awaiter41 = exports && exports.__awaiter || function(thisArg, _arguments, P2, generator) {
      function adopt(value) {
        return value instanceof P2 ? value : new P2(function(resolve) {
          resolve(value);
        });
      }
      return new (P2 || (P2 = Promise))(function(resolve, reject) {
        function fulfilled(value) {
          try {
            step(generator.next(value));
          } catch (e3) {
            reject(e3);
          }
        }
        function rejected(value) {
          try {
            step(generator["throw"](value));
          } catch (e3) {
            reject(e3);
          }
        }
        function step(result) {
          result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
      });
    };
    var __generator41 = exports && exports.__generator || function(thisArg, body) {
      var _2 = { label: 0, sent: function() {
        if (t3[0] & 1) throw t3[1];
        return t3[1];
      }, trys: [], ops: [] }, f2, y2, t3, g2;
      return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
        return this;
      }), g2;
      function verb(n3) {
        return function(v2) {
          return step([n3, v2]);
        };
      }
      function step(op) {
        if (f2) throw new TypeError("Generator is already executing.");
        while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
          if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
          if (y2 = 0, t3) op = [op[0] & 2, t3.value];
          switch (op[0]) {
            case 0:
            case 1:
              t3 = op;
              break;
            case 4:
              _2.label++;
              return { value: op[1], done: false };
            case 5:
              _2.label++;
              y2 = op[1];
              op = [0];
              continue;
            case 7:
              op = _2.ops.pop();
              _2.trys.pop();
              continue;
            default:
              if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
                _2 = 0;
                continue;
              }
              if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
                _2.label = op[1];
                break;
              }
              if (op[0] === 6 && _2.label < t3[1]) {
                _2.label = t3[1];
                t3 = op;
                break;
              }
              if (t3 && _2.label < t3[2]) {
                _2.label = t3[2];
                _2.ops.push(op);
                break;
              }
              if (t3[2]) _2.ops.pop();
              _2.trys.pop();
              continue;
          }
          op = body.call(thisArg, _2);
        } catch (e3) {
          op = [6, e3];
          y2 = 0;
        } finally {
          f2 = t3 = 0;
        }
        if (op[0] & 5) throw op[1];
        return { value: op[0] ? op[1] : void 0, done: true };
      }
    };
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.WebRequest = exports.genAdapter = void 0;
    var adapter_interface_1 = (init_esm(), __toCommonJS(esm_exports));
    var util_1 = require_util();
    var common_1 = require_common();
    var WebRequest2 = function(_super) {
      __extends16(WebRequest3, _super);
      function WebRequest3(config) {
        var _this = _super.call(this) || this;
        var timeout = config.timeout, timeoutMsg = config.timeoutMsg, restrictedMethods = config.restrictedMethods;
        _this.timeout = timeout || 0;
        _this.timeoutMsg = timeoutMsg || "";
        _this.restrictedMethods = restrictedMethods || ["get", "post", "upload", "download"];
        return _this;
      }
      WebRequest3.prototype.get = function(options) {
        return this.request(__assign43(__assign43({}, options), { method: "get" }), this.restrictedMethods.includes("get"));
      };
      WebRequest3.prototype.post = function(options) {
        return this.request(__assign43(__assign43({}, options), { method: "post" }), this.restrictedMethods.includes("post"));
      };
      WebRequest3.prototype.put = function(options) {
        return this.request(__assign43(__assign43({}, options), { method: "put" }));
      };
      WebRequest3.prototype.upload = function(options) {
        var data2 = options.data, file = options.file, name = options.name, method = options.method, _a3 = options.headers, headers = _a3 === void 0 ? {} : _a3;
        var reqMethod = { post: "post", put: "put" }[method === null || method === void 0 ? void 0 : method.toLowerCase()] || "put";
        var formData = new FormData();
        if (reqMethod === "post") {
          Object.keys(data2).forEach(function(key) {
            formData.append(key, data2[key]);
          });
          formData.append("key", name);
          formData.append("file", file);
          return this.request(__assign43(__assign43({}, options), { data: formData, method: reqMethod }), this.restrictedMethods.includes("upload"));
        }
        return this.request(__assign43(__assign43({}, options), { method: "put", headers, body: file }), this.restrictedMethods.includes("upload"));
      };
      WebRequest3.prototype.download = function(options) {
        return __awaiter41(this, void 0, void 0, function() {
          var data2, url2, fileName, link, e_1;
          return __generator41(this, function(_a3) {
            switch (_a3.label) {
              case 0:
                _a3.trys.push([0, 2, , 3]);
                return [4, this.get(__assign43(__assign43({}, options), { headers: {}, responseType: "blob" }))];
              case 1:
                data2 = _a3.sent().data;
                url2 = window.URL.createObjectURL(new Blob([data2]));
                fileName = decodeURIComponent(new URL(options.url).pathname.split("/").pop() || "");
                link = document.createElement("a");
                link.href = url2;
                link.setAttribute("download", fileName);
                link.style.display = "none";
                document.body.appendChild(link);
                link.click();
                window.URL.revokeObjectURL(url2);
                document.body.removeChild(link);
                return [3, 3];
              case 2:
                e_1 = _a3.sent();
                return [3, 3];
              case 3:
                return [2, new Promise(function(resolve) {
                  resolve({
                    statusCode: 200,
                    tempFilePath: options.url
                  });
                })];
            }
          });
        });
      };
      WebRequest3.prototype.fetch = function(options) {
        var _a3;
        return __awaiter41(this, void 0, void 0, function() {
          var abortController, url2, _b, enableAbort, _c, stream, signal, _timeout, _d, shouldThrowOnError, timeout, timer, res;
          var _this = this;
          return __generator41(this, function(_e2) {
            switch (_e2.label) {
              case 0:
                abortController = new AbortController();
                url2 = options.url, _b = options.enableAbort, enableAbort = _b === void 0 ? false : _b, _c = options.stream, stream = _c === void 0 ? false : _c, signal = options.signal, _timeout = options.timeout, _d = options.shouldThrowOnError, shouldThrowOnError = _d === void 0 ? true : _d;
                timeout = _timeout !== null && _timeout !== void 0 ? _timeout : this.timeout;
                if (signal) {
                  if (signal.aborted)
                    abortController.abort();
                  signal.addEventListener("abort", function() {
                    return abortController.abort();
                  });
                }
                timer = null;
                if (enableAbort && timeout) {
                  timer = setTimeout(function() {
                    console.warn(_this.timeoutMsg);
                    abortController.abort(new Error(_this.timeoutMsg));
                  }, timeout);
                }
                return [4, fetch(url2, __assign43(__assign43({}, options), { signal: abortController.signal })).then(function(response) {
                  return __awaiter41(_this, void 0, void 0, function() {
                    var _a4, _b2, _c2;
                    return __generator41(this, function(_d2) {
                      switch (_d2.label) {
                        case 0:
                          clearTimeout(timer);
                          if (!shouldThrowOnError) return [3, 4];
                          if (!response.ok) return [3, 1];
                          _a4 = response;
                          return [3, 3];
                        case 1:
                          _c2 = (_b2 = Promise).reject;
                          return [4, response.json()];
                        case 2:
                          _a4 = _c2.apply(_b2, [_d2.sent()]);
                          _d2.label = 3;
                        case 3:
                          return [2, _a4];
                        case 4:
                          return [2, response];
                      }
                    });
                  });
                }).catch(function(x2) {
                  clearTimeout(timer);
                  if (shouldThrowOnError) {
                    return Promise.reject(x2);
                  }
                })];
              case 1:
                res = _e2.sent();
                return [2, {
                  data: stream ? res.body : ((_a3 = res.headers.get("content-type")) === null || _a3 === void 0 ? void 0 : _a3.includes("application/json")) ? res.json() : res.text(),
                  statusCode: res.status,
                  header: res.headers
                }];
            }
          });
        });
      };
      WebRequest3.prototype.request = function(options, enableAbort) {
        var _this = this;
        if (enableAbort === void 0) {
          enableAbort = false;
        }
        var method = String(options.method).toLowerCase() || "get";
        return new Promise(function(resolve) {
          var url2 = options.url, _a3 = options.headers, headers = _a3 === void 0 ? {} : _a3, data2 = options.data, responseType = options.responseType, withCredentials = options.withCredentials, body = options.body, onUploadProgress = options.onUploadProgress;
          var realUrl = (0, util_1.formatUrl)((0, common_1.getProtocol)(), url2, method === "get" ? data2 : {});
          var ajax = new XMLHttpRequest();
          ajax.open(method, realUrl);
          responseType && (ajax.responseType = responseType);
          Object.keys(headers).forEach(function(key) {
            ajax.setRequestHeader(key, headers[key]);
          });
          var timer;
          if (onUploadProgress) {
            ajax.upload.addEventListener("progress", onUploadProgress);
          }
          ajax.onreadystatechange = function() {
            var result = {};
            if (ajax.readyState === 4) {
              var headers_1 = ajax.getAllResponseHeaders();
              var arr = headers_1.trim().split(/[\r\n]+/);
              var headerMap_1 = {};
              arr.forEach(function(line) {
                var parts = line.split(": ");
                var header = parts.shift().toLowerCase();
                var value = parts.join(": ");
                headerMap_1[header] = value;
              });
              result.header = headerMap_1;
              result.statusCode = ajax.status;
              try {
                result.data = responseType === "blob" ? ajax.response : JSON.parse(ajax.responseText);
              } catch (e3) {
                result.data = responseType === "blob" ? ajax.response : ajax.responseText;
              }
              clearTimeout(timer);
              resolve(result);
            }
          };
          if (enableAbort && _this.timeout) {
            timer = setTimeout(function() {
              console.warn(_this.timeoutMsg);
              ajax.abort();
            }, _this.timeout);
          }
          var payload;
          if ((0, util_1.isFormData)(data2)) {
            payload = data2;
          } else if (headers["content-type"] === "application/x-www-form-urlencoded") {
            payload = (0, util_1.toQueryString)(data2);
          } else if (body) {
            payload = body;
          } else {
            payload = data2 ? JSON.stringify(data2) : void 0;
          }
          if (withCredentials) {
            ajax.withCredentials = true;
          }
          ajax.send(payload);
        });
      };
      return WebRequest3;
    }(adapter_interface_1.AbstractSDKRequest);
    exports.WebRequest = WebRequest2;
    function genAdapter3() {
      var adapter2 = {
        type: "default",
        root: window,
        reqClass: WebRequest2,
        wsClass: WebSocket,
        localStorage
      };
      return adapter2;
    }
    exports.genAdapter = genAdapter3;
  }
});

// node_modules/@cloudbase/utilities/dist/cjs/adapters/index.js
var require_adapters = __commonJS({
  "node_modules/@cloudbase/utilities/dist/cjs/adapters/index.js"(exports) {
    "use strict";
    var __assign43 = exports && exports.__assign || function() {
      __assign43 = Object.assign || function(t3) {
        for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
          s2 = arguments[i2];
          for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
            t3[p2] = s2[p2];
        }
        return t3;
      };
      return __assign43.apply(this, arguments);
    };
    var __createBinding = exports && exports.__createBinding || (Object.create ? function(o2, m2, k2, k22) {
      if (k22 === void 0) k22 = k2;
      var desc = Object.getOwnPropertyDescriptor(m2, k2);
      if (!desc || ("get" in desc ? !m2.__esModule : desc.writable || desc.configurable)) {
        desc = { enumerable: true, get: function() {
          return m2[k2];
        } };
      }
      Object.defineProperty(o2, k22, desc);
    } : function(o2, m2, k2, k22) {
      if (k22 === void 0) k22 = k2;
      o2[k22] = m2[k2];
    });
    var __setModuleDefault = exports && exports.__setModuleDefault || (Object.create ? function(o2, v2) {
      Object.defineProperty(o2, "default", { enumerable: true, value: v2 });
    } : function(o2, v2) {
      o2["default"] = v2;
    });
    var __importStar = exports && exports.__importStar || function(mod) {
      if (mod && mod.__esModule) return mod;
      var result = {};
      if (mod != null) {
        for (var k2 in mod) if (k2 !== "default" && Object.prototype.hasOwnProperty.call(mod, k2)) __createBinding(result, mod, k2);
      }
      __setModuleDefault(result, mod);
      return result;
    };
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.useDefaultAdapter = exports.useAdapters = exports.RUNTIME = void 0;
    var Web = __importStar(require_web());
    var util_1 = require_util();
    var RUNTIME2;
    (function(RUNTIME3) {
      RUNTIME3["WEB"] = "web";
      RUNTIME3["WX_MP"] = "wx_mp";
    })(RUNTIME2 = exports.RUNTIME || (exports.RUNTIME = {}));
    function useAdapters3(adapters, options) {
      var adapterList = (0, util_1.isArray)(adapters) ? adapters : [adapters];
      for (var _i = 0, adapterList_1 = adapterList; _i < adapterList_1.length; _i++) {
        var adapter2 = adapterList_1[_i];
        var isMatch2 = adapter2.isMatch, genAdapter3 = adapter2.genAdapter, runtime2 = adapter2.runtime;
        if (isMatch2()) {
          return {
            adapter: __assign43({ isMatch: isMatch2 }, genAdapter3(options)),
            runtime: runtime2
          };
        }
      }
    }
    exports.useAdapters = useAdapters3;
    function useDefaultAdapter4() {
      return {
        adapter: __assign43({}, Web.genAdapter()),
        runtime: RUNTIME2.WEB
      };
    }
    exports.useDefaultAdapter = useDefaultAdapter4;
  }
});

// node_modules/lodash/_freeGlobal.js
var require_freeGlobal = __commonJS({
  "node_modules/lodash/_freeGlobal.js"(exports, module) {
    var freeGlobal = typeof global == "object" && global && global.Object === Object && global;
    module.exports = freeGlobal;
  }
});

// node_modules/lodash/_root.js
var require_root = __commonJS({
  "node_modules/lodash/_root.js"(exports, module) {
    var freeGlobal = require_freeGlobal();
    var freeSelf = typeof self == "object" && self && self.Object === Object && self;
    var root = freeGlobal || freeSelf || Function("return this")();
    module.exports = root;
  }
});

// node_modules/lodash/_Symbol.js
var require_Symbol = __commonJS({
  "node_modules/lodash/_Symbol.js"(exports, module) {
    var root = require_root();
    var Symbol2 = root.Symbol;
    module.exports = Symbol2;
  }
});

// node_modules/lodash/_getRawTag.js
var require_getRawTag = __commonJS({
  "node_modules/lodash/_getRawTag.js"(exports, module) {
    var Symbol2 = require_Symbol();
    var objectProto = Object.prototype;
    var hasOwnProperty2 = objectProto.hasOwnProperty;
    var nativeObjectToString = objectProto.toString;
    var symToStringTag = Symbol2 ? Symbol2.toStringTag : void 0;
    function getRawTag(value) {
      var isOwn = hasOwnProperty2.call(value, symToStringTag), tag = value[symToStringTag];
      try {
        value[symToStringTag] = void 0;
        var unmasked = true;
      } catch (e3) {
      }
      var result = nativeObjectToString.call(value);
      if (unmasked) {
        if (isOwn) {
          value[symToStringTag] = tag;
        } else {
          delete value[symToStringTag];
        }
      }
      return result;
    }
    module.exports = getRawTag;
  }
});

// node_modules/lodash/_objectToString.js
var require_objectToString = __commonJS({
  "node_modules/lodash/_objectToString.js"(exports, module) {
    var objectProto = Object.prototype;
    var nativeObjectToString = objectProto.toString;
    function objectToString2(value) {
      return nativeObjectToString.call(value);
    }
    module.exports = objectToString2;
  }
});

// node_modules/lodash/_baseGetTag.js
var require_baseGetTag = __commonJS({
  "node_modules/lodash/_baseGetTag.js"(exports, module) {
    var Symbol2 = require_Symbol();
    var getRawTag = require_getRawTag();
    var objectToString2 = require_objectToString();
    var nullTag = "[object Null]";
    var undefinedTag = "[object Undefined]";
    var symToStringTag = Symbol2 ? Symbol2.toStringTag : void 0;
    function baseGetTag(value) {
      if (value == null) {
        return value === void 0 ? undefinedTag : nullTag;
      }
      return symToStringTag && symToStringTag in Object(value) ? getRawTag(value) : objectToString2(value);
    }
    module.exports = baseGetTag;
  }
});

// node_modules/lodash/isObject.js
var require_isObject = __commonJS({
  "node_modules/lodash/isObject.js"(exports, module) {
    function isObject3(value) {
      var type = typeof value;
      return value != null && (type == "object" || type == "function");
    }
    module.exports = isObject3;
  }
});

// node_modules/lodash/isFunction.js
var require_isFunction = __commonJS({
  "node_modules/lodash/isFunction.js"(exports, module) {
    var baseGetTag = require_baseGetTag();
    var isObject3 = require_isObject();
    var asyncTag = "[object AsyncFunction]";
    var funcTag = "[object Function]";
    var genTag = "[object GeneratorFunction]";
    var proxyTag = "[object Proxy]";
    function isFunction(value) {
      if (!isObject3(value)) {
        return false;
      }
      var tag = baseGetTag(value);
      return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;
    }
    module.exports = isFunction;
  }
});

// node_modules/lodash/_coreJsData.js
var require_coreJsData = __commonJS({
  "node_modules/lodash/_coreJsData.js"(exports, module) {
    var root = require_root();
    var coreJsData = root["__core-js_shared__"];
    module.exports = coreJsData;
  }
});

// node_modules/lodash/_isMasked.js
var require_isMasked = __commonJS({
  "node_modules/lodash/_isMasked.js"(exports, module) {
    var coreJsData = require_coreJsData();
    var maskSrcKey = function() {
      var uid2 = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || "");
      return uid2 ? "Symbol(src)_1." + uid2 : "";
    }();
    function isMasked(func) {
      return !!maskSrcKey && maskSrcKey in func;
    }
    module.exports = isMasked;
  }
});

// node_modules/lodash/_toSource.js
var require_toSource = __commonJS({
  "node_modules/lodash/_toSource.js"(exports, module) {
    var funcProto = Function.prototype;
    var funcToString = funcProto.toString;
    function toSource(func) {
      if (func != null) {
        try {
          return funcToString.call(func);
        } catch (e3) {
        }
        try {
          return func + "";
        } catch (e3) {
        }
      }
      return "";
    }
    module.exports = toSource;
  }
});

// node_modules/lodash/_baseIsNative.js
var require_baseIsNative = __commonJS({
  "node_modules/lodash/_baseIsNative.js"(exports, module) {
    var isFunction = require_isFunction();
    var isMasked = require_isMasked();
    var isObject3 = require_isObject();
    var toSource = require_toSource();
    var reRegExpChar = /[\\^$.*+?()[\]{}|]/g;
    var reIsHostCtor = /^\[object .+?Constructor\]$/;
    var funcProto = Function.prototype;
    var objectProto = Object.prototype;
    var funcToString = funcProto.toString;
    var hasOwnProperty2 = objectProto.hasOwnProperty;
    var reIsNative = RegExp(
      "^" + funcToString.call(hasOwnProperty2).replace(reRegExpChar, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$"
    );
    function baseIsNative(value) {
      if (!isObject3(value) || isMasked(value)) {
        return false;
      }
      var pattern = isFunction(value) ? reIsNative : reIsHostCtor;
      return pattern.test(toSource(value));
    }
    module.exports = baseIsNative;
  }
});

// node_modules/lodash/_getValue.js
var require_getValue = __commonJS({
  "node_modules/lodash/_getValue.js"(exports, module) {
    function getValue(object, key) {
      return object == null ? void 0 : object[key];
    }
    module.exports = getValue;
  }
});

// node_modules/lodash/_getNative.js
var require_getNative = __commonJS({
  "node_modules/lodash/_getNative.js"(exports, module) {
    var baseIsNative = require_baseIsNative();
    var getValue = require_getValue();
    function getNative(object, key) {
      var value = getValue(object, key);
      return baseIsNative(value) ? value : void 0;
    }
    module.exports = getNative;
  }
});

// node_modules/lodash/_defineProperty.js
var require_defineProperty = __commonJS({
  "node_modules/lodash/_defineProperty.js"(exports, module) {
    var getNative = require_getNative();
    var defineProperty4 = function() {
      try {
        var func = getNative(Object, "defineProperty");
        func({}, "", {});
        return func;
      } catch (e3) {
      }
    }();
    module.exports = defineProperty4;
  }
});

// node_modules/lodash/_baseAssignValue.js
var require_baseAssignValue = __commonJS({
  "node_modules/lodash/_baseAssignValue.js"(exports, module) {
    var defineProperty4 = require_defineProperty();
    function baseAssignValue(object, key, value) {
      if (key == "__proto__" && defineProperty4) {
        defineProperty4(object, key, {
          "configurable": true,
          "enumerable": true,
          "value": value,
          "writable": true
        });
      } else {
        object[key] = value;
      }
    }
    module.exports = baseAssignValue;
  }
});

// node_modules/lodash/eq.js
var require_eq = __commonJS({
  "node_modules/lodash/eq.js"(exports, module) {
    function eq(value, other) {
      return value === other || value !== value && other !== other;
    }
    module.exports = eq;
  }
});

// node_modules/lodash/_assignValue.js
var require_assignValue = __commonJS({
  "node_modules/lodash/_assignValue.js"(exports, module) {
    var baseAssignValue = require_baseAssignValue();
    var eq = require_eq();
    var objectProto = Object.prototype;
    var hasOwnProperty2 = objectProto.hasOwnProperty;
    function assignValue(object, key, value) {
      var objValue = object[key];
      if (!(hasOwnProperty2.call(object, key) && eq(objValue, value)) || value === void 0 && !(key in object)) {
        baseAssignValue(object, key, value);
      }
    }
    module.exports = assignValue;
  }
});

// node_modules/lodash/isArray.js
var require_isArray = __commonJS({
  "node_modules/lodash/isArray.js"(exports, module) {
    var isArray4 = Array.isArray;
    module.exports = isArray4;
  }
});

// node_modules/lodash/isObjectLike.js
var require_isObjectLike = __commonJS({
  "node_modules/lodash/isObjectLike.js"(exports, module) {
    function isObjectLike2(value) {
      return value != null && typeof value == "object";
    }
    module.exports = isObjectLike2;
  }
});

// node_modules/lodash/isSymbol.js
var require_isSymbol = __commonJS({
  "node_modules/lodash/isSymbol.js"(exports, module) {
    var baseGetTag = require_baseGetTag();
    var isObjectLike2 = require_isObjectLike();
    var symbolTag = "[object Symbol]";
    function isSymbol2(value) {
      return typeof value == "symbol" || isObjectLike2(value) && baseGetTag(value) == symbolTag;
    }
    module.exports = isSymbol2;
  }
});

// node_modules/lodash/_isKey.js
var require_isKey = __commonJS({
  "node_modules/lodash/_isKey.js"(exports, module) {
    var isArray4 = require_isArray();
    var isSymbol2 = require_isSymbol();
    var reIsDeepProp = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/;
    var reIsPlainProp = /^\w*$/;
    function isKey(value, object) {
      if (isArray4(value)) {
        return false;
      }
      var type = typeof value;
      if (type == "number" || type == "symbol" || type == "boolean" || value == null || isSymbol2(value)) {
        return true;
      }
      return reIsPlainProp.test(value) || !reIsDeepProp.test(value) || object != null && value in Object(object);
    }
    module.exports = isKey;
  }
});

// node_modules/lodash/_nativeCreate.js
var require_nativeCreate = __commonJS({
  "node_modules/lodash/_nativeCreate.js"(exports, module) {
    var getNative = require_getNative();
    var nativeCreate = getNative(Object, "create");
    module.exports = nativeCreate;
  }
});

// node_modules/lodash/_hashClear.js
var require_hashClear = __commonJS({
  "node_modules/lodash/_hashClear.js"(exports, module) {
    var nativeCreate = require_nativeCreate();
    function hashClear() {
      this.__data__ = nativeCreate ? nativeCreate(null) : {};
      this.size = 0;
    }
    module.exports = hashClear;
  }
});

// node_modules/lodash/_hashDelete.js
var require_hashDelete = __commonJS({
  "node_modules/lodash/_hashDelete.js"(exports, module) {
    function hashDelete(key) {
      var result = this.has(key) && delete this.__data__[key];
      this.size -= result ? 1 : 0;
      return result;
    }
    module.exports = hashDelete;
  }
});

// node_modules/lodash/_hashGet.js
var require_hashGet = __commonJS({
  "node_modules/lodash/_hashGet.js"(exports, module) {
    var nativeCreate = require_nativeCreate();
    var HASH_UNDEFINED = "__lodash_hash_undefined__";
    var objectProto = Object.prototype;
    var hasOwnProperty2 = objectProto.hasOwnProperty;
    function hashGet(key) {
      var data2 = this.__data__;
      if (nativeCreate) {
        var result = data2[key];
        return result === HASH_UNDEFINED ? void 0 : result;
      }
      return hasOwnProperty2.call(data2, key) ? data2[key] : void 0;
    }
    module.exports = hashGet;
  }
});

// node_modules/lodash/_hashHas.js
var require_hashHas = __commonJS({
  "node_modules/lodash/_hashHas.js"(exports, module) {
    var nativeCreate = require_nativeCreate();
    var objectProto = Object.prototype;
    var hasOwnProperty2 = objectProto.hasOwnProperty;
    function hashHas(key) {
      var data2 = this.__data__;
      return nativeCreate ? data2[key] !== void 0 : hasOwnProperty2.call(data2, key);
    }
    module.exports = hashHas;
  }
});

// node_modules/lodash/_hashSet.js
var require_hashSet = __commonJS({
  "node_modules/lodash/_hashSet.js"(exports, module) {
    var nativeCreate = require_nativeCreate();
    var HASH_UNDEFINED = "__lodash_hash_undefined__";
    function hashSet(key, value) {
      var data2 = this.__data__;
      this.size += this.has(key) ? 0 : 1;
      data2[key] = nativeCreate && value === void 0 ? HASH_UNDEFINED : value;
      return this;
    }
    module.exports = hashSet;
  }
});

// node_modules/lodash/_Hash.js
var require_Hash = __commonJS({
  "node_modules/lodash/_Hash.js"(exports, module) {
    var hashClear = require_hashClear();
    var hashDelete = require_hashDelete();
    var hashGet = require_hashGet();
    var hashHas = require_hashHas();
    var hashSet = require_hashSet();
    function Hash(entries2) {
      var index = -1, length = entries2 == null ? 0 : entries2.length;
      this.clear();
      while (++index < length) {
        var entry = entries2[index];
        this.set(entry[0], entry[1]);
      }
    }
    Hash.prototype.clear = hashClear;
    Hash.prototype["delete"] = hashDelete;
    Hash.prototype.get = hashGet;
    Hash.prototype.has = hashHas;
    Hash.prototype.set = hashSet;
    module.exports = Hash;
  }
});

// node_modules/lodash/_listCacheClear.js
var require_listCacheClear = __commonJS({
  "node_modules/lodash/_listCacheClear.js"(exports, module) {
    function listCacheClear() {
      this.__data__ = [];
      this.size = 0;
    }
    module.exports = listCacheClear;
  }
});

// node_modules/lodash/_assocIndexOf.js
var require_assocIndexOf = __commonJS({
  "node_modules/lodash/_assocIndexOf.js"(exports, module) {
    var eq = require_eq();
    function assocIndexOf(array, key) {
      var length = array.length;
      while (length--) {
        if (eq(array[length][0], key)) {
          return length;
        }
      }
      return -1;
    }
    module.exports = assocIndexOf;
  }
});

// node_modules/lodash/_listCacheDelete.js
var require_listCacheDelete = __commonJS({
  "node_modules/lodash/_listCacheDelete.js"(exports, module) {
    var assocIndexOf = require_assocIndexOf();
    var arrayProto = Array.prototype;
    var splice2 = arrayProto.splice;
    function listCacheDelete(key) {
      var data2 = this.__data__, index = assocIndexOf(data2, key);
      if (index < 0) {
        return false;
      }
      var lastIndex = data2.length - 1;
      if (index == lastIndex) {
        data2.pop();
      } else {
        splice2.call(data2, index, 1);
      }
      --this.size;
      return true;
    }
    module.exports = listCacheDelete;
  }
});

// node_modules/lodash/_listCacheGet.js
var require_listCacheGet = __commonJS({
  "node_modules/lodash/_listCacheGet.js"(exports, module) {
    var assocIndexOf = require_assocIndexOf();
    function listCacheGet(key) {
      var data2 = this.__data__, index = assocIndexOf(data2, key);
      return index < 0 ? void 0 : data2[index][1];
    }
    module.exports = listCacheGet;
  }
});

// node_modules/lodash/_listCacheHas.js
var require_listCacheHas = __commonJS({
  "node_modules/lodash/_listCacheHas.js"(exports, module) {
    var assocIndexOf = require_assocIndexOf();
    function listCacheHas(key) {
      return assocIndexOf(this.__data__, key) > -1;
    }
    module.exports = listCacheHas;
  }
});

// node_modules/lodash/_listCacheSet.js
var require_listCacheSet = __commonJS({
  "node_modules/lodash/_listCacheSet.js"(exports, module) {
    var assocIndexOf = require_assocIndexOf();
    function listCacheSet(key, value) {
      var data2 = this.__data__, index = assocIndexOf(data2, key);
      if (index < 0) {
        ++this.size;
        data2.push([key, value]);
      } else {
        data2[index][1] = value;
      }
      return this;
    }
    module.exports = listCacheSet;
  }
});

// node_modules/lodash/_ListCache.js
var require_ListCache = __commonJS({
  "node_modules/lodash/_ListCache.js"(exports, module) {
    var listCacheClear = require_listCacheClear();
    var listCacheDelete = require_listCacheDelete();
    var listCacheGet = require_listCacheGet();
    var listCacheHas = require_listCacheHas();
    var listCacheSet = require_listCacheSet();
    function ListCache(entries2) {
      var index = -1, length = entries2 == null ? 0 : entries2.length;
      this.clear();
      while (++index < length) {
        var entry = entries2[index];
        this.set(entry[0], entry[1]);
      }
    }
    ListCache.prototype.clear = listCacheClear;
    ListCache.prototype["delete"] = listCacheDelete;
    ListCache.prototype.get = listCacheGet;
    ListCache.prototype.has = listCacheHas;
    ListCache.prototype.set = listCacheSet;
    module.exports = ListCache;
  }
});

// node_modules/lodash/_Map.js
var require_Map = __commonJS({
  "node_modules/lodash/_Map.js"(exports, module) {
    var getNative = require_getNative();
    var root = require_root();
    var Map2 = getNative(root, "Map");
    module.exports = Map2;
  }
});

// node_modules/lodash/_mapCacheClear.js
var require_mapCacheClear = __commonJS({
  "node_modules/lodash/_mapCacheClear.js"(exports, module) {
    var Hash = require_Hash();
    var ListCache = require_ListCache();
    var Map2 = require_Map();
    function mapCacheClear() {
      this.size = 0;
      this.__data__ = {
        "hash": new Hash(),
        "map": new (Map2 || ListCache)(),
        "string": new Hash()
      };
    }
    module.exports = mapCacheClear;
  }
});

// node_modules/lodash/_isKeyable.js
var require_isKeyable = __commonJS({
  "node_modules/lodash/_isKeyable.js"(exports, module) {
    function isKeyable(value) {
      var type = typeof value;
      return type == "string" || type == "number" || type == "symbol" || type == "boolean" ? value !== "__proto__" : value === null;
    }
    module.exports = isKeyable;
  }
});

// node_modules/lodash/_getMapData.js
var require_getMapData = __commonJS({
  "node_modules/lodash/_getMapData.js"(exports, module) {
    var isKeyable = require_isKeyable();
    function getMapData(map, key) {
      var data2 = map.__data__;
      return isKeyable(key) ? data2[typeof key == "string" ? "string" : "hash"] : data2.map;
    }
    module.exports = getMapData;
  }
});

// node_modules/lodash/_mapCacheDelete.js
var require_mapCacheDelete = __commonJS({
  "node_modules/lodash/_mapCacheDelete.js"(exports, module) {
    var getMapData = require_getMapData();
    function mapCacheDelete(key) {
      var result = getMapData(this, key)["delete"](key);
      this.size -= result ? 1 : 0;
      return result;
    }
    module.exports = mapCacheDelete;
  }
});

// node_modules/lodash/_mapCacheGet.js
var require_mapCacheGet = __commonJS({
  "node_modules/lodash/_mapCacheGet.js"(exports, module) {
    var getMapData = require_getMapData();
    function mapCacheGet(key) {
      return getMapData(this, key).get(key);
    }
    module.exports = mapCacheGet;
  }
});

// node_modules/lodash/_mapCacheHas.js
var require_mapCacheHas = __commonJS({
  "node_modules/lodash/_mapCacheHas.js"(exports, module) {
    var getMapData = require_getMapData();
    function mapCacheHas(key) {
      return getMapData(this, key).has(key);
    }
    module.exports = mapCacheHas;
  }
});

// node_modules/lodash/_mapCacheSet.js
var require_mapCacheSet = __commonJS({
  "node_modules/lodash/_mapCacheSet.js"(exports, module) {
    var getMapData = require_getMapData();
    function mapCacheSet(key, value) {
      var data2 = getMapData(this, key), size2 = data2.size;
      data2.set(key, value);
      this.size += data2.size == size2 ? 0 : 1;
      return this;
    }
    module.exports = mapCacheSet;
  }
});

// node_modules/lodash/_MapCache.js
var require_MapCache = __commonJS({
  "node_modules/lodash/_MapCache.js"(exports, module) {
    var mapCacheClear = require_mapCacheClear();
    var mapCacheDelete = require_mapCacheDelete();
    var mapCacheGet = require_mapCacheGet();
    var mapCacheHas = require_mapCacheHas();
    var mapCacheSet = require_mapCacheSet();
    function MapCache(entries2) {
      var index = -1, length = entries2 == null ? 0 : entries2.length;
      this.clear();
      while (++index < length) {
        var entry = entries2[index];
        this.set(entry[0], entry[1]);
      }
    }
    MapCache.prototype.clear = mapCacheClear;
    MapCache.prototype["delete"] = mapCacheDelete;
    MapCache.prototype.get = mapCacheGet;
    MapCache.prototype.has = mapCacheHas;
    MapCache.prototype.set = mapCacheSet;
    module.exports = MapCache;
  }
});

// node_modules/lodash/memoize.js
var require_memoize = __commonJS({
  "node_modules/lodash/memoize.js"(exports, module) {
    var MapCache = require_MapCache();
    var FUNC_ERROR_TEXT = "Expected a function";
    function memoize(func, resolver) {
      if (typeof func != "function" || resolver != null && typeof resolver != "function") {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      var memoized = function() {
        var args = arguments, key = resolver ? resolver.apply(this, args) : args[0], cache = memoized.cache;
        if (cache.has(key)) {
          return cache.get(key);
        }
        var result = func.apply(this, args);
        memoized.cache = cache.set(key, result) || cache;
        return result;
      };
      memoized.cache = new (memoize.Cache || MapCache)();
      return memoized;
    }
    memoize.Cache = MapCache;
    module.exports = memoize;
  }
});

// node_modules/lodash/_memoizeCapped.js
var require_memoizeCapped = __commonJS({
  "node_modules/lodash/_memoizeCapped.js"(exports, module) {
    var memoize = require_memoize();
    var MAX_MEMOIZE_SIZE = 500;
    function memoizeCapped(func) {
      var result = memoize(func, function(key) {
        if (cache.size === MAX_MEMOIZE_SIZE) {
          cache.clear();
        }
        return key;
      });
      var cache = result.cache;
      return result;
    }
    module.exports = memoizeCapped;
  }
});

// node_modules/lodash/_stringToPath.js
var require_stringToPath = __commonJS({
  "node_modules/lodash/_stringToPath.js"(exports, module) {
    var memoizeCapped = require_memoizeCapped();
    var rePropName = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;
    var reEscapeChar = /\\(\\)?/g;
    var stringToPath = memoizeCapped(function(string) {
      var result = [];
      if (string.charCodeAt(0) === 46) {
        result.push("");
      }
      string.replace(rePropName, function(match2, number, quote, subString) {
        result.push(quote ? subString.replace(reEscapeChar, "$1") : number || match2);
      });
      return result;
    });
    module.exports = stringToPath;
  }
});

// node_modules/lodash/_arrayMap.js
var require_arrayMap = __commonJS({
  "node_modules/lodash/_arrayMap.js"(exports, module) {
    function arrayMap(array, iteratee) {
      var index = -1, length = array == null ? 0 : array.length, result = Array(length);
      while (++index < length) {
        result[index] = iteratee(array[index], index, array);
      }
      return result;
    }
    module.exports = arrayMap;
  }
});

// node_modules/lodash/_baseToString.js
var require_baseToString = __commonJS({
  "node_modules/lodash/_baseToString.js"(exports, module) {
    var Symbol2 = require_Symbol();
    var arrayMap = require_arrayMap();
    var isArray4 = require_isArray();
    var isSymbol2 = require_isSymbol();
    var INFINITY = 1 / 0;
    var symbolProto = Symbol2 ? Symbol2.prototype : void 0;
    var symbolToString = symbolProto ? symbolProto.toString : void 0;
    function baseToString(value) {
      if (typeof value == "string") {
        return value;
      }
      if (isArray4(value)) {
        return arrayMap(value, baseToString) + "";
      }
      if (isSymbol2(value)) {
        return symbolToString ? symbolToString.call(value) : "";
      }
      var result = value + "";
      return result == "0" && 1 / value == -INFINITY ? "-0" : result;
    }
    module.exports = baseToString;
  }
});

// node_modules/lodash/toString.js
var require_toString = __commonJS({
  "node_modules/lodash/toString.js"(exports, module) {
    var baseToString = require_baseToString();
    function toString5(value) {
      return value == null ? "" : baseToString(value);
    }
    module.exports = toString5;
  }
});

// node_modules/lodash/_castPath.js
var require_castPath = __commonJS({
  "node_modules/lodash/_castPath.js"(exports, module) {
    var isArray4 = require_isArray();
    var isKey = require_isKey();
    var stringToPath = require_stringToPath();
    var toString5 = require_toString();
    function castPath(value, object) {
      if (isArray4(value)) {
        return value;
      }
      return isKey(value, object) ? [value] : stringToPath(toString5(value));
    }
    module.exports = castPath;
  }
});

// node_modules/lodash/_isIndex.js
var require_isIndex = __commonJS({
  "node_modules/lodash/_isIndex.js"(exports, module) {
    var MAX_SAFE_INTEGER = 9007199254740991;
    var reIsUint = /^(?:0|[1-9]\d*)$/;
    function isIndex(value, length) {
      var type = typeof value;
      length = length == null ? MAX_SAFE_INTEGER : length;
      return !!length && (type == "number" || type != "symbol" && reIsUint.test(value)) && (value > -1 && value % 1 == 0 && value < length);
    }
    module.exports = isIndex;
  }
});

// node_modules/lodash/_toKey.js
var require_toKey = __commonJS({
  "node_modules/lodash/_toKey.js"(exports, module) {
    var isSymbol2 = require_isSymbol();
    var INFINITY = 1 / 0;
    function toKey(value) {
      if (typeof value == "string" || isSymbol2(value)) {
        return value;
      }
      var result = value + "";
      return result == "0" && 1 / value == -INFINITY ? "-0" : result;
    }
    module.exports = toKey;
  }
});

// node_modules/lodash/_baseSet.js
var require_baseSet = __commonJS({
  "node_modules/lodash/_baseSet.js"(exports, module) {
    var assignValue = require_assignValue();
    var castPath = require_castPath();
    var isIndex = require_isIndex();
    var isObject3 = require_isObject();
    var toKey = require_toKey();
    function baseSet(object, path2, value, customizer) {
      if (!isObject3(object)) {
        return object;
      }
      path2 = castPath(path2, object);
      var index = -1, length = path2.length, lastIndex = length - 1, nested = object;
      while (nested != null && ++index < length) {
        var key = toKey(path2[index]), newValue = value;
        if (key === "__proto__" || key === "constructor" || key === "prototype") {
          return object;
        }
        if (index != lastIndex) {
          var objValue = nested[key];
          newValue = customizer ? customizer(objValue, key, nested) : void 0;
          if (newValue === void 0) {
            newValue = isObject3(objValue) ? objValue : isIndex(path2[index + 1]) ? [] : {};
          }
        }
        assignValue(nested, key, newValue);
        nested = nested[key];
      }
      return object;
    }
    module.exports = baseSet;
  }
});

// node_modules/lodash/set.js
var require_set = __commonJS({
  "node_modules/lodash/set.js"(exports, module) {
    var baseSet = require_baseSet();
    function set4(object, path2, value) {
      return object == null ? object : baseSet(object, path2, value);
    }
    module.exports = set4;
  }
});

// node_modules/lodash/last.js
var require_last = __commonJS({
  "node_modules/lodash/last.js"(exports, module) {
    function last(array) {
      var length = array == null ? 0 : array.length;
      return length ? array[length - 1] : void 0;
    }
    module.exports = last;
  }
});

// node_modules/lodash/_baseGet.js
var require_baseGet = __commonJS({
  "node_modules/lodash/_baseGet.js"(exports, module) {
    var castPath = require_castPath();
    var toKey = require_toKey();
    function baseGet(object, path2) {
      path2 = castPath(path2, object);
      var index = 0, length = path2.length;
      while (object != null && index < length) {
        object = object[toKey(path2[index++])];
      }
      return index && index == length ? object : void 0;
    }
    module.exports = baseGet;
  }
});

// node_modules/lodash/_baseSlice.js
var require_baseSlice = __commonJS({
  "node_modules/lodash/_baseSlice.js"(exports, module) {
    function baseSlice(array, start, end) {
      var index = -1, length = array.length;
      if (start < 0) {
        start = -start > length ? 0 : length + start;
      }
      end = end > length ? length : end;
      if (end < 0) {
        end += length;
      }
      length = start > end ? 0 : end - start >>> 0;
      start >>>= 0;
      var result = Array(length);
      while (++index < length) {
        result[index] = array[index + start];
      }
      return result;
    }
    module.exports = baseSlice;
  }
});

// node_modules/lodash/_parent.js
var require_parent = __commonJS({
  "node_modules/lodash/_parent.js"(exports, module) {
    var baseGet = require_baseGet();
    var baseSlice = require_baseSlice();
    function parent2(object, path2) {
      return path2.length < 2 ? object : baseGet(object, baseSlice(path2, 0, -1));
    }
    module.exports = parent2;
  }
});

// node_modules/lodash/_baseUnset.js
var require_baseUnset = __commonJS({
  "node_modules/lodash/_baseUnset.js"(exports, module) {
    var castPath = require_castPath();
    var last = require_last();
    var parent2 = require_parent();
    var toKey = require_toKey();
    function baseUnset(object, path2) {
      path2 = castPath(path2, object);
      object = parent2(object, path2);
      return object == null || delete object[toKey(last(path2))];
    }
    module.exports = baseUnset;
  }
});

// node_modules/lodash/unset.js
var require_unset = __commonJS({
  "node_modules/lodash/unset.js"(exports, module) {
    var baseUnset = require_baseUnset();
    function unset2(object, path2) {
      return object == null ? true : baseUnset(object, path2);
    }
    module.exports = unset2;
  }
});

// node_modules/lodash/_stackClear.js
var require_stackClear = __commonJS({
  "node_modules/lodash/_stackClear.js"(exports, module) {
    var ListCache = require_ListCache();
    function stackClear() {
      this.__data__ = new ListCache();
      this.size = 0;
    }
    module.exports = stackClear;
  }
});

// node_modules/lodash/_stackDelete.js
var require_stackDelete = __commonJS({
  "node_modules/lodash/_stackDelete.js"(exports, module) {
    function stackDelete(key) {
      var data2 = this.__data__, result = data2["delete"](key);
      this.size = data2.size;
      return result;
    }
    module.exports = stackDelete;
  }
});

// node_modules/lodash/_stackGet.js
var require_stackGet = __commonJS({
  "node_modules/lodash/_stackGet.js"(exports, module) {
    function stackGet(key) {
      return this.__data__.get(key);
    }
    module.exports = stackGet;
  }
});

// node_modules/lodash/_stackHas.js
var require_stackHas = __commonJS({
  "node_modules/lodash/_stackHas.js"(exports, module) {
    function stackHas(key) {
      return this.__data__.has(key);
    }
    module.exports = stackHas;
  }
});

// node_modules/lodash/_stackSet.js
var require_stackSet = __commonJS({
  "node_modules/lodash/_stackSet.js"(exports, module) {
    var ListCache = require_ListCache();
    var Map2 = require_Map();
    var MapCache = require_MapCache();
    var LARGE_ARRAY_SIZE = 200;
    function stackSet(key, value) {
      var data2 = this.__data__;
      if (data2 instanceof ListCache) {
        var pairs = data2.__data__;
        if (!Map2 || pairs.length < LARGE_ARRAY_SIZE - 1) {
          pairs.push([key, value]);
          this.size = ++data2.size;
          return this;
        }
        data2 = this.__data__ = new MapCache(pairs);
      }
      data2.set(key, value);
      this.size = data2.size;
      return this;
    }
    module.exports = stackSet;
  }
});

// node_modules/lodash/_Stack.js
var require_Stack = __commonJS({
  "node_modules/lodash/_Stack.js"(exports, module) {
    var ListCache = require_ListCache();
    var stackClear = require_stackClear();
    var stackDelete = require_stackDelete();
    var stackGet = require_stackGet();
    var stackHas = require_stackHas();
    var stackSet = require_stackSet();
    function Stack(entries2) {
      var data2 = this.__data__ = new ListCache(entries2);
      this.size = data2.size;
    }
    Stack.prototype.clear = stackClear;
    Stack.prototype["delete"] = stackDelete;
    Stack.prototype.get = stackGet;
    Stack.prototype.has = stackHas;
    Stack.prototype.set = stackSet;
    module.exports = Stack;
  }
});

// node_modules/lodash/_arrayEach.js
var require_arrayEach = __commonJS({
  "node_modules/lodash/_arrayEach.js"(exports, module) {
    function arrayEach(array, iteratee) {
      var index = -1, length = array == null ? 0 : array.length;
      while (++index < length) {
        if (iteratee(array[index], index, array) === false) {
          break;
        }
      }
      return array;
    }
    module.exports = arrayEach;
  }
});

// node_modules/lodash/_copyObject.js
var require_copyObject = __commonJS({
  "node_modules/lodash/_copyObject.js"(exports, module) {
    var assignValue = require_assignValue();
    var baseAssignValue = require_baseAssignValue();
    function copyObject(source, props, object, customizer) {
      var isNew = !object;
      object || (object = {});
      var index = -1, length = props.length;
      while (++index < length) {
        var key = props[index];
        var newValue = customizer ? customizer(object[key], source[key], key, object, source) : void 0;
        if (newValue === void 0) {
          newValue = source[key];
        }
        if (isNew) {
          baseAssignValue(object, key, newValue);
        } else {
          assignValue(object, key, newValue);
        }
      }
      return object;
    }
    module.exports = copyObject;
  }
});

// node_modules/lodash/_baseTimes.js
var require_baseTimes = __commonJS({
  "node_modules/lodash/_baseTimes.js"(exports, module) {
    function baseTimes(n3, iteratee) {
      var index = -1, result = Array(n3);
      while (++index < n3) {
        result[index] = iteratee(index);
      }
      return result;
    }
    module.exports = baseTimes;
  }
});

// node_modules/lodash/_baseIsArguments.js
var require_baseIsArguments = __commonJS({
  "node_modules/lodash/_baseIsArguments.js"(exports, module) {
    var baseGetTag = require_baseGetTag();
    var isObjectLike2 = require_isObjectLike();
    var argsTag = "[object Arguments]";
    function baseIsArguments(value) {
      return isObjectLike2(value) && baseGetTag(value) == argsTag;
    }
    module.exports = baseIsArguments;
  }
});

// node_modules/lodash/isArguments.js
var require_isArguments = __commonJS({
  "node_modules/lodash/isArguments.js"(exports, module) {
    var baseIsArguments = require_baseIsArguments();
    var isObjectLike2 = require_isObjectLike();
    var objectProto = Object.prototype;
    var hasOwnProperty2 = objectProto.hasOwnProperty;
    var propertyIsEnumerable2 = objectProto.propertyIsEnumerable;
    var isArguments = baseIsArguments(/* @__PURE__ */ function() {
      return arguments;
    }()) ? baseIsArguments : function(value) {
      return isObjectLike2(value) && hasOwnProperty2.call(value, "callee") && !propertyIsEnumerable2.call(value, "callee");
    };
    module.exports = isArguments;
  }
});

// node_modules/lodash/stubFalse.js
var require_stubFalse = __commonJS({
  "node_modules/lodash/stubFalse.js"(exports, module) {
    function stubFalse() {
      return false;
    }
    module.exports = stubFalse;
  }
});

// node_modules/lodash/isBuffer.js
var require_isBuffer = __commonJS({
  "node_modules/lodash/isBuffer.js"(exports, module) {
    var root = require_root();
    var stubFalse = require_stubFalse();
    var freeExports = typeof exports == "object" && exports && !exports.nodeType && exports;
    var freeModule = freeExports && typeof module == "object" && module && !module.nodeType && module;
    var moduleExports = freeModule && freeModule.exports === freeExports;
    var Buffer2 = moduleExports ? root.Buffer : void 0;
    var nativeIsBuffer = Buffer2 ? Buffer2.isBuffer : void 0;
    var isBuffer = nativeIsBuffer || stubFalse;
    module.exports = isBuffer;
  }
});

// node_modules/lodash/isLength.js
var require_isLength = __commonJS({
  "node_modules/lodash/isLength.js"(exports, module) {
    var MAX_SAFE_INTEGER = 9007199254740991;
    function isLength(value) {
      return typeof value == "number" && value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
    }
    module.exports = isLength;
  }
});

// node_modules/lodash/_baseIsTypedArray.js
var require_baseIsTypedArray = __commonJS({
  "node_modules/lodash/_baseIsTypedArray.js"(exports, module) {
    var baseGetTag = require_baseGetTag();
    var isLength = require_isLength();
    var isObjectLike2 = require_isObjectLike();
    var argsTag = "[object Arguments]";
    var arrayTag = "[object Array]";
    var boolTag = "[object Boolean]";
    var dateTag = "[object Date]";
    var errorTag = "[object Error]";
    var funcTag = "[object Function]";
    var mapTag = "[object Map]";
    var numberTag = "[object Number]";
    var objectTag = "[object Object]";
    var regexpTag = "[object RegExp]";
    var setTag = "[object Set]";
    var stringTag = "[object String]";
    var weakMapTag = "[object WeakMap]";
    var arrayBufferTag = "[object ArrayBuffer]";
    var dataViewTag = "[object DataView]";
    var float32Tag = "[object Float32Array]";
    var float64Tag = "[object Float64Array]";
    var int8Tag = "[object Int8Array]";
    var int16Tag = "[object Int16Array]";
    var int32Tag = "[object Int32Array]";
    var uint8Tag = "[object Uint8Array]";
    var uint8ClampedTag = "[object Uint8ClampedArray]";
    var uint16Tag = "[object Uint16Array]";
    var uint32Tag = "[object Uint32Array]";
    var typedArrayTags = {};
    typedArrayTags[float32Tag] = typedArrayTags[float64Tag] = typedArrayTags[int8Tag] = typedArrayTags[int16Tag] = typedArrayTags[int32Tag] = typedArrayTags[uint8Tag] = typedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] = typedArrayTags[uint32Tag] = true;
    typedArrayTags[argsTag] = typedArrayTags[arrayTag] = typedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] = typedArrayTags[dataViewTag] = typedArrayTags[dateTag] = typedArrayTags[errorTag] = typedArrayTags[funcTag] = typedArrayTags[mapTag] = typedArrayTags[numberTag] = typedArrayTags[objectTag] = typedArrayTags[regexpTag] = typedArrayTags[setTag] = typedArrayTags[stringTag] = typedArrayTags[weakMapTag] = false;
    function baseIsTypedArray(value) {
      return isObjectLike2(value) && isLength(value.length) && !!typedArrayTags[baseGetTag(value)];
    }
    module.exports = baseIsTypedArray;
  }
});

// node_modules/lodash/_baseUnary.js
var require_baseUnary = __commonJS({
  "node_modules/lodash/_baseUnary.js"(exports, module) {
    function baseUnary(func) {
      return function(value) {
        return func(value);
      };
    }
    module.exports = baseUnary;
  }
});

// node_modules/lodash/_nodeUtil.js
var require_nodeUtil = __commonJS({
  "node_modules/lodash/_nodeUtil.js"(exports, module) {
    var freeGlobal = require_freeGlobal();
    var freeExports = typeof exports == "object" && exports && !exports.nodeType && exports;
    var freeModule = freeExports && typeof module == "object" && module && !module.nodeType && module;
    var moduleExports = freeModule && freeModule.exports === freeExports;
    var freeProcess = moduleExports && freeGlobal.process;
    var nodeUtil = function() {
      try {
        var types = freeModule && freeModule.require && freeModule.require("util").types;
        if (types) {
          return types;
        }
        return freeProcess && freeProcess.binding && freeProcess.binding("util");
      } catch (e3) {
      }
    }();
    module.exports = nodeUtil;
  }
});

// node_modules/lodash/isTypedArray.js
var require_isTypedArray = __commonJS({
  "node_modules/lodash/isTypedArray.js"(exports, module) {
    var baseIsTypedArray = require_baseIsTypedArray();
    var baseUnary = require_baseUnary();
    var nodeUtil = require_nodeUtil();
    var nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;
    var isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;
    module.exports = isTypedArray;
  }
});

// node_modules/lodash/_arrayLikeKeys.js
var require_arrayLikeKeys = __commonJS({
  "node_modules/lodash/_arrayLikeKeys.js"(exports, module) {
    var baseTimes = require_baseTimes();
    var isArguments = require_isArguments();
    var isArray4 = require_isArray();
    var isBuffer = require_isBuffer();
    var isIndex = require_isIndex();
    var isTypedArray = require_isTypedArray();
    var objectProto = Object.prototype;
    var hasOwnProperty2 = objectProto.hasOwnProperty;
    function arrayLikeKeys(value, inherited) {
      var isArr = isArray4(value), isArg = !isArr && isArguments(value), isBuff = !isArr && !isArg && isBuffer(value), isType = !isArr && !isArg && !isBuff && isTypedArray(value), skipIndexes = isArr || isArg || isBuff || isType, result = skipIndexes ? baseTimes(value.length, String) : [], length = result.length;
      for (var key in value) {
        if ((inherited || hasOwnProperty2.call(value, key)) && !(skipIndexes && // Safari 9 has enumerable `arguments.length` in strict mode.
        (key == "length" || // Node.js 0.10 has enumerable non-index properties on buffers.
        isBuff && (key == "offset" || key == "parent") || // PhantomJS 2 has enumerable non-index properties on typed arrays.
        isType && (key == "buffer" || key == "byteLength" || key == "byteOffset") || // Skip index properties.
        isIndex(key, length)))) {
          result.push(key);
        }
      }
      return result;
    }
    module.exports = arrayLikeKeys;
  }
});

// node_modules/lodash/_isPrototype.js
var require_isPrototype = __commonJS({
  "node_modules/lodash/_isPrototype.js"(exports, module) {
    var objectProto = Object.prototype;
    function isPrototype(value) {
      var Ctor = value && value.constructor, proto = typeof Ctor == "function" && Ctor.prototype || objectProto;
      return value === proto;
    }
    module.exports = isPrototype;
  }
});

// node_modules/lodash/_overArg.js
var require_overArg = __commonJS({
  "node_modules/lodash/_overArg.js"(exports, module) {
    function overArg(func, transform) {
      return function(arg) {
        return func(transform(arg));
      };
    }
    module.exports = overArg;
  }
});

// node_modules/lodash/_nativeKeys.js
var require_nativeKeys = __commonJS({
  "node_modules/lodash/_nativeKeys.js"(exports, module) {
    var overArg = require_overArg();
    var nativeKeys = overArg(Object.keys, Object);
    module.exports = nativeKeys;
  }
});

// node_modules/lodash/_baseKeys.js
var require_baseKeys = __commonJS({
  "node_modules/lodash/_baseKeys.js"(exports, module) {
    var isPrototype = require_isPrototype();
    var nativeKeys = require_nativeKeys();
    var objectProto = Object.prototype;
    var hasOwnProperty2 = objectProto.hasOwnProperty;
    function baseKeys(object) {
      if (!isPrototype(object)) {
        return nativeKeys(object);
      }
      var result = [];
      for (var key in Object(object)) {
        if (hasOwnProperty2.call(object, key) && key != "constructor") {
          result.push(key);
        }
      }
      return result;
    }
    module.exports = baseKeys;
  }
});

// node_modules/lodash/isArrayLike.js
var require_isArrayLike = __commonJS({
  "node_modules/lodash/isArrayLike.js"(exports, module) {
    var isFunction = require_isFunction();
    var isLength = require_isLength();
    function isArrayLike(value) {
      return value != null && isLength(value.length) && !isFunction(value);
    }
    module.exports = isArrayLike;
  }
});

// node_modules/lodash/keys.js
var require_keys = __commonJS({
  "node_modules/lodash/keys.js"(exports, module) {
    var arrayLikeKeys = require_arrayLikeKeys();
    var baseKeys = require_baseKeys();
    var isArrayLike = require_isArrayLike();
    function keys4(object) {
      return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);
    }
    module.exports = keys4;
  }
});

// node_modules/lodash/_baseAssign.js
var require_baseAssign = __commonJS({
  "node_modules/lodash/_baseAssign.js"(exports, module) {
    var copyObject = require_copyObject();
    var keys4 = require_keys();
    function baseAssign(object, source) {
      return object && copyObject(source, keys4(source), object);
    }
    module.exports = baseAssign;
  }
});

// node_modules/lodash/_nativeKeysIn.js
var require_nativeKeysIn = __commonJS({
  "node_modules/lodash/_nativeKeysIn.js"(exports, module) {
    function nativeKeysIn(object) {
      var result = [];
      if (object != null) {
        for (var key in Object(object)) {
          result.push(key);
        }
      }
      return result;
    }
    module.exports = nativeKeysIn;
  }
});

// node_modules/lodash/_baseKeysIn.js
var require_baseKeysIn = __commonJS({
  "node_modules/lodash/_baseKeysIn.js"(exports, module) {
    var isObject3 = require_isObject();
    var isPrototype = require_isPrototype();
    var nativeKeysIn = require_nativeKeysIn();
    var objectProto = Object.prototype;
    var hasOwnProperty2 = objectProto.hasOwnProperty;
    function baseKeysIn(object) {
      if (!isObject3(object)) {
        return nativeKeysIn(object);
      }
      var isProto = isPrototype(object), result = [];
      for (var key in object) {
        if (!(key == "constructor" && (isProto || !hasOwnProperty2.call(object, key)))) {
          result.push(key);
        }
      }
      return result;
    }
    module.exports = baseKeysIn;
  }
});

// node_modules/lodash/keysIn.js
var require_keysIn = __commonJS({
  "node_modules/lodash/keysIn.js"(exports, module) {
    var arrayLikeKeys = require_arrayLikeKeys();
    var baseKeysIn = require_baseKeysIn();
    var isArrayLike = require_isArrayLike();
    function keysIn(object) {
      return isArrayLike(object) ? arrayLikeKeys(object, true) : baseKeysIn(object);
    }
    module.exports = keysIn;
  }
});

// node_modules/lodash/_baseAssignIn.js
var require_baseAssignIn = __commonJS({
  "node_modules/lodash/_baseAssignIn.js"(exports, module) {
    var copyObject = require_copyObject();
    var keysIn = require_keysIn();
    function baseAssignIn(object, source) {
      return object && copyObject(source, keysIn(source), object);
    }
    module.exports = baseAssignIn;
  }
});

// node_modules/lodash/_cloneBuffer.js
var require_cloneBuffer = __commonJS({
  "node_modules/lodash/_cloneBuffer.js"(exports, module) {
    var root = require_root();
    var freeExports = typeof exports == "object" && exports && !exports.nodeType && exports;
    var freeModule = freeExports && typeof module == "object" && module && !module.nodeType && module;
    var moduleExports = freeModule && freeModule.exports === freeExports;
    var Buffer2 = moduleExports ? root.Buffer : void 0;
    var allocUnsafe = Buffer2 ? Buffer2.allocUnsafe : void 0;
    function cloneBuffer(buffer2, isDeep) {
      if (isDeep) {
        return buffer2.slice();
      }
      var length = buffer2.length, result = allocUnsafe ? allocUnsafe(length) : new buffer2.constructor(length);
      buffer2.copy(result);
      return result;
    }
    module.exports = cloneBuffer;
  }
});

// node_modules/lodash/_copyArray.js
var require_copyArray = __commonJS({
  "node_modules/lodash/_copyArray.js"(exports, module) {
    function copyArray(source, array) {
      var index = -1, length = source.length;
      array || (array = Array(length));
      while (++index < length) {
        array[index] = source[index];
      }
      return array;
    }
    module.exports = copyArray;
  }
});

// node_modules/lodash/_arrayFilter.js
var require_arrayFilter = __commonJS({
  "node_modules/lodash/_arrayFilter.js"(exports, module) {
    function arrayFilter(array, predicate) {
      var index = -1, length = array == null ? 0 : array.length, resIndex = 0, result = [];
      while (++index < length) {
        var value = array[index];
        if (predicate(value, index, array)) {
          result[resIndex++] = value;
        }
      }
      return result;
    }
    module.exports = arrayFilter;
  }
});

// node_modules/lodash/stubArray.js
var require_stubArray = __commonJS({
  "node_modules/lodash/stubArray.js"(exports, module) {
    function stubArray() {
      return [];
    }
    module.exports = stubArray;
  }
});

// node_modules/lodash/_getSymbols.js
var require_getSymbols = __commonJS({
  "node_modules/lodash/_getSymbols.js"(exports, module) {
    var arrayFilter = require_arrayFilter();
    var stubArray = require_stubArray();
    var objectProto = Object.prototype;
    var propertyIsEnumerable2 = objectProto.propertyIsEnumerable;
    var nativeGetSymbols = Object.getOwnPropertySymbols;
    var getSymbols = !nativeGetSymbols ? stubArray : function(object) {
      if (object == null) {
        return [];
      }
      object = Object(object);
      return arrayFilter(nativeGetSymbols(object), function(symbol) {
        return propertyIsEnumerable2.call(object, symbol);
      });
    };
    module.exports = getSymbols;
  }
});

// node_modules/lodash/_copySymbols.js
var require_copySymbols = __commonJS({
  "node_modules/lodash/_copySymbols.js"(exports, module) {
    var copyObject = require_copyObject();
    var getSymbols = require_getSymbols();
    function copySymbols(source, object) {
      return copyObject(source, getSymbols(source), object);
    }
    module.exports = copySymbols;
  }
});

// node_modules/lodash/_arrayPush.js
var require_arrayPush = __commonJS({
  "node_modules/lodash/_arrayPush.js"(exports, module) {
    function arrayPush(array, values2) {
      var index = -1, length = values2.length, offset = array.length;
      while (++index < length) {
        array[offset + index] = values2[index];
      }
      return array;
    }
    module.exports = arrayPush;
  }
});

// node_modules/lodash/_getPrototype.js
var require_getPrototype = __commonJS({
  "node_modules/lodash/_getPrototype.js"(exports, module) {
    var overArg = require_overArg();
    var getPrototype = overArg(Object.getPrototypeOf, Object);
    module.exports = getPrototype;
  }
});

// node_modules/lodash/_getSymbolsIn.js
var require_getSymbolsIn = __commonJS({
  "node_modules/lodash/_getSymbolsIn.js"(exports, module) {
    var arrayPush = require_arrayPush();
    var getPrototype = require_getPrototype();
    var getSymbols = require_getSymbols();
    var stubArray = require_stubArray();
    var nativeGetSymbols = Object.getOwnPropertySymbols;
    var getSymbolsIn = !nativeGetSymbols ? stubArray : function(object) {
      var result = [];
      while (object) {
        arrayPush(result, getSymbols(object));
        object = getPrototype(object);
      }
      return result;
    };
    module.exports = getSymbolsIn;
  }
});

// node_modules/lodash/_copySymbolsIn.js
var require_copySymbolsIn = __commonJS({
  "node_modules/lodash/_copySymbolsIn.js"(exports, module) {
    var copyObject = require_copyObject();
    var getSymbolsIn = require_getSymbolsIn();
    function copySymbolsIn(source, object) {
      return copyObject(source, getSymbolsIn(source), object);
    }
    module.exports = copySymbolsIn;
  }
});

// node_modules/lodash/_baseGetAllKeys.js
var require_baseGetAllKeys = __commonJS({
  "node_modules/lodash/_baseGetAllKeys.js"(exports, module) {
    var arrayPush = require_arrayPush();
    var isArray4 = require_isArray();
    function baseGetAllKeys(object, keysFunc, symbolsFunc) {
      var result = keysFunc(object);
      return isArray4(object) ? result : arrayPush(result, symbolsFunc(object));
    }
    module.exports = baseGetAllKeys;
  }
});

// node_modules/lodash/_getAllKeys.js
var require_getAllKeys = __commonJS({
  "node_modules/lodash/_getAllKeys.js"(exports, module) {
    var baseGetAllKeys = require_baseGetAllKeys();
    var getSymbols = require_getSymbols();
    var keys4 = require_keys();
    function getAllKeys(object) {
      return baseGetAllKeys(object, keys4, getSymbols);
    }
    module.exports = getAllKeys;
  }
});

// node_modules/lodash/_getAllKeysIn.js
var require_getAllKeysIn = __commonJS({
  "node_modules/lodash/_getAllKeysIn.js"(exports, module) {
    var baseGetAllKeys = require_baseGetAllKeys();
    var getSymbolsIn = require_getSymbolsIn();
    var keysIn = require_keysIn();
    function getAllKeysIn(object) {
      return baseGetAllKeys(object, keysIn, getSymbolsIn);
    }
    module.exports = getAllKeysIn;
  }
});

// node_modules/lodash/_DataView.js
var require_DataView = __commonJS({
  "node_modules/lodash/_DataView.js"(exports, module) {
    var getNative = require_getNative();
    var root = require_root();
    var DataView2 = getNative(root, "DataView");
    module.exports = DataView2;
  }
});

// node_modules/lodash/_Promise.js
var require_Promise = __commonJS({
  "node_modules/lodash/_Promise.js"(exports, module) {
    var getNative = require_getNative();
    var root = require_root();
    var Promise2 = getNative(root, "Promise");
    module.exports = Promise2;
  }
});

// node_modules/lodash/_Set.js
var require_Set = __commonJS({
  "node_modules/lodash/_Set.js"(exports, module) {
    var getNative = require_getNative();
    var root = require_root();
    var Set2 = getNative(root, "Set");
    module.exports = Set2;
  }
});

// node_modules/lodash/_WeakMap.js
var require_WeakMap = __commonJS({
  "node_modules/lodash/_WeakMap.js"(exports, module) {
    var getNative = require_getNative();
    var root = require_root();
    var WeakMap3 = getNative(root, "WeakMap");
    module.exports = WeakMap3;
  }
});

// node_modules/lodash/_getTag.js
var require_getTag = __commonJS({
  "node_modules/lodash/_getTag.js"(exports, module) {
    var DataView2 = require_DataView();
    var Map2 = require_Map();
    var Promise2 = require_Promise();
    var Set2 = require_Set();
    var WeakMap3 = require_WeakMap();
    var baseGetTag = require_baseGetTag();
    var toSource = require_toSource();
    var mapTag = "[object Map]";
    var objectTag = "[object Object]";
    var promiseTag = "[object Promise]";
    var setTag = "[object Set]";
    var weakMapTag = "[object WeakMap]";
    var dataViewTag = "[object DataView]";
    var dataViewCtorString = toSource(DataView2);
    var mapCtorString = toSource(Map2);
    var promiseCtorString = toSource(Promise2);
    var setCtorString = toSource(Set2);
    var weakMapCtorString = toSource(WeakMap3);
    var getTag = baseGetTag;
    if (DataView2 && getTag(new DataView2(new ArrayBuffer(1))) != dataViewTag || Map2 && getTag(new Map2()) != mapTag || Promise2 && getTag(Promise2.resolve()) != promiseTag || Set2 && getTag(new Set2()) != setTag || WeakMap3 && getTag(new WeakMap3()) != weakMapTag) {
      getTag = function(value) {
        var result = baseGetTag(value), Ctor = result == objectTag ? value.constructor : void 0, ctorString = Ctor ? toSource(Ctor) : "";
        if (ctorString) {
          switch (ctorString) {
            case dataViewCtorString:
              return dataViewTag;
            case mapCtorString:
              return mapTag;
            case promiseCtorString:
              return promiseTag;
            case setCtorString:
              return setTag;
            case weakMapCtorString:
              return weakMapTag;
          }
        }
        return result;
      };
    }
    module.exports = getTag;
  }
});

// node_modules/lodash/_initCloneArray.js
var require_initCloneArray = __commonJS({
  "node_modules/lodash/_initCloneArray.js"(exports, module) {
    var objectProto = Object.prototype;
    var hasOwnProperty2 = objectProto.hasOwnProperty;
    function initCloneArray(array) {
      var length = array.length, result = new array.constructor(length);
      if (length && typeof array[0] == "string" && hasOwnProperty2.call(array, "index")) {
        result.index = array.index;
        result.input = array.input;
      }
      return result;
    }
    module.exports = initCloneArray;
  }
});

// node_modules/lodash/_Uint8Array.js
var require_Uint8Array = __commonJS({
  "node_modules/lodash/_Uint8Array.js"(exports, module) {
    var root = require_root();
    var Uint8Array2 = root.Uint8Array;
    module.exports = Uint8Array2;
  }
});

// node_modules/lodash/_cloneArrayBuffer.js
var require_cloneArrayBuffer = __commonJS({
  "node_modules/lodash/_cloneArrayBuffer.js"(exports, module) {
    var Uint8Array2 = require_Uint8Array();
    function cloneArrayBuffer(arrayBuffer) {
      var result = new arrayBuffer.constructor(arrayBuffer.byteLength);
      new Uint8Array2(result).set(new Uint8Array2(arrayBuffer));
      return result;
    }
    module.exports = cloneArrayBuffer;
  }
});

// node_modules/lodash/_cloneDataView.js
var require_cloneDataView = __commonJS({
  "node_modules/lodash/_cloneDataView.js"(exports, module) {
    var cloneArrayBuffer = require_cloneArrayBuffer();
    function cloneDataView(dataView, isDeep) {
      var buffer2 = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;
      return new dataView.constructor(buffer2, dataView.byteOffset, dataView.byteLength);
    }
    module.exports = cloneDataView;
  }
});

// node_modules/lodash/_cloneRegExp.js
var require_cloneRegExp = __commonJS({
  "node_modules/lodash/_cloneRegExp.js"(exports, module) {
    var reFlags = /\w*$/;
    function cloneRegExp(regexp) {
      var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));
      result.lastIndex = regexp.lastIndex;
      return result;
    }
    module.exports = cloneRegExp;
  }
});

// node_modules/lodash/_cloneSymbol.js
var require_cloneSymbol = __commonJS({
  "node_modules/lodash/_cloneSymbol.js"(exports, module) {
    var Symbol2 = require_Symbol();
    var symbolProto = Symbol2 ? Symbol2.prototype : void 0;
    var symbolValueOf = symbolProto ? symbolProto.valueOf : void 0;
    function cloneSymbol(symbol) {
      return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};
    }
    module.exports = cloneSymbol;
  }
});

// node_modules/lodash/_cloneTypedArray.js
var require_cloneTypedArray = __commonJS({
  "node_modules/lodash/_cloneTypedArray.js"(exports, module) {
    var cloneArrayBuffer = require_cloneArrayBuffer();
    function cloneTypedArray(typedArray, isDeep) {
      var buffer2 = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;
      return new typedArray.constructor(buffer2, typedArray.byteOffset, typedArray.length);
    }
    module.exports = cloneTypedArray;
  }
});

// node_modules/lodash/_initCloneByTag.js
var require_initCloneByTag = __commonJS({
  "node_modules/lodash/_initCloneByTag.js"(exports, module) {
    var cloneArrayBuffer = require_cloneArrayBuffer();
    var cloneDataView = require_cloneDataView();
    var cloneRegExp = require_cloneRegExp();
    var cloneSymbol = require_cloneSymbol();
    var cloneTypedArray = require_cloneTypedArray();
    var boolTag = "[object Boolean]";
    var dateTag = "[object Date]";
    var mapTag = "[object Map]";
    var numberTag = "[object Number]";
    var regexpTag = "[object RegExp]";
    var setTag = "[object Set]";
    var stringTag = "[object String]";
    var symbolTag = "[object Symbol]";
    var arrayBufferTag = "[object ArrayBuffer]";
    var dataViewTag = "[object DataView]";
    var float32Tag = "[object Float32Array]";
    var float64Tag = "[object Float64Array]";
    var int8Tag = "[object Int8Array]";
    var int16Tag = "[object Int16Array]";
    var int32Tag = "[object Int32Array]";
    var uint8Tag = "[object Uint8Array]";
    var uint8ClampedTag = "[object Uint8ClampedArray]";
    var uint16Tag = "[object Uint16Array]";
    var uint32Tag = "[object Uint32Array]";
    function initCloneByTag(object, tag, isDeep) {
      var Ctor = object.constructor;
      switch (tag) {
        case arrayBufferTag:
          return cloneArrayBuffer(object);
        case boolTag:
        case dateTag:
          return new Ctor(+object);
        case dataViewTag:
          return cloneDataView(object, isDeep);
        case float32Tag:
        case float64Tag:
        case int8Tag:
        case int16Tag:
        case int32Tag:
        case uint8Tag:
        case uint8ClampedTag:
        case uint16Tag:
        case uint32Tag:
          return cloneTypedArray(object, isDeep);
        case mapTag:
          return new Ctor();
        case numberTag:
        case stringTag:
          return new Ctor(object);
        case regexpTag:
          return cloneRegExp(object);
        case setTag:
          return new Ctor();
        case symbolTag:
          return cloneSymbol(object);
      }
    }
    module.exports = initCloneByTag;
  }
});

// node_modules/lodash/_baseCreate.js
var require_baseCreate = __commonJS({
  "node_modules/lodash/_baseCreate.js"(exports, module) {
    var isObject3 = require_isObject();
    var objectCreate2 = Object.create;
    var baseCreate = /* @__PURE__ */ function() {
      function object() {
      }
      return function(proto) {
        if (!isObject3(proto)) {
          return {};
        }
        if (objectCreate2) {
          return objectCreate2(proto);
        }
        object.prototype = proto;
        var result = new object();
        object.prototype = void 0;
        return result;
      };
    }();
    module.exports = baseCreate;
  }
});

// node_modules/lodash/_initCloneObject.js
var require_initCloneObject = __commonJS({
  "node_modules/lodash/_initCloneObject.js"(exports, module) {
    var baseCreate = require_baseCreate();
    var getPrototype = require_getPrototype();
    var isPrototype = require_isPrototype();
    function initCloneObject(object) {
      return typeof object.constructor == "function" && !isPrototype(object) ? baseCreate(getPrototype(object)) : {};
    }
    module.exports = initCloneObject;
  }
});

// node_modules/lodash/_baseIsMap.js
var require_baseIsMap = __commonJS({
  "node_modules/lodash/_baseIsMap.js"(exports, module) {
    var getTag = require_getTag();
    var isObjectLike2 = require_isObjectLike();
    var mapTag = "[object Map]";
    function baseIsMap(value) {
      return isObjectLike2(value) && getTag(value) == mapTag;
    }
    module.exports = baseIsMap;
  }
});

// node_modules/lodash/isMap.js
var require_isMap = __commonJS({
  "node_modules/lodash/isMap.js"(exports, module) {
    var baseIsMap = require_baseIsMap();
    var baseUnary = require_baseUnary();
    var nodeUtil = require_nodeUtil();
    var nodeIsMap = nodeUtil && nodeUtil.isMap;
    var isMap = nodeIsMap ? baseUnary(nodeIsMap) : baseIsMap;
    module.exports = isMap;
  }
});

// node_modules/lodash/_baseIsSet.js
var require_baseIsSet = __commonJS({
  "node_modules/lodash/_baseIsSet.js"(exports, module) {
    var getTag = require_getTag();
    var isObjectLike2 = require_isObjectLike();
    var setTag = "[object Set]";
    function baseIsSet(value) {
      return isObjectLike2(value) && getTag(value) == setTag;
    }
    module.exports = baseIsSet;
  }
});

// node_modules/lodash/isSet.js
var require_isSet = __commonJS({
  "node_modules/lodash/isSet.js"(exports, module) {
    var baseIsSet = require_baseIsSet();
    var baseUnary = require_baseUnary();
    var nodeUtil = require_nodeUtil();
    var nodeIsSet = nodeUtil && nodeUtil.isSet;
    var isSet = nodeIsSet ? baseUnary(nodeIsSet) : baseIsSet;
    module.exports = isSet;
  }
});

// node_modules/lodash/_baseClone.js
var require_baseClone = __commonJS({
  "node_modules/lodash/_baseClone.js"(exports, module) {
    var Stack = require_Stack();
    var arrayEach = require_arrayEach();
    var assignValue = require_assignValue();
    var baseAssign = require_baseAssign();
    var baseAssignIn = require_baseAssignIn();
    var cloneBuffer = require_cloneBuffer();
    var copyArray = require_copyArray();
    var copySymbols = require_copySymbols();
    var copySymbolsIn = require_copySymbolsIn();
    var getAllKeys = require_getAllKeys();
    var getAllKeysIn = require_getAllKeysIn();
    var getTag = require_getTag();
    var initCloneArray = require_initCloneArray();
    var initCloneByTag = require_initCloneByTag();
    var initCloneObject = require_initCloneObject();
    var isArray4 = require_isArray();
    var isBuffer = require_isBuffer();
    var isMap = require_isMap();
    var isObject3 = require_isObject();
    var isSet = require_isSet();
    var keys4 = require_keys();
    var keysIn = require_keysIn();
    var CLONE_DEEP_FLAG = 1;
    var CLONE_FLAT_FLAG = 2;
    var CLONE_SYMBOLS_FLAG = 4;
    var argsTag = "[object Arguments]";
    var arrayTag = "[object Array]";
    var boolTag = "[object Boolean]";
    var dateTag = "[object Date]";
    var errorTag = "[object Error]";
    var funcTag = "[object Function]";
    var genTag = "[object GeneratorFunction]";
    var mapTag = "[object Map]";
    var numberTag = "[object Number]";
    var objectTag = "[object Object]";
    var regexpTag = "[object RegExp]";
    var setTag = "[object Set]";
    var stringTag = "[object String]";
    var symbolTag = "[object Symbol]";
    var weakMapTag = "[object WeakMap]";
    var arrayBufferTag = "[object ArrayBuffer]";
    var dataViewTag = "[object DataView]";
    var float32Tag = "[object Float32Array]";
    var float64Tag = "[object Float64Array]";
    var int8Tag = "[object Int8Array]";
    var int16Tag = "[object Int16Array]";
    var int32Tag = "[object Int32Array]";
    var uint8Tag = "[object Uint8Array]";
    var uint8ClampedTag = "[object Uint8ClampedArray]";
    var uint16Tag = "[object Uint16Array]";
    var uint32Tag = "[object Uint32Array]";
    var cloneableTags = {};
    cloneableTags[argsTag] = cloneableTags[arrayTag] = cloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] = cloneableTags[boolTag] = cloneableTags[dateTag] = cloneableTags[float32Tag] = cloneableTags[float64Tag] = cloneableTags[int8Tag] = cloneableTags[int16Tag] = cloneableTags[int32Tag] = cloneableTags[mapTag] = cloneableTags[numberTag] = cloneableTags[objectTag] = cloneableTags[regexpTag] = cloneableTags[setTag] = cloneableTags[stringTag] = cloneableTags[symbolTag] = cloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] = cloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;
    cloneableTags[errorTag] = cloneableTags[funcTag] = cloneableTags[weakMapTag] = false;
    function baseClone(value, bitmask, customizer, key, object, stack) {
      var result, isDeep = bitmask & CLONE_DEEP_FLAG, isFlat = bitmask & CLONE_FLAT_FLAG, isFull = bitmask & CLONE_SYMBOLS_FLAG;
      if (customizer) {
        result = object ? customizer(value, key, object, stack) : customizer(value);
      }
      if (result !== void 0) {
        return result;
      }
      if (!isObject3(value)) {
        return value;
      }
      var isArr = isArray4(value);
      if (isArr) {
        result = initCloneArray(value);
        if (!isDeep) {
          return copyArray(value, result);
        }
      } else {
        var tag = getTag(value), isFunc = tag == funcTag || tag == genTag;
        if (isBuffer(value)) {
          return cloneBuffer(value, isDeep);
        }
        if (tag == objectTag || tag == argsTag || isFunc && !object) {
          result = isFlat || isFunc ? {} : initCloneObject(value);
          if (!isDeep) {
            return isFlat ? copySymbolsIn(value, baseAssignIn(result, value)) : copySymbols(value, baseAssign(result, value));
          }
        } else {
          if (!cloneableTags[tag]) {
            return object ? value : {};
          }
          result = initCloneByTag(value, tag, isDeep);
        }
      }
      stack || (stack = new Stack());
      var stacked = stack.get(value);
      if (stacked) {
        return stacked;
      }
      stack.set(value, result);
      if (isSet(value)) {
        value.forEach(function(subValue) {
          result.add(baseClone(subValue, bitmask, customizer, subValue, value, stack));
        });
      } else if (isMap(value)) {
        value.forEach(function(subValue, key2) {
          result.set(key2, baseClone(subValue, bitmask, customizer, key2, value, stack));
        });
      }
      var keysFunc = isFull ? isFlat ? getAllKeysIn : getAllKeys : isFlat ? keysIn : keys4;
      var props = isArr ? void 0 : keysFunc(value);
      arrayEach(props || value, function(subValue, key2) {
        if (props) {
          key2 = subValue;
          subValue = value[key2];
        }
        assignValue(result, key2, baseClone(subValue, bitmask, customizer, key2, value, stack));
      });
      return result;
    }
    module.exports = baseClone;
  }
});

// node_modules/lodash/cloneDeep.js
var require_cloneDeep = __commonJS({
  "node_modules/lodash/cloneDeep.js"(exports, module) {
    var baseClone = require_baseClone();
    var CLONE_DEEP_FLAG = 1;
    var CLONE_SYMBOLS_FLAG = 4;
    function cloneDeep2(value) {
      return baseClone(value, CLONE_DEEP_FLAG | CLONE_SYMBOLS_FLAG);
    }
    module.exports = cloneDeep2;
  }
});

// node_modules/text-encoding-shim/index.js
var require_text_encoding_shim = __commonJS({
  "node_modules/text-encoding-shim/index.js"(exports, module) {
    (function(root, factory) {
      if (typeof define === "function" && define.amd) {
        define([], factory);
      } else if (typeof exports === "object") {
        module.exports = factory();
      } else {
        var textEncoding = factory();
        root.TextEncoder = textEncoding.TextEncoder;
        root.TextDecoder = textEncoding.TextDecoder;
      }
    })(exports, function() {
      "use strict";
      var g2 = typeof global !== "undefined" ? global : self;
      if (typeof g2.TextEncoder !== "undefined" && typeof g2.TextDecoder !== "undefined") {
        return { "TextEncoder": g2.TextEncoder, "TextDecoder": g2.TextDecoder };
      }
      var utf8Encodings = [
        "utf8",
        "utf-8",
        "unicode-1-1-utf-8"
      ];
      var TextEncoder = function(encoding) {
        if (utf8Encodings.indexOf(encoding) < 0 && typeof encoding !== "undefined" && encoding !== null) {
          throw new RangeError("Invalid encoding type. Only utf-8 is supported");
        } else {
          this.encoding = "utf-8";
          this.encode = function(str) {
            if (typeof str !== "string") {
              throw new TypeError("passed argument must be of type string");
            }
            var binstr = unescape(encodeURIComponent(str)), arr = new Uint8Array(binstr.length);
            binstr.split("").forEach(function(char, i2) {
              arr[i2] = char.charCodeAt(0);
            });
            return arr;
          };
        }
      };
      var TextDecoder2 = function(encoding, options) {
        if (utf8Encodings.indexOf(encoding) < 0 && typeof encoding !== "undefined" && encoding !== null) {
          throw new RangeError("Invalid encoding type. Only utf-8 is supported");
        }
        this.encoding = "utf-8";
        this.ignoreBOM = false;
        this.fatal = typeof options !== "undefined" && "fatal" in options ? options.fatal : false;
        if (typeof this.fatal !== "boolean") {
          throw new TypeError("fatal flag must be boolean");
        }
        this.decode = function(view, options2) {
          if (typeof view === "undefined") {
            return "";
          }
          var stream = typeof options2 !== "undefined" && "stream" in options2 ? options2.stream : false;
          if (typeof stream !== "boolean") {
            throw new TypeError("stream option must be boolean");
          }
          if (!ArrayBuffer.isView(view)) {
            throw new TypeError("passed argument must be an array buffer view");
          } else {
            var arr = new Uint8Array(view.buffer, view.byteOffset, view.byteLength), charArr = new Array(arr.length);
            arr.forEach(function(charcode, i2) {
              charArr[i2] = String.fromCharCode(charcode);
            });
            return decodeURIComponent(escape(charArr.join("")));
          }
        };
      };
      return { "TextEncoder": TextEncoder, "TextDecoder": TextDecoder2 };
    });
  }
});

// node_modules/@cloudbase/utilities/dist/esm/constants/index.js
var constants_exports = {};
__export(constants_exports, {
  COMMUNITY_SITE_URL: () => COMMUNITY_SITE_URL,
  ERRORS: () => ERRORS,
  IS_DEBUG_MODE: () => IS_DEBUG_MODE,
  OATUH_LOGINTYPE: () => OATUH_LOGINTYPE,
  getProtocol: () => getProtocol,
  getSdkName: () => getSdkName,
  setProtocol: () => setProtocol,
  setSdkName: () => setSdkName
});

// node_modules/@cloudbase/utilities/dist/esm/constants/common.js
var sdkName = "@cloudbase/js-sdk";
function setSdkName(name) {
  sdkName = name;
}
function getSdkName() {
  return sdkName;
}
var PROTOCOL = "https:";
function setProtocol(protocol) {
  PROTOCOL = protocol;
}
function getProtocol() {
  return PROTOCOL;
}
var IS_DEBUG_MODE = true;
var COMMUNITY_SITE_URL = "https://support.qq.com/products/148793";

// node_modules/@cloudbase/utilities/dist/esm/constants/errors.js
var ERRORS = {
  INVALID_PARAMS: "INVALID_PARAMS",
  INVALID_SYNTAX: "INVALID_SYNTAX",
  INVALID_OPERATION: "INVALID_OPERATION",
  OPERATION_FAIL: "OPERATION_FAIL",
  NETWORK_ERROR: "NETWORK_ERROR",
  UNKOWN_ERROR: "UNKOWN_ERROR"
};

// node_modules/@cloudbase/utilities/dist/esm/constants/index.js
var OATUH_LOGINTYPE = "constants";

// node_modules/@cloudbase/utilities/dist/esm/adapters/index.js
var adapters_exports = {};
__export(adapters_exports, {
  RUNTIME: () => RUNTIME,
  useAdapters: () => useAdapters,
  useDefaultAdapter: () => useDefaultAdapter
});

// node_modules/@cloudbase/utilities/dist/esm/adapters/platforms/web.js
init_esm();

// node_modules/@cloudbase/utilities/dist/esm/libs/util.js
var util_exports = {};
__export(util_exports, {
  createPromiseCallback: () => createPromiseCallback,
  execCallback: () => execCallback,
  formatUrl: () => formatUrl2,
  genSeqId: () => genSeqId,
  generateRequestId: () => generateRequestId,
  getHash: () => getHash,
  getQuery: () => getQuery,
  isArray: () => isArray,
  isFormData: () => isFormData,
  isInstanceOf: () => isInstanceOf,
  isNull: () => isNull,
  isPalinObject: () => isPalinObject,
  isString: () => isString,
  isUndefined: () => isUndefined,
  parseCaptcha: () => parseCaptcha,
  parseQueryString: () => parseQueryString,
  printError: () => printError,
  printGroupLog: () => printGroupLog,
  printInfo: () => printInfo,
  printWarn: () => printWarn,
  removeParam: () => removeParam,
  sleep: () => sleep,
  throwError: () => throwError,
  toQueryString: () => toQueryString,
  transformPhone: () => transformPhone
});
var __rest = function(s2, e3) {
  var t3 = {};
  for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e3.indexOf(p2) < 0)
    t3[p2] = s2[p2];
  if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
      if (e3.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
        t3[p2[i2]] = s2[p2[i2]];
    }
  return t3;
};
function isArray(val) {
  return Object.prototype.toString.call(val) === "[object Array]";
}
function isString(val) {
  return typeof val === "string";
}
function isUndefined(val) {
  return typeof val === "undefined";
}
function isPalinObject(val) {
  return Object.prototype.toString.call(val) === "[object Object]";
}
function isNull(val) {
  return Object.prototype.toString.call(val) === "[object Null]";
}
function isInstanceOf(instance, construct2) {
  return instance instanceof construct2;
}
function isFormData(val) {
  return Object.prototype.toString.call(val) === "[object FormData]";
}
function genSeqId() {
  return Math.random().toString(16).slice(2);
}
function generateRequestId() {
  var d2 = (/* @__PURE__ */ new Date()).getTime();
  var d22 = (Date === null || Date === void 0 ? void 0 : Date.now) && Date.now() * 1e3 || 0;
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(c2) {
    var r3 = Math.random() * 16;
    if (d2 > 0) {
      r3 = (d2 + r3) % 16 | 0;
      d2 = Math.floor(d2 / 16);
    } else {
      r3 = (d22 + r3) % 16 | 0;
      d22 = Math.floor(d22 / 16);
    }
    return (c2 === "x" ? r3 : r3 & 7 | 8).toString(16);
  });
}
function formatUrl2(PROTOCOL2, url2, query) {
  if (query === void 0) {
    query = {};
  }
  var urlHasQuery = /\?/.test(url2);
  var queryString = "";
  Object.keys(query).forEach(function(key) {
    if (queryString === "") {
      !urlHasQuery && (url2 += "?");
    } else {
      queryString += "&";
    }
    queryString += "".concat(key, "=").concat(encodeURIComponent(query[key]));
  });
  url2 += queryString;
  if (/^http(s)?:\/\//.test(url2)) {
    return url2;
  }
  return "".concat(PROTOCOL2).concat(url2);
}
function toQueryString(query) {
  if (query === void 0) {
    query = {};
  }
  var queryString = [];
  Object.keys(query).forEach(function(key) {
    queryString.push("".concat(key, "=").concat(encodeURIComponent(query[key])));
  });
  return queryString.join("&");
}
function getQuery(name, url2) {
  if (typeof window === "undefined") {
    return false;
  }
  var u2 = url2 || decodeURIComponent(window.location.search);
  var reg = new RegExp("(^|&)".concat(name, "=([^&]*)(&|$)"));
  var r3 = u2.substr(u2.indexOf("?") + 1).match(reg);
  return r3 !== null && r3 !== void 0 ? r3[2] : "";
}
var getHash = function(name) {
  if (typeof window === "undefined") {
    return "";
  }
  var matches = window.location.hash.match(new RegExp("[#?&/]".concat(name, "=([^&#]*)")));
  return matches ? matches[1] : "";
};
function removeParam(key, sourceURL) {
  var rtn = sourceURL.split("?")[0];
  var param;
  var params = [];
  var queryString = sourceURL.indexOf("?") !== -1 ? sourceURL.split("?")[1] : "";
  if (queryString !== "") {
    params = queryString.split("&");
    for (var i2 = params.length - 1; i2 >= 0; i2 -= 1) {
      param = params[i2].split("=")[0];
      if (param === key) {
        params.splice(i2, 1);
      }
    }
    rtn = "".concat(rtn, "?").concat(params.join("&"));
  }
  return rtn;
}
function createPromiseCallback() {
  var cb = {};
  if (!Promise) {
    cb = function() {
    };
    cb.promise = {};
    var throwPromiseNotDefined = function() {
      throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.');
    };
    Object.defineProperty(cb.promise, "then", { get: throwPromiseNotDefined });
    Object.defineProperty(cb.promise, "catch", { get: throwPromiseNotDefined });
    return cb;
  }
  var promise = new Promise(function(resolve, reject) {
    cb = function(err, data2) {
      if (err)
        return reject(err);
      return resolve(data2);
    };
  });
  cb.promise = promise;
  return cb;
}
function execCallback(fn, err, data2) {
  if (data2 === void 0) {
    data2 = null;
  }
  if (fn && typeof fn === "function") {
    return fn(err, data2);
  }
  if (err) {
    throw err;
  }
  return data2;
}
function printWarn(error, msg) {
  console.warn("[".concat(getSdkName(), "][").concat(error, "]:").concat(msg));
}
function printError(error, msg) {
  console.error({
    code: error,
    msg: "[".concat(getSdkName(), "][").concat(error, "]:").concat(msg)
  });
}
function printInfo(error, msg) {
  console.log("[".concat(getSdkName(), "][").concat(error, "]:").concat(msg));
}
function throwError(error, msg) {
  throw new Error(JSON.stringify({
    code: error,
    msg: "[".concat(getSdkName(), "][").concat(error, "]:").concat(msg)
  }));
}
function printGroupLog(options) {
  var _a3;
  var title = options.title, _b = options.subtitle, subtitle = _b === void 0 ? "" : _b, _c = options.content, content = _c === void 0 ? [] : _c, _d = options.printTrace, printTrace = _d === void 0 ? false : _d, _e2 = options.collapsed, collapsed = _e2 === void 0 ? false : _e2;
  if (collapsed) {
    (console.groupCollapsed || console.error)(title, subtitle);
  } else {
    (console.group || console.error)(title, subtitle);
  }
  for (var _i = 0, content_1 = content; _i < content_1.length; _i++) {
    var tip = content_1[_i];
    var type = tip.type, body = tip.body;
    switch (type) {
      case "info":
        console.log(body);
        break;
      case "warn":
        console.warn(body);
        break;
      case "error":
        console.error(body);
        break;
    }
  }
  if (printTrace) {
    (console.trace || console.log)("stack trace:");
  }
  (_a3 = console.groupEnd) === null || _a3 === void 0 ? void 0 : _a3.call(console);
}
var sleep = function(ms) {
  if (ms === void 0) {
    ms = 0;
  }
  return new Promise(function(r3) {
    return setTimeout(r3, ms);
  });
};
function transformPhone(phoneNumber) {
  return "+86".concat(phoneNumber);
}
var parseQueryString = function(queryString) {
  queryString = queryString.replace(/^\?/, "");
  var params = {};
  var pairs = queryString.split("&");
  pairs.forEach(function(item) {
    var _a3 = item.split("="), key = _a3[0], value = _a3[1];
    key = decodeURIComponent(key);
    value = decodeURIComponent(value);
    if (key) {
      if (params[key]) {
        if (Array.isArray(params[key])) {
          params[key].push(value);
        } else {
          params[key] = [params[key], value];
        }
      } else {
        params[key] = value;
      }
    }
  });
  return params;
};
function parseCaptcha(url2) {
  var queryObj = {};
  var matched = url2.match(/^(data:.*?)(\?[^#\s]*)?$/);
  if (matched) {
    url2 = matched[1];
    var search = matched[2];
    if (search) {
      queryObj = parseQueryString(search);
    }
  }
  var token = queryObj.token, restQueryObj = __rest(queryObj, ["token"]);
  if (/^data:/.test(url2) && !token) {
    return {
      error: "invalid_argument",
      error_description: "invalid captcha data: ".concat(url2)
    };
  }
  if (!token) {
    return {
      error: "unimplemented",
      error_description: "need to impl captcha data"
    };
  }
  return {
    state: restQueryObj.state,
    token,
    captchaData: url2
  };
}

// node_modules/@cloudbase/utilities/dist/esm/adapters/platforms/web.js
var __extends = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var __assign = function() {
  __assign = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign.apply(this, arguments);
};
var __awaiter = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var WebRequest = function(_super) {
  __extends(WebRequest2, _super);
  function WebRequest2(config) {
    var _this = _super.call(this) || this;
    var timeout = config.timeout, timeoutMsg = config.timeoutMsg, restrictedMethods = config.restrictedMethods;
    _this.timeout = timeout || 0;
    _this.timeoutMsg = timeoutMsg || "";
    _this.restrictedMethods = restrictedMethods || ["get", "post", "upload", "download"];
    return _this;
  }
  WebRequest2.prototype.get = function(options) {
    return this.request(__assign(__assign({}, options), { method: "get" }), this.restrictedMethods.includes("get"));
  };
  WebRequest2.prototype.post = function(options) {
    return this.request(__assign(__assign({}, options), { method: "post" }), this.restrictedMethods.includes("post"));
  };
  WebRequest2.prototype.put = function(options) {
    return this.request(__assign(__assign({}, options), { method: "put" }));
  };
  WebRequest2.prototype.upload = function(options) {
    var data2 = options.data, file = options.file, name = options.name, method = options.method, _a3 = options.headers, headers = _a3 === void 0 ? {} : _a3;
    var reqMethod = { post: "post", put: "put" }[method === null || method === void 0 ? void 0 : method.toLowerCase()] || "put";
    var formData = new FormData();
    if (reqMethod === "post") {
      Object.keys(data2).forEach(function(key) {
        formData.append(key, data2[key]);
      });
      formData.append("key", name);
      formData.append("file", file);
      return this.request(__assign(__assign({}, options), { data: formData, method: reqMethod }), this.restrictedMethods.includes("upload"));
    }
    return this.request(__assign(__assign({}, options), { method: "put", headers, body: file }), this.restrictedMethods.includes("upload"));
  };
  WebRequest2.prototype.download = function(options) {
    return __awaiter(this, void 0, void 0, function() {
      var data2, url2, fileName, link, e_1;
      return __generator(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            return [4, this.get(__assign(__assign({}, options), { headers: {}, responseType: "blob" }))];
          case 1:
            data2 = _a3.sent().data;
            url2 = window.URL.createObjectURL(new Blob([data2]));
            fileName = decodeURIComponent(new URL(options.url).pathname.split("/").pop() || "");
            link = document.createElement("a");
            link.href = url2;
            link.setAttribute("download", fileName);
            link.style.display = "none";
            document.body.appendChild(link);
            link.click();
            window.URL.revokeObjectURL(url2);
            document.body.removeChild(link);
            return [3, 3];
          case 2:
            e_1 = _a3.sent();
            return [3, 3];
          case 3:
            return [2, new Promise(function(resolve) {
              resolve({
                statusCode: 200,
                tempFilePath: options.url
              });
            })];
        }
      });
    });
  };
  WebRequest2.prototype.fetch = function(options) {
    var _a3;
    return __awaiter(this, void 0, void 0, function() {
      var abortController, url2, _b, enableAbort, _c, stream, signal, _timeout, _d, shouldThrowOnError, timeout, timer, res;
      var _this = this;
      return __generator(this, function(_e2) {
        switch (_e2.label) {
          case 0:
            abortController = new AbortController();
            url2 = options.url, _b = options.enableAbort, enableAbort = _b === void 0 ? false : _b, _c = options.stream, stream = _c === void 0 ? false : _c, signal = options.signal, _timeout = options.timeout, _d = options.shouldThrowOnError, shouldThrowOnError = _d === void 0 ? true : _d;
            timeout = _timeout !== null && _timeout !== void 0 ? _timeout : this.timeout;
            if (signal) {
              if (signal.aborted)
                abortController.abort();
              signal.addEventListener("abort", function() {
                return abortController.abort();
              });
            }
            timer = null;
            if (enableAbort && timeout) {
              timer = setTimeout(function() {
                console.warn(_this.timeoutMsg);
                abortController.abort(new Error(_this.timeoutMsg));
              }, timeout);
            }
            return [4, fetch(url2, __assign(__assign({}, options), { signal: abortController.signal })).then(function(response) {
              return __awaiter(_this, void 0, void 0, function() {
                var _a4, _b2, _c2;
                return __generator(this, function(_d2) {
                  switch (_d2.label) {
                    case 0:
                      clearTimeout(timer);
                      if (!shouldThrowOnError) return [3, 4];
                      if (!response.ok) return [3, 1];
                      _a4 = response;
                      return [3, 3];
                    case 1:
                      _c2 = (_b2 = Promise).reject;
                      return [4, response.json()];
                    case 2:
                      _a4 = _c2.apply(_b2, [_d2.sent()]);
                      _d2.label = 3;
                    case 3:
                      return [2, _a4];
                    case 4:
                      return [2, response];
                  }
                });
              });
            }).catch(function(x2) {
              clearTimeout(timer);
              if (shouldThrowOnError) {
                return Promise.reject(x2);
              }
            })];
          case 1:
            res = _e2.sent();
            return [2, {
              data: stream ? res.body : ((_a3 = res.headers.get("content-type")) === null || _a3 === void 0 ? void 0 : _a3.includes("application/json")) ? res.json() : res.text(),
              statusCode: res.status,
              header: res.headers
            }];
        }
      });
    });
  };
  WebRequest2.prototype.request = function(options, enableAbort) {
    var _this = this;
    if (enableAbort === void 0) {
      enableAbort = false;
    }
    var method = String(options.method).toLowerCase() || "get";
    return new Promise(function(resolve) {
      var url2 = options.url, _a3 = options.headers, headers = _a3 === void 0 ? {} : _a3, data2 = options.data, responseType = options.responseType, withCredentials = options.withCredentials, body = options.body, onUploadProgress = options.onUploadProgress;
      var realUrl = formatUrl2(getProtocol(), url2, method === "get" ? data2 : {});
      var ajax = new XMLHttpRequest();
      ajax.open(method, realUrl);
      responseType && (ajax.responseType = responseType);
      Object.keys(headers).forEach(function(key) {
        ajax.setRequestHeader(key, headers[key]);
      });
      var timer;
      if (onUploadProgress) {
        ajax.upload.addEventListener("progress", onUploadProgress);
      }
      ajax.onreadystatechange = function() {
        var result = {};
        if (ajax.readyState === 4) {
          var headers_1 = ajax.getAllResponseHeaders();
          var arr = headers_1.trim().split(/[\r\n]+/);
          var headerMap_1 = {};
          arr.forEach(function(line) {
            var parts = line.split(": ");
            var header = parts.shift().toLowerCase();
            var value = parts.join(": ");
            headerMap_1[header] = value;
          });
          result.header = headerMap_1;
          result.statusCode = ajax.status;
          try {
            result.data = responseType === "blob" ? ajax.response : JSON.parse(ajax.responseText);
          } catch (e3) {
            result.data = responseType === "blob" ? ajax.response : ajax.responseText;
          }
          clearTimeout(timer);
          resolve(result);
        }
      };
      if (enableAbort && _this.timeout) {
        timer = setTimeout(function() {
          console.warn(_this.timeoutMsg);
          ajax.abort();
        }, _this.timeout);
      }
      var payload;
      if (isFormData(data2)) {
        payload = data2;
      } else if (headers["content-type"] === "application/x-www-form-urlencoded") {
        payload = toQueryString(data2);
      } else if (body) {
        payload = body;
      } else {
        payload = data2 ? JSON.stringify(data2) : void 0;
      }
      if (withCredentials) {
        ajax.withCredentials = true;
      }
      ajax.send(payload);
    });
  };
  return WebRequest2;
}(AbstractSDKRequest);
function genAdapter() {
  var adapter2 = {
    type: "default",
    root: window,
    reqClass: WebRequest,
    wsClass: WebSocket,
    localStorage
  };
  return adapter2;
}

// node_modules/@cloudbase/utilities/dist/esm/adapters/index.js
var __assign2 = function() {
  __assign2 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign2.apply(this, arguments);
};
var RUNTIME;
(function(RUNTIME2) {
  RUNTIME2["WEB"] = "web";
  RUNTIME2["WX_MP"] = "wx_mp";
})(RUNTIME || (RUNTIME = {}));
function useAdapters(adapters, options) {
  var adapterList = isArray(adapters) ? adapters : [adapters];
  for (var _i = 0, adapterList_1 = adapterList; _i < adapterList_1.length; _i++) {
    var adapter2 = adapterList_1[_i];
    var isMatch2 = adapter2.isMatch, genAdapter3 = adapter2.genAdapter, runtime2 = adapter2.runtime;
    if (isMatch2()) {
      return {
        adapter: __assign2({ isMatch: isMatch2 }, genAdapter3(options)),
        runtime: runtime2
      };
    }
  }
}
function useDefaultAdapter() {
  return {
    adapter: __assign2({}, genAdapter()),
    runtime: RUNTIME.WEB
  };
}

// node_modules/@cloudbase/utilities/dist/esm/libs/cache.js
var cache_exports = {};
__export(cache_exports, {
  CloudbaseCache: () => CloudbaseCache
});
init_esm();
var __extends2 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var __awaiter2 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator2 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var TcbCacheObject = function(_super) {
  __extends2(TcbCacheObject2, _super);
  function TcbCacheObject2(root) {
    var _this = _super.call(this) || this;
    _this.root = root;
    if (!root.tcbCacheObject) {
      root.tcbCacheObject = {};
    }
    return _this;
  }
  TcbCacheObject2.prototype.setItem = function(key, value) {
    this.root.tcbCacheObject[key] = value;
  };
  TcbCacheObject2.prototype.getItem = function(key) {
    return this.root.tcbCacheObject[key];
  };
  TcbCacheObject2.prototype.removeItem = function(key) {
    delete this.root.tcbCacheObject[key];
  };
  TcbCacheObject2.prototype.clear = function() {
    delete this.root.tcbCacheObject;
  };
  return TcbCacheObject2;
}(AbstractStorage);
function createStorage(persistence, adapter2) {
  switch (persistence) {
    case "local":
      if (!adapter2.localStorage) {
        printWarn(ERRORS.INVALID_PARAMS, "localStorage is not supported on current platform");
        return new TcbCacheObject(adapter2.root);
      }
      return adapter2.localStorage;
    case "none":
      return new TcbCacheObject(adapter2.root);
    default:
      if (!adapter2.localStorage) {
        printWarn(ERRORS.INVALID_PARAMS, "localStorage is not supported on current platform");
        return new TcbCacheObject(adapter2.root);
      }
      return adapter2.localStorage;
  }
}
var CloudbaseCache = function() {
  function CloudbaseCache4(config) {
    this.keys = {};
    var persistence = config.persistence, _a3 = config.platformInfo, platformInfo = _a3 === void 0 ? {} : _a3, _b = config.keys, keys4 = _b === void 0 ? {} : _b;
    this.platformInfo = platformInfo;
    if (!this.storage) {
      this.persistenceTag = this.platformInfo.adapter.primaryStorage || persistence;
      this.storage = createStorage(this.persistenceTag, this.platformInfo.adapter);
      this.keys = keys4;
    }
  }
  Object.defineProperty(CloudbaseCache4.prototype, "mode", {
    get: function() {
      return this.storage.mode || "sync";
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(CloudbaseCache4.prototype, "persistence", {
    get: function() {
      return this.persistenceTag;
    },
    enumerable: false,
    configurable: true
  });
  CloudbaseCache4.prototype.setStore = function(key, value, version3) {
    if (this.mode === "async") {
      printWarn(ERRORS.INVALID_OPERATION, "current platform's storage is asynchronous, please use setStoreAsync insteed");
      return;
    }
    if (!this.storage) {
      return;
    }
    try {
      var val = {
        version: version3 || "localCachev1",
        content: value
      };
      this.storage.setItem(key, JSON.stringify(val));
    } catch (e3) {
      throw new Error(JSON.stringify({
        code: ERRORS.OPERATION_FAIL,
        msg: "[".concat(getSdkName(), "][").concat(ERRORS.OPERATION_FAIL, "]setStore failed"),
        info: e3
      }));
    }
    return;
  };
  CloudbaseCache4.prototype.setStoreAsync = function(key, value, version3) {
    return __awaiter2(this, void 0, void 0, function() {
      var val, e_1;
      return __generator2(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            if (!this.storage) {
              return [2];
            }
            _a3.label = 1;
          case 1:
            _a3.trys.push([1, 3, , 4]);
            val = {
              version: version3 || "localCachev1",
              content: value
            };
            return [4, this.storage.setItem(key, JSON.stringify(val))];
          case 2:
            _a3.sent();
            return [3, 4];
          case 3:
            e_1 = _a3.sent();
            return [2];
          case 4:
            return [2];
        }
      });
    });
  };
  CloudbaseCache4.prototype.getStore = function(key, version3) {
    var _a3;
    if (this.mode === "async") {
      printWarn(ERRORS.INVALID_OPERATION, "current platform's storage is asynchronous, please use getStoreAsync insteed");
      return;
    }
    try {
      if (typeof process !== "undefined" && ((_a3 = process.env) === null || _a3 === void 0 ? void 0 : _a3.tcb_token)) {
        return process.env.tcb_token;
      }
      if (!this.storage) {
        return "";
      }
    } catch (e3) {
      return "";
    }
    version3 = version3 || "localCachev1";
    var content = this.storage.getItem(key);
    if (!content) {
      return "";
    }
    if (content.indexOf(version3) >= 0) {
      var d2 = JSON.parse(content);
      return d2.content;
    }
    return "";
  };
  CloudbaseCache4.prototype.getStoreAsync = function(key, version3) {
    var _a3;
    return __awaiter2(this, void 0, void 0, function() {
      var content, d2;
      return __generator2(this, function(_b) {
        switch (_b.label) {
          case 0:
            try {
              if (typeof process !== "undefined" && ((_a3 = process.env) === null || _a3 === void 0 ? void 0 : _a3.tcb_token)) {
                return [2, process.env.tcb_token];
              }
              if (!this.storage) {
                return [2, ""];
              }
            } catch (e3) {
              return [2, ""];
            }
            version3 = version3 || "localCachev1";
            return [4, this.storage.getItem(key)];
          case 1:
            content = _b.sent();
            if (!content) {
              return [2, ""];
            }
            if (content.indexOf(version3) >= 0) {
              d2 = JSON.parse(content);
              return [2, d2.content];
            }
            return [2, ""];
        }
      });
    });
  };
  CloudbaseCache4.prototype.removeStore = function(key) {
    if (this.mode === "async") {
      printWarn(ERRORS.INVALID_OPERATION, "current platform's storage is asynchronous, please use removeStoreAsync insteed");
      return;
    }
    this.storage.removeItem(key);
  };
  CloudbaseCache4.prototype.removeStoreAsync = function(key) {
    return __awaiter2(this, void 0, void 0, function() {
      return __generator2(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.storage.removeItem(key)];
          case 1:
            _a3.sent();
            return [2];
        }
      });
    });
  };
  return CloudbaseCache4;
}();

// node_modules/@cloudbase/utilities/dist/esm/libs/events.js
var events_exports = {};
__export(events_exports, {
  CloudbaseEvent: () => CloudbaseEvent,
  CloudbaseEventEmitter: () => CloudbaseEventEmitter,
  IErrorEvent: () => IErrorEvent,
  activateEvent: () => activateEvent,
  addEventListener: () => addEventListener,
  removeEventListener: () => removeEventListener
});
var __extends3 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var __spreadArray = function(to2, from2, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from2.length, ar2; i2 < l2; i2++) {
    if (ar2 || !(i2 in from2)) {
      if (!ar2) ar2 = Array.prototype.slice.call(from2, 0, i2);
      ar2[i2] = from2[i2];
    }
  }
  return to2.concat(ar2 || Array.prototype.slice.call(from2));
};
function customeAddEventListener(name, listener, listeners) {
  listeners[name] = listeners[name] || [];
  listeners[name].push(listener);
}
function customRemoveEventListener(name, listener, listeners) {
  if (listeners === null || listeners === void 0 ? void 0 : listeners[name]) {
    var index = listeners[name].indexOf(listener);
    if (index !== -1) {
      listeners[name].splice(index, 1);
    }
  }
}
var CloudbaseEvent = /* @__PURE__ */ function() {
  function CloudbaseEvent2(name, data2) {
    this.data = data2 || null;
    this.name = name;
  }
  return CloudbaseEvent2;
}();
var IErrorEvent = function(_super) {
  __extends3(IErrorEvent2, _super);
  function IErrorEvent2(error, data2) {
    var _this = _super.call(this, "error", { error, data: data2 }) || this;
    _this.error = error;
    return _this;
  }
  return IErrorEvent2;
}(CloudbaseEvent);
var CloudbaseEventEmitter = function() {
  function CloudbaseEventEmitter5() {
    this.listeners = {};
  }
  CloudbaseEventEmitter5.prototype.on = function(name, listener) {
    customeAddEventListener(name, listener, this.listeners);
    return this;
  };
  CloudbaseEventEmitter5.prototype.off = function(name, listener) {
    customRemoveEventListener(name, listener, this.listeners);
    return this;
  };
  CloudbaseEventEmitter5.prototype.fire = function(event, data2) {
    if (isInstanceOf(event, IErrorEvent)) {
      console.error(event.error);
      return this;
    }
    var ev = isString(event) ? new CloudbaseEvent(event, data2 || {}) : event;
    var name = ev.name;
    if (this.listens(name)) {
      ev.target = this;
      var handlers = this.listeners[name] ? __spreadArray([], this.listeners[name], true) : [];
      for (var _i = 0, handlers_1 = handlers; _i < handlers_1.length; _i++) {
        var fn = handlers_1[_i];
        fn.call(this, ev);
      }
    }
    return this;
  };
  CloudbaseEventEmitter5.prototype.listens = function(name) {
    return this.listeners[name] && this.listeners[name].length > 0;
  };
  return CloudbaseEventEmitter5;
}();
var eventEmitter = new CloudbaseEventEmitter();
function addEventListener(event, callback) {
  eventEmitter.on(event, callback);
}
function activateEvent(event, data2) {
  if (data2 === void 0) {
    data2 = {};
  }
  eventEmitter.fire(event, data2);
}
function removeEventListener(event, callback) {
  eventEmitter.off(event, callback);
}

// node_modules/@cloudbase/utilities/dist/esm/libs/langEvent.js
var langEvent_exports = {};
__export(langEvent_exports, {
  LANG_CHANGE_EVENT: () => LANG_CHANGE_EVENT,
  bus: () => bus
});
var bus = new CloudbaseEventEmitter();
var LANG_CHANGE_EVENT = "lang_change";

// node_modules/@cloudbase/utilities/dist/esm/helpers/index.js
var helpers_exports = {};
__export(helpers_exports, {
  catchErrorsDecorator: () => catchErrorsDecorator
});

// node_modules/@cloudbase/utilities/dist/esm/helpers/decorators.js
var __awaiter3 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator3 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var isFirefox = false;
if (typeof navigator !== "undefined" && navigator.userAgent) {
  isFirefox = navigator.userAgent.indexOf("Firefox") !== -1;
}
var REG_STACK_DECORATE = isFirefox ? /(\.js\/)?__decorate(\$\d+)?<@.*\d$/ : /(\/\w+\.js\.)?__decorate(\$\d+)?\s*\(.*\)$/;
var REG_STACK_LINK = /https?:\/\/.+:\d*\/.*\.js:\d+:\d+/;
function catchErrorsDecorator(options) {
  var _a3 = options.mode, mode = _a3 === void 0 ? "async" : _a3, _b = options.customInfo, customInfo = _b === void 0 ? {} : _b, title = options.title, _c = options.messages, messages = _c === void 0 ? [] : _c;
  return function(target, methodName, descriptor) {
    if (!IS_DEBUG_MODE) {
      return;
    }
    var className = customInfo.className || target.constructor.name;
    var fnName = customInfo.methodName || methodName;
    var fn = descriptor.value;
    var sourceLink = getSourceLink(new Error());
    if (mode === "sync") {
      descriptor.value = function() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        var innerErr = getRewritedError({
          err: new Error(),
          className,
          methodName: fnName,
          sourceLink
        });
        try {
          return fn.apply(this, args);
        } catch (err) {
          var failErr = err;
          var errMsg = err.message, error = err.error, errorDescription = err.error_description;
          var logs = {
            title: title || "".concat(className, ".").concat(fnName, " failed"),
            content: [{
              type: "error",
              body: err
            }]
          };
          if (errMsg && /^\{.*\}$/.test(errMsg)) {
            var msg = JSON.parse(errMsg);
            logs.subtitle = errMsg;
            if (msg.code) {
              if (innerErr) {
                innerErr.code = msg.code;
                innerErr.msg = msg.msg;
              } else {
                err.code = msg.code;
                err.message = msg.msg;
              }
              failErr = innerErr || err;
              logs.content = messages.map(function(msg2) {
                return {
                  type: "info",
                  body: msg2
                };
              });
            }
          }
          if (error && errorDescription) {
            logs.subtitle = errorDescription;
            if (innerErr) {
              innerErr.code = error;
              innerErr.msg = errorDescription;
            } else {
              err.code = error;
              err.message = errorDescription;
            }
            failErr = innerErr || err;
            logs.content = messages.map(function(msg2) {
              return {
                type: "info",
                body: msg2
              };
            });
          }
          printGroupLog(logs);
          throw failErr;
        }
      };
    } else {
      descriptor.value = function() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        return __awaiter3(this, void 0, void 0, function() {
          var innerErr, err_1, failErr, errMsg, error, errorDescription, logs, msg;
          return __generator3(this, function(_a4) {
            switch (_a4.label) {
              case 0:
                innerErr = getRewritedError({
                  err: new Error(),
                  className,
                  methodName: fnName,
                  sourceLink
                });
                _a4.label = 1;
              case 1:
                _a4.trys.push([1, 3, , 4]);
                return [4, fn.apply(this, args)];
              case 2:
                return [2, _a4.sent()];
              case 3:
                err_1 = _a4.sent();
                failErr = err_1;
                errMsg = err_1.message, error = err_1.error, errorDescription = err_1.error_description;
                logs = {
                  title: title || "".concat(className, ".").concat(fnName, " failed"),
                  content: [{
                    type: "error",
                    body: err_1
                  }]
                };
                if (errMsg && /^\{.*\}$/.test(errMsg)) {
                  msg = JSON.parse(errMsg);
                  logs.subtitle = msg;
                  if (msg.code) {
                    if (innerErr) {
                      innerErr.code = msg.code;
                      innerErr.message = msg.msg;
                    } else {
                      err_1.code = msg.code;
                      err_1.message = msg.msg;
                    }
                    failErr = innerErr || err_1;
                    logs.content = messages.map(function(msg2) {
                      return {
                        type: "info",
                        body: msg2
                      };
                    });
                  }
                }
                if (error && errorDescription) {
                  logs.subtitle = errorDescription;
                  if (innerErr) {
                    innerErr.code = error;
                    innerErr.msg = errorDescription;
                  } else {
                    err_1.code = error;
                    err_1.message = errorDescription;
                  }
                  failErr = innerErr || err_1;
                  logs.content = messages.map(function(msg2) {
                    return {
                      type: "info",
                      body: msg2
                    };
                  });
                }
                printGroupLog(logs);
                throw failErr;
              case 4:
                return [2];
            }
          });
        });
      };
    }
  };
}
function getSourceLink(err) {
  var sourceLink = "";
  var outterErrStacks = err.stack.split("\n");
  var indexOfDecorator = outterErrStacks.findIndex(function(str) {
    return REG_STACK_DECORATE.test(str);
  });
  if (indexOfDecorator !== -1) {
    var match2 = REG_STACK_LINK.exec(outterErrStacks[indexOfDecorator + 1] || "");
    sourceLink = match2 ? match2[0] : "";
  }
  return sourceLink;
}
function getRewritedError(options) {
  var err = options.err, className = options.className, methodName = options.methodName, sourceLink = options.sourceLink;
  if (!sourceLink) {
    return null;
  }
  var innerErrStack = err.stack.split("\n");
  var REG_STACK_INNER_METHOD = isFirefox ? /^catchErrorsDecorator\/<\/descriptor.value@.*\d$/ : new RegExp("".concat(className, "\\.descriptor.value\\s*\\[as\\s").concat(methodName, "\\]\\s*\\(.*\\)$"));
  var REG_STACK_INNER_METHOD_WITHOUT_LINK = isFirefox ? /^catchErrorsDecorator\/<\/descriptor.value/ : new RegExp("".concat(className, "\\.descriptor.value\\s*\\[as\\s").concat(methodName, "\\]"));
  var indexOfSource = innerErrStack.findIndex(function(str) {
    return REG_STACK_INNER_METHOD.test(str);
  });
  var innerErr;
  if (indexOfSource !== -1) {
    var realErrStack = innerErrStack.filter(function(v2, i2) {
      return i2 > indexOfSource;
    });
    realErrStack.unshift(innerErrStack[indexOfSource].replace(REG_STACK_INNER_METHOD_WITHOUT_LINK, "".concat(className, ".").concat(methodName)).replace(REG_STACK_LINK, sourceLink));
    innerErr = new Error();
    innerErr.stack = "".concat(isFirefox ? "@debugger" : "Error", "\n").concat(realErrStack.join("\n"));
  }
  return innerErr;
}

// node_modules/@cloudbase/utilities/dist/esm/libs/abortController.js
var AbortController2 = function() {
  function AbortController3() {
    var _this = this;
    this.listeners = [];
    this.signal = {
      aborted: false,
      addEventListener: function(e3, f2) {
        if (e3 === "abort") {
          _this.listeners.push(f2);
        }
      }
    };
  }
  AbortController3.prototype.abort = function() {
    if (this.signal.aborted)
      return;
    this.signal.aborted = true;
    this.listeners.forEach(function(f2) {
      return f2();
    });
  };
  return AbortController3;
}();

// node_modules/jwt-decode/build/jwt-decode.esm.js
function e(e3) {
  this.message = e3;
}
e.prototype = new Error(), e.prototype.name = "InvalidCharacterError";
var r = "undefined" != typeof window && window.atob && window.atob.bind(window) || function(r3) {
  var t3 = String(r3).replace(/=+$/, "");
  if (t3.length % 4 == 1) throw new e("'atob' failed: The string to be decoded is not correctly encoded.");
  for (var n3, o2, a2 = 0, i2 = 0, c2 = ""; o2 = t3.charAt(i2++); ~o2 && (n3 = a2 % 4 ? 64 * n3 + o2 : o2, a2++ % 4) ? c2 += String.fromCharCode(255 & n3 >> (-2 * a2 & 6)) : 0) o2 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o2);
  return c2;
};
function n(e3) {
  this.message = e3;
}
n.prototype = new Error(), n.prototype.name = "InvalidTokenError";

// node_modules/@cloudbase/app/dist/esm/libs/component.js
var __spreadArray2 = function(to2, from2, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from2.length, ar2; i2 < l2; i2++) {
    if (ar2 || !(i2 in from2)) {
      if (!ar2) ar2 = Array.prototype.slice.call(from2, 0, i2);
      ar2[i2] = from2[i2];
    }
  }
  return to2.concat(ar2 || Array.prototype.slice.call(from2));
};
var ERRORS2 = constants_exports.ERRORS;
var components = {};
function registerComponent(app, component12) {
  var name = component12.name, namespace = component12.namespace, entity = component12.entity, injectEvents = component12.injectEvents, _a3 = component12.IIFE, IIFE = _a3 === void 0 ? false : _a3;
  if (components[name] || namespace && app[namespace]) {
    throw new Error(JSON.stringify({
      code: ERRORS2.INVALID_OPERATION,
      msg: "Duplicate component ".concat(name)
    }));
  }
  if (IIFE) {
    if (!entity || typeof entity !== "function") {
      throw new Error(JSON.stringify({
        code: ERRORS2.INVALID_PARAMS,
        msg: "IIFE component's entity must be a function"
      }));
    }
    entity.call(app);
  }
  components[name] = component12;
  if (namespace) {
    app.prototype[namespace] = entity;
  } else {
    deepExtend(app.prototype, entity);
  }
  if (injectEvents) {
    var bus3 = injectEvents.bus, events = injectEvents.events;
    if (!bus3 || !events || events.length === 0) {
      return;
    }
    var originCallback_1 = app.prototype.fire || function() {
    };
    if (!app.prototype.events) {
      app.prototype.events = {};
    }
    var originEvents = app.prototype.events || {};
    if (originEvents[name]) {
      app.prototype.events[name].events = __spreadArray2(__spreadArray2([], app.prototype.events[name].events, true), events, true);
    } else {
      app.prototype.events[name] = { bus: bus3, events };
    }
    app.prototype.fire = function(eventName, data2) {
      originCallback_1(eventName, data2);
      var eventNames = Object.keys(this.events);
      for (var _i = 0, eventNames_1 = eventNames; _i < eventNames_1.length; _i++) {
        var name_1 = eventNames_1[_i];
        var _a4 = this.events[name_1], bus_1 = _a4.bus, eventList = _a4.events;
        if (eventList.includes(eventName)) {
          bus_1.fire(eventName, data2);
          break;
        }
      }
    };
  }
}
function deepExtend(target, source) {
  if (!(source instanceof Object)) {
    return source;
  }
  switch (source.constructor) {
    case Date: {
      var dateValue = source;
      return new Date(dateValue.getTime());
    }
    case Object:
      if (target === void 0) {
        target = {};
      }
      break;
    case Array:
      target = [];
      break;
    default:
      return source;
  }
  var sourceKeys = Object.keys(source);
  for (var _i = 0, sourceKeys_1 = sourceKeys; _i < sourceKeys_1.length; _i++) {
    var key = sourceKeys_1[_i];
    if (!Object.prototype.hasOwnProperty.call(source, key)) {
      continue;
    }
    target[key] = deepExtend(target[key], source[key]);
  }
  return target;
}
function registerHook(app, hook2) {
  var entity = hook2.entity, target = hook2.target;
  if (Object.prototype.hasOwnProperty.call(app, target)) {
    throw new Error(JSON.stringify({
      code: ERRORS2.INVALID_OPERATION,
      msg: "target:".concat(target, " is not exist")
    }));
  }
  var originMethod = app.prototype[target];
  if (typeof originMethod !== "function") {
    throw new Error(JSON.stringify({
      code: ERRORS2.INVALID_OPERATION,
      msg: "target:".concat(target, " is not a function which is the only type supports hook")
    }));
  }
  app.prototype[target] = function() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      args[_i] = arguments[_i];
    }
    entity.call.apply(entity, __spreadArray2([this], args, false));
    return originMethod.call.apply(originMethod, __spreadArray2([this], args, false));
  };
}

// node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js
init_esm();

// node_modules/web-streams-polyfill/dist/ponyfill.mjs
function e2() {
}
function t(e3) {
  return "object" == typeof e3 && null !== e3 || "function" == typeof e3;
}
var r2 = e2;
function o(e3, t3) {
  try {
    Object.defineProperty(e3, "name", { value: t3, configurable: true });
  } catch (e4) {
  }
}
var n2 = Promise;
var a = Promise.resolve.bind(n2);
var i = Promise.prototype.then;
var l = Promise.reject.bind(n2);
var s = a;
function u(e3) {
  return new n2(e3);
}
function c(e3) {
  return u((t3) => t3(e3));
}
function d(e3) {
  return l(e3);
}
function f(e3, t3, r3) {
  return i.call(e3, t3, r3);
}
function b(e3, t3, o2) {
  f(f(e3, t3, o2), void 0, r2);
}
function h(e3, t3) {
  b(e3, t3);
}
function m(e3, t3) {
  b(e3, void 0, t3);
}
function _(e3, t3, r3) {
  return f(e3, t3, r3);
}
function p(e3) {
  f(e3, void 0, r2);
}
var y = (e3) => {
  if ("function" == typeof queueMicrotask) y = queueMicrotask;
  else {
    const e4 = c(void 0);
    y = (t3) => f(e4, t3);
  }
  return y(e3);
};
function S(e3, t3, r3) {
  if ("function" != typeof e3) throw new TypeError("Argument is not a function");
  return Function.prototype.apply.call(e3, t3, r3);
}
function g(e3, t3, r3) {
  try {
    return c(S(e3, t3, r3));
  } catch (e4) {
    return d(e4);
  }
}
var v = class {
  constructor() {
    this._cursor = 0, this._size = 0, this._front = { _elements: [], _next: void 0 }, this._back = this._front, this._cursor = 0, this._size = 0;
  }
  get length() {
    return this._size;
  }
  push(e3) {
    const t3 = this._back;
    let r3 = t3;
    16383 === t3._elements.length && (r3 = { _elements: [], _next: void 0 }), t3._elements.push(e3), r3 !== t3 && (this._back = r3, t3._next = r3), ++this._size;
  }
  shift() {
    const e3 = this._front;
    let t3 = e3;
    const r3 = this._cursor;
    let o2 = r3 + 1;
    const n3 = e3._elements, a2 = n3[r3];
    return 16384 === o2 && (t3 = e3._next, o2 = 0), --this._size, this._cursor = o2, e3 !== t3 && (this._front = t3), n3[r3] = void 0, a2;
  }
  forEach(e3) {
    let t3 = this._cursor, r3 = this._front, o2 = r3._elements;
    for (; !(t3 === o2.length && void 0 === r3._next || t3 === o2.length && (r3 = r3._next, o2 = r3._elements, t3 = 0, 0 === o2.length)); ) e3(o2[t3]), ++t3;
  }
  peek() {
    const e3 = this._front, t3 = this._cursor;
    return e3._elements[t3];
  }
};
var w = Symbol("[[AbortSteps]]");
var R = Symbol("[[ErrorSteps]]");
var T = Symbol("[[CancelSteps]]");
var C = Symbol("[[PullSteps]]");
var P = Symbol("[[ReleaseSteps]]");
function q(e3, t3) {
  e3._ownerReadableStream = t3, t3._reader = e3, "readable" === t3._state ? B(e3) : "closed" === t3._state ? function(e4) {
    B(e4), A(e4);
  }(e3) : k(e3, t3._storedError);
}
function E(e3, t3) {
  return Or(e3._ownerReadableStream, t3);
}
function W(e3) {
  const t3 = e3._ownerReadableStream;
  "readable" === t3._state ? j(e3, new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")) : function(e4, t4) {
    k(e4, t4);
  }(e3, new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")), t3._readableStreamController[P](), t3._reader = void 0, e3._ownerReadableStream = void 0;
}
function O(e3) {
  return new TypeError("Cannot " + e3 + " a stream using a released reader");
}
function B(e3) {
  e3._closedPromise = u((t3, r3) => {
    e3._closedPromise_resolve = t3, e3._closedPromise_reject = r3;
  });
}
function k(e3, t3) {
  B(e3), j(e3, t3);
}
function j(e3, t3) {
  void 0 !== e3._closedPromise_reject && (p(e3._closedPromise), e3._closedPromise_reject(t3), e3._closedPromise_resolve = void 0, e3._closedPromise_reject = void 0);
}
function A(e3) {
  void 0 !== e3._closedPromise_resolve && (e3._closedPromise_resolve(void 0), e3._closedPromise_resolve = void 0, e3._closedPromise_reject = void 0);
}
var z = Number.isFinite || function(e3) {
  return "number" == typeof e3 && isFinite(e3);
};
var D = Math.trunc || function(e3) {
  return e3 < 0 ? Math.ceil(e3) : Math.floor(e3);
};
function L(e3, t3) {
  if (void 0 !== e3 && ("object" != typeof (r3 = e3) && "function" != typeof r3)) throw new TypeError(`${t3} is not an object.`);
  var r3;
}
function F(e3, t3) {
  if ("function" != typeof e3) throw new TypeError(`${t3} is not a function.`);
}
function I(e3, t3) {
  if (!/* @__PURE__ */ function(e4) {
    return "object" == typeof e4 && null !== e4 || "function" == typeof e4;
  }(e3)) throw new TypeError(`${t3} is not an object.`);
}
function $(e3, t3, r3) {
  if (void 0 === e3) throw new TypeError(`Parameter ${t3} is required in '${r3}'.`);
}
function M(e3, t3, r3) {
  if (void 0 === e3) throw new TypeError(`${t3} is required in '${r3}'.`);
}
function Y(e3) {
  return Number(e3);
}
function x(e3) {
  return 0 === e3 ? 0 : e3;
}
function Q(e3, t3) {
  const r3 = Number.MAX_SAFE_INTEGER;
  let o2 = Number(e3);
  if (o2 = x(o2), !z(o2)) throw new TypeError(`${t3} is not a finite number`);
  if (o2 = function(e4) {
    return x(D(e4));
  }(o2), o2 < 0 || o2 > r3) throw new TypeError(`${t3} is outside the accepted range of 0 to ${r3}, inclusive`);
  return z(o2) && 0 !== o2 ? o2 : 0;
}
function N(e3, t3) {
  if (!Er(e3)) throw new TypeError(`${t3} is not a ReadableStream.`);
}
function H(e3) {
  return new ReadableStreamDefaultReader(e3);
}
function V(e3, t3) {
  e3._reader._readRequests.push(t3);
}
function U(e3, t3, r3) {
  const o2 = e3._reader._readRequests.shift();
  r3 ? o2._closeSteps() : o2._chunkSteps(t3);
}
function G(e3) {
  return e3._reader._readRequests.length;
}
function X(e3) {
  const t3 = e3._reader;
  return void 0 !== t3 && !!J(t3);
}
var ReadableStreamDefaultReader = class {
  constructor(e3) {
    if ($(e3, 1, "ReadableStreamDefaultReader"), N(e3, "First parameter"), Wr(e3)) throw new TypeError("This stream has already been locked for exclusive reading by another reader");
    q(this, e3), this._readRequests = new v();
  }
  get closed() {
    return J(this) ? this._closedPromise : d(ee("closed"));
  }
  cancel(e3 = void 0) {
    return J(this) ? void 0 === this._ownerReadableStream ? d(O("cancel")) : E(this, e3) : d(ee("cancel"));
  }
  read() {
    if (!J(this)) return d(ee("read"));
    if (void 0 === this._ownerReadableStream) return d(O("read from"));
    let e3, t3;
    const r3 = u((r4, o2) => {
      e3 = r4, t3 = o2;
    });
    return K(this, { _chunkSteps: (t4) => e3({ value: t4, done: false }), _closeSteps: () => e3({ value: void 0, done: true }), _errorSteps: (e4) => t3(e4) }), r3;
  }
  releaseLock() {
    if (!J(this)) throw ee("releaseLock");
    void 0 !== this._ownerReadableStream && function(e3) {
      W(e3);
      const t3 = new TypeError("Reader was released");
      Z(e3, t3);
    }(this);
  }
};
function J(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_readRequests") && e3 instanceof ReadableStreamDefaultReader);
}
function K(e3, t3) {
  const r3 = e3._ownerReadableStream;
  r3._disturbed = true, "closed" === r3._state ? t3._closeSteps() : "errored" === r3._state ? t3._errorSteps(r3._storedError) : r3._readableStreamController[C](t3);
}
function Z(e3, t3) {
  const r3 = e3._readRequests;
  e3._readRequests = new v(), r3.forEach((e4) => {
    e4._errorSteps(t3);
  });
}
function ee(e3) {
  return new TypeError(`ReadableStreamDefaultReader.prototype.${e3} can only be used on a ReadableStreamDefaultReader`);
}
var te;
var re;
var oe;
function ne(e3) {
  return e3.slice();
}
function ae(e3, t3, r3, o2, n3) {
  new Uint8Array(e3).set(new Uint8Array(r3, o2, n3), t3);
}
Object.defineProperties(ReadableStreamDefaultReader.prototype, { cancel: { enumerable: true }, read: { enumerable: true }, releaseLock: { enumerable: true }, closed: { enumerable: true } }), o(ReadableStreamDefaultReader.prototype.cancel, "cancel"), o(ReadableStreamDefaultReader.prototype.read, "read"), o(ReadableStreamDefaultReader.prototype.releaseLock, "releaseLock"), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(ReadableStreamDefaultReader.prototype, Symbol.toStringTag, { value: "ReadableStreamDefaultReader", configurable: true });
var ie = (e3) => (ie = "function" == typeof e3.transfer ? (e4) => e4.transfer() : "function" == typeof structuredClone ? (e4) => structuredClone(e4, { transfer: [e4] }) : (e4) => e4, ie(e3));
var le = (e3) => (le = "boolean" == typeof e3.detached ? (e4) => e4.detached : (e4) => 0 === e4.byteLength, le(e3));
function se(e3, t3, r3) {
  if (e3.slice) return e3.slice(t3, r3);
  const o2 = r3 - t3, n3 = new ArrayBuffer(o2);
  return ae(n3, 0, e3, t3, o2), n3;
}
function ue(e3, t3) {
  const r3 = e3[t3];
  if (null != r3) {
    if ("function" != typeof r3) throw new TypeError(`${String(t3)} is not a function`);
    return r3;
  }
}
function ce(e3) {
  try {
    const t3 = e3.done, r3 = e3.value;
    return f(s(r3), (e4) => ({ done: t3, value: e4 }));
  } catch (e4) {
    return d(e4);
  }
}
var de = null !== (oe = null !== (te = Symbol.asyncIterator) && void 0 !== te ? te : null === (re = Symbol.for) || void 0 === re ? void 0 : re.call(Symbol, "Symbol.asyncIterator")) && void 0 !== oe ? oe : "@@asyncIterator";
function fe(e3, r3 = "sync", o2) {
  if (void 0 === o2) if ("async" === r3) {
    if (void 0 === (o2 = ue(e3, de))) {
      return function(e4) {
        const r4 = { next() {
          let t3;
          try {
            t3 = be(e4);
          } catch (e5) {
            return d(e5);
          }
          return ce(t3);
        }, return(r5) {
          let o3;
          try {
            const t3 = ue(e4.iterator, "return");
            if (void 0 === t3) return c({ done: true, value: r5 });
            o3 = S(t3, e4.iterator, [r5]);
          } catch (e5) {
            return d(e5);
          }
          return t(o3) ? ce(o3) : d(new TypeError("The iterator.return() method must return an object"));
        } };
        return { iterator: r4, nextMethod: r4.next, done: false };
      }(fe(e3, "sync", ue(e3, Symbol.iterator)));
    }
  } else o2 = ue(e3, Symbol.iterator);
  if (void 0 === o2) throw new TypeError("The object is not iterable");
  const n3 = S(o2, e3, []);
  if (!t(n3)) throw new TypeError("The iterator method must return an object");
  return { iterator: n3, nextMethod: n3.next, done: false };
}
function be(e3) {
  const r3 = S(e3.nextMethod, e3.iterator, []);
  if (!t(r3)) throw new TypeError("The iterator.next() method must return an object");
  return r3;
}
var he = class {
  constructor(e3, t3) {
    this._ongoingPromise = void 0, this._isFinished = false, this._reader = e3, this._preventCancel = t3;
  }
  next() {
    const e3 = () => this._nextSteps();
    return this._ongoingPromise = this._ongoingPromise ? _(this._ongoingPromise, e3, e3) : e3(), this._ongoingPromise;
  }
  return(e3) {
    const t3 = () => this._returnSteps(e3);
    return this._ongoingPromise = this._ongoingPromise ? _(this._ongoingPromise, t3, t3) : t3(), this._ongoingPromise;
  }
  _nextSteps() {
    if (this._isFinished) return Promise.resolve({ value: void 0, done: true });
    const e3 = this._reader;
    let t3, r3;
    const o2 = u((e4, o3) => {
      t3 = e4, r3 = o3;
    });
    return K(e3, { _chunkSteps: (e4) => {
      this._ongoingPromise = void 0, y(() => t3({ value: e4, done: false }));
    }, _closeSteps: () => {
      this._ongoingPromise = void 0, this._isFinished = true, W(e3), t3({ value: void 0, done: true });
    }, _errorSteps: (t4) => {
      this._ongoingPromise = void 0, this._isFinished = true, W(e3), r3(t4);
    } }), o2;
  }
  _returnSteps(e3) {
    if (this._isFinished) return Promise.resolve({ value: e3, done: true });
    this._isFinished = true;
    const t3 = this._reader;
    if (!this._preventCancel) {
      const r3 = E(t3, e3);
      return W(t3), _(r3, () => ({ value: e3, done: true }));
    }
    return W(t3), c({ value: e3, done: true });
  }
};
var me = { next() {
  return _e(this) ? this._asyncIteratorImpl.next() : d(pe("next"));
}, return(e3) {
  return _e(this) ? this._asyncIteratorImpl.return(e3) : d(pe("return"));
}, [de]() {
  return this;
} };
function _e(e3) {
  if (!t(e3)) return false;
  if (!Object.prototype.hasOwnProperty.call(e3, "_asyncIteratorImpl")) return false;
  try {
    return e3._asyncIteratorImpl instanceof he;
  } catch (e4) {
    return false;
  }
}
function pe(e3) {
  return new TypeError(`ReadableStreamAsyncIterator.${e3} can only be used on a ReadableSteamAsyncIterator`);
}
Object.defineProperty(me, de, { enumerable: false });
var ye = Number.isNaN || function(e3) {
  return e3 != e3;
};
function Se(e3) {
  const t3 = se(e3.buffer, e3.byteOffset, e3.byteOffset + e3.byteLength);
  return new Uint8Array(t3);
}
function ge(e3) {
  const t3 = e3._queue.shift();
  return e3._queueTotalSize -= t3.size, e3._queueTotalSize < 0 && (e3._queueTotalSize = 0), t3.value;
}
function ve(e3, t3, r3) {
  if ("number" != typeof (o2 = r3) || ye(o2) || o2 < 0 || r3 === 1 / 0) throw new RangeError("Size must be a finite, non-NaN, non-negative number.");
  var o2;
  e3._queue.push({ value: t3, size: r3 }), e3._queueTotalSize += r3;
}
function we(e3) {
  e3._queue = new v(), e3._queueTotalSize = 0;
}
function Re(e3) {
  return e3 === DataView;
}
var ReadableStreamBYOBRequest = class {
  constructor() {
    throw new TypeError("Illegal constructor");
  }
  get view() {
    if (!Ce(this)) throw Ke("view");
    return this._view;
  }
  respond(e3) {
    if (!Ce(this)) throw Ke("respond");
    if ($(e3, 1, "respond"), e3 = Q(e3, "First parameter"), void 0 === this._associatedReadableByteStreamController) throw new TypeError("This BYOB request has been invalidated");
    if (le(this._view.buffer)) throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");
    Ge(this._associatedReadableByteStreamController, e3);
  }
  respondWithNewView(e3) {
    if (!Ce(this)) throw Ke("respondWithNewView");
    if ($(e3, 1, "respondWithNewView"), !ArrayBuffer.isView(e3)) throw new TypeError("You can only respond with array buffer views");
    if (void 0 === this._associatedReadableByteStreamController) throw new TypeError("This BYOB request has been invalidated");
    if (le(e3.buffer)) throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");
    Xe(this._associatedReadableByteStreamController, e3);
  }
};
Object.defineProperties(ReadableStreamBYOBRequest.prototype, { respond: { enumerable: true }, respondWithNewView: { enumerable: true }, view: { enumerable: true } }), o(ReadableStreamBYOBRequest.prototype.respond, "respond"), o(ReadableStreamBYOBRequest.prototype.respondWithNewView, "respondWithNewView"), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(ReadableStreamBYOBRequest.prototype, Symbol.toStringTag, { value: "ReadableStreamBYOBRequest", configurable: true });
var ReadableByteStreamController = class {
  constructor() {
    throw new TypeError("Illegal constructor");
  }
  get byobRequest() {
    if (!Te(this)) throw Ze("byobRequest");
    return Ve(this);
  }
  get desiredSize() {
    if (!Te(this)) throw Ze("desiredSize");
    return Ue(this);
  }
  close() {
    if (!Te(this)) throw Ze("close");
    if (this._closeRequested) throw new TypeError("The stream has already been closed; do not close it again!");
    const e3 = this._controlledReadableByteStream._state;
    if ("readable" !== e3) throw new TypeError(`The stream (in ${e3} state) is not in the readable state and cannot be closed`);
    xe(this);
  }
  enqueue(e3) {
    if (!Te(this)) throw Ze("enqueue");
    if ($(e3, 1, "enqueue"), !ArrayBuffer.isView(e3)) throw new TypeError("chunk must be an array buffer view");
    if (0 === e3.byteLength) throw new TypeError("chunk must have non-zero byteLength");
    if (0 === e3.buffer.byteLength) throw new TypeError("chunk's buffer must have non-zero byteLength");
    if (this._closeRequested) throw new TypeError("stream is closed or draining");
    const t3 = this._controlledReadableByteStream._state;
    if ("readable" !== t3) throw new TypeError(`The stream (in ${t3} state) is not in the readable state and cannot be enqueued to`);
    Qe(this, e3);
  }
  error(e3 = void 0) {
    if (!Te(this)) throw Ze("error");
    Ne(this, e3);
  }
  [T](e3) {
    qe(this), we(this);
    const t3 = this._cancelAlgorithm(e3);
    return Ye(this), t3;
  }
  [C](e3) {
    const t3 = this._controlledReadableByteStream;
    if (this._queueTotalSize > 0) return void He(this, e3);
    const r3 = this._autoAllocateChunkSize;
    if (void 0 !== r3) {
      let t4;
      try {
        t4 = new ArrayBuffer(r3);
      } catch (t5) {
        return void e3._errorSteps(t5);
      }
      const o2 = { buffer: t4, bufferByteLength: r3, byteOffset: 0, byteLength: r3, bytesFilled: 0, minimumFill: 1, elementSize: 1, viewConstructor: Uint8Array, readerType: "default" };
      this._pendingPullIntos.push(o2);
    }
    V(t3, e3), Pe(this);
  }
  [P]() {
    if (this._pendingPullIntos.length > 0) {
      const e3 = this._pendingPullIntos.peek();
      e3.readerType = "none", this._pendingPullIntos = new v(), this._pendingPullIntos.push(e3);
    }
  }
};
function Te(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_controlledReadableByteStream") && e3 instanceof ReadableByteStreamController);
}
function Ce(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_associatedReadableByteStreamController") && e3 instanceof ReadableStreamBYOBRequest);
}
function Pe(e3) {
  const t3 = function(e4) {
    const t4 = e4._controlledReadableByteStream;
    if ("readable" !== t4._state) return false;
    if (e4._closeRequested) return false;
    if (!e4._started) return false;
    if (X(t4) && G(t4) > 0) return true;
    if (nt(t4) && ot(t4) > 0) return true;
    const r3 = Ue(e4);
    if (r3 > 0) return true;
    return false;
  }(e3);
  if (!t3) return;
  if (e3._pulling) return void (e3._pullAgain = true);
  e3._pulling = true;
  b(e3._pullAlgorithm(), () => (e3._pulling = false, e3._pullAgain && (e3._pullAgain = false, Pe(e3)), null), (t4) => (Ne(e3, t4), null));
}
function qe(e3) {
  Le(e3), e3._pendingPullIntos = new v();
}
function Ee(e3, t3) {
  let r3 = false;
  "closed" === e3._state && (r3 = true);
  const o2 = Oe(t3);
  "default" === t3.readerType ? U(e3, o2, r3) : function(e4, t4, r4) {
    const o3 = e4._reader, n3 = o3._readIntoRequests.shift();
    r4 ? n3._closeSteps(t4) : n3._chunkSteps(t4);
  }(e3, o2, r3);
}
function We(e3, t3) {
  for (let r3 = 0; r3 < t3.length; ++r3) Ee(e3, t3[r3]);
}
function Oe(e3) {
  const t3 = e3.bytesFilled, r3 = e3.elementSize;
  return new e3.viewConstructor(e3.buffer, e3.byteOffset, t3 / r3);
}
function Be(e3, t3, r3, o2) {
  e3._queue.push({ buffer: t3, byteOffset: r3, byteLength: o2 }), e3._queueTotalSize += o2;
}
function ke(e3, t3, r3, o2) {
  let n3;
  try {
    n3 = se(t3, r3, r3 + o2);
  } catch (t4) {
    throw Ne(e3, t4), t4;
  }
  Be(e3, n3, 0, o2);
}
function je(e3, t3) {
  t3.bytesFilled > 0 && ke(e3, t3.buffer, t3.byteOffset, t3.bytesFilled), Me(e3);
}
function Ae(e3, t3) {
  const r3 = Math.min(e3._queueTotalSize, t3.byteLength - t3.bytesFilled), o2 = t3.bytesFilled + r3;
  let n3 = r3, a2 = false;
  const i2 = o2 - o2 % t3.elementSize;
  i2 >= t3.minimumFill && (n3 = i2 - t3.bytesFilled, a2 = true);
  const l2 = e3._queue;
  for (; n3 > 0; ) {
    const r4 = l2.peek(), o3 = Math.min(n3, r4.byteLength), a3 = t3.byteOffset + t3.bytesFilled;
    ae(t3.buffer, a3, r4.buffer, r4.byteOffset, o3), r4.byteLength === o3 ? l2.shift() : (r4.byteOffset += o3, r4.byteLength -= o3), e3._queueTotalSize -= o3, ze(e3, o3, t3), n3 -= o3;
  }
  return a2;
}
function ze(e3, t3, r3) {
  r3.bytesFilled += t3;
}
function De(e3) {
  0 === e3._queueTotalSize && e3._closeRequested ? (Ye(e3), Br(e3._controlledReadableByteStream)) : Pe(e3);
}
function Le(e3) {
  null !== e3._byobRequest && (e3._byobRequest._associatedReadableByteStreamController = void 0, e3._byobRequest._view = null, e3._byobRequest = null);
}
function Fe(e3) {
  const t3 = [];
  for (; e3._pendingPullIntos.length > 0 && 0 !== e3._queueTotalSize; ) {
    const r3 = e3._pendingPullIntos.peek();
    Ae(e3, r3) && (Me(e3), t3.push(r3));
  }
  return t3;
}
function Ie(e3, t3, r3, o2) {
  const n3 = e3._controlledReadableByteStream, a2 = t3.constructor, i2 = function(e4) {
    return Re(e4) ? 1 : e4.BYTES_PER_ELEMENT;
  }(a2), { byteOffset: l2, byteLength: s2 } = t3, u2 = r3 * i2;
  let c2;
  try {
    c2 = ie(t3.buffer);
  } catch (e4) {
    return void o2._errorSteps(e4);
  }
  const d2 = { buffer: c2, bufferByteLength: c2.byteLength, byteOffset: l2, byteLength: s2, bytesFilled: 0, minimumFill: u2, elementSize: i2, viewConstructor: a2, readerType: "byob" };
  if (e3._pendingPullIntos.length > 0) return e3._pendingPullIntos.push(d2), void rt(n3, o2);
  if ("closed" === n3._state) {
    const e4 = new a2(d2.buffer, d2.byteOffset, 0);
    return void o2._closeSteps(e4);
  }
  if (e3._queueTotalSize > 0) {
    if (Ae(e3, d2)) {
      const t4 = Oe(d2);
      return De(e3), void o2._chunkSteps(t4);
    }
    if (e3._closeRequested) {
      const t4 = new TypeError("Insufficient bytes to fill elements in the given buffer");
      return Ne(e3, t4), void o2._errorSteps(t4);
    }
  }
  e3._pendingPullIntos.push(d2), rt(n3, o2), Pe(e3);
}
function $e(e3, t3) {
  const r3 = e3._pendingPullIntos.peek();
  Le(e3);
  "closed" === e3._controlledReadableByteStream._state ? function(e4, t4) {
    "none" === t4.readerType && Me(e4);
    const r4 = e4._controlledReadableByteStream;
    if (nt(r4)) {
      const t5 = [];
      for (; t5.length < ot(r4); ) t5.push(Me(e4));
      We(r4, t5);
    }
  }(e3, r3) : function(e4, t4, r4) {
    if (ze(0, t4, r4), "none" === r4.readerType) {
      je(e4, r4);
      const t5 = Fe(e4);
      return void We(e4._controlledReadableByteStream, t5);
    }
    if (r4.bytesFilled < r4.minimumFill) return;
    Me(e4);
    const o2 = r4.bytesFilled % r4.elementSize;
    if (o2 > 0) {
      const t5 = r4.byteOffset + r4.bytesFilled;
      ke(e4, r4.buffer, t5 - o2, o2);
    }
    r4.bytesFilled -= o2;
    const n3 = Fe(e4);
    Ee(e4._controlledReadableByteStream, r4), We(e4._controlledReadableByteStream, n3);
  }(e3, t3, r3), Pe(e3);
}
function Me(e3) {
  return e3._pendingPullIntos.shift();
}
function Ye(e3) {
  e3._pullAlgorithm = void 0, e3._cancelAlgorithm = void 0;
}
function xe(e3) {
  const t3 = e3._controlledReadableByteStream;
  if (!e3._closeRequested && "readable" === t3._state) if (e3._queueTotalSize > 0) e3._closeRequested = true;
  else {
    if (e3._pendingPullIntos.length > 0) {
      const t4 = e3._pendingPullIntos.peek();
      if (t4.bytesFilled % t4.elementSize !== 0) {
        const t5 = new TypeError("Insufficient bytes to fill elements in the given buffer");
        throw Ne(e3, t5), t5;
      }
    }
    Ye(e3), Br(t3);
  }
}
function Qe(e3, t3) {
  const r3 = e3._controlledReadableByteStream;
  if (e3._closeRequested || "readable" !== r3._state) return;
  const { buffer: o2, byteOffset: n3, byteLength: a2 } = t3;
  if (le(o2)) throw new TypeError("chunk's buffer is detached and so cannot be enqueued");
  const i2 = ie(o2);
  if (e3._pendingPullIntos.length > 0) {
    const t4 = e3._pendingPullIntos.peek();
    if (le(t4.buffer)) throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");
    Le(e3), t4.buffer = ie(t4.buffer), "none" === t4.readerType && je(e3, t4);
  }
  if (X(r3)) if (function(e4) {
    const t4 = e4._controlledReadableByteStream._reader;
    for (; t4._readRequests.length > 0; ) {
      if (0 === e4._queueTotalSize) return;
      He(e4, t4._readRequests.shift());
    }
  }(e3), 0 === G(r3)) Be(e3, i2, n3, a2);
  else {
    e3._pendingPullIntos.length > 0 && Me(e3);
    U(r3, new Uint8Array(i2, n3, a2), false);
  }
  else if (nt(r3)) {
    Be(e3, i2, n3, a2);
    We(r3, Fe(e3));
  } else Be(e3, i2, n3, a2);
  Pe(e3);
}
function Ne(e3, t3) {
  const r3 = e3._controlledReadableByteStream;
  "readable" === r3._state && (qe(e3), we(e3), Ye(e3), kr(r3, t3));
}
function He(e3, t3) {
  const r3 = e3._queue.shift();
  e3._queueTotalSize -= r3.byteLength, De(e3);
  const o2 = new Uint8Array(r3.buffer, r3.byteOffset, r3.byteLength);
  t3._chunkSteps(o2);
}
function Ve(e3) {
  if (null === e3._byobRequest && e3._pendingPullIntos.length > 0) {
    const t3 = e3._pendingPullIntos.peek(), r3 = new Uint8Array(t3.buffer, t3.byteOffset + t3.bytesFilled, t3.byteLength - t3.bytesFilled), o2 = Object.create(ReadableStreamBYOBRequest.prototype);
    !function(e4, t4, r4) {
      e4._associatedReadableByteStreamController = t4, e4._view = r4;
    }(o2, e3, r3), e3._byobRequest = o2;
  }
  return e3._byobRequest;
}
function Ue(e3) {
  const t3 = e3._controlledReadableByteStream._state;
  return "errored" === t3 ? null : "closed" === t3 ? 0 : e3._strategyHWM - e3._queueTotalSize;
}
function Ge(e3, t3) {
  const r3 = e3._pendingPullIntos.peek();
  if ("closed" === e3._controlledReadableByteStream._state) {
    if (0 !== t3) throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream");
  } else {
    if (0 === t3) throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");
    if (r3.bytesFilled + t3 > r3.byteLength) throw new RangeError("bytesWritten out of range");
  }
  r3.buffer = ie(r3.buffer), $e(e3, t3);
}
function Xe(e3, t3) {
  const r3 = e3._pendingPullIntos.peek();
  if ("closed" === e3._controlledReadableByteStream._state) {
    if (0 !== t3.byteLength) throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream");
  } else if (0 === t3.byteLength) throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");
  if (r3.byteOffset + r3.bytesFilled !== t3.byteOffset) throw new RangeError("The region specified by view does not match byobRequest");
  if (r3.bufferByteLength !== t3.buffer.byteLength) throw new RangeError("The buffer of view has different capacity than byobRequest");
  if (r3.bytesFilled + t3.byteLength > r3.byteLength) throw new RangeError("The region specified by view is larger than byobRequest");
  const o2 = t3.byteLength;
  r3.buffer = ie(t3.buffer), $e(e3, o2);
}
function Je(e3, t3, r3, o2, n3, a2, i2) {
  t3._controlledReadableByteStream = e3, t3._pullAgain = false, t3._pulling = false, t3._byobRequest = null, t3._queue = t3._queueTotalSize = void 0, we(t3), t3._closeRequested = false, t3._started = false, t3._strategyHWM = a2, t3._pullAlgorithm = o2, t3._cancelAlgorithm = n3, t3._autoAllocateChunkSize = i2, t3._pendingPullIntos = new v(), e3._readableStreamController = t3;
  b(c(r3()), () => (t3._started = true, Pe(t3), null), (e4) => (Ne(t3, e4), null));
}
function Ke(e3) {
  return new TypeError(`ReadableStreamBYOBRequest.prototype.${e3} can only be used on a ReadableStreamBYOBRequest`);
}
function Ze(e3) {
  return new TypeError(`ReadableByteStreamController.prototype.${e3} can only be used on a ReadableByteStreamController`);
}
function et(e3, t3) {
  if ("byob" !== (e3 = `${e3}`)) throw new TypeError(`${t3} '${e3}' is not a valid enumeration value for ReadableStreamReaderMode`);
  return e3;
}
function tt(e3) {
  return new ReadableStreamBYOBReader(e3);
}
function rt(e3, t3) {
  e3._reader._readIntoRequests.push(t3);
}
function ot(e3) {
  return e3._reader._readIntoRequests.length;
}
function nt(e3) {
  const t3 = e3._reader;
  return void 0 !== t3 && !!at(t3);
}
Object.defineProperties(ReadableByteStreamController.prototype, { close: { enumerable: true }, enqueue: { enumerable: true }, error: { enumerable: true }, byobRequest: { enumerable: true }, desiredSize: { enumerable: true } }), o(ReadableByteStreamController.prototype.close, "close"), o(ReadableByteStreamController.prototype.enqueue, "enqueue"), o(ReadableByteStreamController.prototype.error, "error"), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(ReadableByteStreamController.prototype, Symbol.toStringTag, { value: "ReadableByteStreamController", configurable: true });
var ReadableStreamBYOBReader = class {
  constructor(e3) {
    if ($(e3, 1, "ReadableStreamBYOBReader"), N(e3, "First parameter"), Wr(e3)) throw new TypeError("This stream has already been locked for exclusive reading by another reader");
    if (!Te(e3._readableStreamController)) throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");
    q(this, e3), this._readIntoRequests = new v();
  }
  get closed() {
    return at(this) ? this._closedPromise : d(st("closed"));
  }
  cancel(e3 = void 0) {
    return at(this) ? void 0 === this._ownerReadableStream ? d(O("cancel")) : E(this, e3) : d(st("cancel"));
  }
  read(e3, t3 = {}) {
    if (!at(this)) return d(st("read"));
    if (!ArrayBuffer.isView(e3)) return d(new TypeError("view must be an array buffer view"));
    if (0 === e3.byteLength) return d(new TypeError("view must have non-zero byteLength"));
    if (0 === e3.buffer.byteLength) return d(new TypeError("view's buffer must have non-zero byteLength"));
    if (le(e3.buffer)) return d(new TypeError("view's buffer has been detached"));
    let r3;
    try {
      r3 = function(e4, t4) {
        var r4;
        return L(e4, t4), { min: Q(null !== (r4 = null == e4 ? void 0 : e4.min) && void 0 !== r4 ? r4 : 1, `${t4} has member 'min' that`) };
      }(t3, "options");
    } catch (e4) {
      return d(e4);
    }
    const o2 = r3.min;
    if (0 === o2) return d(new TypeError("options.min must be greater than 0"));
    if (function(e4) {
      return Re(e4.constructor);
    }(e3)) {
      if (o2 > e3.byteLength) return d(new RangeError("options.min must be less than or equal to view's byteLength"));
    } else if (o2 > e3.length) return d(new RangeError("options.min must be less than or equal to view's length"));
    if (void 0 === this._ownerReadableStream) return d(O("read from"));
    let n3, a2;
    const i2 = u((e4, t4) => {
      n3 = e4, a2 = t4;
    });
    return it(this, e3, o2, { _chunkSteps: (e4) => n3({ value: e4, done: false }), _closeSteps: (e4) => n3({ value: e4, done: true }), _errorSteps: (e4) => a2(e4) }), i2;
  }
  releaseLock() {
    if (!at(this)) throw st("releaseLock");
    void 0 !== this._ownerReadableStream && function(e3) {
      W(e3);
      const t3 = new TypeError("Reader was released");
      lt(e3, t3);
    }(this);
  }
};
function at(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_readIntoRequests") && e3 instanceof ReadableStreamBYOBReader);
}
function it(e3, t3, r3, o2) {
  const n3 = e3._ownerReadableStream;
  n3._disturbed = true, "errored" === n3._state ? o2._errorSteps(n3._storedError) : Ie(n3._readableStreamController, t3, r3, o2);
}
function lt(e3, t3) {
  const r3 = e3._readIntoRequests;
  e3._readIntoRequests = new v(), r3.forEach((e4) => {
    e4._errorSteps(t3);
  });
}
function st(e3) {
  return new TypeError(`ReadableStreamBYOBReader.prototype.${e3} can only be used on a ReadableStreamBYOBReader`);
}
function ut(e3, t3) {
  const { highWaterMark: r3 } = e3;
  if (void 0 === r3) return t3;
  if (ye(r3) || r3 < 0) throw new RangeError("Invalid highWaterMark");
  return r3;
}
function ct(e3) {
  const { size: t3 } = e3;
  return t3 || (() => 1);
}
function dt(e3, t3) {
  L(e3, t3);
  const r3 = null == e3 ? void 0 : e3.highWaterMark, o2 = null == e3 ? void 0 : e3.size;
  return { highWaterMark: void 0 === r3 ? void 0 : Y(r3), size: void 0 === o2 ? void 0 : ft(o2, `${t3} has member 'size' that`) };
}
function ft(e3, t3) {
  return F(e3, t3), (t4) => Y(e3(t4));
}
function bt(e3, t3, r3) {
  return F(e3, r3), (r4) => g(e3, t3, [r4]);
}
function ht(e3, t3, r3) {
  return F(e3, r3), () => g(e3, t3, []);
}
function mt(e3, t3, r3) {
  return F(e3, r3), (r4) => S(e3, t3, [r4]);
}
function _t(e3, t3, r3) {
  return F(e3, r3), (r4, o2) => g(e3, t3, [r4, o2]);
}
function pt(e3, t3) {
  if (!gt(e3)) throw new TypeError(`${t3} is not a WritableStream.`);
}
Object.defineProperties(ReadableStreamBYOBReader.prototype, { cancel: { enumerable: true }, read: { enumerable: true }, releaseLock: { enumerable: true }, closed: { enumerable: true } }), o(ReadableStreamBYOBReader.prototype.cancel, "cancel"), o(ReadableStreamBYOBReader.prototype.read, "read"), o(ReadableStreamBYOBReader.prototype.releaseLock, "releaseLock"), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(ReadableStreamBYOBReader.prototype, Symbol.toStringTag, { value: "ReadableStreamBYOBReader", configurable: true });
var WritableStream = class {
  constructor(e3 = {}, t3 = {}) {
    void 0 === e3 ? e3 = null : I(e3, "First parameter");
    const r3 = dt(t3, "Second parameter"), o2 = function(e4, t4) {
      L(e4, t4);
      const r4 = null == e4 ? void 0 : e4.abort, o3 = null == e4 ? void 0 : e4.close, n4 = null == e4 ? void 0 : e4.start, a2 = null == e4 ? void 0 : e4.type, i2 = null == e4 ? void 0 : e4.write;
      return { abort: void 0 === r4 ? void 0 : bt(r4, e4, `${t4} has member 'abort' that`), close: void 0 === o3 ? void 0 : ht(o3, e4, `${t4} has member 'close' that`), start: void 0 === n4 ? void 0 : mt(n4, e4, `${t4} has member 'start' that`), write: void 0 === i2 ? void 0 : _t(i2, e4, `${t4} has member 'write' that`), type: a2 };
    }(e3, "First parameter");
    St(this);
    if (void 0 !== o2.type) throw new RangeError("Invalid type is specified");
    const n3 = ct(r3);
    !function(e4, t4, r4, o3) {
      const n4 = Object.create(WritableStreamDefaultController.prototype);
      let a2, i2, l2, s2;
      a2 = void 0 !== t4.start ? () => t4.start(n4) : () => {
      };
      i2 = void 0 !== t4.write ? (e5) => t4.write(e5, n4) : () => c(void 0);
      l2 = void 0 !== t4.close ? () => t4.close() : () => c(void 0);
      s2 = void 0 !== t4.abort ? (e5) => t4.abort(e5) : () => c(void 0);
      Ft(e4, n4, a2, i2, l2, s2, r4, o3);
    }(this, o2, ut(r3, 1), n3);
  }
  get locked() {
    if (!gt(this)) throw Nt("locked");
    return vt(this);
  }
  abort(e3 = void 0) {
    return gt(this) ? vt(this) ? d(new TypeError("Cannot abort a stream that already has a writer")) : wt(this, e3) : d(Nt("abort"));
  }
  close() {
    return gt(this) ? vt(this) ? d(new TypeError("Cannot close a stream that already has a writer")) : qt(this) ? d(new TypeError("Cannot close an already-closing stream")) : Rt(this) : d(Nt("close"));
  }
  getWriter() {
    if (!gt(this)) throw Nt("getWriter");
    return yt(this);
  }
};
function yt(e3) {
  return new WritableStreamDefaultWriter(e3);
}
function St(e3) {
  e3._state = "writable", e3._storedError = void 0, e3._writer = void 0, e3._writableStreamController = void 0, e3._writeRequests = new v(), e3._inFlightWriteRequest = void 0, e3._closeRequest = void 0, e3._inFlightCloseRequest = void 0, e3._pendingAbortRequest = void 0, e3._backpressure = false;
}
function gt(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_writableStreamController") && e3 instanceof WritableStream);
}
function vt(e3) {
  return void 0 !== e3._writer;
}
function wt(e3, t3) {
  var r3;
  if ("closed" === e3._state || "errored" === e3._state) return c(void 0);
  e3._writableStreamController._abortReason = t3, null === (r3 = e3._writableStreamController._abortController) || void 0 === r3 || r3.abort(t3);
  const o2 = e3._state;
  if ("closed" === o2 || "errored" === o2) return c(void 0);
  if (void 0 !== e3._pendingAbortRequest) return e3._pendingAbortRequest._promise;
  let n3 = false;
  "erroring" === o2 && (n3 = true, t3 = void 0);
  const a2 = u((r4, o3) => {
    e3._pendingAbortRequest = { _promise: void 0, _resolve: r4, _reject: o3, _reason: t3, _wasAlreadyErroring: n3 };
  });
  return e3._pendingAbortRequest._promise = a2, n3 || Ct(e3, t3), a2;
}
function Rt(e3) {
  const t3 = e3._state;
  if ("closed" === t3 || "errored" === t3) return d(new TypeError(`The stream (in ${t3} state) is not in the writable state and cannot be closed`));
  const r3 = u((t4, r4) => {
    const o3 = { _resolve: t4, _reject: r4 };
    e3._closeRequest = o3;
  }), o2 = e3._writer;
  var n3;
  return void 0 !== o2 && e3._backpressure && "writable" === t3 && or(o2), ve(n3 = e3._writableStreamController, Dt, 0), Mt(n3), r3;
}
function Tt(e3, t3) {
  "writable" !== e3._state ? Pt(e3) : Ct(e3, t3);
}
function Ct(e3, t3) {
  const r3 = e3._writableStreamController;
  e3._state = "erroring", e3._storedError = t3;
  const o2 = e3._writer;
  void 0 !== o2 && jt(o2, t3), !function(e4) {
    if (void 0 === e4._inFlightWriteRequest && void 0 === e4._inFlightCloseRequest) return false;
    return true;
  }(e3) && r3._started && Pt(e3);
}
function Pt(e3) {
  e3._state = "errored", e3._writableStreamController[R]();
  const t3 = e3._storedError;
  if (e3._writeRequests.forEach((e4) => {
    e4._reject(t3);
  }), e3._writeRequests = new v(), void 0 === e3._pendingAbortRequest) return void Et(e3);
  const r3 = e3._pendingAbortRequest;
  if (e3._pendingAbortRequest = void 0, r3._wasAlreadyErroring) return r3._reject(t3), void Et(e3);
  b(e3._writableStreamController[w](r3._reason), () => (r3._resolve(), Et(e3), null), (t4) => (r3._reject(t4), Et(e3), null));
}
function qt(e3) {
  return void 0 !== e3._closeRequest || void 0 !== e3._inFlightCloseRequest;
}
function Et(e3) {
  void 0 !== e3._closeRequest && (e3._closeRequest._reject(e3._storedError), e3._closeRequest = void 0);
  const t3 = e3._writer;
  void 0 !== t3 && Jt(t3, e3._storedError);
}
function Wt(e3, t3) {
  const r3 = e3._writer;
  void 0 !== r3 && t3 !== e3._backpressure && (t3 ? function(e4) {
    Zt(e4);
  }(r3) : or(r3)), e3._backpressure = t3;
}
Object.defineProperties(WritableStream.prototype, { abort: { enumerable: true }, close: { enumerable: true }, getWriter: { enumerable: true }, locked: { enumerable: true } }), o(WritableStream.prototype.abort, "abort"), o(WritableStream.prototype.close, "close"), o(WritableStream.prototype.getWriter, "getWriter"), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(WritableStream.prototype, Symbol.toStringTag, { value: "WritableStream", configurable: true });
var WritableStreamDefaultWriter = class {
  constructor(e3) {
    if ($(e3, 1, "WritableStreamDefaultWriter"), pt(e3, "First parameter"), vt(e3)) throw new TypeError("This stream has already been locked for exclusive writing by another writer");
    this._ownerWritableStream = e3, e3._writer = this;
    const t3 = e3._state;
    if ("writable" === t3) !qt(e3) && e3._backpressure ? Zt(this) : tr(this), Gt(this);
    else if ("erroring" === t3) er(this, e3._storedError), Gt(this);
    else if ("closed" === t3) tr(this), Gt(r3 = this), Kt(r3);
    else {
      const t4 = e3._storedError;
      er(this, t4), Xt(this, t4);
    }
    var r3;
  }
  get closed() {
    return Ot(this) ? this._closedPromise : d(Vt("closed"));
  }
  get desiredSize() {
    if (!Ot(this)) throw Vt("desiredSize");
    if (void 0 === this._ownerWritableStream) throw Ut("desiredSize");
    return function(e3) {
      const t3 = e3._ownerWritableStream, r3 = t3._state;
      if ("errored" === r3 || "erroring" === r3) return null;
      if ("closed" === r3) return 0;
      return $t(t3._writableStreamController);
    }(this);
  }
  get ready() {
    return Ot(this) ? this._readyPromise : d(Vt("ready"));
  }
  abort(e3 = void 0) {
    return Ot(this) ? void 0 === this._ownerWritableStream ? d(Ut("abort")) : function(e4, t3) {
      return wt(e4._ownerWritableStream, t3);
    }(this, e3) : d(Vt("abort"));
  }
  close() {
    if (!Ot(this)) return d(Vt("close"));
    const e3 = this._ownerWritableStream;
    return void 0 === e3 ? d(Ut("close")) : qt(e3) ? d(new TypeError("Cannot close an already-closing stream")) : Bt(this);
  }
  releaseLock() {
    if (!Ot(this)) throw Vt("releaseLock");
    void 0 !== this._ownerWritableStream && At(this);
  }
  write(e3 = void 0) {
    return Ot(this) ? void 0 === this._ownerWritableStream ? d(Ut("write to")) : zt(this, e3) : d(Vt("write"));
  }
};
function Ot(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_ownerWritableStream") && e3 instanceof WritableStreamDefaultWriter);
}
function Bt(e3) {
  return Rt(e3._ownerWritableStream);
}
function kt(e3, t3) {
  "pending" === e3._closedPromiseState ? Jt(e3, t3) : function(e4, t4) {
    Xt(e4, t4);
  }(e3, t3);
}
function jt(e3, t3) {
  "pending" === e3._readyPromiseState ? rr(e3, t3) : function(e4, t4) {
    er(e4, t4);
  }(e3, t3);
}
function At(e3) {
  const t3 = e3._ownerWritableStream, r3 = new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");
  jt(e3, r3), kt(e3, r3), t3._writer = void 0, e3._ownerWritableStream = void 0;
}
function zt(e3, t3) {
  const r3 = e3._ownerWritableStream, o2 = r3._writableStreamController, n3 = function(e4, t4) {
    if (void 0 === e4._strategySizeAlgorithm) return 1;
    try {
      return e4._strategySizeAlgorithm(t4);
    } catch (t5) {
      return Yt(e4, t5), 1;
    }
  }(o2, t3);
  if (r3 !== e3._ownerWritableStream) return d(Ut("write to"));
  const a2 = r3._state;
  if ("errored" === a2) return d(r3._storedError);
  if (qt(r3) || "closed" === a2) return d(new TypeError("The stream is closing or closed and cannot be written to"));
  if ("erroring" === a2) return d(r3._storedError);
  const i2 = function(e4) {
    return u((t4, r4) => {
      const o3 = { _resolve: t4, _reject: r4 };
      e4._writeRequests.push(o3);
    });
  }(r3);
  return function(e4, t4, r4) {
    try {
      ve(e4, t4, r4);
    } catch (t5) {
      return void Yt(e4, t5);
    }
    const o3 = e4._controlledWritableStream;
    if (!qt(o3) && "writable" === o3._state) {
      Wt(o3, xt(e4));
    }
    Mt(e4);
  }(o2, t3, n3), i2;
}
Object.defineProperties(WritableStreamDefaultWriter.prototype, { abort: { enumerable: true }, close: { enumerable: true }, releaseLock: { enumerable: true }, write: { enumerable: true }, closed: { enumerable: true }, desiredSize: { enumerable: true }, ready: { enumerable: true } }), o(WritableStreamDefaultWriter.prototype.abort, "abort"), o(WritableStreamDefaultWriter.prototype.close, "close"), o(WritableStreamDefaultWriter.prototype.releaseLock, "releaseLock"), o(WritableStreamDefaultWriter.prototype.write, "write"), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(WritableStreamDefaultWriter.prototype, Symbol.toStringTag, { value: "WritableStreamDefaultWriter", configurable: true });
var Dt = {};
var WritableStreamDefaultController = class {
  constructor() {
    throw new TypeError("Illegal constructor");
  }
  get abortReason() {
    if (!Lt(this)) throw Ht("abortReason");
    return this._abortReason;
  }
  get signal() {
    if (!Lt(this)) throw Ht("signal");
    if (void 0 === this._abortController) throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");
    return this._abortController.signal;
  }
  error(e3 = void 0) {
    if (!Lt(this)) throw Ht("error");
    "writable" === this._controlledWritableStream._state && Qt(this, e3);
  }
  [w](e3) {
    const t3 = this._abortAlgorithm(e3);
    return It(this), t3;
  }
  [R]() {
    we(this);
  }
};
function Lt(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_controlledWritableStream") && e3 instanceof WritableStreamDefaultController);
}
function Ft(e3, t3, r3, o2, n3, a2, i2, l2) {
  t3._controlledWritableStream = e3, e3._writableStreamController = t3, t3._queue = void 0, t3._queueTotalSize = void 0, we(t3), t3._abortReason = void 0, t3._abortController = function() {
    if ("function" == typeof AbortController) return new AbortController();
  }(), t3._started = false, t3._strategySizeAlgorithm = l2, t3._strategyHWM = i2, t3._writeAlgorithm = o2, t3._closeAlgorithm = n3, t3._abortAlgorithm = a2;
  const s2 = xt(t3);
  Wt(e3, s2);
  b(c(r3()), () => (t3._started = true, Mt(t3), null), (r4) => (t3._started = true, Tt(e3, r4), null));
}
function It(e3) {
  e3._writeAlgorithm = void 0, e3._closeAlgorithm = void 0, e3._abortAlgorithm = void 0, e3._strategySizeAlgorithm = void 0;
}
function $t(e3) {
  return e3._strategyHWM - e3._queueTotalSize;
}
function Mt(e3) {
  const t3 = e3._controlledWritableStream;
  if (!e3._started) return;
  if (void 0 !== t3._inFlightWriteRequest) return;
  if ("erroring" === t3._state) return void Pt(t3);
  if (0 === e3._queue.length) return;
  const r3 = e3._queue.peek().value;
  r3 === Dt ? function(e4) {
    const t4 = e4._controlledWritableStream;
    (function(e5) {
      e5._inFlightCloseRequest = e5._closeRequest, e5._closeRequest = void 0;
    })(t4), ge(e4);
    const r4 = e4._closeAlgorithm();
    It(e4), b(r4, () => (function(e5) {
      e5._inFlightCloseRequest._resolve(void 0), e5._inFlightCloseRequest = void 0, "erroring" === e5._state && (e5._storedError = void 0, void 0 !== e5._pendingAbortRequest && (e5._pendingAbortRequest._resolve(), e5._pendingAbortRequest = void 0)), e5._state = "closed";
      const t5 = e5._writer;
      void 0 !== t5 && Kt(t5);
    }(t4), null), (e5) => (function(e6, t5) {
      e6._inFlightCloseRequest._reject(t5), e6._inFlightCloseRequest = void 0, void 0 !== e6._pendingAbortRequest && (e6._pendingAbortRequest._reject(t5), e6._pendingAbortRequest = void 0), Tt(e6, t5);
    }(t4, e5), null));
  }(e3) : function(e4, t4) {
    const r4 = e4._controlledWritableStream;
    !function(e5) {
      e5._inFlightWriteRequest = e5._writeRequests.shift();
    }(r4);
    const o2 = e4._writeAlgorithm(t4);
    b(o2, () => {
      !function(e5) {
        e5._inFlightWriteRequest._resolve(void 0), e5._inFlightWriteRequest = void 0;
      }(r4);
      const t5 = r4._state;
      if (ge(e4), !qt(r4) && "writable" === t5) {
        const t6 = xt(e4);
        Wt(r4, t6);
      }
      return Mt(e4), null;
    }, (t5) => ("writable" === r4._state && It(e4), function(e5, t6) {
      e5._inFlightWriteRequest._reject(t6), e5._inFlightWriteRequest = void 0, Tt(e5, t6);
    }(r4, t5), null));
  }(e3, r3);
}
function Yt(e3, t3) {
  "writable" === e3._controlledWritableStream._state && Qt(e3, t3);
}
function xt(e3) {
  return $t(e3) <= 0;
}
function Qt(e3, t3) {
  const r3 = e3._controlledWritableStream;
  It(e3), Ct(r3, t3);
}
function Nt(e3) {
  return new TypeError(`WritableStream.prototype.${e3} can only be used on a WritableStream`);
}
function Ht(e3) {
  return new TypeError(`WritableStreamDefaultController.prototype.${e3} can only be used on a WritableStreamDefaultController`);
}
function Vt(e3) {
  return new TypeError(`WritableStreamDefaultWriter.prototype.${e3} can only be used on a WritableStreamDefaultWriter`);
}
function Ut(e3) {
  return new TypeError("Cannot " + e3 + " a stream using a released writer");
}
function Gt(e3) {
  e3._closedPromise = u((t3, r3) => {
    e3._closedPromise_resolve = t3, e3._closedPromise_reject = r3, e3._closedPromiseState = "pending";
  });
}
function Xt(e3, t3) {
  Gt(e3), Jt(e3, t3);
}
function Jt(e3, t3) {
  void 0 !== e3._closedPromise_reject && (p(e3._closedPromise), e3._closedPromise_reject(t3), e3._closedPromise_resolve = void 0, e3._closedPromise_reject = void 0, e3._closedPromiseState = "rejected");
}
function Kt(e3) {
  void 0 !== e3._closedPromise_resolve && (e3._closedPromise_resolve(void 0), e3._closedPromise_resolve = void 0, e3._closedPromise_reject = void 0, e3._closedPromiseState = "resolved");
}
function Zt(e3) {
  e3._readyPromise = u((t3, r3) => {
    e3._readyPromise_resolve = t3, e3._readyPromise_reject = r3;
  }), e3._readyPromiseState = "pending";
}
function er(e3, t3) {
  Zt(e3), rr(e3, t3);
}
function tr(e3) {
  Zt(e3), or(e3);
}
function rr(e3, t3) {
  void 0 !== e3._readyPromise_reject && (p(e3._readyPromise), e3._readyPromise_reject(t3), e3._readyPromise_resolve = void 0, e3._readyPromise_reject = void 0, e3._readyPromiseState = "rejected");
}
function or(e3) {
  void 0 !== e3._readyPromise_resolve && (e3._readyPromise_resolve(void 0), e3._readyPromise_resolve = void 0, e3._readyPromise_reject = void 0, e3._readyPromiseState = "fulfilled");
}
Object.defineProperties(WritableStreamDefaultController.prototype, { abortReason: { enumerable: true }, signal: { enumerable: true }, error: { enumerable: true } }), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(WritableStreamDefaultController.prototype, Symbol.toStringTag, { value: "WritableStreamDefaultController", configurable: true });
var nr = "undefined" != typeof globalThis ? globalThis : "undefined" != typeof self ? self : "undefined" != typeof global ? global : void 0;
var ar = function() {
  const e3 = null == nr ? void 0 : nr.DOMException;
  return function(e4) {
    if ("function" != typeof e4 && "object" != typeof e4) return false;
    if ("DOMException" !== e4.name) return false;
    try {
      return new e4(), true;
    } catch (e5) {
      return false;
    }
  }(e3) ? e3 : void 0;
}() || function() {
  const e3 = function(e4, t3) {
    this.message = e4 || "", this.name = t3 || "Error", Error.captureStackTrace && Error.captureStackTrace(this, this.constructor);
  };
  return o(e3, "DOMException"), e3.prototype = Object.create(Error.prototype), Object.defineProperty(e3.prototype, "constructor", { value: e3, writable: true, configurable: true }), e3;
}();
function ir(t3, r3, o2, n3, a2, i2) {
  const l2 = H(t3), s2 = yt(r3);
  t3._disturbed = true;
  let _2 = false, y2 = c(void 0);
  return u((S2, g2) => {
    let v2;
    if (void 0 !== i2) {
      if (v2 = () => {
        const e3 = void 0 !== i2.reason ? i2.reason : new ar("Aborted", "AbortError"), o3 = [];
        n3 || o3.push(() => "writable" === r3._state ? wt(r3, e3) : c(void 0)), a2 || o3.push(() => "readable" === t3._state ? Or(t3, e3) : c(void 0)), q2(() => Promise.all(o3.map((e4) => e4())), true, e3);
      }, i2.aborted) return void v2();
      i2.addEventListener("abort", v2);
    }
    var w2, R2, T2;
    if (P2(t3, l2._closedPromise, (e3) => (n3 ? E2(true, e3) : q2(() => wt(r3, e3), true, e3), null)), P2(r3, s2._closedPromise, (e3) => (a2 ? E2(true, e3) : q2(() => Or(t3, e3), true, e3), null)), w2 = t3, R2 = l2._closedPromise, T2 = () => (o2 ? E2() : q2(() => function(e3) {
      const t4 = e3._ownerWritableStream, r4 = t4._state;
      return qt(t4) || "closed" === r4 ? c(void 0) : "errored" === r4 ? d(t4._storedError) : Bt(e3);
    }(s2)), null), "closed" === w2._state ? T2() : h(R2, T2), qt(r3) || "closed" === r3._state) {
      const e3 = new TypeError("the destination writable stream closed before all data could be piped to it");
      a2 ? E2(true, e3) : q2(() => Or(t3, e3), true, e3);
    }
    function C2() {
      const e3 = y2;
      return f(y2, () => e3 !== y2 ? C2() : void 0);
    }
    function P2(e3, t4, r4) {
      "errored" === e3._state ? r4(e3._storedError) : m(t4, r4);
    }
    function q2(e3, t4, o3) {
      function n4() {
        return b(e3(), () => O2(t4, o3), (e4) => O2(true, e4)), null;
      }
      _2 || (_2 = true, "writable" !== r3._state || qt(r3) ? n4() : h(C2(), n4));
    }
    function E2(e3, t4) {
      _2 || (_2 = true, "writable" !== r3._state || qt(r3) ? O2(e3, t4) : h(C2(), () => O2(e3, t4)));
    }
    function O2(e3, t4) {
      return At(s2), W(l2), void 0 !== i2 && i2.removeEventListener("abort", v2), e3 ? g2(t4) : S2(void 0), null;
    }
    p(u((t4, r4) => {
      !function o3(n4) {
        n4 ? t4() : f(_2 ? c(true) : f(s2._readyPromise, () => u((t5, r5) => {
          K(l2, { _chunkSteps: (r6) => {
            y2 = f(zt(s2, r6), void 0, e2), t5(false);
          }, _closeSteps: () => t5(true), _errorSteps: r5 });
        })), o3, r4);
      }(false);
    }));
  });
}
var ReadableStreamDefaultController = class {
  constructor() {
    throw new TypeError("Illegal constructor");
  }
  get desiredSize() {
    if (!lr(this)) throw pr("desiredSize");
    return hr(this);
  }
  close() {
    if (!lr(this)) throw pr("close");
    if (!mr(this)) throw new TypeError("The stream is not in a state that permits close");
    dr(this);
  }
  enqueue(e3 = void 0) {
    if (!lr(this)) throw pr("enqueue");
    if (!mr(this)) throw new TypeError("The stream is not in a state that permits enqueue");
    return fr(this, e3);
  }
  error(e3 = void 0) {
    if (!lr(this)) throw pr("error");
    br(this, e3);
  }
  [T](e3) {
    we(this);
    const t3 = this._cancelAlgorithm(e3);
    return cr(this), t3;
  }
  [C](e3) {
    const t3 = this._controlledReadableStream;
    if (this._queue.length > 0) {
      const r3 = ge(this);
      this._closeRequested && 0 === this._queue.length ? (cr(this), Br(t3)) : sr(this), e3._chunkSteps(r3);
    } else V(t3, e3), sr(this);
  }
  [P]() {
  }
};
function lr(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_controlledReadableStream") && e3 instanceof ReadableStreamDefaultController);
}
function sr(e3) {
  if (!ur(e3)) return;
  if (e3._pulling) return void (e3._pullAgain = true);
  e3._pulling = true;
  b(e3._pullAlgorithm(), () => (e3._pulling = false, e3._pullAgain && (e3._pullAgain = false, sr(e3)), null), (t3) => (br(e3, t3), null));
}
function ur(e3) {
  const t3 = e3._controlledReadableStream;
  if (!mr(e3)) return false;
  if (!e3._started) return false;
  if (Wr(t3) && G(t3) > 0) return true;
  return hr(e3) > 0;
}
function cr(e3) {
  e3._pullAlgorithm = void 0, e3._cancelAlgorithm = void 0, e3._strategySizeAlgorithm = void 0;
}
function dr(e3) {
  if (!mr(e3)) return;
  const t3 = e3._controlledReadableStream;
  e3._closeRequested = true, 0 === e3._queue.length && (cr(e3), Br(t3));
}
function fr(e3, t3) {
  if (!mr(e3)) return;
  const r3 = e3._controlledReadableStream;
  if (Wr(r3) && G(r3) > 0) U(r3, t3, false);
  else {
    let r4;
    try {
      r4 = e3._strategySizeAlgorithm(t3);
    } catch (t4) {
      throw br(e3, t4), t4;
    }
    try {
      ve(e3, t3, r4);
    } catch (t4) {
      throw br(e3, t4), t4;
    }
  }
  sr(e3);
}
function br(e3, t3) {
  const r3 = e3._controlledReadableStream;
  "readable" === r3._state && (we(e3), cr(e3), kr(r3, t3));
}
function hr(e3) {
  const t3 = e3._controlledReadableStream._state;
  return "errored" === t3 ? null : "closed" === t3 ? 0 : e3._strategyHWM - e3._queueTotalSize;
}
function mr(e3) {
  const t3 = e3._controlledReadableStream._state;
  return !e3._closeRequested && "readable" === t3;
}
function _r(e3, t3, r3, o2, n3, a2, i2) {
  t3._controlledReadableStream = e3, t3._queue = void 0, t3._queueTotalSize = void 0, we(t3), t3._started = false, t3._closeRequested = false, t3._pullAgain = false, t3._pulling = false, t3._strategySizeAlgorithm = i2, t3._strategyHWM = a2, t3._pullAlgorithm = o2, t3._cancelAlgorithm = n3, e3._readableStreamController = t3;
  b(c(r3()), () => (t3._started = true, sr(t3), null), (e4) => (br(t3, e4), null));
}
function pr(e3) {
  return new TypeError(`ReadableStreamDefaultController.prototype.${e3} can only be used on a ReadableStreamDefaultController`);
}
function yr(e3, t3) {
  return Te(e3._readableStreamController) ? function(e4) {
    let t4, r3, o2, n3, a2, i2 = H(e4), l2 = false, s2 = false, d2 = false, f2 = false, b2 = false;
    const h2 = u((e5) => {
      a2 = e5;
    });
    function _2(e5) {
      m(e5._closedPromise, (t5) => (e5 !== i2 || (Ne(o2._readableStreamController, t5), Ne(n3._readableStreamController, t5), f2 && b2 || a2(void 0)), null));
    }
    function p2() {
      at(i2) && (W(i2), i2 = H(e4), _2(i2));
      K(i2, { _chunkSteps: (t5) => {
        y(() => {
          s2 = false, d2 = false;
          const r4 = t5;
          let i3 = t5;
          if (!f2 && !b2) try {
            i3 = Se(t5);
          } catch (t6) {
            return Ne(o2._readableStreamController, t6), Ne(n3._readableStreamController, t6), void a2(Or(e4, t6));
          }
          f2 || Qe(o2._readableStreamController, r4), b2 || Qe(n3._readableStreamController, i3), l2 = false, s2 ? g2() : d2 && v2();
        });
      }, _closeSteps: () => {
        l2 = false, f2 || xe(o2._readableStreamController), b2 || xe(n3._readableStreamController), o2._readableStreamController._pendingPullIntos.length > 0 && Ge(o2._readableStreamController, 0), n3._readableStreamController._pendingPullIntos.length > 0 && Ge(n3._readableStreamController, 0), f2 && b2 || a2(void 0);
      }, _errorSteps: () => {
        l2 = false;
      } });
    }
    function S2(t5, r4) {
      J(i2) && (W(i2), i2 = tt(e4), _2(i2));
      const u2 = r4 ? n3 : o2, c2 = r4 ? o2 : n3;
      it(i2, t5, 1, { _chunkSteps: (t6) => {
        y(() => {
          s2 = false, d2 = false;
          const o3 = r4 ? b2 : f2;
          if (r4 ? f2 : b2) o3 || Xe(u2._readableStreamController, t6);
          else {
            let r5;
            try {
              r5 = Se(t6);
            } catch (t7) {
              return Ne(u2._readableStreamController, t7), Ne(c2._readableStreamController, t7), void a2(Or(e4, t7));
            }
            o3 || Xe(u2._readableStreamController, t6), Qe(c2._readableStreamController, r5);
          }
          l2 = false, s2 ? g2() : d2 && v2();
        });
      }, _closeSteps: (e5) => {
        l2 = false;
        const t6 = r4 ? b2 : f2, o3 = r4 ? f2 : b2;
        t6 || xe(u2._readableStreamController), o3 || xe(c2._readableStreamController), void 0 !== e5 && (t6 || Xe(u2._readableStreamController, e5), !o3 && c2._readableStreamController._pendingPullIntos.length > 0 && Ge(c2._readableStreamController, 0)), t6 && o3 || a2(void 0);
      }, _errorSteps: () => {
        l2 = false;
      } });
    }
    function g2() {
      if (l2) return s2 = true, c(void 0);
      l2 = true;
      const e5 = Ve(o2._readableStreamController);
      return null === e5 ? p2() : S2(e5._view, false), c(void 0);
    }
    function v2() {
      if (l2) return d2 = true, c(void 0);
      l2 = true;
      const e5 = Ve(n3._readableStreamController);
      return null === e5 ? p2() : S2(e5._view, true), c(void 0);
    }
    function w2(o3) {
      if (f2 = true, t4 = o3, b2) {
        const o4 = ne([t4, r3]), n4 = Or(e4, o4);
        a2(n4);
      }
      return h2;
    }
    function R2(o3) {
      if (b2 = true, r3 = o3, f2) {
        const o4 = ne([t4, r3]), n4 = Or(e4, o4);
        a2(n4);
      }
      return h2;
    }
    function T2() {
    }
    return o2 = Pr(T2, g2, w2), n3 = Pr(T2, v2, R2), _2(i2), [o2, n3];
  }(e3) : function(e4) {
    const t4 = H(e4);
    let r3, o2, n3, a2, i2, l2 = false, s2 = false, d2 = false, f2 = false;
    const b2 = u((e5) => {
      i2 = e5;
    });
    function h2() {
      if (l2) return s2 = true, c(void 0);
      l2 = true;
      return K(t4, { _chunkSteps: (e5) => {
        y(() => {
          s2 = false;
          const t5 = e5, r4 = e5;
          d2 || fr(n3._readableStreamController, t5), f2 || fr(a2._readableStreamController, r4), l2 = false, s2 && h2();
        });
      }, _closeSteps: () => {
        l2 = false, d2 || dr(n3._readableStreamController), f2 || dr(a2._readableStreamController), d2 && f2 || i2(void 0);
      }, _errorSteps: () => {
        l2 = false;
      } }), c(void 0);
    }
    function _2(t5) {
      if (d2 = true, r3 = t5, f2) {
        const t6 = ne([r3, o2]), n4 = Or(e4, t6);
        i2(n4);
      }
      return b2;
    }
    function p2(t5) {
      if (f2 = true, o2 = t5, d2) {
        const t6 = ne([r3, o2]), n4 = Or(e4, t6);
        i2(n4);
      }
      return b2;
    }
    function S2() {
    }
    return n3 = Cr(S2, h2, _2), a2 = Cr(S2, h2, p2), m(t4._closedPromise, (e5) => (br(n3._readableStreamController, e5), br(a2._readableStreamController, e5), d2 && f2 || i2(void 0), null)), [n3, a2];
  }(e3);
}
function Sr(r3) {
  return t(o2 = r3) && void 0 !== o2.getReader ? function(r4) {
    let o3;
    function n3() {
      let e3;
      try {
        e3 = r4.read();
      } catch (e4) {
        return d(e4);
      }
      return _(e3, (e4) => {
        if (!t(e4)) throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");
        if (e4.done) dr(o3._readableStreamController);
        else {
          const t3 = e4.value;
          fr(o3._readableStreamController, t3);
        }
      });
    }
    function a2(e3) {
      try {
        return c(r4.cancel(e3));
      } catch (e4) {
        return d(e4);
      }
    }
    return o3 = Cr(e2, n3, a2, 0), o3;
  }(r3.getReader()) : function(r4) {
    let o3;
    const n3 = fe(r4, "async");
    function a2() {
      let e3;
      try {
        e3 = be(n3);
      } catch (e4) {
        return d(e4);
      }
      return _(c(e3), (e4) => {
        if (!t(e4)) throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");
        if (e4.done) dr(o3._readableStreamController);
        else {
          const t3 = e4.value;
          fr(o3._readableStreamController, t3);
        }
      });
    }
    function i2(e3) {
      const r5 = n3.iterator;
      let o4;
      try {
        o4 = ue(r5, "return");
      } catch (e4) {
        return d(e4);
      }
      if (void 0 === o4) return c(void 0);
      return _(g(o4, r5, [e3]), (e4) => {
        if (!t(e4)) throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object");
      });
    }
    return o3 = Cr(e2, a2, i2, 0), o3;
  }(r3);
  var o2;
}
function gr(e3, t3, r3) {
  return F(e3, r3), (r4) => g(e3, t3, [r4]);
}
function vr(e3, t3, r3) {
  return F(e3, r3), (r4) => g(e3, t3, [r4]);
}
function wr(e3, t3, r3) {
  return F(e3, r3), (r4) => S(e3, t3, [r4]);
}
function Rr(e3, t3) {
  if ("bytes" !== (e3 = `${e3}`)) throw new TypeError(`${t3} '${e3}' is not a valid enumeration value for ReadableStreamType`);
  return e3;
}
function Tr(e3, t3) {
  L(e3, t3);
  const r3 = null == e3 ? void 0 : e3.preventAbort, o2 = null == e3 ? void 0 : e3.preventCancel, n3 = null == e3 ? void 0 : e3.preventClose, a2 = null == e3 ? void 0 : e3.signal;
  return void 0 !== a2 && function(e4, t4) {
    if (!function(e5) {
      if ("object" != typeof e5 || null === e5) return false;
      try {
        return "boolean" == typeof e5.aborted;
      } catch (e6) {
        return false;
      }
    }(e4)) throw new TypeError(`${t4} is not an AbortSignal.`);
  }(a2, `${t3} has member 'signal' that`), { preventAbort: Boolean(r3), preventCancel: Boolean(o2), preventClose: Boolean(n3), signal: a2 };
}
Object.defineProperties(ReadableStreamDefaultController.prototype, { close: { enumerable: true }, enqueue: { enumerable: true }, error: { enumerable: true }, desiredSize: { enumerable: true } }), o(ReadableStreamDefaultController.prototype.close, "close"), o(ReadableStreamDefaultController.prototype.enqueue, "enqueue"), o(ReadableStreamDefaultController.prototype.error, "error"), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(ReadableStreamDefaultController.prototype, Symbol.toStringTag, { value: "ReadableStreamDefaultController", configurable: true });
var ReadableStream = class {
  constructor(e3 = {}, t3 = {}) {
    void 0 === e3 ? e3 = null : I(e3, "First parameter");
    const r3 = dt(t3, "Second parameter"), o2 = function(e4, t4) {
      L(e4, t4);
      const r4 = e4, o3 = null == r4 ? void 0 : r4.autoAllocateChunkSize, n3 = null == r4 ? void 0 : r4.cancel, a2 = null == r4 ? void 0 : r4.pull, i2 = null == r4 ? void 0 : r4.start, l2 = null == r4 ? void 0 : r4.type;
      return { autoAllocateChunkSize: void 0 === o3 ? void 0 : Q(o3, `${t4} has member 'autoAllocateChunkSize' that`), cancel: void 0 === n3 ? void 0 : gr(n3, r4, `${t4} has member 'cancel' that`), pull: void 0 === a2 ? void 0 : vr(a2, r4, `${t4} has member 'pull' that`), start: void 0 === i2 ? void 0 : wr(i2, r4, `${t4} has member 'start' that`), type: void 0 === l2 ? void 0 : Rr(l2, `${t4} has member 'type' that`) };
    }(e3, "First parameter");
    if (qr(this), "bytes" === o2.type) {
      if (void 0 !== r3.size) throw new RangeError("The strategy for a byte stream cannot have a size function");
      !function(e4, t4, r4) {
        const o3 = Object.create(ReadableByteStreamController.prototype);
        let n3, a2, i2;
        n3 = void 0 !== t4.start ? () => t4.start(o3) : () => {
        }, a2 = void 0 !== t4.pull ? () => t4.pull(o3) : () => c(void 0), i2 = void 0 !== t4.cancel ? (e5) => t4.cancel(e5) : () => c(void 0);
        const l2 = t4.autoAllocateChunkSize;
        if (0 === l2) throw new TypeError("autoAllocateChunkSize must be greater than 0");
        Je(e4, o3, n3, a2, i2, r4, l2);
      }(this, o2, ut(r3, 0));
    } else {
      const e4 = ct(r3);
      !function(e5, t4, r4, o3) {
        const n3 = Object.create(ReadableStreamDefaultController.prototype);
        let a2, i2, l2;
        a2 = void 0 !== t4.start ? () => t4.start(n3) : () => {
        }, i2 = void 0 !== t4.pull ? () => t4.pull(n3) : () => c(void 0), l2 = void 0 !== t4.cancel ? (e6) => t4.cancel(e6) : () => c(void 0), _r(e5, n3, a2, i2, l2, r4, o3);
      }(this, o2, ut(r3, 1), e4);
    }
  }
  get locked() {
    if (!Er(this)) throw jr("locked");
    return Wr(this);
  }
  cancel(e3 = void 0) {
    return Er(this) ? Wr(this) ? d(new TypeError("Cannot cancel a stream that already has a reader")) : Or(this, e3) : d(jr("cancel"));
  }
  getReader(e3 = void 0) {
    if (!Er(this)) throw jr("getReader");
    return void 0 === function(e4, t3) {
      L(e4, t3);
      const r3 = null == e4 ? void 0 : e4.mode;
      return { mode: void 0 === r3 ? void 0 : et(r3, `${t3} has member 'mode' that`) };
    }(e3, "First parameter").mode ? H(this) : tt(this);
  }
  pipeThrough(e3, t3 = {}) {
    if (!Er(this)) throw jr("pipeThrough");
    $(e3, 1, "pipeThrough");
    const r3 = function(e4, t4) {
      L(e4, t4);
      const r4 = null == e4 ? void 0 : e4.readable;
      M(r4, "readable", "ReadableWritablePair"), N(r4, `${t4} has member 'readable' that`);
      const o3 = null == e4 ? void 0 : e4.writable;
      return M(o3, "writable", "ReadableWritablePair"), pt(o3, `${t4} has member 'writable' that`), { readable: r4, writable: o3 };
    }(e3, "First parameter"), o2 = Tr(t3, "Second parameter");
    if (Wr(this)) throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");
    if (vt(r3.writable)) throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");
    return p(ir(this, r3.writable, o2.preventClose, o2.preventAbort, o2.preventCancel, o2.signal)), r3.readable;
  }
  pipeTo(e3, t3 = {}) {
    if (!Er(this)) return d(jr("pipeTo"));
    if (void 0 === e3) return d("Parameter 1 is required in 'pipeTo'.");
    if (!gt(e3)) return d(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));
    let r3;
    try {
      r3 = Tr(t3, "Second parameter");
    } catch (e4) {
      return d(e4);
    }
    return Wr(this) ? d(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")) : vt(e3) ? d(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")) : ir(this, e3, r3.preventClose, r3.preventAbort, r3.preventCancel, r3.signal);
  }
  tee() {
    if (!Er(this)) throw jr("tee");
    return ne(yr(this));
  }
  values(e3 = void 0) {
    if (!Er(this)) throw jr("values");
    return function(e4, t3) {
      const r3 = H(e4), o2 = new he(r3, t3), n3 = Object.create(me);
      return n3._asyncIteratorImpl = o2, n3;
    }(this, function(e4, t3) {
      L(e4, t3);
      const r3 = null == e4 ? void 0 : e4.preventCancel;
      return { preventCancel: Boolean(r3) };
    }(e3, "First parameter").preventCancel);
  }
  [de](e3) {
    return this.values(e3);
  }
  static from(e3) {
    return Sr(e3);
  }
};
function Cr(e3, t3, r3, o2 = 1, n3 = () => 1) {
  const a2 = Object.create(ReadableStream.prototype);
  qr(a2);
  return _r(a2, Object.create(ReadableStreamDefaultController.prototype), e3, t3, r3, o2, n3), a2;
}
function Pr(e3, t3, r3) {
  const o2 = Object.create(ReadableStream.prototype);
  qr(o2);
  return Je(o2, Object.create(ReadableByteStreamController.prototype), e3, t3, r3, 0, void 0), o2;
}
function qr(e3) {
  e3._state = "readable", e3._reader = void 0, e3._storedError = void 0, e3._disturbed = false;
}
function Er(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_readableStreamController") && e3 instanceof ReadableStream);
}
function Wr(e3) {
  return void 0 !== e3._reader;
}
function Or(t3, r3) {
  if (t3._disturbed = true, "closed" === t3._state) return c(void 0);
  if ("errored" === t3._state) return d(t3._storedError);
  Br(t3);
  const o2 = t3._reader;
  if (void 0 !== o2 && at(o2)) {
    const e3 = o2._readIntoRequests;
    o2._readIntoRequests = new v(), e3.forEach((e4) => {
      e4._closeSteps(void 0);
    });
  }
  return _(t3._readableStreamController[T](r3), e2);
}
function Br(e3) {
  e3._state = "closed";
  const t3 = e3._reader;
  if (void 0 !== t3 && (A(t3), J(t3))) {
    const e4 = t3._readRequests;
    t3._readRequests = new v(), e4.forEach((e5) => {
      e5._closeSteps();
    });
  }
}
function kr(e3, t3) {
  e3._state = "errored", e3._storedError = t3;
  const r3 = e3._reader;
  void 0 !== r3 && (j(r3, t3), J(r3) ? Z(r3, t3) : lt(r3, t3));
}
function jr(e3) {
  return new TypeError(`ReadableStream.prototype.${e3} can only be used on a ReadableStream`);
}
function Ar(e3, t3) {
  L(e3, t3);
  const r3 = null == e3 ? void 0 : e3.highWaterMark;
  return M(r3, "highWaterMark", "QueuingStrategyInit"), { highWaterMark: Y(r3) };
}
Object.defineProperties(ReadableStream, { from: { enumerable: true } }), Object.defineProperties(ReadableStream.prototype, { cancel: { enumerable: true }, getReader: { enumerable: true }, pipeThrough: { enumerable: true }, pipeTo: { enumerable: true }, tee: { enumerable: true }, values: { enumerable: true }, locked: { enumerable: true } }), o(ReadableStream.from, "from"), o(ReadableStream.prototype.cancel, "cancel"), o(ReadableStream.prototype.getReader, "getReader"), o(ReadableStream.prototype.pipeThrough, "pipeThrough"), o(ReadableStream.prototype.pipeTo, "pipeTo"), o(ReadableStream.prototype.tee, "tee"), o(ReadableStream.prototype.values, "values"), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(ReadableStream.prototype, Symbol.toStringTag, { value: "ReadableStream", configurable: true }), Object.defineProperty(ReadableStream.prototype, de, { value: ReadableStream.prototype.values, writable: true, configurable: true });
var zr = (e3) => e3.byteLength;
o(zr, "size");
var ByteLengthQueuingStrategy = class {
  constructor(e3) {
    $(e3, 1, "ByteLengthQueuingStrategy"), e3 = Ar(e3, "First parameter"), this._byteLengthQueuingStrategyHighWaterMark = e3.highWaterMark;
  }
  get highWaterMark() {
    if (!Lr(this)) throw Dr("highWaterMark");
    return this._byteLengthQueuingStrategyHighWaterMark;
  }
  get size() {
    if (!Lr(this)) throw Dr("size");
    return zr;
  }
};
function Dr(e3) {
  return new TypeError(`ByteLengthQueuingStrategy.prototype.${e3} can only be used on a ByteLengthQueuingStrategy`);
}
function Lr(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_byteLengthQueuingStrategyHighWaterMark") && e3 instanceof ByteLengthQueuingStrategy);
}
Object.defineProperties(ByteLengthQueuingStrategy.prototype, { highWaterMark: { enumerable: true }, size: { enumerable: true } }), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(ByteLengthQueuingStrategy.prototype, Symbol.toStringTag, { value: "ByteLengthQueuingStrategy", configurable: true });
var Fr = () => 1;
o(Fr, "size");
var CountQueuingStrategy = class {
  constructor(e3) {
    $(e3, 1, "CountQueuingStrategy"), e3 = Ar(e3, "First parameter"), this._countQueuingStrategyHighWaterMark = e3.highWaterMark;
  }
  get highWaterMark() {
    if (!$r(this)) throw Ir("highWaterMark");
    return this._countQueuingStrategyHighWaterMark;
  }
  get size() {
    if (!$r(this)) throw Ir("size");
    return Fr;
  }
};
function Ir(e3) {
  return new TypeError(`CountQueuingStrategy.prototype.${e3} can only be used on a CountQueuingStrategy`);
}
function $r(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_countQueuingStrategyHighWaterMark") && e3 instanceof CountQueuingStrategy);
}
function Mr(e3, t3, r3) {
  return F(e3, r3), (r4) => g(e3, t3, [r4]);
}
function Yr(e3, t3, r3) {
  return F(e3, r3), (r4) => S(e3, t3, [r4]);
}
function xr(e3, t3, r3) {
  return F(e3, r3), (r4, o2) => g(e3, t3, [r4, o2]);
}
function Qr(e3, t3, r3) {
  return F(e3, r3), (r4) => g(e3, t3, [r4]);
}
Object.defineProperties(CountQueuingStrategy.prototype, { highWaterMark: { enumerable: true }, size: { enumerable: true } }), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(CountQueuingStrategy.prototype, Symbol.toStringTag, { value: "CountQueuingStrategy", configurable: true });
var TransformStream = class {
  constructor(e3 = {}, t3 = {}, r3 = {}) {
    void 0 === e3 && (e3 = null);
    const o2 = dt(t3, "Second parameter"), n3 = dt(r3, "Third parameter"), a2 = function(e4, t4) {
      L(e4, t4);
      const r4 = null == e4 ? void 0 : e4.cancel, o3 = null == e4 ? void 0 : e4.flush, n4 = null == e4 ? void 0 : e4.readableType, a3 = null == e4 ? void 0 : e4.start, i3 = null == e4 ? void 0 : e4.transform, l3 = null == e4 ? void 0 : e4.writableType;
      return { cancel: void 0 === r4 ? void 0 : Qr(r4, e4, `${t4} has member 'cancel' that`), flush: void 0 === o3 ? void 0 : Mr(o3, e4, `${t4} has member 'flush' that`), readableType: n4, start: void 0 === a3 ? void 0 : Yr(a3, e4, `${t4} has member 'start' that`), transform: void 0 === i3 ? void 0 : xr(i3, e4, `${t4} has member 'transform' that`), writableType: l3 };
    }(e3, "First parameter");
    if (void 0 !== a2.readableType) throw new RangeError("Invalid readableType specified");
    if (void 0 !== a2.writableType) throw new RangeError("Invalid writableType specified");
    const i2 = ut(n3, 0), l2 = ct(n3), s2 = ut(o2, 1), f2 = ct(o2);
    let h2;
    !function(e4, t4, r4, o3, n4, a3) {
      function i3() {
        return t4;
      }
      function l3(t5) {
        return function(e5, t6) {
          const r5 = e5._transformStreamController;
          if (e5._backpressure) {
            return _(e5._backpressureChangePromise, () => {
              const o4 = e5._writable;
              if ("erroring" === o4._state) throw o4._storedError;
              return Zr(r5, t6);
            });
          }
          return Zr(r5, t6);
        }(e4, t5);
      }
      function s3(t5) {
        return function(e5, t6) {
          const r5 = e5._transformStreamController;
          if (void 0 !== r5._finishPromise) return r5._finishPromise;
          const o4 = e5._readable;
          r5._finishPromise = u((e6, t7) => {
            r5._finishPromise_resolve = e6, r5._finishPromise_reject = t7;
          });
          const n5 = r5._cancelAlgorithm(t6);
          return Jr(r5), b(n5, () => ("errored" === o4._state ? ro(r5, o4._storedError) : (br(o4._readableStreamController, t6), to(r5)), null), (e6) => (br(o4._readableStreamController, e6), ro(r5, e6), null)), r5._finishPromise;
        }(e4, t5);
      }
      function c2() {
        return function(e5) {
          const t5 = e5._transformStreamController;
          if (void 0 !== t5._finishPromise) return t5._finishPromise;
          const r5 = e5._readable;
          t5._finishPromise = u((e6, r6) => {
            t5._finishPromise_resolve = e6, t5._finishPromise_reject = r6;
          });
          const o4 = t5._flushAlgorithm();
          return Jr(t5), b(o4, () => ("errored" === r5._state ? ro(t5, r5._storedError) : (dr(r5._readableStreamController), to(t5)), null), (e6) => (br(r5._readableStreamController, e6), ro(t5, e6), null)), t5._finishPromise;
        }(e4);
      }
      function d2() {
        return function(e5) {
          return Gr(e5, false), e5._backpressureChangePromise;
        }(e4);
      }
      function f3(t5) {
        return function(e5, t6) {
          const r5 = e5._transformStreamController;
          if (void 0 !== r5._finishPromise) return r5._finishPromise;
          const o4 = e5._writable;
          r5._finishPromise = u((e6, t7) => {
            r5._finishPromise_resolve = e6, r5._finishPromise_reject = t7;
          });
          const n5 = r5._cancelAlgorithm(t6);
          return Jr(r5), b(n5, () => ("errored" === o4._state ? ro(r5, o4._storedError) : (Yt(o4._writableStreamController, t6), Ur(e5), to(r5)), null), (t7) => (Yt(o4._writableStreamController, t7), Ur(e5), ro(r5, t7), null)), r5._finishPromise;
        }(e4, t5);
      }
      e4._writable = function(e5, t5, r5, o4, n5 = 1, a4 = () => 1) {
        const i4 = Object.create(WritableStream.prototype);
        return St(i4), Ft(i4, Object.create(WritableStreamDefaultController.prototype), e5, t5, r5, o4, n5, a4), i4;
      }(i3, l3, c2, s3, r4, o3), e4._readable = Cr(i3, d2, f3, n4, a3), e4._backpressure = void 0, e4._backpressureChangePromise = void 0, e4._backpressureChangePromise_resolve = void 0, Gr(e4, true), e4._transformStreamController = void 0;
    }(this, u((e4) => {
      h2 = e4;
    }), s2, f2, i2, l2), function(e4, t4) {
      const r4 = Object.create(TransformStreamDefaultController.prototype);
      let o3, n4, a3;
      o3 = void 0 !== t4.transform ? (e5) => t4.transform(e5, r4) : (e5) => {
        try {
          return Kr(r4, e5), c(void 0);
        } catch (e6) {
          return d(e6);
        }
      };
      n4 = void 0 !== t4.flush ? () => t4.flush(r4) : () => c(void 0);
      a3 = void 0 !== t4.cancel ? (e5) => t4.cancel(e5) : () => c(void 0);
      !function(e5, t5, r5, o4, n5) {
        t5._controlledTransformStream = e5, e5._transformStreamController = t5, t5._transformAlgorithm = r5, t5._flushAlgorithm = o4, t5._cancelAlgorithm = n5, t5._finishPromise = void 0, t5._finishPromise_resolve = void 0, t5._finishPromise_reject = void 0;
      }(e4, r4, o3, n4, a3);
    }(this, a2), void 0 !== a2.start ? h2(a2.start(this._transformStreamController)) : h2(void 0);
  }
  get readable() {
    if (!Nr(this)) throw oo("readable");
    return this._readable;
  }
  get writable() {
    if (!Nr(this)) throw oo("writable");
    return this._writable;
  }
};
function Nr(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_transformStreamController") && e3 instanceof TransformStream);
}
function Hr(e3, t3) {
  br(e3._readable._readableStreamController, t3), Vr(e3, t3);
}
function Vr(e3, t3) {
  Jr(e3._transformStreamController), Yt(e3._writable._writableStreamController, t3), Ur(e3);
}
function Ur(e3) {
  e3._backpressure && Gr(e3, false);
}
function Gr(e3, t3) {
  void 0 !== e3._backpressureChangePromise && e3._backpressureChangePromise_resolve(), e3._backpressureChangePromise = u((t4) => {
    e3._backpressureChangePromise_resolve = t4;
  }), e3._backpressure = t3;
}
Object.defineProperties(TransformStream.prototype, { readable: { enumerable: true }, writable: { enumerable: true } }), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(TransformStream.prototype, Symbol.toStringTag, { value: "TransformStream", configurable: true });
var TransformStreamDefaultController = class {
  constructor() {
    throw new TypeError("Illegal constructor");
  }
  get desiredSize() {
    if (!Xr(this)) throw eo("desiredSize");
    return hr(this._controlledTransformStream._readable._readableStreamController);
  }
  enqueue(e3 = void 0) {
    if (!Xr(this)) throw eo("enqueue");
    Kr(this, e3);
  }
  error(e3 = void 0) {
    if (!Xr(this)) throw eo("error");
    var t3;
    t3 = e3, Hr(this._controlledTransformStream, t3);
  }
  terminate() {
    if (!Xr(this)) throw eo("terminate");
    !function(e3) {
      const t3 = e3._controlledTransformStream;
      dr(t3._readable._readableStreamController);
      const r3 = new TypeError("TransformStream terminated");
      Vr(t3, r3);
    }(this);
  }
};
function Xr(e3) {
  return !!t(e3) && (!!Object.prototype.hasOwnProperty.call(e3, "_controlledTransformStream") && e3 instanceof TransformStreamDefaultController);
}
function Jr(e3) {
  e3._transformAlgorithm = void 0, e3._flushAlgorithm = void 0, e3._cancelAlgorithm = void 0;
}
function Kr(e3, t3) {
  const r3 = e3._controlledTransformStream, o2 = r3._readable._readableStreamController;
  if (!mr(o2)) throw new TypeError("Readable side is not in a state that permits enqueue");
  try {
    fr(o2, t3);
  } catch (e4) {
    throw Vr(r3, e4), r3._readable._storedError;
  }
  const n3 = function(e4) {
    return !ur(e4);
  }(o2);
  n3 !== r3._backpressure && Gr(r3, true);
}
function Zr(e3, t3) {
  return _(e3._transformAlgorithm(t3), void 0, (t4) => {
    throw Hr(e3._controlledTransformStream, t4), t4;
  });
}
function eo(e3) {
  return new TypeError(`TransformStreamDefaultController.prototype.${e3} can only be used on a TransformStreamDefaultController`);
}
function to(e3) {
  void 0 !== e3._finishPromise_resolve && (e3._finishPromise_resolve(), e3._finishPromise_resolve = void 0, e3._finishPromise_reject = void 0);
}
function ro(e3, t3) {
  void 0 !== e3._finishPromise_reject && (p(e3._finishPromise), e3._finishPromise_reject(t3), e3._finishPromise_resolve = void 0, e3._finishPromise_reject = void 0);
}
function oo(e3) {
  return new TypeError(`TransformStream.prototype.${e3} can only be used on a TransformStream`);
}
Object.defineProperties(TransformStreamDefaultController.prototype, { enqueue: { enumerable: true }, error: { enumerable: true }, terminate: { enumerable: true }, desiredSize: { enumerable: true } }), o(TransformStreamDefaultController.prototype.enqueue, "enqueue"), o(TransformStreamDefaultController.prototype.error, "error"), o(TransformStreamDefaultController.prototype.terminate, "terminate"), "symbol" == typeof Symbol.toStringTag && Object.defineProperty(TransformStreamDefaultController.prototype, Symbol.toStringTag, { value: "TransformStreamDefaultController", configurable: true });

// node_modules/@cloudbase/adapter-wx_mp/dist/esm/index.js
var __extends4 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (b3.hasOwnProperty(p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var __assign3 = function() {
  __assign3 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign3.apply(this, arguments);
};
var __awaiter4 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator4 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (_2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var __rest2 = function(s2, e3) {
  var t3 = {};
  for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e3.indexOf(p2) < 0)
    t3[p2] = s2[p2];
  if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
      if (e3.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
        t3[p2[i2]] = s2[p2[i2]];
    }
  return t3;
};
function isMatch() {
  if (typeof wx === "undefined") {
    return false;
  }
  if (typeof Page === "undefined") {
    return false;
  }
  if (!wx.getSystemInfoSync) {
    return false;
  }
  if (!wx.getStorageSync) {
    return false;
  }
  if (!wx.setStorageSync) {
    return false;
  }
  if (!wx.connectSocket) {
    return false;
  }
  if (!wx.request) {
    return false;
  }
  try {
    if (!wx.getSystemInfoSync()) {
      return false;
    }
    if (wx.getSystemInfoSync().AppPlatform === "qq") {
      return false;
    }
  } catch (e3) {
    return false;
  }
  return true;
}
function isPlugin() {
  return typeof App === "undefined" && typeof getApp === "undefined" && !wx.onAppHide && !wx.offAppHide && !wx.onAppShow && !wx.offAppShow;
}
var TASK_ABORT_ERROR_MSG = "Error when aborting requestTask";
var WxRequest = function(_super) {
  __extends4(WxRequest2, _super);
  function WxRequest2(config) {
    if (config === void 0) {
      config = {};
    }
    var _this = _super.call(this) || this;
    var timeout = config.timeout, timeoutMsg = config.timeoutMsg, restrictedMethods = config.restrictedMethods;
    _this._timeout = timeout || 0;
    _this._timeoutMsg = timeoutMsg || "";
    _this._restrictedMethods = restrictedMethods || ["get", "post", "upload", "download"];
    return _this;
  }
  WxRequest2.prototype.post = function(options) {
    var self2 = this;
    return new Promise(function(resolve, reject) {
      var url2 = options.url, data2 = options.data, headers = options.headers;
      var task = wx.request({
        url: formatUrl("https:", url2),
        data: data2,
        timeout: self2._timeout,
        method: "POST",
        header: headers,
        success: function(res) {
          if (res.statusCode >= 200 && res.statusCode < 300) {
            resolve({
              statusCode: res.statusCode,
              status: res.statusCode,
              data: res.data
            });
          } else {
            reject(res);
          }
        },
        fail: function(err) {
          reject(err);
        },
        complete: function(err) {
          if (!err || !err.errMsg) {
            return;
          }
          if (!self2._timeout || self2._restrictedMethods.indexOf("post") === -1) {
            return;
          }
          var errMsg = err.errMsg;
          if (errMsg === "request:fail timeout") {
            console.warn(self2._timeoutMsg);
            try {
              task.abort();
            } catch (e3) {
            }
          }
        }
      });
    });
  };
  WxRequest2.prototype.get = function(options) {
    var self2 = this;
    return new Promise(function(resolve, reject) {
      var url2 = options.url, body = options.body, headers = options.headers;
      var finalUrl = formatUrl("https:", url2);
      var task = wx.request({
        url: finalUrl,
        data: body,
        timeout: self2._timeout,
        method: "GET",
        header: headers,
        success: function(res) {
          if (res.statusCode >= 200 && res.statusCode < 300) {
            resolve({
              statusCode: res.statusCode,
              status: res.statusCode,
              data: res.data
            });
          } else {
            reject(res);
          }
        },
        fail: function(err) {
          reject(err);
        },
        complete: function(err) {
          if (!err || !err.errMsg) {
            return;
          }
          if (!self2._timeout || self2._restrictedMethods.indexOf("get") === -1) {
            return;
          }
          var errMsg = err.errMsg;
          if (errMsg.includes("timeout")) {
            console.warn(self2._timeoutMsg);
            try {
              task.abort();
            } catch (e3) {
              console.warn(TASK_ABORT_ERROR_MSG, e3);
            }
          }
        }
      });
    });
  };
  WxRequest2.prototype.upload = function(options) {
    var _this = this;
    var self2 = this;
    return new Promise(function(resolve) {
      return __awaiter4(_this, void 0, void 0, function() {
        var url2, file, data2, headers, onUploadProgress, task;
        return __generator4(this, function(_a3) {
          url2 = options.url, file = options.file, data2 = options.data, headers = options.headers, onUploadProgress = options.onUploadProgress;
          task = wx.uploadFile({
            url: url2,
            filePath: file,
            name: "file",
            formData: __assign3({}, data2),
            header: headers,
            timeout: this._timeout,
            success: function(res) {
              var result = {
                statusCode: res.statusCode,
                data: res.data || {}
              };
              if (res.statusCode === 200 && data2.success_action_status) {
                result.statusCode = parseInt(data2.success_action_status, 10);
              }
              resolve(result);
            },
            fail: function(err) {
              resolve(err);
            },
            complete: function(err) {
              if (!err || !err.errMsg) {
                return;
              }
              if (!self2._timeout || self2._restrictedMethods.indexOf("upload") === -1) {
                return;
              }
              var errMsg = err.errMsg;
              if (errMsg === "request:fail timeout") {
                console.warn(self2._timeoutMsg);
                try {
                  task.abort();
                } catch (e3) {
                }
              }
            }
          });
          if (onUploadProgress) {
            task.onProgressUpdate(function(res) {
              onUploadProgress(res);
            });
          }
          return [2];
        });
      });
    });
  };
  WxRequest2.prototype.download = function(options) {
    var _this = this;
    var self2 = this;
    return new Promise(function(resolve, reject) {
      var url2 = options.url, headers = options.headers;
      var task = wx.downloadFile({
        url: formatUrl("https:", url2),
        header: headers,
        timeout: _this._timeout,
        success: function(res) {
          if (res.statusCode === 200 && res.tempFilePath) {
            resolve({
              statusCode: 200,
              tempFilePath: res.tempFilePath
            });
          } else {
            resolve(res);
          }
        },
        fail: function(err) {
          reject(err);
        },
        complete: function(err) {
          if (!err || !err.errMsg) {
            return;
          }
          if (!self2._timeout || self2._restrictedMethods.indexOf("download") === -1) {
            return;
          }
          var errMsg = err.errMsg;
          if (errMsg === "request:fail timeout") {
            console.warn(self2._timeoutMsg);
            try {
              task.abort();
            } catch (e3) {
            }
          }
        }
      });
    });
  };
  WxRequest2.prototype.fetch = function(options) {
    var url2 = options.url, body = options.body, enableAbort = options.enableAbort, headers = options.headers, method = options.method, _a3 = options.stream, shouldStream = _a3 === void 0 ? false : _a3, signal = options.signal, _timeout = options.timeout;
    var self2 = this;
    var timeout = _timeout !== null && _timeout !== void 0 ? _timeout : this._timeout;
    var controller = null;
    var stream = new ReadableStream({
      start: function(c2) {
        controller = c2;
      },
      cancel: function() {
        controller = null;
      }
    });
    return new Promise(function(resolve, reject) {
      shouldStream && resolve({ data: stream });
      var task = wx.request({
        url: formatUrl("https:", url2),
        data: body,
        timeout,
        method: method.toUpperCase(),
        header: headers,
        success: function(res) {
          var _a4;
          (_a4 = controller) === null || _a4 === void 0 ? void 0 : _a4.close();
          !shouldStream && resolve(res);
        },
        fail: function(err) {
          var _a4;
          (_a4 = controller) === null || _a4 === void 0 ? void 0 : _a4.close();
          reject(err);
          if (shouldStream) {
            throw err;
          }
        },
        complete: function(err) {
          if (!err || !err.errMsg) {
            return;
          }
          if (!timeout || self2._restrictedMethods.indexOf("post") === -1 || !enableAbort) {
            return;
          }
          var errMsg = err.errMsg;
          if (errMsg === "request:fail timeout") {
            console.warn(self2._timeoutMsg);
            try {
              task.abort();
            } catch (e3) {
              console.warn(TASK_ABORT_ERROR_MSG, e3);
            }
          }
        },
        enableChunked: shouldStream
      });
      task.onChunkReceived(function(buffer2) {
        var _a4;
        (_a4 = controller) === null || _a4 === void 0 ? void 0 : _a4.enqueue(new Uint8Array(buffer2.data));
      });
      if (signal) {
        var abort_1 = function() {
          try {
            task.abort();
          } catch (e3) {
            console.warn(TASK_ABORT_ERROR_MSG, e3);
          }
        };
        if (signal.aborted) {
          abort_1();
        } else {
          signal.addEventListener("abort", function() {
            return abort_1();
          });
        }
      }
    });
  };
  return WxRequest2;
}(AbstractSDKRequest);
var wxMpStorage = {
  setItem: function(key, value) {
    wx.setStorageSync(key, value);
  },
  getItem: function(key) {
    return wx.getStorageSync(key);
  },
  removeItem: function(key) {
    wx.removeStorageSync(key);
  },
  clear: function() {
    wx.clearStorageSync();
  }
};
var WxMpWebSocket = /* @__PURE__ */ function() {
  function WxMpWebSocket2(url2, options) {
    if (options === void 0) {
      options = {};
    }
    var ws = wx.connectSocket(__assign3({ url: url2 }, options));
    var socketTask = {
      set onopen(cb) {
        ws.onOpen(cb);
      },
      set onmessage(cb) {
        ws.onMessage(cb);
      },
      set onclose(cb) {
        ws.onClose(cb);
      },
      set onerror(cb) {
        ws.onError(cb);
      },
      send: function(data2) {
        return ws.send({ data: data2 });
      },
      close: function(code2, reason) {
        return ws.close({
          code: code2,
          reason
        });
      },
      get readyState() {
        return ws.readyState;
      },
      CONNECTING: 0,
      OPEN: 1,
      CLOSING: 2,
      CLOSED: 3
    };
    return socketTask;
  }
  return WxMpWebSocket2;
}();
function parseQueryString2(search) {
  var params = {};
  var cleanSearch = search.replace(/^[?#]/, "");
  if (!cleanSearch) {
    return params;
  }
  var pairs = cleanSearch.split("&");
  pairs.forEach(function(item) {
    var _a3 = item.split("="), key = _a3[0], value = _a3[1];
    key = decodeURIComponent(key);
    value = decodeURIComponent(value);
    if (key) {
      if (params[key]) {
        if (Array.isArray(params[key])) {
          params[key].push(value);
        } else {
          params[key] = [params[key], value];
        }
      } else {
        params[key] = value;
      }
    }
  });
  return params;
}
function genAdapter2(options) {
  var adapter2 = {
    root: { globalThis: {} },
    reqClass: WxRequest,
    wsClass: WxMpWebSocket,
    captchaOptions: {
      openURIWithCallback: function(_url) {
        var EventBus = options.EventBus;
        var queryObj = {};
        var url2 = _url;
        console.log("openURIWithCallback", _url);
        var matched = _url.match(/^(data:.*?)(\?[^#\s]*)?$/);
        if (matched) {
          url2 = matched[1];
          console.log("openURIWithCallback url", url2);
          var search = matched[2];
          if (search) {
            queryObj = parseQueryString2(search);
          }
        }
        console.log("openURIWithCallback queryObj", queryObj);
        var token = queryObj.token, restQueryObj = __rest2(queryObj, ["token"]);
        if (/^data:/.test(url2) && !token) {
          return Promise.reject({
            error: "invalid_argument",
            error_description: "invalie captcha data: " + _url
          });
        }
        if (!token) {
          return Promise.reject({
            error: "unimplemented",
            error_description: "need to impl captcha data"
          });
        }
        return new Promise(function(resolve) {
          console.log("wait for captcha...");
          EventBus.$emit("CAPTCHA_DATA_CHANGE", __assign3(__assign3({}, restQueryObj), { token, url: url2 }));
          EventBus.$once("RESOLVE_CAPTCHA_DATA", function(res) {
            resolve(res);
          });
        });
      }
    },
    localStorage: wxMpStorage,
    primaryStorage: StorageType.local,
    getAppSign: function() {
      var info = wx.getAccountInfoSync();
      if (isPlugin()) {
        return info && info.plugin ? info.plugin.appId : "";
      } else {
        return info && info.miniProgram ? info.miniProgram.appId : "";
      }
    }
  };
  return adapter2;
}
var adapter = {
  genAdapter: genAdapter2,
  isMatch,
  runtime: "wx_mp"
};
var esm_default = adapter;

// node_modules/@cloudbase/app/dist/esm/libs/adapter.js
init_esm();
var __assign4 = function() {
  __assign4 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign4.apply(this, arguments);
};
var __rest3 = function(s2, e3) {
  var t3 = {};
  for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e3.indexOf(p2) < 0)
    t3[p2] = s2[p2];
  if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
      if (e3.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
        t3[p2[i2]] = s2[p2[i2]];
    }
  return t3;
};
var Platform = {};
var getWxDefaultAdapter = function() {
  WxRequest.prototype.upload = function(options) {
    var _this = this;
    var self2 = this;
    return new Promise(function(resolve) {
      var url2 = options.url, file = options.file, data2 = options.data, headers = options.headers;
      var fs = wx.getFileSystemManager();
      var task = wx.request({
        url: url2,
        method: options.method,
        header: __assign4({ "content-type": " " }, headers),
        data: fs.readFileSync(file),
        timeout: _this._timeout,
        success: function(res) {
          var result = {
            statusCode: res.statusCode,
            data: res.data || {}
          };
          if (res.statusCode === 200 && (data2 === null || data2 === void 0 ? void 0 : data2.success_action_status)) {
            result.statusCode = parseInt(data2.success_action_status, 10);
          }
          resolve(result);
        },
        fail: function(err) {
          resolve(err);
        },
        complete: function(err) {
          if (!(err === null || err === void 0 ? void 0 : err.errMsg)) {
            return;
          }
          if (!self2._timeout || self2._restrictedMethods.indexOf("upload") === -1) {
            return;
          }
          var errMsg = err.errMsg;
          if (errMsg === "request:fail timeout") {
            console.warn(self2._timeoutMsg);
            try {
              task.abort();
            } catch (e3) {
            }
          }
        }
      });
    });
  };
  function isPlugin2() {
    return typeof App === "undefined" && typeof getApp === "undefined" && !wx.onAppHide && !wx.offAppHide && !wx.onAppShow && !wx.offAppShow;
  }
  esm_default.genAdapter = function genAdapter3(options) {
    var adapter2 = {
      root: { globalThis: {} },
      reqClass: WxRequest,
      wsClass: WxMpWebSocket,
      captchaOptions: {
        openURIWithCallback: function(_url) {
          var EventBus = options.EventBus;
          var queryObj = {};
          var url2 = _url;
          console.log("openURIWithCallback", _url);
          var matched = _url.match(/^(data:.*?)(\?[^#\s]*)?$/);
          if (matched) {
            url2 = matched[1];
            console.log("openURIWithCallback url", url2);
            var search = matched[2];
            if (search) {
              queryObj = parseQueryString2(search);
            }
          }
          console.log("openURIWithCallback queryObj", queryObj);
          var token = queryObj.token, restQueryObj = __rest3(queryObj, ["token"]);
          if (/^data:/.test(url2) && !token) {
            return Promise.reject({
              error: "invalid_argument",
              error_description: "invalie captcha data: ".concat(_url)
            });
          }
          if (!token) {
            return Promise.reject({
              error: "unimplemented",
              error_description: "need to impl captcha data"
            });
          }
          return new Promise(function(resolve) {
            console.log("wait for captcha...");
            EventBus.$emit("CAPTCHA_DATA_CHANGE", __assign4(__assign4({}, restQueryObj), { token, url: url2 }));
            EventBus.$once("RESOLVE_CAPTCHA_DATA", function(res) {
              resolve(res);
            });
          });
        }
      },
      localStorage: wxMpStorage,
      primaryStorage: StorageType.local,
      getAppSign: function() {
        var info = wx.getAccountInfoSync();
        if (isPlugin2()) {
          return info && info.plugin ? info.plugin.appId : "";
        }
        return info && info.miniProgram ? info.miniProgram.appId : "";
      }
    };
    return adapter2;
  };
  return esm_default;
};

// node_modules/@cloudbase/app/dist/esm/libs/cache.js
var __assign5 = function() {
  __assign5 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign5.apply(this, arguments);
};
var USER_INFO_KEY = "user_info";
var CloudbaseCache2 = cache_exports.CloudbaseCache;
var cacheMap = {};
var localCacheMap = {};
function initCache(config) {
  var env = config.env, platformInfo = config.platformInfo;
  var userInfoKey = "".concat(USER_INFO_KEY, "_").concat(env);
  var keys4 = {
    userInfoKey
  };
  cacheMap[env] = cacheMap[env] || new CloudbaseCache2(__assign5(__assign5({}, config), { keys: keys4, platformInfo }));
  localCacheMap[env] = localCacheMap[env] || new CloudbaseCache2(__assign5(__assign5({}, config), { keys: keys4, platformInfo, persistence: "local" }));
}
function getCacheByEnvId(env) {
  return cacheMap[env];
}
function getLocalCache(env) {
  return localCacheMap[env];
}

// node_modules/@cloudbase/app/dist/esm/constants/common.js
var __assign6 = function() {
  __assign6 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign6.apply(this, arguments);
};
var ZONE_CHINA = ["ap-shanghai", "ap-guangzhou", "ap-shenzhen-fsi", "ap-shanghai-fsi", "ap-nanjing", "ap-beijing", "ap-chengdu", "ap-chongqing", "ap-hongkong"];
var setUtilitiesSdkName = constants_exports.setSdkName;
var setUtilitiesProtocol = constants_exports.setProtocol;
var sdkVersion = "";
var sdkName2 = "@cloudbase/js-sdk";
function setSdkVersion(version3) {
  sdkVersion = version3;
}
function getSdkVersion() {
  return sdkVersion;
}
function setSdkName2(name) {
  sdkName2 = name;
  setUtilitiesSdkName(name);
}
function getSdkName2() {
  return sdkName2;
}
var DATA_VERSION = "2020-01-10";
var END_POINT_INFO_ARR = [];
var END_POINT_INFO_SEARCH_KEYS = ["env", "endPointKey", "region"];
var DEFAULT_PROTOCOL = "https:";
function findMatchedInfo(info) {
  return END_POINT_INFO_ARR.find(function(targetInfo) {
    return END_POINT_INFO_SEARCH_KEYS.filter(function(searchKey) {
      return info[searchKey] != null;
    }).every(function(searchKey) {
      return targetInfo[searchKey] === info[searchKey];
    });
  });
}
function setEndPointInfo(newInfo) {
  var _a3, _b;
  if (newInfo.protocol && !/:$/.test(newInfo.protocol)) {
    newInfo.protocol = "".concat(newInfo.protocol, ":");
  }
  var endPointInfo = findMatchedInfo(newInfo);
  if (endPointInfo) {
    if (newInfo.baseUrl != null) {
      endPointInfo.baseUrl = newInfo.baseUrl;
    }
    if (newInfo.protocol != null) {
      endPointInfo.protocol = newInfo.protocol;
    }
  } else {
    END_POINT_INFO_ARR.push(__assign6(__assign6({}, newInfo), { protocol: (_a3 = newInfo.protocol) !== null && _a3 !== void 0 ? _a3 : DEFAULT_PROTOCOL }));
  }
  if (newInfo.endPointKey === "CLOUD_API") {
    setUtilitiesProtocol((_b = newInfo.protocol) !== null && _b !== void 0 ? _b : DEFAULT_PROTOCOL);
  }
}
function getEndPointInfo(env, endPointKey, region) {
  return findMatchedInfo({ env, endPointKey, region });
}
function setGatewayEndPointWithEnv(env, protocol, region) {
  if (region === void 0) {
    region = "ap-shanghai";
  }
  region = region || "ap-shanghai";
  var baseUrl = "//".concat(env, ".api.tcloudbasegateway.com/v1");
  if (!ZONE_CHINA.includes(region)) {
    baseUrl = "//".concat(env, ".api.intl.tcloudbasegateway.com/v1");
  }
  setEndPointInfo({ endPointKey: "GATEWAY", env, baseUrl, protocol });
}
function setRegionLevelEndpoint(env, region, protocol) {
  var baseUrl = "//".concat(env, ".").concat(region || "ap-shanghai", ".tcb-api.tencentcloudapi.com/web");
  setEndPointInfo({ env, region, baseUrl, protocol, endPointKey: "CLOUD_API" });
}
function getBaseEndPoint(env, endPointKey) {
  if (endPointKey === void 0) {
    endPointKey = "CLOUD_API";
  }
  var info = getEndPointInfo(env, endPointKey || "CLOUD_API");
  var PROTOCOL2 = info.protocol, BASE_URL = info.baseUrl;
  var webEndpoint = "".concat(PROTOCOL2).concat(BASE_URL);
  return webEndpoint.match(/(http(s)?:)?\/\/([^/?#]*)/)[0];
}
var LOGINTYPE;
(function(LOGINTYPE2) {
  LOGINTYPE2["NULL"] = "NULL";
  LOGINTYPE2["ANONYMOUS"] = "ANONYMOUS";
  LOGINTYPE2["WECHAT"] = "WECHAT";
  LOGINTYPE2["WECHAT_PUBLIC"] = "WECHAT-PUBLIC";
  LOGINTYPE2["WECHAT_OPEN"] = "WECHAT-OPEN";
  LOGINTYPE2["CUSTOM"] = "CUSTOM";
  LOGINTYPE2["EMAIL"] = "EMAIL";
  LOGINTYPE2["USERNAME"] = "USERNAME";
  LOGINTYPE2["PHONE"] = "PHONE";
})(LOGINTYPE || (LOGINTYPE = {}));

// node_modules/@cloudbase/app/dist/esm/libs/request.js
var __assign7 = function() {
  __assign7 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign7.apply(this, arguments);
};
var __awaiter5 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator5 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var __rest4 = function(s2, e3) {
  var t3 = {};
  for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e3.indexOf(p2) < 0)
    t3[p2] = s2[p2];
  if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
      if (e3.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
        t3[p2[i2]] = s2[p2[i2]];
    }
  return t3;
};
var ERRORS3 = constants_exports.ERRORS;
var genSeqId2 = util_exports.genSeqId;
var isFormData2 = util_exports.isFormData;
var formatUrl3 = util_exports.formatUrl;
var ACTIONS_WITHOUT_ACCESSTOKEN = [
  "auth.getJwt",
  "auth.logout",
  "auth.signInWithTicket",
  "auth.signInAnonymously",
  "auth.signIn",
  "auth.fetchAccessTokenWithRefreshToken",
  "auth.signUpWithEmailAndPassword",
  "auth.activateEndUserMail",
  "auth.sendPasswordResetEmail",
  "auth.resetPasswordWithToken",
  "auth.isUsernameRegistered"
];
function bindHooks(instance, name, hooks) {
  var originMethod = instance[name];
  instance[name] = function(options) {
    var data2 = {};
    var headers = {};
    hooks.forEach(function(hook2) {
      var _a3 = hook2.call(instance, options), appendedData = _a3.data, appendedHeaders = _a3.headers;
      Object.assign(data2, appendedData);
      Object.assign(headers, appendedHeaders);
    });
    var originData = options.data;
    originData && function() {
      if (isFormData2(originData)) {
        Object.keys(data2).forEach(function(key) {
          originData.append(key, data2[key]);
        });
        return;
      }
      options.data = __assign7(__assign7({}, originData), data2);
    }();
    options.headers = __assign7(__assign7({}, options.headers || {}), headers);
    return originMethod.call(instance, options);
  };
}
function beforeEach() {
  var seqId = genSeqId2();
  return {
    data: {
      seqId
    },
    headers: {
      "X-SDK-Version": "@cloudbase/js-sdk/".concat(getSdkVersion()),
      "x-seqid": seqId
    }
  };
}
var CloudbaseRequest = function() {
  function CloudbaseRequest2(config) {
    var _this = this;
    this.throwWhenRequestFail = false;
    this.config = config;
    var reqConfig = {
      timeout: this.config.timeout,
      timeoutMsg: "[@cloudbase/js-sdk] ".concat(this.config.timeout / 1e3, "s"),
      restrictedMethods: ["post", "put"]
    };
    this.reqClass = new Platform.adapter.reqClass(reqConfig);
    this.throwWhenRequestFail = config.throw || false;
    this.localCache = getLocalCache(this.config.env);
    if (this.config.endPointMode !== "GATEWAY") {
      bindHooks(this.reqClass, "post", [beforeEach]);
      bindHooks(this.reqClass, "upload", [beforeEach]);
      bindHooks(this.reqClass, "download", [beforeEach]);
    }
    langEvent_exports.bus.on(langEvent_exports.LANG_CHANGE_EVENT, function(params) {
      var _a3;
      _this.config.i18n = ((_a3 = params.data) === null || _a3 === void 0 ? void 0 : _a3.i18n) || _this.config.i18n;
    });
  }
  CloudbaseRequest2.prototype.getAccessToken = function(token) {
    if (token === void 0) {
      token = null;
    }
    return __awaiter5(this, void 0, void 0, function() {
      var app, oauthInstance, oauthClient;
      return __generator5(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            if (token != null) {
              return [2, token];
            }
            app = this.config._fromApp;
            if (!app.oauthInstance) {
              throw new Error("you can't request without auth");
            }
            oauthInstance = app.oauthInstance;
            oauthClient = oauthInstance.oauth2client;
            return [4, this.getOauthAccessTokenV2(oauthClient)];
          case 1:
            return [2, _a3.sent().accessToken];
        }
      });
    });
  };
  CloudbaseRequest2.prototype.getDefaultHeaders = function() {
    var _a3;
    var _b, _c;
    return _a3 = {}, _a3[(_b = this.config.i18n) === null || _b === void 0 ? void 0 : _b.LANG_HEADER_KEY] = (_c = this.config.i18n) === null || _c === void 0 ? void 0 : _c.lang, _a3["X-SDK-Version"] = "@cloudbase/js-sdk/".concat(getSdkVersion()), _a3;
  };
  CloudbaseRequest2.prototype.post = function(options, customReqOpts) {
    return __awaiter5(this, void 0, void 0, function() {
      var res;
      return __generator5(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.reqClass.post(__assign7(__assign7({}, options), { headers: __assign7(__assign7({}, options.headers), this.getDefaultHeaders()), customReqOpts }))];
          case 1:
            res = _a3.sent();
            return [2, res];
        }
      });
    });
  };
  CloudbaseRequest2.prototype.upload = function(options) {
    return __awaiter5(this, void 0, void 0, function() {
      var res;
      return __generator5(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.reqClass.upload(__assign7(__assign7({}, options), { headers: __assign7(__assign7({}, options.headers), this.getDefaultHeaders()) }))];
          case 1:
            res = _a3.sent();
            return [2, res];
        }
      });
    });
  };
  CloudbaseRequest2.prototype.download = function(options) {
    return __awaiter5(this, void 0, void 0, function() {
      var res;
      return __generator5(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.reqClass.download(__assign7(__assign7({}, options), { headers: __assign7(__assign7({}, options.headers), this.getDefaultHeaders()) }))];
          case 1:
            res = _a3.sent();
            return [2, res];
        }
      });
    });
  };
  CloudbaseRequest2.prototype.getBaseEndPoint = function(endPointKey) {
    if (endPointKey === void 0) {
      endPointKey = "CLOUD_API";
    }
    return getBaseEndPoint(this.config.env, endPointKey);
  };
  CloudbaseRequest2.prototype.getOauthAccessTokenV2 = function(oauthClient) {
    return __awaiter5(this, void 0, void 0, function() {
      var validAccessToken, credentials;
      return __generator5(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, oauthClient.getAccessToken()];
          case 1:
            validAccessToken = _a3.sent();
            return [4, oauthClient.getCredentials()];
          case 2:
            credentials = _a3.sent();
            return [2, {
              accessToken: validAccessToken,
              accessTokenExpire: new Date(credentials.expires_at).getTime()
            }];
        }
      });
    });
  };
  CloudbaseRequest2.prototype.request = function(action, params, options, customReqOpts) {
    var _a3, _b;
    return __awaiter5(this, void 0, void 0, function() {
      var tcbTraceKey, contentType, tmpObj, app, oauthInstance, oauthClient, _c, payload, opts, traceHeader, parse2, inQuery, search, formatQuery, endPointMode, url2, BASE_URL, PROTOCOL2, newUrl, res, resTraceHeader;
      return __generator5(this, function(_d) {
        switch (_d.label) {
          case 0:
            tcbTraceKey = "x-tcb-trace_".concat(this.config.env);
            contentType = "application/x-www-form-urlencoded";
            tmpObj = __assign7({ action, dataVersion: DATA_VERSION, env: this.config.env }, params);
            if (!(ACTIONS_WITHOUT_ACCESSTOKEN.indexOf(action) === -1)) return [3, 2];
            app = this.config._fromApp;
            if (!app.oauthInstance) {
              throw new Error("you can't request without auth");
            }
            oauthInstance = app.oauthInstance;
            oauthClient = oauthInstance.oauth2client;
            _c = tmpObj;
            return [4, this.getOauthAccessTokenV2(oauthClient)];
          case 1:
            _c.access_token = _d.sent().accessToken;
            _d.label = 2;
          case 2:
            if (action === "storage.uploadFile") {
              payload = new FormData();
              Object.keys(payload).forEach(function(key) {
                if (Object.prototype.hasOwnProperty.call(payload, key) && payload[key] !== void 0) {
                  payload.append(key, tmpObj[key]);
                }
              });
              contentType = "multipart/form-data";
            } else {
              contentType = "application/json;charset=UTF-8";
              payload = {};
              Object.keys(tmpObj).forEach(function(key) {
                if (tmpObj[key] !== void 0) {
                  payload[key] = tmpObj[key];
                }
              });
            }
            opts = {
              headers: __assign7(__assign7({ "content-type": contentType }, this.getDefaultHeaders()), options === null || options === void 0 ? void 0 : options.headers)
            };
            if (options === null || options === void 0 ? void 0 : options.onUploadProgress) {
              opts.onUploadProgress = options.onUploadProgress;
            }
            if (this.config.region) {
              opts.headers["X-TCB-Region"] = this.config.region;
            }
            traceHeader = this.localCache.getStore(tcbTraceKey);
            if (traceHeader) {
              opts.headers["X-TCB-Trace"] = traceHeader;
            }
            parse2 = (options === null || options === void 0 ? void 0 : options.parse) !== void 0 ? options.parse : params.parse;
            inQuery = (options === null || options === void 0 ? void 0 : options.inQuery) !== void 0 ? options.inQuery : params.inQuery;
            search = (options === null || options === void 0 ? void 0 : options.search) !== void 0 ? options.search : params.search;
            formatQuery = __assign7(__assign7({}, (options === null || options === void 0 ? void 0 : options.defaultQuery) || {}), { env: this.config.env });
            parse2 && (formatQuery.parse = true);
            inQuery && (formatQuery = __assign7(__assign7({}, inQuery), formatQuery));
            endPointMode = this.config.endPointMode || "CLOUD_API";
            url2 = getEndPointInfo(this.config.env, endPointMode);
            BASE_URL = url2.baseUrl;
            PROTOCOL2 = url2.protocol;
            if (endPointMode === "GATEWAY") {
              if (action === "functions.invokeFunction" || /^(storage|database)\./.test(action)) {
                BASE_URL = "".concat(BASE_URL.match(/\/\/([^/?#]*)/)[0], "/web");
              }
            }
            if (options.pathname) {
              newUrl = formatUrl3(PROTOCOL2, "".concat((_a3 = getBaseEndPoint(this.config.env, endPointMode)) === null || _a3 === void 0 ? void 0 : _a3.replace(/^https?:/, ""), "/").concat(options.pathname), formatQuery);
            } else {
              newUrl = formatUrl3(PROTOCOL2, BASE_URL, formatQuery);
            }
            if (search) {
              newUrl += search;
            }
            return [4, this.post(__assign7({ url: newUrl, data: payload }, opts), customReqOpts)];
          case 3:
            res = _d.sent();
            resTraceHeader = (_b = res.header) === null || _b === void 0 ? void 0 : _b["x-tcb-trace"];
            if (resTraceHeader) {
              this.localCache.setStore(tcbTraceKey, resTraceHeader);
            }
            if (Number(res.status) !== 200 && Number(res.statusCode) !== 200 || !res.data) {
              throw new Error("network request error");
            }
            return [2, res];
        }
      });
    });
  };
  CloudbaseRequest2.prototype.fetch = function(options) {
    var _a3, _b, _c, _d, _e2, _f, _g, _h;
    return __awaiter5(this, void 0, void 0, function() {
      var token, _j, headers, restOptions, doFetch, result, err_1;
      var _this = this;
      return __generator5(this, function(_k) {
        switch (_k.label) {
          case 0:
            token = options.token, _j = options.headers, headers = _j === void 0 ? {} : _j, restOptions = __rest4(options, ["token", "headers"]);
            doFetch = function() {
              return __awaiter5(_this, void 0, void 0, function() {
                var _a4, _b2, _c2;
                var _d2, _e3;
                return __generator5(this, function(_f2) {
                  switch (_f2.label) {
                    case 0:
                      _b2 = (_a4 = this.reqClass).fetch;
                      _d2 = {};
                      _e3 = { "X-SDK-Version": "@cloudbase/js-sdk/".concat(getSdkVersion()) };
                      _c2 = "Bearer ".concat;
                      return [4, this.getAccessToken(token)];
                    case 1:
                      return [2, _b2.apply(_a4, [__assign7.apply(void 0, [(_d2.headers = __assign7.apply(void 0, [__assign7.apply(void 0, [(_e3.Authorization = _c2.apply("Bearer ", [_f2.sent()]), _e3), this.getDefaultHeaders()]), headers]), _d2), restOptions])])];
                  }
                });
              });
            };
            _k.label = 1;
          case 1:
            _k.trys.push([1, 3, , 6]);
            return [4, doFetch()];
          case 2:
            result = _k.sent();
            return [2, result];
          case 3:
            err_1 = _k.sent();
            if (!((err_1 === null || err_1 === void 0 ? void 0 : err_1.code) === "ACCESS_TOKEN_EXPIRED")) return [3, 5];
            if (typeof ((_d = (_c = (_b = (_a3 = this.config) === null || _a3 === void 0 ? void 0 : _a3._fromApp) === null || _b === void 0 ? void 0 : _b.oauthInstance) === null || _c === void 0 ? void 0 : _c.authApi) === null || _d === void 0 ? void 0 : _d.refreshTokenForce) !== "function") {
              throw err_1;
            }
            return [4, (_h = (_g = (_f = (_e2 = this.config) === null || _e2 === void 0 ? void 0 : _e2._fromApp) === null || _f === void 0 ? void 0 : _f.oauthInstance) === null || _g === void 0 ? void 0 : _g.authApi) === null || _h === void 0 ? void 0 : _h.refreshTokenForce()];
          case 4:
            _k.sent();
            return [2, doFetch()];
          case 5:
            throw err_1;
          case 6:
            return [2];
        }
      });
    });
  };
  CloudbaseRequest2.prototype.send = function(action, data2, options, customReqOpts) {
    if (data2 === void 0) {
      data2 = {};
    }
    if (options === void 0) {
      options = {};
    }
    return __awaiter5(this, void 0, void 0, function() {
      var response;
      return __generator5(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.request(action, data2, __assign7(__assign7({}, options), { onUploadProgress: data2.onUploadProgress }), customReqOpts)];
          case 1:
            response = _a3.sent();
            if (response.data.code && this.throwWhenRequestFail) {
              throw new Error(JSON.stringify({
                code: ERRORS3.OPERATION_FAIL,
                msg: "[".concat(response.data.code, "] ").concat(response.data.message)
              }));
            }
            return [2, response.data];
        }
      });
    });
  };
  CloudbaseRequest2.prototype.gateWay = function(options, customReqOpts) {
    return __awaiter5(this, void 0, void 0, function() {
      var name, data2, _a3, path2, method, _b, header, jsonData, requestId, _c, baseUrl, protocol, endpoint, response, _d;
      var _e2;
      return __generator5(this, function(_f) {
        switch (_f.label) {
          case 0:
            name = options.name, data2 = options.data, _a3 = options.path, path2 = _a3 === void 0 ? "" : _a3, method = options.method, _b = options.header, header = _b === void 0 ? {} : _b;
            if (!name || !path2) {
              throw new Error(JSON.stringify({
                code: ERRORS3.INVALID_PARAMS,
                msg: "[gateWay] invalid function name or path"
              }));
            }
            try {
              jsonData = data2 ? JSON.stringify(data2) : "";
            } catch (e3) {
              throw new Error(JSON.stringify({
                code: ERRORS3.INVALID_PARAMS,
                msg: "[gateWay] invalid data"
              }));
            }
            requestId = util_exports.generateRequestId();
            _c = getEndPointInfo(this.config.env, "GATEWAY"), baseUrl = _c.baseUrl, protocol = _c.protocol;
            endpoint = "".concat(protocol).concat(baseUrl, "/").concat(path2, "/").concat(name);
            return [4, this.fetch({
              method: method || "POST",
              headers: __assign7({ "Content-Type": "application/json; charset=utf-8", "X-Request-Id": requestId }, header),
              body: jsonData,
              url: endpoint,
              customReqOpts
            })];
          case 1:
            response = _f.sent();
            _d = [__assign7({ requestId }, response)];
            _e2 = {};
            return [4, response.data];
          case 2:
            return [2, __assign7.apply(void 0, _d.concat([(_e2.data = _f.sent(), _e2)]))];
        }
      });
    });
  };
  return CloudbaseRequest2;
}();
var requestMap = {};
function initRequest(config) {
  requestMap[config.env] = new CloudbaseRequest(__assign7(__assign7({}, config), { throw: true }));
}
function getRequestByEnvId(env) {
  return requestMap[env];
}

// node_modules/@cloudbase/app/dist/esm/libs/lang.js
var _a;
var LANGS;
(function(LANGS2) {
  LANGS2["ZH"] = "zh-CN";
  LANGS2["EN"] = "en-US";
})(LANGS || (LANGS = {}));
var LANG_HEADER_KEY = "Accept-Language";
var langMap = (_a = {}, _a[LANGS.EN] = {
  " AI+ ": "Please check the calling method or visit the AI+ homepage to view the documentation",
  "AI+ ": "AI+ request error, error code",
  : "error message",
  : "not implemented",
  " wasm ": "wasm loading is not supported in mini programs",
  " js ": "dynamic js loading is not supported in mini programs",
  : "request timeout",
  " privatelink sdk ": "missing privatelink sdk address"
}, _a);
var t2 = function(text, lang) {
  var _a3;
  return ((_a3 = langMap[lang]) === null || _a3 === void 0 ? void 0 : _a3[text]) || text;
};
var getLangCacheKey = function(config) {
  return "lang_".concat(config.clientId || config.env);
};
var i18nProxy = function(platform, config) {
  var _a3, _b;
  var cacheKey = getLangCacheKey(config);
  var localStorage2 = (platform.adapter || {}).localStorage;
  var lang = config.lang || ((_a3 = localStorage2 === null || localStorage2 === void 0 ? void 0 : localStorage2.getItem) === null || _a3 === void 0 ? void 0 : _a3.call(localStorage2, cacheKey)) || LANGS.ZH;
  (_b = localStorage2 === null || localStorage2 === void 0 ? void 0 : localStorage2.setItem) === null || _b === void 0 ? void 0 : _b.call(localStorage2, cacheKey, lang);
  return new Proxy({
    t: function(text) {
      return t2(text, lang);
    },
    LANG_HEADER_KEY,
    lang
  }, {
    get: function(target, prop) {
      var _a4;
      if (prop === "lang") {
        return ((_a4 = localStorage2 === null || localStorage2 === void 0 ? void 0 : localStorage2.getItem) === null || _a4 === void 0 ? void 0 : _a4.call(localStorage2, cacheKey)) || target[prop];
      }
      return target[prop];
    },
    set: function(target, prop, newValue) {
      var _a4;
      if (prop === "lang" && newValue !== target[prop]) {
        target[prop] = newValue;
        target.t = function(text) {
          return t2(text, newValue);
        };
        (_a4 = localStorage2 === null || localStorage2 === void 0 ? void 0 : localStorage2.setItem) === null || _a4 === void 0 ? void 0 : _a4.call(localStorage2, cacheKey, newValue);
        langEvent_exports.bus.fire(langEvent_exports.LANG_CHANGE_EVENT, { i18n: target });
      }
      target[prop] = newValue;
      return true;
    }
  });
};

// node_modules/@cloudbase/app/dist/esm/index.js
var __assign8 = function() {
  __assign8 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign8.apply(this, arguments);
};
var __decorate = function(decorators, target, key, desc) {
  var c2 = arguments.length, r3 = c2 < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d2;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r3 = Reflect.decorate(decorators, target, key, desc);
  else for (var i2 = decorators.length - 1; i2 >= 0; i2--) if (d2 = decorators[i2]) r3 = (c2 < 3 ? d2(r3) : c2 > 3 ? d2(target, key, r3) : d2(target, key)) || r3;
  return c2 > 3 && r3 && Object.defineProperty(target, key, r3), r3;
};
var __metadata = function(k2, v2) {
  if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k2, v2);
};
var __awaiter6 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator6 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var useAdapters2 = adapters_exports.useAdapters;
var useDefaultAdapter2 = adapters_exports.useDefaultAdapter;
var ERRORS4 = constants_exports.ERRORS;
var COMMUNITY_SITE_URL2 = constants_exports.COMMUNITY_SITE_URL;
var printWarn2 = util_exports.printWarn;
var catchErrorsDecorator2 = helpers_exports.catchErrorsDecorator;
var DEFAULT_INIT_CONFIG = {
  timeout: 15e3,
  persistence: "local"
};
var MAX_TIMEOUT = 1e3 * 60 * 10;
var MIN_TIMEOUT = 100;
var extensionMap = {};
var Cloudbase = function() {
  function Cloudbase2(config) {
    this.cloudbaseConfig = config ? config : this.cloudbaseConfig;
    this.authInstance = null;
    this.oauthInstance = null;
    this.version = getSdkVersion();
  }
  Object.defineProperty(Cloudbase2.prototype, "config", {
    get: function() {
      return this.cloudbaseConfig;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(Cloudbase2.prototype, "platform", {
    get: function() {
      return Platform;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(Cloudbase2.prototype, "cache", {
    get: function() {
      return getCacheByEnvId(this.cloudbaseConfig.env);
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(Cloudbase2.prototype, "localCache", {
    get: function() {
      return getLocalCache(this.cloudbaseConfig.env);
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(Cloudbase2.prototype, "request", {
    get: function() {
      return getRequestByEnvId(this.cloudbaseConfig.env);
    },
    enumerable: false,
    configurable: true
  });
  Cloudbase2.prototype.init = function(config) {
    var _a3;
    if (!config.env) {
      throw new Error(JSON.stringify({
        code: ERRORS4.INVALID_PARAMS,
        msg: "env must not be specified"
      }));
    }
    if (!Platform.adapter) {
      this.useDefaultAdapter();
    }
    var reqConfig = {
      timeout: config.timeout || 5e3,
      timeoutMsg: "[".concat(getSdkName2(), "][REQUEST TIMEOUT] request had been abort since didn't finished within").concat(config.timeout / 1e3, "s")
    };
    this.requestClient = new Platform.adapter.reqClass(reqConfig);
    this.cloudbaseConfig = __assign8(__assign8(__assign8({}, DEFAULT_INIT_CONFIG), config), { i18n: i18nProxy(Platform, config) });
    delete this.cloudbaseConfig.lang;
    this.cloudbaseConfig.timeout = this.formatTimeout(this.cloudbaseConfig.timeout);
    var _b = this.cloudbaseConfig, env = _b.env, persistence = _b.persistence, debug = _b.debug, timeout = _b.timeout, oauthClient = _b.oauthClient, i18n = _b.i18n;
    initCache({ env, persistence, debug, platformInfo: this.platform });
    setRegionLevelEndpoint(env, config.region || "");
    setGatewayEndPointWithEnv(env, DEFAULT_PROTOCOL, config.region || "");
    var app = new Cloudbase2(this.cloudbaseConfig);
    initRequest({
      env,
      region: config.region || "",
      timeout,
      oauthClient,
      _fromApp: app,
      i18n,
      endPointMode: config.endPointMode
    });
    app.requestClient = this.requestClient;
    (_a3 = this === null || this === void 0 ? void 0 : this.fire) === null || _a3 === void 0 ? void 0 : _a3.call(this, "cloudbase_init", app);
    this.try2InitAuth(app);
    return app;
  };
  Cloudbase2.prototype.updateConfig = function(config) {
    var persistence = config.persistence, debug = config.debug;
    this.cloudbaseConfig.persistence = persistence;
    this.cloudbaseConfig.debug = debug;
    initCache({ env: this.cloudbaseConfig.env, persistence, debug, platformInfo: this.platform });
  };
  Cloudbase2.prototype.updateLang = function(lang) {
    var _a3;
    if (!lang || lang === ((_a3 = this.cloudbaseConfig.i18n) === null || _a3 === void 0 ? void 0 : _a3.lang))
      return;
    this.cloudbaseConfig.i18n.lang = lang;
  };
  Cloudbase2.prototype.registerExtension = function(ext) {
    extensionMap[ext.name] = ext;
  };
  Cloudbase2.prototype.invokeExtension = function(name, opts) {
    return __awaiter6(this, void 0, void 0, function() {
      var ext;
      return __generator6(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            ext = extensionMap[name];
            if (!ext) {
              throw new Error(JSON.stringify({
                code: ERRORS4.INVALID_PARAMS,
                msg: "extension:".concat(name, " must be registered before invoke")
              }));
            }
            return [4, ext.invoke(opts, this)];
          case 1:
            return [2, _a3.sent()];
        }
      });
    });
  };
  Cloudbase2.prototype.useAdapters = function(adapters, options) {
    var _a3 = useAdapters2(adapters, options) || {}, adapter2 = _a3.adapter, runtime2 = _a3.runtime;
    adapter2 && (Platform.adapter = adapter2);
    runtime2 && (Platform.runtime = runtime2);
  };
  Cloudbase2.prototype.registerHook = function(hook2) {
    registerHook(Cloudbase2, hook2);
  };
  Cloudbase2.prototype.registerComponent = function(component12) {
    registerComponent(Cloudbase2, component12);
  };
  Cloudbase2.prototype.registerVersion = function(version3) {
    setSdkVersion(version3);
    this.version = version3;
  };
  Cloudbase2.prototype.registerSdkName = function(name) {
    setSdkName2(name);
  };
  Cloudbase2.prototype.registerEndPoint = function(url2, protocol) {
    setEndPointInfo({ baseUrl: url2, protocol, env: this.config.env, endPointKey: "CLOUD_API" });
  };
  Cloudbase2.prototype.registerEndPointWithKey = function(props) {
    setEndPointInfo({
      env: this.config.env,
      endPointKey: props.key,
      baseUrl: props.url,
      protocol: props.protocol
    });
  };
  Cloudbase2.prototype.getEndPointWithKey = function(key) {
    var info = getEndPointInfo(this.config.env, key);
    return {
      BASE_URL: info.baseUrl,
      PROTOCOL: info.protocol
    };
  };
  Cloudbase2.prototype.parseCaptcha = function(url2) {
    return util_exports.parseCaptcha(url2);
  };
  Cloudbase2.prototype.useDefaultAdapter = function() {
    var _a3 = useDefaultAdapter2.bind(this)(), adapter2 = _a3.adapter, runtime2 = _a3.runtime;
    Platform.adapter = adapter2;
    Platform.runtime = runtime2;
  };
  Cloudbase2.prototype.formatTimeout = function(timeout) {
    switch (true) {
      case timeout > MAX_TIMEOUT:
        printWarn2(ERRORS4.INVALID_PARAMS, "timeout is greater than maximum value[10min]");
        return MAX_TIMEOUT;
      case timeout < MIN_TIMEOUT:
        printWarn2(ERRORS4.INVALID_PARAMS, "timeout is less than maximum value[100ms]");
        return MIN_TIMEOUT;
      default:
        return timeout;
    }
  };
  Cloudbase2.prototype.try2InitAuth = function(app) {
    try {
      app.auth();
    } catch (error) {
      console.log("try2InitAuth error:", error);
    }
  };
  __decorate([
    catchErrorsDecorator2({
      mode: "sync",
      title: "Cloudbase ",
      messages: [
        "",
        "  1 -  cloudbase.init() ",
        "  2 - https://docs.cloudbase.net/api-reference/webv3/adapter#%E7%AC%AC-2-%E6%AD%A5%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8%E5%BA%94%E7%94%A8%E6%9D%A5%E6%BA%90",
        "".concat(COMMUNITY_SITE_URL2)
      ]
    }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Cloudbase2)
  ], Cloudbase2.prototype, "init", null);
  __decorate([
    catchErrorsDecorator2({
      title: "",
      messages: [
        "",
        "  1 -  invokeExtension() ",
        "  2 -  registerExtension() ",
        "".concat(COMMUNITY_SITE_URL2)
      ]
    }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", Promise)
  ], Cloudbase2.prototype, "invokeExtension", null);
  return Cloudbase2;
}();
var cloudbase2 = new Cloudbase();
cloudbase2.useAdapters(getWxDefaultAdapter());
var esm_default2 = cloudbase2;

// node_modules/@cloudbase/oauth/dist/esm/auth/consts.js
var AUTH_API_PREFIX = "/auth";
var ApiUrls;
(function(ApiUrls2) {
  ApiUrls2["AUTH_SIGN_UP_URL"] = "/v1/signup";
  ApiUrls2["AUTH_TOKEN_URL"] = "/v1/token";
  ApiUrls2["AUTH_REVOKE_URL"] = "/v1/revoke";
  ApiUrls2["WEDA_USER_URL"] = "/v1/plugin/weda/userinfo";
  ApiUrls2["AUTH_RESET_PASSWORD"] = "/v1/reset";
  ApiUrls2["AUTH_GET_DEVICE_CODE"] = "/v1/device/code";
  ApiUrls2["CHECK_USERNAME"] = "/v1/checkUsername";
  ApiUrls2["CHECK_IF_USER_EXIST"] = "/v1/checkIfUserExist";
  ApiUrls2["GET_PROVIDER_TYPE"] = "/v1/mgr/provider/providerSubType";
  ApiUrls2["AUTH_SIGN_IN_URL"] = "/v1/signin";
  ApiUrls2["AUTH_SIGN_IN_ANONYMOUSLY_URL"] = "/v1/signin/anonymously";
  ApiUrls2["AUTH_SIGN_IN_WITH_PROVIDER_URL"] = "/v1/signin/with/provider";
  ApiUrls2["AUTH_SIGN_IN_WITH_WECHAT_URL"] = "/v1/signin/wechat/noauth";
  ApiUrls2["AUTH_SIGN_IN_CUSTOM"] = "/v1/signin/custom";
  ApiUrls2["PROVIDER_TOKEN_URL"] = "/v1/provider/token";
  ApiUrls2["PROVIDER_URI_URL"] = "/v1/provider/uri";
  ApiUrls2["USER_ME_URL"] = "/v1/user/me";
  ApiUrls2["AUTH_SIGNOUT_URL"] = "/v1/user/signout";
  ApiUrls2["USER_QUERY_URL"] = "/v1/user/query";
  ApiUrls2["USER_PRIFILE_URL"] = "/v1/user/profile";
  ApiUrls2["USER_BASIC_EDIT_URL"] = "/v1/user/basic/edit";
  ApiUrls2["USER_TRANS_BY_PROVIDER_URL"] = "/v1/user/trans/by/provider";
  ApiUrls2["PROVIDER_LIST"] = "/v1/user/provider";
  ApiUrls2["PROVIDER_BIND_URL"] = "/v1/user/provider/bind";
  ApiUrls2["PROVIDER_UNBIND_URL"] = "/v1/user/provider";
  ApiUrls2["CHECK_PWD_URL"] = "/v1/user/sudo";
  ApiUrls2["SUDO_URL"] = "/v1/user/sudo";
  ApiUrls2["BIND_CONTACT_URL"] = "/v1/user/contact";
  ApiUrls2["AUTH_SET_PASSWORD"] = "/v1/user/password";
  ApiUrls2["AUTHORIZE_DEVICE_URL"] = "/v1/user/device/authorize";
  ApiUrls2["AUTHORIZE_URL"] = "/v1/user/authorize";
  ApiUrls2["AUTHORIZE_INFO_URL"] = "/v1/user/authorize/info";
  ApiUrls2["AUTHORIZED_DEVICES_DELETE_URL"] = "/v1/user/authorized/devices/";
  ApiUrls2["AUTH_REVOKE_ALL_URL"] = "/v1/user/revoke/all";
  ApiUrls2["GET_USER_BEHAVIOR_LOG"] = "/v1/user/security/history";
  ApiUrls2["VERIFICATION_URL"] = "/v1/verification";
  ApiUrls2["VERIFY_URL"] = "/v1/verification/verify";
  ApiUrls2["CAPTCHA_DATA_URL"] = "/v1/captcha/data";
  ApiUrls2["VERIFY_CAPTCHA_DATA_URL"] = "/v1/captcha/data/verify";
  ApiUrls2["GET_CAPTCHA_URL"] = "/v1/captcha/init";
  ApiUrls2["GET_MINIPROGRAM_QRCODE"] = "/v1/qrcode/generate";
  ApiUrls2["GET_MINIPROGRAM_QRCODE_STATUS"] = "/v1/qrcode/get/status";
})(ApiUrls || (ApiUrls = {}));
var ApiUrlsV2;
(function(ApiUrlsV22) {
  ApiUrlsV22["AUTH_SIGN_IN_URL"] = "/v2/signin/username";
  ApiUrlsV22["AUTH_TOKEN_URL"] = "/v2/token";
  ApiUrlsV22["USER_ME_URL"] = "/v2/user/me";
  ApiUrlsV22["VERIFY_URL"] = "/v2/signin/verificationcode";
  ApiUrlsV22["AUTH_SIGN_IN_WITH_PROVIDER_URL"] = "/v2/signin/with/provider";
  ApiUrlsV22["AUTH_PUBLIC_KEY"] = "/v2/signin/publichkey";
  ApiUrlsV22["AUTH_RESET_PASSWORD"] = "/v2/signin/password/update";
})(ApiUrlsV2 || (ApiUrlsV2 = {}));
var VerificationUsages;
(function(VerificationUsages2) {
  VerificationUsages2["REGISTER"] = "REGISTER";
  VerificationUsages2["SIGN_IN"] = "SIGN_IN";
  VerificationUsages2["PASSWORD_RESET"] = "PASSWORD_RESET";
  VerificationUsages2["EMAIL_ADDRESS_CHANGE"] = "EMAIL_ADDRESS_CHANGE";
  VerificationUsages2["PHONE_NUMBER_CHANGE"] = "PHONE_NUMBER_CHANGE";
})(VerificationUsages || (VerificationUsages = {}));
var ErrorType;
(function(ErrorType2) {
  ErrorType2["UNREACHABLE"] = "unreachable";
  ErrorType2["LOCAL"] = "local";
  ErrorType2["CANCELLED"] = "cancelled";
  ErrorType2["UNKNOWN"] = "unknown";
  ErrorType2["UNAUTHENTICATED"] = "unauthenticated";
  ErrorType2["RESOURCE_EXHAUSTED"] = "resource_exhausted";
  ErrorType2["FAILED_PRECONDITION"] = "failed_precondition";
  ErrorType2["INVALID_ARGUMENT"] = "invalid_argument";
  ErrorType2["DEADLINE_EXCEEDED"] = "deadline_exceeded";
  ErrorType2["NOT_FOUND"] = "not_found";
  ErrorType2["ALREADY_EXISTS"] = "already_exists";
  ErrorType2["PERMISSION_DENIED"] = "permission_denied";
  ErrorType2["ABORTED"] = "aborted";
  ErrorType2["OUT_OF_RANGE"] = "out_of_range";
  ErrorType2["UNIMPLEMENTED"] = "unimplemented";
  ErrorType2["INTERNAL"] = "internal";
  ErrorType2["UNAVAILABLE"] = "unavailable";
  ErrorType2["DATA_LOSS"] = "data_loss";
  ErrorType2["INVALID_PASSWORD"] = "invalid_password";
  ErrorType2["PASSWORD_NOT_SET"] = "password_not_set";
  ErrorType2["INVALID_STATUS"] = "invalid_status";
  ErrorType2["USER_PENDING"] = "user_pending";
  ErrorType2["USER_BLOCKED"] = "user_blocked";
  ErrorType2["INVALID_VERIFICATION_CODE"] = "invalid_verification_code";
  ErrorType2["TWO_FACTOR_REQUIRED"] = "two_factor_required";
  ErrorType2["INVALID_TWO_FACTOR"] = "invalid_two_factor";
  ErrorType2["INVALID_TWO_FACTOR_RECOVERY"] = "invalid_two_factor_recovery";
  ErrorType2["UNDER_REVIEW"] = "under_review";
  ErrorType2["INVALID_REQUEST"] = "invalid_request";
  ErrorType2["UNAUTHORIZED_CLIENT"] = "unauthorized_client";
  ErrorType2["ACCESS_DENIED"] = "access_denied";
  ErrorType2["UNSUPPORTED_RESPONSE_TYPE"] = "unsupported_response_type";
  ErrorType2["INVALID_SCOPE"] = "invalid_scope";
  ErrorType2["INVALID_GRANT"] = "invalid_grant";
  ErrorType2["SERVER_ERROR"] = "server_error";
  ErrorType2["TEMPORARILY_UNAVAILABLE"] = "temporarily_unavailable";
  ErrorType2["INTERACTION_REQUIRED"] = "interaction_required";
  ErrorType2["LOGIN_REQUIRED"] = "login_required";
  ErrorType2["ACCOUNT_SELECTION_REQUIRED"] = "account_selection_required";
  ErrorType2["CONSENT_REQUIRED"] = "consent_required";
  ErrorType2["INVALID_REQUEST_URI"] = "invalid_request_uri";
  ErrorType2["INVALID_REQUEST_OBJECT"] = "invalid_request_object";
  ErrorType2["REQUEST_NOT_SUPPORTED"] = "request_not_supported";
  ErrorType2["REQUEST_URI_NOT_SUPPORTED"] = "request_uri_not_supported";
  ErrorType2["REGISTRATION_NOT_SUPPORTED"] = "registration_not_supported";
  ErrorType2["CAPTCHA_REQUIRED"] = "captcha_required";
  ErrorType2["CAPTCHA_INVALID"] = "captcha_invalid";
})(ErrorType || (ErrorType = {}));
var LOGIN_STATE_CHANGED_TYPE = {
  SIGN_OUT: "sign_out",
  SIGN_IN: "sign_in",
  CREDENTIALS_ERROR: "credentials_error"
};
var AUTH_STATE_CHANGED_TYPE = {
  SIGNED_OUT: "SIGNED_OUT",
  SIGNED_IN: "SIGNED_IN",
  INITIAL_SESSION: "INITIAL_SESSION",
  PASSWORD_RECOVERY: "PASSWORD_RECOVERY",
  TOKEN_REFRESHED: "TOKEN_REFRESHED",
  USER_UPDATED: "USER_UPDATED",
  BIND_IDENTITY: "BIND_IDENTITY"
};
var EVENTS = {
  LOGIN_STATE_CHANGED: "loginStateChanged",
  AUTH_STATE_CHANGED: "authStateChanged"
};
var OAUTH_TYPE = {
  SIGN_IN: "sign_in",
  BIND_IDENTITY: "bind_identity"
};

// node_modules/@cloudbase/oauth/dist/esm/oauth2client/consts.js
var Syntax;
(function(Syntax2) {
  Syntax2["CLIENT_ID"] = "client_id";
  Syntax2["CLIENT_SECRET"] = "client_secret";
  Syntax2["RESPONSE_TYPE"] = "response_type";
  Syntax2["SCOPE"] = "scope";
  Syntax2["STATE"] = "state";
  Syntax2["REDIRECT_URI"] = "redirect_uri";
  Syntax2["ERROR"] = "error";
  Syntax2["ERROR_DESCRIPTION"] = "error_description";
  Syntax2["ERROR_URI"] = "error_uri";
  Syntax2["GRANT_TYPE"] = "grant_type";
  Syntax2["CODE"] = "code";
  Syntax2["ACCESS_TOKEN"] = "access_token";
  Syntax2["TOKEN_TYPE"] = "token_type";
  Syntax2["EXPIRES_IN"] = "expires_in";
  Syntax2["USERNAME"] = "username";
  Syntax2["PASSWORD"] = "password";
  Syntax2["REFRESH_TOKEN"] = "refresh_token";
})(Syntax || (Syntax = {}));

// node_modules/@cloudbase/oauth/dist/esm/utils/uuid.js
function uuidv4() {
  return "xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g, (c2) => {
    const r3 = Math.random() * 16 | 0;
    const v2 = c2 === "x" ? r3 : r3 & 3 | 8;
    return v2.toString(16);
  });
}

// node_modules/@cloudbase/oauth/dist/esm/oauth2client/oauth2client.js
init_utils();

// node_modules/@cloudbase/oauth/dist/esm/utils/function/single-promise.js
var jsSdkFnPromiseMap = /* @__PURE__ */ new Map();
var SinglePromise = class {
  constructor(options) {
    this.clientId = (options == null ? void 0 : options.clientId) || "";
    jsSdkFnPromiseMap = jsSdkFnPromiseMap || /* @__PURE__ */ new Map();
  }
  async run(key, fn) {
    key = `${this.clientId}_${key}`;
    let result = jsSdkFnPromiseMap.get(key);
    if (!result) {
      result = new Promise((resolve, reject) => {
        (async () => {
          try {
            await this.runIdlePromise();
            const fnResult = fn();
            resolve(await fnResult);
          } catch (error) {
            reject(error);
          } finally {
            jsSdkFnPromiseMap.delete(key);
          }
        })();
      });
      jsSdkFnPromiseMap.set(key, result);
    }
    return result;
  }
  runIdlePromise() {
    return Promise.resolve();
  }
};

// node_modules/@cloudbase/oauth/dist/esm/utils/base64.js
var b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
var b64re = /^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;
function weBtoa(string) {
  string = String(string);
  let bitmap;
  let a2;
  let b2;
  let c2;
  let result = "";
  let i2 = 0;
  const rest = string.length % 3;
  for (; i2 < string.length; ) {
    if ((a2 = string.charCodeAt(i2++)) > 255 || (b2 = string.charCodeAt(i2++)) > 255 || (c2 = string.charCodeAt(i2++)) > 255)
      throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");
    bitmap = a2 << 16 | b2 << 8 | c2;
    result += b64.charAt(bitmap >> 18 & 63) + b64.charAt(bitmap >> 12 & 63) + b64.charAt(bitmap >> 6 & 63) + b64.charAt(bitmap & 63);
  }
  return rest ? result.slice(0, rest - 3) + "===".substring(rest) : result;
}
var weAtob = function(string) {
  string = String(string).replace(/[\t\n\f\r ]+/g, "");
  if (!b64re.test(string))
    throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");
  string += "==".slice(2 - (string.length & 3));
  let bitmap;
  let result = "";
  let r1;
  let r22;
  let i2 = 0;
  for (; i2 < string.length; ) {
    bitmap = b64.indexOf(string.charAt(i2++)) << 18 | b64.indexOf(string.charAt(i2++)) << 12 | (r1 = b64.indexOf(string.charAt(i2++))) << 6 | (r22 = b64.indexOf(string.charAt(i2++)));
    result += r1 === 64 ? String.fromCharCode(bitmap >> 16 & 255) : r22 === 64 ? String.fromCharCode(bitmap >> 16 & 255, bitmap >> 8 & 255) : String.fromCharCode(bitmap >> 16 & 255, bitmap >> 8 & 255, bitmap & 255);
  }
  return result;
};
function b64DecodeUnicode(str) {
  return decodeURIComponent(weAtob(str).replace(/(.)/g, (p2) => {
    let code2 = p2.charCodeAt(0).toString(16).toUpperCase();
    if (code2.length < 2) {
      code2 = `0${code2}`;
    }
    return `%${code2}`;
  }));
}
function base64_url_decode(str) {
  let output = str.replace(/-/g, "+").replace(/_/g, "/");
  switch (output.length % 4) {
    case 0:
      break;
    case 2:
      output += "==";
      break;
    case 3:
      output += "=";
      break;
    default:
      throw new Error("Illegal base64url string!");
  }
  try {
    return b64DecodeUnicode(output);
  } catch (err) {
    return weAtob(output);
  }
}
function weappJwtDecodeAll(token) {
  if (typeof token !== "string") {
    throw new Error("Invalid token specified");
  }
  try {
    const parts = token.split(".").map((segment, i2) => i2 === 2 ? segment : JSON.parse(base64_url_decode(segment)));
    return { claims: parts[1], header: parts[0], signature: parts[2] };
  } catch (e3) {
    throw new Error(`Invalid token specified: ${e3}` ? e3.message : "");
  }
}

// node_modules/@cloudbase/oauth/dist/esm/utils/mp.js
function isMp() {
  if (typeof globalThis === "undefined") {
    return false;
  }
  const { wx: wx2 } = globalThis;
  if (typeof wx2 === "undefined") {
    return false;
  }
  if (globalThis.Page === void 0) {
    return false;
  }
  if (!wx2.getDeviceInfo) {
    return false;
  }
  if (!wx2.getStorageSync) {
    return false;
  }
  if (!wx2.setStorageSync) {
    return false;
  }
  if (!wx2.connectSocket) {
    return false;
  }
  if (!wx2.request) {
    return false;
  }
  try {
    if (!wx2.getDeviceInfo()) {
      return false;
    }
    if (wx2.getDeviceInfo().platform === "qq") {
      return false;
    }
  } catch (e3) {
    return false;
  }
  return true;
}
var IS_IN_MP_WEBVIEW = false;
function ready() {
  IS_IN_MP_WEBVIEW = IS_IN_MP_WEBVIEW || typeof window !== void 0 && window.__wxjs_environment === "miniprogram";
}
try {
  if (!isMp()) {
    IS_IN_MP_WEBVIEW = IS_IN_MP_WEBVIEW || !!navigator.userAgent.match(/miniprogram/i) || window.__wxjs_environment === "miniprogram";
    if (window && window.WeixinJSBridge && window.WeixinJSBridge.invoke) {
      ready();
    } else if (typeof document !== "undefined") {
      document.addEventListener("WeixinJSBridgeReady", ready, false);
    }
  }
} catch (e3) {
}

// node_modules/@cloudbase/oauth/dist/esm/oauth2client/oauth2client.js
var RequestIdHeaderName = "x-request-id";
var DeviceIdHeaderName = "x-device-id";
var DeviceIdSectionName = "device_id";
var defaultRequest = async function(url2, options) {
  let result = null;
  let responseError = null;
  try {
    const copyOptions = Object.assign({}, options);
    if (!copyOptions.method) {
      copyOptions.method = "GET";
    }
    if (copyOptions.body && typeof copyOptions.body !== "string") {
      copyOptions.body = JSON.stringify(copyOptions.body);
    }
    const responseResult = await fetch(url2, copyOptions);
    const jsonResponse = await responseResult.json();
    if (jsonResponse == null ? void 0 : jsonResponse.error) {
      responseError = jsonResponse;
      responseError.error_uri = new URL(url2).pathname;
    } else {
      result = jsonResponse;
    }
  } catch (error) {
    responseError = {
      error: ErrorType.UNREACHABLE,
      error_description: error.message,
      error_uri: new URL(url2).pathname
    };
  }
  if (responseError) {
    throw responseError;
  } else {
    return result;
  }
};
function generateRequestId2() {
  return uuidv4();
}
var DefaultStorage = class {
  constructor(opts) {
    this._env = (opts == null ? void 0 : opts.env) || "";
  }
  async getItem(key) {
    return window.localStorage.getItem(`${key}${this._env}`);
  }
  async removeItem(key) {
    window.localStorage.removeItem(`${key}${this._env}`);
  }
  async setItem(key, value) {
    window.localStorage.setItem(`${key}${this._env}`, value);
  }
  getItemSync(key) {
    return window.localStorage.getItem(`${key}${this._env}`);
  }
  removeItemSync(key) {
    window.localStorage.removeItem(`${key}${this._env}`);
  }
  setItemSync(key, value) {
    window.localStorage.setItem(`${key}${this._env}`, value);
  }
};
var defaultStorage = new DefaultStorage();
function isCredentialsExpired(credentials) {
  let isExpired = true;
  if ((credentials == null ? void 0 : credentials.expires_at) && (credentials == null ? void 0 : credentials.access_token)) {
    isExpired = credentials.expires_at < /* @__PURE__ */ new Date();
  }
  return isExpired;
}
var LocalCredentials = class {
  constructor(options) {
    this.credentials = null;
    this.accessKeyCredentials = null;
    this.singlePromise = null;
    this.tokenSectionName = options.tokenSectionName;
    this.storage = options.storage;
    this.clientId = options.clientId;
    this.singlePromise = new SinglePromise({ clientId: this.clientId });
    this.credentials = options.credentials || null;
  }
  getStorageCredentialsSync() {
    let credentials = null;
    const tokenStr = this.storage.getItemSync(this.tokenSectionName);
    if (tokenStr !== void 0 && tokenStr !== null) {
      try {
        credentials = JSON.parse(tokenStr);
        if (credentials == null ? void 0 : credentials.expires_at) {
          credentials.expires_at = new Date(credentials.expires_at);
        }
      } catch (error) {
        this.storage.removeItem(this.tokenSectionName);
        credentials = null;
      }
    }
    return credentials;
  }
  async setCredentials(credentials) {
    if (credentials == null ? void 0 : credentials.expires_in) {
      if (!(credentials == null ? void 0 : credentials.expires_at)) {
        credentials.expires_at = new Date(Date.now() + (credentials.expires_in - 30) * 1e3);
      }
      if (this.storage) {
        const tokenStr = JSON.stringify(credentials);
        await this.storage.setItem(this.tokenSectionName, tokenStr);
      }
      this.credentials = credentials;
    } else {
      if (this.storage) {
        await this.storage.removeItem(this.tokenSectionName);
      }
      this.credentials = null;
    }
  }
  setAccessKeyCredentials(credentials) {
    this.accessKeyCredentials = credentials;
  }
  async getCredentials() {
    return this.singlePromise.run("getCredentials", async () => {
      if (isCredentialsExpired(this.credentials)) {
        const { credentials, isAccessKeyCredentials } = await this.getStorageCredentials();
        if (isAccessKeyCredentials) {
          return credentials;
        }
        this.credentials = credentials;
      }
      return this.credentials;
    });
  }
  async getStorageCredentials() {
    return this.singlePromise.run("_getStorageCredentials", async () => {
      let credentials = null;
      let isAccessKeyCredentials = false;
      const tokenStr = await this.storage.getItem(this.tokenSectionName);
      if (!!tokenStr) {
        try {
          credentials = JSON.parse(tokenStr);
          if (credentials == null ? void 0 : credentials.expires_at) {
            credentials.expires_at = new Date(credentials.expires_at);
          }
        } catch (error) {
          await this.storage.removeItem(this.tokenSectionName);
          credentials = null;
        }
      } else {
        credentials = this.accessKeyCredentials || null;
        isAccessKeyCredentials = true;
      }
      return { credentials, isAccessKeyCredentials };
    });
  }
};
var OAuth2Client = class _OAuth2Client {
  constructor(options) {
    this.initializePromise = null;
    this.lockAcquired = false;
    this.pendingInLock = [];
    this.singlePromise = null;
    if (!options.clientSecret) {
      options.clientSecret = "";
    }
    if (!options.clientId && options.env) {
      options.clientId = options.env;
    }
    this.apiOrigin = options.apiOrigin;
    this.apiPath = options.apiPath || AUTH_API_PREFIX;
    this.clientId = options.clientId;
    this.i18n = options.i18n;
    this.eventBus = options.eventBus;
    this.singlePromise = new SinglePromise({ clientId: this.clientId });
    this.retry = this.formatRetry(options.retry, _OAuth2Client.defaultRetry);
    if (options.baseRequest) {
      this.baseRequest = options.baseRequest;
    } else {
      this.baseRequest = defaultRequest;
    }
    this.tokenInURL = options.tokenInURL;
    this.headers = options.headers;
    this.storage = options.storage || defaultStorage;
    this.localCredentials = new LocalCredentials({
      tokenSectionName: `credentials_${options.clientId}`,
      storage: this.storage,
      clientId: options.clientId
    });
    this.clientSecret = options.clientSecret;
    if (options.clientId) {
      this.basicAuth = `Basic ${weBtoa(`${options.clientId}:${this.clientSecret}`)}`;
    }
    this.wxCloud = options.wxCloud;
    try {
      if (isMp()) {
        this.useWxCloud = options.useWxCloud;
        if (this.wxCloud === void 0 && options.env) {
          wx.cloud.init({ env: options.env });
          this.wxCloud = wx.cloud;
        }
      }
    } catch (error) {
    }
    this.refreshTokenFunc = options.refreshTokenFunc || this.defaultRefreshTokenFunc;
    this.anonymousSignInFunc = options.anonymousSignInFunc;
    this.onCredentialsError = options.onCredentialsError;
    this.getInitialSession = options.getInitialSession;
    this.onInitialSessionObtained = options.onInitialSessionObtained;
    this.logDebugMessages = options.debug ?? false;
    langEvent_exports.bus.on(langEvent_exports.LANG_CHANGE_EVENT, (params) => {
      var _a3;
      this.i18n = ((_a3 = params.data) == null ? void 0 : _a3.i18n) || this.i18n;
    });
  }
  setGetInitialSession(callback) {
    this.getInitialSession = callback;
  }
  setOnInitialSessionObtained(callback) {
    this.onInitialSessionObtained = callback;
  }
  async initialize(func) {
    if (this.initializePromise) {
      return await this.initializePromise;
    }
    if (func !== void 0) {
      this.initializePromise = func;
      return await this.initializePromise;
    }
    this.initializePromise = (async () => await this._acquireLock(-1, async () => await this._initialize()))();
    return await this.initializePromise;
  }
  async setCredentials(credentials) {
    await this.initializePromise;
    return this._acquireLock(-1, async () => this.localCredentials.setCredentials(credentials));
  }
  setAccessKeyCredentials(credentials) {
    return this.localCredentials.setAccessKeyCredentials(credentials);
  }
  async getAccessToken() {
    await this.initializePromise;
    const credentials = await this.getCredentials();
    if (credentials == null ? void 0 : credentials.access_token) {
      return Promise.resolve(credentials.access_token);
    }
    const respErr = { error: ErrorType.UNAUTHENTICATED };
    return Promise.reject(respErr);
  }
  async request(url2, options) {
    var _a3, _b;
    if (!options) {
      options = {};
    }
    const retry = this.formatRetry(options.retry, this.retry);
    options.headers = { ...options.headers, [(_a3 = this.i18n) == null ? void 0 : _a3.LANG_HEADER_KEY]: (_b = this.i18n) == null ? void 0 : _b.lang };
    if (this.headers) {
      options.headers = {
        ...this.headers,
        ...options.headers
      };
    }
    if (!options.headers[RequestIdHeaderName]) {
      options.headers[RequestIdHeaderName] = generateRequestId2();
    }
    if (!options.headers[DeviceIdHeaderName]) {
      const deviceId = await this.getDeviceId();
      options.headers[DeviceIdHeaderName] = deviceId;
    }
    if ((options == null ? void 0 : options.withBasicAuth) && this.basicAuth) {
      options.headers.Authorization = this.basicAuth;
    }
    if (options == null ? void 0 : options.withCredentials) {
      const credentials = options.getCredentials ? await options.getCredentials() : await this.getCredentials();
      if (credentials) {
        if (this.tokenInURL) {
          if (url2.indexOf("?") < 0) {
            url2 += "?";
          }
          url2 += `access_token=${credentials.access_token}`;
        } else {
          options.headers.Authorization = `${credentials.token_type} ${credentials.access_token}`;
        }
      }
    } else {
      if (this.clientId && url2.indexOf("client_id") < 0) {
        url2 += url2.indexOf("?") < 0 ? "?" : "&";
        url2 += `client_id=${this.clientId}`;
      }
    }
    if (url2.startsWith("/")) {
      url2 = `${this.apiOrigin}${this.apiPath}${url2}`;
    }
    let response = null;
    const maxRequestTimes = retry + 1;
    for (let requestTime = 0; requestTime < maxRequestTimes; requestTime++) {
      try {
        if (options.useWxCloud || this.useWxCloud) {
          response = await this.wxCloudCallFunction(url2, options);
        } else {
          response = await this.baseRequest(url2, options);
        }
        if (!!(response == null ? void 0 : response.code)) {
          throw {
            error: response.code,
            error_description: response.message,
            error_uri: new URL(url2).pathname
          };
        }
        break;
      } catch (responseError) {
        if (options.withCredentials && responseError && responseError.error === ErrorType.UNAUTHENTICATED) {
          await this.setCredentials(null);
          return Promise.reject(responseError);
        }
        if (requestTime === retry || !responseError || responseError.error !== "unreachable") {
          return Promise.reject(responseError);
        }
      }
      await this.sleep(_OAuth2Client.retryInterval);
    }
    return response;
  }
  async wxCloudCallFunction(url2, options) {
    var _a3;
    let result = null;
    let responseError = null;
    try {
      let userAgent2 = "";
      try {
        userAgent2 = await wx.getRendererUserAgent();
      } catch (error) {
      }
      const { result: responseResult } = await this.wxCloud.callFunction({
        name: "httpOverCallFunction",
        data: {
          url: url2,
          method: options.method,
          headers: {
            origin: "https://servicewechat.com",
            "User-Agent": userAgent2,
            ...options.headers
          },
          body: options.body
        }
      });
      if ((_a3 = responseResult == null ? void 0 : responseResult.body) == null ? void 0 : _a3.error_code) {
        responseError = responseResult == null ? void 0 : responseResult.body;
        responseError.error_uri = getPathName(url2);
      } else {
        result = responseResult == null ? void 0 : responseResult.body;
      }
    } catch (error) {
      responseError = {
        error: ErrorType.UNREACHABLE,
        error_description: error.message,
        error_uri: getPathName(url2)
      };
    }
    if (responseError) {
      throw responseError;
    } else {
      return result;
    }
  }
  async getCredentials() {
    await this.initializePromise;
    return this._acquireLock(-1, async () => this._getCredentials());
  }
  getCredentialsSync() {
    const credentials = this.localCredentials.getStorageCredentialsSync();
    return credentials;
  }
  getCredentialsAsync() {
    return this.getCredentials();
  }
  async getScope() {
    var _a3;
    const credentials = await this.localCredentials.getCredentials();
    if (!credentials) {
      const msg = "credentials not found";
      (_a3 = this.onCredentialsError) == null ? void 0 : _a3.call(this, { msg });
      return this.unAuthenticatedError(msg);
    }
    return credentials.scope;
  }
  async getGroups() {
    var _a3;
    const credentials = await this.localCredentials.getCredentials();
    if (!credentials) {
      const msg = "credentials not found";
      (_a3 = this.onCredentialsError) == null ? void 0 : _a3.call(this, { msg });
      return this.unAuthenticatedError(msg);
    }
    return credentials.groups;
  }
  async refreshToken(credentials, options) {
    await this.initializePromise;
    return this._acquireLock(-1, async () => this._refreshToken(credentials, options));
  }
  async _refreshToken(credentials, options) {
    return this.singlePromise.run("_refreshToken", async () => {
      var _a3, _b, _c, _d;
      if (!credentials || !credentials.refresh_token) {
        const msg = "no refresh token found in credentials";
        (_a3 = this.onCredentialsError) == null ? void 0 : _a3.call(this, { msg });
        return this.unAuthenticatedError(msg);
      }
      try {
        const newCredentials = await this.refreshTokenFunc(credentials.refresh_token, credentials);
        await this.localCredentials.setCredentials(newCredentials);
        (_b = this.eventBus) == null ? void 0 : _b.fire(EVENTS.AUTH_STATE_CHANGED, { event: AUTH_STATE_CHANGED_TYPE.TOKEN_REFRESHED });
        return newCredentials;
      } catch (error) {
        if (options == null ? void 0 : options.throwError) {
          throw error;
        }
        if (error.error === ErrorType.INVALID_GRANT) {
          await this.localCredentials.setCredentials(null);
          const msg = error.error_description;
          (_c = this.onCredentialsError) == null ? void 0 : _c.call(this, { msg });
          return this.unAuthenticatedError(msg);
        }
        (_d = this.onCredentialsError) == null ? void 0 : _d.call(this, { msg: error.error_description });
        return Promise.reject(error);
      }
    });
  }
  async anonymousLogin(credentials) {
    return this.singlePromise.run("_anonymousLogin", async () => {
      if (this.anonymousSignInFunc) {
        const c2 = await this.anonymousSignInFunc(credentials);
        credentials = c2 || await this.localCredentials.getCredentials();
      } else {
        credentials = await this.anonymousSignIn(credentials);
      }
      return credentials;
    });
  }
  checkRetry(retry) {
    let responseError = null;
    if (typeof retry !== "number" || retry < _OAuth2Client.minRetry || retry > _OAuth2Client.maxRetry) {
      responseError = {
        error: ErrorType.UNREACHABLE,
        error_description: "wrong options param: retry"
      };
    }
    if (responseError) {
      throw responseError;
    }
    return retry;
  }
  formatRetry(retry, defaultVale) {
    if (typeof retry === "undefined") {
      return defaultVale;
    }
    return this.checkRetry(retry);
  }
  async sleep(ms) {
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve();
      }, ms);
    });
  }
  async anonymousSignIn(credentials) {
    return this.singlePromise.run("_anonymous", async () => {
      if (!credentials || credentials.scope !== "anonymous") {
        return this.unAuthenticatedError("no anonymous in credentials");
      }
      try {
        const newCredentials = await this.request(ApiUrls.AUTH_SIGN_IN_ANONYMOUSLY_URL, {
          method: "POST",
          withBasicAuth: true,
          body: {}
        });
        await this.localCredentials.setCredentials(newCredentials);
        return newCredentials;
      } catch (error) {
        if (error.error === ErrorType.INVALID_GRANT) {
          await this.localCredentials.setCredentials(null);
          return this.unAuthenticatedError(error.error_description);
        }
        return Promise.reject(error);
      }
    });
  }
  async defaultRefreshTokenFunc(refreshToken, credentials) {
    var _a3;
    if (refreshToken === void 0 || refreshToken === "") {
      const msg = "refresh token not found";
      (_a3 = this.onCredentialsError) == null ? void 0 : _a3.call(this, { msg });
      return this.unAuthenticatedError(msg);
    }
    let url2 = ApiUrls.AUTH_TOKEN_URL;
    if ((credentials == null ? void 0 : credentials.version) === "v2") {
      url2 = ApiUrlsV2.AUTH_TOKEN_URL;
    }
    const newCredentials = await this.request(url2, {
      method: "POST",
      body: {
        client_id: this.clientId,
        client_secret: this.clientSecret,
        grant_type: "refresh_token",
        refresh_token: refreshToken
      }
    });
    return { ...newCredentials, version: (credentials == null ? void 0 : credentials.version) || "v1" };
  }
  async getDeviceId() {
    if (this.deviceID) {
      return this.deviceID;
    }
    let deviceId = await this.storage.getItem(DeviceIdSectionName);
    if (!(typeof deviceId === "string" && deviceId.length >= 16 && deviceId.length <= 48)) {
      deviceId = uuidv4();
      await this.storage.setItem(DeviceIdSectionName, deviceId);
    }
    this.deviceID = deviceId;
    return deviceId;
  }
  unAuthenticatedError(err) {
    const respErr = {
      error: ErrorType.UNAUTHENTICATED,
      error_description: err
    };
    return Promise.reject(respErr);
  }
  _debug(...args) {
    if (this.logDebugMessages) {
      console.log("[OAuth2Client]", ...args);
    }
  }
  async _initialize() {
    try {
      if (!this.getInitialSession) {
        this._debug("#_initialize()", "no getInitialSession callback set, skipping");
        return { error: null };
      }
      this._debug("#_initialize()", "calling getInitialSession callback");
      try {
        const { data: data2, error } = await this.getInitialSession();
        if (data2 == null ? void 0 : data2.session) {
          this._debug("#_initialize()", "session obtained from getInitialSession", data2.session);
          await this.localCredentials.setCredentials(data2 == null ? void 0 : data2.session);
        }
        if (this.onInitialSessionObtained) {
          this._debug("#_initialize()", "calling onInitialSessionObtained callback");
          try {
            await this.onInitialSessionObtained(data2, error);
          } catch (callbackError) {
            this._debug("#_initialize()", "error in onInitialSessionObtained", callbackError);
          }
        }
        if (error) {
          this._debug("#_initialize()", "error from getInitialSession", error);
          return { error };
        }
        return { error: null };
      } catch (err) {
        this._debug("#_initialize()", "exception during getInitialSession", err);
        return { error: err instanceof Error ? err : new Error(String(err)) };
      }
    } catch (error) {
      this._debug("#_initialize()", "unexpected error", error);
      return { error: error instanceof Error ? error : new Error(String(error)) };
    } finally {
      this._debug("#_initialize()", "end");
    }
  }
  async _acquireLock(acquireTimeout, fn) {
    this._debug("#_acquireLock", "begin", acquireTimeout);
    try {
      if (this.lockAcquired) {
        const last = this.pendingInLock.length ? this.pendingInLock[this.pendingInLock.length - 1] : Promise.resolve();
        const result = (async () => {
          await last;
          return await fn();
        })();
        this.pendingInLock.push((async () => {
          try {
            await result;
          } catch (_e2) {
          }
        })());
        return result;
      }
      this._debug("#_acquireLock", "acquiring lock for client", this.clientId);
      try {
        this.lockAcquired = true;
        const result = fn();
        this.pendingInLock.push((async () => {
          try {
            await result;
          } catch (_e2) {
          }
        })());
        await result;
        while (this.pendingInLock.length) {
          const waitOn = [...this.pendingInLock];
          await Promise.all(waitOn);
          this.pendingInLock.splice(0, waitOn.length);
        }
        return await result;
      } finally {
        this._debug("#_acquireLock", "releasing lock for client", this.clientId);
        this.lockAcquired = false;
      }
    } finally {
      this._debug("#_acquireLock", "end");
    }
  }
  async _getCredentials() {
    var _a3, _b, _c;
    let credentials = await this.localCredentials.getCredentials();
    if (!credentials) {
      const msg = "credentials not found";
      (_a3 = this.onCredentialsError) == null ? void 0 : _a3.call(this, { msg });
      return this.unAuthenticatedError(msg);
    }
    if (isCredentialsExpired(credentials)) {
      if (credentials.refresh_token) {
        try {
          credentials = await this._refreshToken(credentials);
        } catch (error) {
          if (credentials.scope === "anonymous") {
            credentials = await this.anonymousLogin(credentials);
          } else {
            (_b = this.onCredentialsError) == null ? void 0 : _b.call(this, { msg: error.error_description });
            return Promise.reject(error);
          }
        }
      } else if (credentials.scope === "anonymous") {
        credentials = await this.anonymousLogin(credentials);
      } else {
        const msg = "no refresh token found in credentials";
        (_c = this.onCredentialsError) == null ? void 0 : _c.call(this, { msg });
        return this.unAuthenticatedError(msg);
      }
    }
    return credentials;
  }
};
OAuth2Client.defaultRetry = 2;
OAuth2Client.minRetry = 0;
OAuth2Client.maxRetry = 5;
OAuth2Client.retryInterval = 1e3;

// node_modules/@cloudbase/oauth/dist/esm/captcha/captcha-dom.js
var import_events2 = __toESM(require_events());
var import_util6 = __toESM(require_util());
var debounce = (func, delay) => {
  let timeoutId;
  return (...args) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => func.apply(null, args), delay);
  };
};
var eventBus = new import_events2.CloudbaseEventEmitter();
var CAPTCHA_EVENT = {
  CAPTCHA_DATA_CHANGE: "captchaDataChange",
  RESOLVE_CAPTCHA_DATA: "resolveCaptchaData"
};
var CAPTCHA_STYLES = {
  overlay: "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:999",
  modal: "position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:320px;padding:20px;background:#fff;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.2);z-index:1000",
  prompt: "margin-bottom:15px",
  captchaWrap: "display:flex;align-items:center;justify-content:space-between;margin-bottom:15px",
  captchaImg: "width:100%;height:auto;border:1px solid #eee",
  refreshBtn: "padding:10px 8px;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer;flex:1;white-space:nowrap;margin-left:10px",
  input: "width:100%;padding:14px 16px;margin-bottom:15px;box-sizing:border-box;border:2px solid #e8ecf4;border-radius:10px;font-size:15px",
  confirmBtn: "width:100%;padding:10px;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer",
  loading: "background:#6c757d;cursor:not-allowed"
};
var genCaptchaDom = ({ oauthInstance, captchaState }) => {
  const CAPTCHA_IMG_ID = "captcha-image";
  const refreshCaptcha = async () => {
    try {
      const result = await oauthInstance.createCaptchaData({ state: captchaState.state });
      captchaState = { ...captchaState, captchaData: result.data, token: result.token };
      document.getElementById(CAPTCHA_IMG_ID).src = result.data;
    } catch (error) {
      console.error("", error);
    }
  };
  const createElement2 = (tag, styles, text) => {
    const el = document.createElement(tag);
    if (styles)
      el.style.cssText = styles;
    if (text)
      el.textContent = text;
    return el;
  };
  const overlay = createElement2("div", CAPTCHA_STYLES.overlay);
  const modal = createElement2("div", CAPTCHA_STYLES.modal);
  modal.appendChild(createElement2("p", CAPTCHA_STYLES.prompt, ""));
  const captchaWrap = createElement2("div", CAPTCHA_STYLES.captchaWrap);
  const captchaImg = createElement2("img", CAPTCHA_STYLES.captchaImg);
  captchaImg.id = CAPTCHA_IMG_ID;
  captchaImg.src = captchaState.captchaData;
  captchaWrap.appendChild(captchaImg);
  const refreshBtn = createElement2("button", CAPTCHA_STYLES.refreshBtn, "");
  refreshBtn.onclick = debounce(async () => {
    refreshBtn.textContent = "...";
    refreshBtn.disabled = true;
    refreshBtn.style.cssText = `${CAPTCHA_STYLES.refreshBtn};${CAPTCHA_STYLES.loading}`;
    try {
      await refreshCaptcha();
    } finally {
      refreshBtn.textContent = "";
      refreshBtn.disabled = false;
      refreshBtn.style.cssText = CAPTCHA_STYLES.refreshBtn;
    }
  }, 500);
  captchaWrap.appendChild(refreshBtn);
  modal.appendChild(captchaWrap);
  const input = createElement2("input", CAPTCHA_STYLES.input);
  input.type = "text";
  input.placeholder = "";
  input.maxLength = 4;
  modal.appendChild(input);
  const errorMsg = createElement2("div", "color:#dc3545;font-size:12px;margin-bottom:10px;display:none;padding:8px;background:#f8d7da;border:1px solid #f5c6cb;border-radius:4px");
  modal.appendChild(errorMsg);
  const showError = (message) => {
    errorMsg.textContent = message;
    errorMsg.style.display = "block";
  };
  const confirmBtn = createElement2("button", CAPTCHA_STYLES.confirmBtn, "");
  confirmBtn.onclick = debounce(async () => {
    const inputValue = input.value.trim();
    if (!inputValue) {
      showError("");
      return;
    }
    errorMsg.style.display = "none";
    confirmBtn.textContent = "...";
    confirmBtn.disabled = true;
    confirmBtn.style.cssText = `${CAPTCHA_STYLES.confirmBtn};${CAPTCHA_STYLES.loading}`;
    try {
      const verifyResult = await oauthInstance.verifyCaptchaData({
        token: captchaState.token,
        key: inputValue
      });
      eventBus.fire(CAPTCHA_EVENT.RESOLVE_CAPTCHA_DATA, verifyResult);
      console.log("");
      document.body.removeChild(overlay);
      document.body.removeChild(modal);
    } catch (error) {
      console.error("", error);
      const errorMessage = error.error_description || "";
      showError(errorMessage);
      input.value = "";
      input.focus();
      await refreshCaptcha();
    } finally {
      confirmBtn.textContent = "";
      confirmBtn.disabled = false;
      confirmBtn.style.cssText = CAPTCHA_STYLES.confirmBtn;
    }
  }, 500);
  modal.appendChild(confirmBtn);
  document.body.appendChild(overlay);
  document.body.appendChild(modal);
};
var openURIWithCallback = async (url2, oauthInstance) => {
  const { captchaData, state, token } = (0, import_util6.parseCaptcha)(url2);
  genCaptchaDom({ oauthInstance, captchaState: { captchaData, state, token } });
  return new Promise((resolve) => {
    console.log("...");
    eventBus.on(CAPTCHA_EVENT.RESOLVE_CAPTCHA_DATA, (res) => {
      resolve(res == null ? void 0 : res.data);
    });
  });
};

// node_modules/@cloudbase/oauth/dist/esm/captcha/captcha.js
var Captcha = class {
  constructor(opts) {
    if (!opts.openURIWithCallback) {
      opts.openURIWithCallback = this.getDefaultOpenURIWithCallback();
    }
    if (!opts.storage) {
      opts.storage = defaultStorage;
    }
    this.config = opts;
    this.tokenSectionName = `captcha_${opts.clientId || opts.env}`;
  }
  isMatch() {
    var _a3, _b, _c;
    return ((_c = (_b = (_a3 = this.config) == null ? void 0 : _a3.adapter) == null ? void 0 : _b.isMatch) == null ? void 0 : _c.call(_b)) || isMp();
  }
  async request(url2, options) {
    if (!options) {
      options = {};
    }
    if (!options.method) {
      options.method = "GET";
    }
    const state = `${options.method}:${url2}`;
    let reqURL = url2;
    if (options.withCaptcha) {
      reqURL = await this.appendCaptchaTokenToURL(url2, state, false);
    }
    let resp;
    try {
      resp = await this.config.request(reqURL, options);
    } catch (err) {
      if (err.error === ErrorType.CAPTCHA_REQUIRED || err.error === ErrorType.CAPTCHA_INVALID) {
        url2 = await this.appendCaptchaTokenToURL(url2, state, err.error === ErrorType.CAPTCHA_INVALID);
        return this.config.request(url2, options);
      }
      return Promise.reject(err);
    }
    return resp;
  }
  getDefaultOpenURIWithCallback() {
    return (url2) => openURIWithCallback(url2, this.config.oauthInstance);
  }
  async getCaptchaToken(forceNewToken, state) {
    if (!forceNewToken) {
      const captchaToken2 = await this.findCaptchaToken();
      if (captchaToken2) {
        return captchaToken2;
      }
    }
    const captchaDataResp = await this.config.request(ApiUrls.CAPTCHA_DATA_URL, {
      method: "POST",
      body: {
        state,
        redirect_uri: ""
      },
      withCredentials: false
    });
    const captchaTokenUrl = `${captchaDataResp.data}?state=${encodeURIComponent(state)}&token=${encodeURIComponent(captchaDataResp.token)}`;
    const captchaToken = await this.config.openURIWithCallback(captchaTokenUrl);
    this.saveCaptchaToken(captchaToken);
    return captchaToken.captcha_token;
  }
  async appendCaptchaTokenToURL(url2, state, forceNewToken) {
    const captchaToken = await this.getCaptchaToken(forceNewToken, state);
    if (url2.indexOf("?") > 0) {
      url2 += `&captcha_token=${captchaToken}`;
    } else {
      url2 += `?captcha_token=${captchaToken}`;
    }
    return url2;
  }
  async saveCaptchaToken(token) {
    token.expires_at = new Date(Date.now() + (token.expires_in - 10) * 1e3);
    const tokenStr = JSON.stringify(token);
    await this.config.storage.setItem(this.tokenSectionName, tokenStr);
  }
  async findCaptchaToken() {
    const tokenStr = await this.config.storage.getItem(this.tokenSectionName);
    if (tokenStr !== void 0 && tokenStr !== null) {
      try {
        const captchaToken = JSON.parse(tokenStr);
        if (captchaToken == null ? void 0 : captchaToken.expires_at) {
          captchaToken.expires_at = new Date(captchaToken.expires_at);
        }
        const isExpired = captchaToken.expires_at < /* @__PURE__ */ new Date();
        if (isExpired) {
          return null;
        }
        return captchaToken.captcha_token;
      } catch (error) {
        await this.config.storage.removeItem(this.tokenSectionName);
        return null;
      }
    }
    return null;
  }
};

// node_modules/@cloudbase/oauth/dist/esm/auth/apis.js
init_utils();

// node_modules/@cloudbase/oauth/dist/esm/utils/urlSearchParams.js
var MyURLSearchParams = class {
  constructor(init) {
    this.params = {};
    if (typeof init === "string") {
      this.parse(init);
    } else if (init && typeof init === "object") {
      for (const key in init) {
        if (Object.prototype.hasOwnProperty.call(init, key)) {
          this.append(key, init[key]);
        }
      }
    }
  }
  parse(str) {
    const params = str.split("&");
    params.forEach((param) => {
      const [key, value] = param.split("=").map(decodeURIComponent);
      this.append(key, value);
    });
  }
  append(key, value) {
    if (this.params[key]) {
      this.params[key] = this.params[key].concat([value]);
    } else {
      this.params[key] = [value];
    }
  }
  get(key) {
    return this.params[key] ? this.params[key][0] : null;
  }
  getAll(key) {
    return this.params[key] || [];
  }
  delete(key) {
    delete this.params[key];
  }
  has(key) {
    return Object.prototype.hasOwnProperty.call(this.params, key);
  }
  set(key, value) {
    this.params[key] = [value];
  }
  toString() {
    const items = [];
    for (const key in this.params) {
      if (Object.prototype.hasOwnProperty.call(this.params, key)) {
        this.params[key].forEach((value) => {
          items.push(`${encodeURIComponent(key)}=${encodeURIComponent(value)}`);
        });
      }
    }
    return items.join("&");
  }
};
var urlSearchParams_default = MyURLSearchParams;

// node_modules/@cloudbase/oauth/dist/esm/auth/apis.js
async function getEncryptUtils(isEncrypt, adapter2) {
  var _a3;
  const getUtils = async () => {
    try {
      const utils = (init_encrypt(), __toCommonJS(encrypt_exports));
      return utils;
    } catch (error) {
      try {
        const utils = await import("./encrypt-INTTS7TI.js");
        return utils;
      } catch (error2) {
        return;
      }
    }
  };
  try {
    if ((((_a3 = adapter2 == null ? void 0 : adapter2.root) == null ? void 0 : _a3.globalThis) || globalThis).IS_MP_BUILD) {
      return;
    }
    if (!process.env.IS_MP_BUILD && isEncrypt) {
      return getUtils();
    }
  } catch (error) {
    if (isEncrypt) {
      return getUtils();
    }
  }
}
var Auth = class _Auth {
  static parseParamsToSearch(params) {
    Object.keys(params).forEach((key) => {
      if (!params[key]) {
        delete params[key];
      }
    });
    const searchParams = new urlSearchParams_default(params);
    return searchParams.toString();
  }
  constructor(opts) {
    let { request } = opts;
    let oAuth2Client = opts.credentialsClient;
    if (!oAuth2Client) {
      const initOptions = {
        apiOrigin: opts.apiOrigin,
        apiPath: opts.apiPath,
        clientId: opts.clientId,
        storage: opts.storage,
        env: opts.env,
        baseRequest: opts.baseRequest,
        anonymousSignInFunc: opts.anonymousSignInFunc,
        wxCloud: opts.wxCloud,
        onCredentialsError: opts.onCredentialsError,
        headers: opts.headers || {},
        i18n: opts.i18n,
        debug: opts.debug
      };
      oAuth2Client = new OAuth2Client(initOptions);
    }
    if (!request) {
      const baseRequest = oAuth2Client.request.bind(oAuth2Client);
      const captcha = new Captcha({
        env: opts.env,
        clientId: opts.clientId,
        request: baseRequest,
        storage: opts.storage,
        adapter: opts.adapter,
        oauthInstance: this,
        ...opts.captchaOptions
      });
      request = captcha.request.bind(captcha);
    }
    this.config = {
      env: opts.env,
      apiOrigin: opts.apiOrigin,
      apiPath: opts.apiPath,
      clientId: opts.clientId,
      request,
      credentialsClient: oAuth2Client,
      storage: opts.storage || defaultStorage,
      adapter: opts.adapter
    };
  }
  getParamsByVersion(params, key) {
    var _a3;
    const paramsTemp = deepClone(params);
    const url2 = ((_a3 = { v2: ApiUrlsV2 }[paramsTemp == null ? void 0 : paramsTemp.version]) == null ? void 0 : _a3[key]) || ApiUrls[key];
    if (paramsTemp) {
      delete paramsTemp.version;
    }
    return { params: paramsTemp, url: url2 };
  }
  async signIn(params) {
    const version3 = params.version || "v1";
    const res = this.getParamsByVersion(params, "AUTH_SIGN_IN_URL");
    if (res.params.query) {
      delete res.params.query;
    }
    const body = await this.getEncryptParams(res.params);
    const credentials = await this.config.request(res.url, {
      method: "POST",
      body
    });
    await this.config.credentialsClient.setCredentials({
      ...credentials,
      version: version3
    });
    return Promise.resolve(credentials);
  }
  async signInAnonymously(data2 = {}, useWxCloud = false) {
    const credentials = await this.config.request(ApiUrls.AUTH_SIGN_IN_ANONYMOUSLY_URL, {
      method: "POST",
      body: data2,
      useWxCloud
    });
    await this.config.credentialsClient.setCredentials(credentials);
    return Promise.resolve(credentials);
  }
  async signUp(params) {
    const data2 = await this.config.request(ApiUrls.AUTH_SIGN_UP_URL, {
      method: "POST",
      body: params
    });
    await this.config.credentialsClient.setCredentials(data2);
    return Promise.resolve(data2);
  }
  async signOut(params) {
    let resp = {};
    if (params) {
      try {
        resp = await this.config.request(ApiUrls.AUTH_SIGNOUT_URL, {
          method: "POST",
          withCredentials: true,
          body: params
        });
      } catch (err) {
        if (err.error !== ErrorType.UNAUTHENTICATED) {
          console.log("sign_out_error", err);
        }
      }
      await this.config.credentialsClient.setCredentials();
      return resp;
    }
    const accessToken = await this.config.credentialsClient.getAccessToken();
    const data2 = await this.config.request(ApiUrls.AUTH_REVOKE_URL, {
      method: "POST",
      body: {
        token: accessToken
      }
    });
    await this.config.credentialsClient.setCredentials();
    return Promise.resolve(data2);
  }
  async revokeAllDevices() {
    await this.config.request(ApiUrls.AUTH_REVOKE_ALL_URL, {
      method: "DELETE",
      withCredentials: true
    });
  }
  async revokeDevice(params) {
    await this.config.request(ApiUrls.AUTHORIZED_DEVICES_DELETE_URL + params.device_id, {
      method: "DELETE",
      withCredentials: true
    });
  }
  async getVerification(params, options) {
    let withCredentials = false;
    if (params.target === "CUR_USER") {
      withCredentials = true;
    } else {
      const hasLogin = await this.hasLoginState();
      if (hasLogin) {
        withCredentials = true;
      }
    }
    const body = deepClone(params);
    if (body.phone_number && !/^\+\d{1,3}\s+\d+/.test(body.phone_number)) {
      body.phone_number = `+86 ${body.phone_number}`;
    }
    return this.config.request(ApiUrls.VERIFICATION_URL, {
      method: "POST",
      body,
      withCaptcha: (options == null ? void 0 : options.withCaptcha) || false,
      withCredentials
    });
  }
  async verify(params) {
    const res = this.getParamsByVersion(params, "VERIFY_URL");
    const data2 = await this.config.request(res.url, {
      method: "POST",
      body: res.params
    });
    if ((params == null ? void 0 : params.version) === "v2") {
      await this.config.credentialsClient.setCredentials({
        ...data2,
        version: "v2"
      });
    }
    return data2;
  }
  async genProviderRedirectUri(params) {
    const { provider_redirect_uri: redirect_uri, other_params: otherParams = {}, ...restParams } = params;
    if (redirect_uri && !restParams.redirect_uri) {
      restParams.redirect_uri = redirect_uri;
    }
    let url2 = `${ApiUrls.PROVIDER_URI_URL}?${_Auth.parseParamsToSearch(restParams)}`;
    Object.keys(otherParams).forEach((key) => {
      const value = otherParams[key];
      if (key === "sign_out_uri" && !((value == null ? void 0 : value.length) > 0)) {
        return;
      }
      url2 += `&other_params[${key}]=${encodeURIComponent(value)}`;
    });
    return this.config.request(url2, {
      method: "GET"
    });
  }
  async grantProviderToken(params, useWxCloud = false) {
    return this.config.request(ApiUrls.PROVIDER_TOKEN_URL, {
      method: "POST",
      body: params,
      useWxCloud
    });
  }
  async patchProviderToken(params) {
    return this.config.request(ApiUrls.PROVIDER_TOKEN_URL, {
      method: "PATCH",
      body: params
    });
  }
  async signInWithProvider(params, useWxCloud = false) {
    const res = this.getParamsByVersion(params, "AUTH_SIGN_IN_WITH_PROVIDER_URL");
    const credentials = await this.config.request(res.url, {
      method: "POST",
      body: res.params,
      useWxCloud
    });
    await this.config.credentialsClient.setCredentials({
      ...credentials,
      version: (params == null ? void 0 : params.version) || "v1"
    });
    return Promise.resolve(credentials);
  }
  async toBindIdentity(params) {
    var _a3, _b;
    const credentials = params.credentials || await this.config.credentialsClient.localCredentials.getCredentials();
    let res;
    try {
      await this.bindWithProvider({
        provider_token: params.provider_token
      }, credentials);
      res = { data: { type: OAUTH_TYPE.BIND_IDENTITY, provider: params.provider }, error: null };
    } catch (error) {
      res = { data: { type: OAUTH_TYPE.BIND_IDENTITY }, error: new AuthError(error) };
    }
    if (params.fireEvent) {
      (_b = (_a3 = this.config.eventBus) == null ? void 0 : _a3.fire) == null ? void 0 : _b.call(_a3, EVENTS.AUTH_STATE_CHANGED, {
        event: AUTH_STATE_CHANGED_TYPE.BIND_IDENTITY,
        info: res
      });
    }
    return res;
  }
  async getInitialSession() {
    let data2 = {};
    try {
      if (typeof window === "undefined" || typeof document === "undefined") {
        return { data: null, error: null };
      }
      const localSearch = new URLSearchParams(location == null ? void 0 : location.search);
      const code2 = localSearch.get("code");
      const state = localSearch.get("state");
      if (!code2 || !state) {
        return { data: null, error: null };
      }
      let cacheData = null;
      try {
        cacheData = JSON.parse(sessionStorage.getItem(state) || "null");
      } catch {
      }
      data2 = { type: cacheData == null ? void 0 : cacheData.type };
      const errorParam = localSearch.get("error");
      const errorDescription = localSearch.get("error_description");
      if (errorParam || errorDescription) {
        return {
          data: data2,
          error: new AuthError({ message: errorDescription || errorParam || "Unknown error from OAuth provider" })
        };
      }
      const provider = (cacheData == null ? void 0 : cacheData.provider) || localSearch.get("provider");
      if (!provider) {
        return { data: data2, error: new AuthError({ message: "Provider is required for OAuth verification" }) };
      }
      const redirectUri = location.origin + location.pathname;
      const { provider_token: providerToken } = await this.grantProviderToken({
        provider_id: provider,
        provider_redirect_uri: redirectUri,
        provider_code: code2
      });
      let credentials;
      let user = null;
      let res;
      if (cacheData.type === OAUTH_TYPE.BIND_IDENTITY) {
        credentials = await this.config.credentialsClient.localCredentials.getCredentials();
        res = await this.toBindIdentity({ provider, provider_token: providerToken, credentials });
      } else if (cacheData.type === OAUTH_TYPE.SIGN_IN) {
        res = this.getParamsByVersion({ provider }, "AUTH_SIGN_IN_WITH_PROVIDER_URL");
        credentials = await this.config.request(res.url, {
          method: "POST",
          body: { provider_token: providerToken }
        });
        try {
          user = await this.getUserInfo({ credentials });
        } catch (e3) {
          console.error("get user info error", e3);
        }
        res = { data: { ...data2, session: credentials, user }, error: null };
      }
      localSearch.delete("code");
      localSearch.delete("state");
      localSearch.delete("provider");
      this.restoreUrlState((cacheData == null ? void 0 : cacheData.search) === void 0 ? `?${localSearch.toString()}` : cacheData.search, (cacheData == null ? void 0 : cacheData.hash) || location.hash);
      try {
        sessionStorage.removeItem(state);
      } catch {
      }
      return res;
    } catch (error) {
      return { data: data2, error: new AuthError(error) };
    }
  }
  async signInCustom(params) {
    const credentials = await this.config.request(ApiUrls.AUTH_SIGN_IN_CUSTOM, {
      method: "POST",
      body: params
    });
    await this.config.credentialsClient.setCredentials(credentials);
    return Promise.resolve(credentials);
  }
  async signInWithWechat(params = {}) {
    const credentials = await this.config.request(ApiUrls.AUTH_SIGN_IN_WITH_WECHAT_URL, {
      method: "POST",
      body: params
    });
    await this.config.credentialsClient.setCredentials(credentials);
    return Promise.resolve(credentials);
  }
  async bindWithProvider(params, credentials) {
    return this.config.request(ApiUrls.PROVIDER_BIND_URL, {
      method: "POST",
      body: params,
      withCredentials: true,
      getCredentials: credentials ? () => credentials : void 0
    });
  }
  async getUserProfile(params) {
    return this.getUserInfo(params);
  }
  async getUserInfo(params = {}) {
    var _a3;
    const res = this.getParamsByVersion(params, "USER_ME_URL");
    if ((_a3 = res.params) == null ? void 0 : _a3.query) {
      const searchParams = new urlSearchParams_default(res.params.query);
      res.url += `?${searchParams.toString()}`;
    }
    const userInfo = await this.config.request(res.url, {
      method: "GET",
      withCredentials: true,
      getCredentials: params.credentials ? () => params.credentials : void 0
    });
    if (userInfo.sub) {
      userInfo.uid = userInfo.sub;
    }
    return userInfo;
  }
  async getWedaUserInfo() {
    const userInfo = await this.config.request(ApiUrls.WEDA_USER_URL, {
      method: "GET",
      withCredentials: true
    });
    return userInfo;
  }
  async deleteMe(params) {
    const res = this.getParamsByVersion(params, "USER_ME_URL");
    const url2 = `${res.url}?${_Auth.parseParamsToSearch(res.params)}`;
    return this.config.request(url2, {
      method: "DELETE",
      withCredentials: true
    });
  }
  async hasLoginState() {
    try {
      await this.config.credentialsClient.getAccessToken();
      return true;
    } catch (error) {
      return false;
    }
  }
  hasLoginStateSync() {
    const credentials = this.config.credentialsClient.getCredentialsSync();
    return credentials;
  }
  async getLoginState() {
    return this.config.credentialsClient.getCredentialsAsync();
  }
  async transByProvider(params) {
    return this.config.request(ApiUrls.USER_TRANS_BY_PROVIDER_URL, {
      method: "PATCH",
      body: params,
      withCredentials: true
    });
  }
  async grantToken(params) {
    const res = this.getParamsByVersion(params, "AUTH_TOKEN_URL");
    return this.config.request(res.url, {
      method: "POST",
      body: res.params
    });
  }
  async getProviders() {
    return this.config.request(ApiUrls.PROVIDER_LIST, {
      method: "GET",
      withCredentials: true
    });
  }
  async unbindProvider(params) {
    return this.config.request(`${ApiUrls.PROVIDER_UNBIND_URL}/${params.provider_id}`, {
      method: "DELETE",
      withCredentials: true
    });
  }
  async checkPassword(params) {
    return this.config.request(`${ApiUrls.CHECK_PWD_URL}`, {
      method: "POST",
      withCredentials: true,
      body: params
    });
  }
  async editContact(params) {
    return this.config.request(`${ApiUrls.BIND_CONTACT_URL}`, {
      method: "PATCH",
      withCredentials: true,
      body: params
    });
  }
  async setPassword(params) {
    return this.config.request(`${ApiUrls.AUTH_SET_PASSWORD}`, {
      method: "PATCH",
      withCredentials: true,
      body: params
    });
  }
  async updatePasswordByOld(params) {
    const sudoToken = await this.sudo({ password: params.old_password });
    return this.setPassword({
      sudo_token: sudoToken.sudo_token,
      new_password: params.new_password
    });
  }
  async sudo(params) {
    return this.config.request(`${ApiUrls.SUDO_URL}`, {
      method: "POST",
      withCredentials: true,
      body: params
    });
  }
  async sendVerificationCodeToCurrentUser(params) {
    params.target = "CUR_USER";
    return this.config.request(ApiUrls.VERIFICATION_URL, {
      method: "POST",
      body: params,
      withCredentials: true,
      withCaptcha: true
    });
  }
  async changeBoundProvider(params) {
    return this.config.request(`${ApiUrls.PROVIDER_LIST}/${params.provider_id}/trans`, {
      method: "POST",
      body: {
        provider_trans_token: params.trans_token
      },
      withCredentials: true
    });
  }
  async setUserProfile(params) {
    return this.config.request(ApiUrls.USER_PRIFILE_URL, {
      method: "PATCH",
      body: params,
      withCredentials: true
    });
  }
  async updateUserBasicInfo(params) {
    return this.config.request(ApiUrls.USER_BASIC_EDIT_URL, {
      method: "POST",
      withCredentials: true,
      body: params
    });
  }
  async queryUserProfile(params) {
    const searchParams = new urlSearchParams_default(params);
    return this.config.request(`${ApiUrls.USER_QUERY_URL}?${searchParams.toString()}`, {
      method: "GET",
      withCredentials: true
    });
  }
  setCustomSignFunc(getTickFn) {
    this.getCustomSignTicketFn = getTickFn;
  }
  async signInWithCustomTicket() {
    const customSignTicketFn = this.getCustomSignTicketFn;
    if (!customSignTicketFn) {
      return Promise.reject({
        error: "failed_precondition",
        error_description: "please use setCustomSignFunc to set custom sign function"
      });
    }
    const customTicket = await customSignTicketFn();
    return this.signInCustom({
      provider_id: "custom",
      ticket: customTicket
    });
  }
  async resetPassword(params) {
    return this.config.request(ApiUrls.AUTH_RESET_PASSWORD, {
      method: "POST",
      body: params
    });
  }
  async authorize(params) {
    return this.config.request(ApiUrls.AUTHORIZE_URL, {
      method: "POST",
      withCredentials: true,
      body: params
    });
  }
  async authorizeDevice(params) {
    return this.config.request(ApiUrls.AUTHORIZE_DEVICE_URL, {
      method: "POST",
      withCredentials: true,
      body: params
    });
  }
  async deviceAuthorize(params) {
    return this.config.request(ApiUrls.AUTH_GET_DEVICE_CODE, {
      method: "POST",
      body: params,
      withCredentials: true
    });
  }
  async authorizeInfo(params) {
    const url2 = `${ApiUrls.AUTHORIZE_INFO_URL}?${_Auth.parseParamsToSearch(params)}`;
    let withBasicAuth = true;
    let withCredentials = false;
    const hasLogin = await this.hasLoginState();
    if (hasLogin) {
      withCredentials = true;
      withBasicAuth = false;
    }
    return this.config.request(url2, {
      method: "GET",
      withBasicAuth,
      withCredentials
    });
  }
  async checkUsername(params) {
    return this.config.request(ApiUrls.CHECK_USERNAME, {
      method: "GET",
      body: params,
      withCredentials: true
    });
  }
  async checkIfUserExist(params) {
    const searchParams = new urlSearchParams_default(params);
    return this.config.request(`${ApiUrls.CHECK_IF_USER_EXIST}?${searchParams.toString()}`, {
      method: "GET"
    });
  }
  async loginScope() {
    return this.config.credentialsClient.getScope();
  }
  async loginGroups() {
    return this.config.credentialsClient.getGroups();
  }
  async refreshTokenForce(params) {
    const credentials = await this.config.credentialsClient.getCredentials();
    return await this.config.credentialsClient.refreshToken({
      ...credentials,
      version: (params == null ? void 0 : params.version) || "v1"
    });
  }
  async getCredentials() {
    return this.config.credentialsClient.getCredentials();
  }
  async getPublicKey() {
    return this.config.request(ApiUrlsV2.AUTH_PUBLIC_KEY, {
      method: "POST",
      body: {}
    });
  }
  async getEncryptParams(params) {
    const { isEncrypt } = params;
    delete params.isEncrypt;
    const payload = deepClone(params);
    const encryptUtils = await getEncryptUtils(isEncrypt, this.config.adapter);
    if (!encryptUtils) {
      return params;
    }
    let publicKey = "";
    let public_key_thumbprint = "";
    try {
      const res = await this.getPublicKey();
      publicKey = res.public_key;
      public_key_thumbprint = res.public_key_thumbprint;
      if (!publicKey || !public_key_thumbprint) {
        throw res;
      }
    } catch (error) {
      throw error;
    }
    return {
      params: encryptUtils.getEncryptInfo({ publicKey, payload }),
      public_key_thumbprint
    };
  }
  async getProviderSubType() {
    return this.config.request(ApiUrls.GET_PROVIDER_TYPE, {
      method: "POST",
      body: {
        provider_id: "weda"
      }
    });
  }
  async verifyCaptchaData({ token, key }) {
    return this.config.request(ApiUrls.VERIFY_CAPTCHA_DATA_URL, {
      method: "POST",
      body: { token, key },
      withCredentials: false
    });
  }
  async createCaptchaData({ state, redirect_uri = void 0 }) {
    return this.config.request(ApiUrls.CAPTCHA_DATA_URL, {
      method: "POST",
      body: { state, redirect_uri },
      withCredentials: false
    });
  }
  async getMiniProgramCode(params) {
    return this.config.request(ApiUrls.GET_MINIPROGRAM_QRCODE, {
      method: "POST",
      body: params
    });
  }
  async getMiniProgramQrCodeStatus(params) {
    return this.config.request(ApiUrls.GET_MINIPROGRAM_QRCODE_STATUS, {
      method: "POST",
      body: params
    });
  }
  async getUserBehaviorLog(params) {
    const action = { LOGIN: "query[action]=USER_LOGIN", MODIFY: "ne_query[action]=USER_LOGIN" };
    const url2 = `${ApiUrls.GET_USER_BEHAVIOR_LOG}?${action[params.type]}&limit=${params.limit}${params.page_token ? `&page_token=${params.page_token}` : ""}`;
    return this.config.request(url2, {
      method: "GET",
      withCredentials: true
    });
  }
  async modifyPassword(params) {
    let publicKey = "";
    let public_key_thumbprint = "";
    const encryptUtils = await getEncryptUtils(true, this.config.adapter);
    if (!encryptUtils) {
      throw new Error("do not support encrypt, a encrypt util required.");
    }
    try {
      const res = await this.getPublicKey();
      publicKey = res.public_key;
      public_key_thumbprint = res.public_key_thumbprint;
      if (!publicKey || !public_key_thumbprint) {
        throw res;
      }
    } catch (error) {
      throw error;
    }
    const encrypt_password = params.password ? encryptUtils.getEncryptInfo({ publicKey, payload: params.password }) : "";
    const encrypt_new_password = encryptUtils.getEncryptInfo({ publicKey, payload: params.new_password });
    return this.config.request(ApiUrls.USER_BASIC_EDIT_URL, {
      method: "POST",
      withCredentials: true,
      body: {
        user_id: params.user_id,
        encrypt_password,
        encrypt_new_password,
        public_key_thumbprint
      }
    });
  }
  async modifyPasswordWithoutLogin(params) {
    let publicKey = "";
    let public_key_thumbprint = "";
    const encryptUtils = await getEncryptUtils(true, this.config.adapter);
    if (!encryptUtils) {
      throw new Error("do not support encrypt, a encrypt util required.");
    }
    try {
      const res = await this.getPublicKey();
      publicKey = res.public_key;
      public_key_thumbprint = res.public_key_thumbprint;
      if (!publicKey || !public_key_thumbprint) {
        throw res;
      }
    } catch (error) {
      throw error;
    }
    const encrypt_password = params.password ? encryptUtils.getEncryptInfo({ publicKey, payload: params.password }) : "";
    const encrypt_new_password = encryptUtils.getEncryptInfo({ publicKey, payload: params.new_password });
    return this.config.request(ApiUrlsV2.AUTH_RESET_PASSWORD, {
      method: "POST",
      body: {
        username: params.username,
        password: encrypt_password,
        new_password: encrypt_new_password,
        public_key_thumbprint
      }
    });
  }
  restoreUrlState(search, hash) {
    if (search === void 0)
      return;
    try {
      const url2 = new URL(window.location.href);
      url2.search = search;
      url2.hash = hash || "";
      window.history.replaceState(null, "", url2.toString());
    } catch {
    }
  }
};

// node_modules/@cloudbase/oauth/dist/esm/auth/auth-error.js
var AuthError = class extends Error {
  constructor(error) {
    super(error.error_description || error.message);
    this.__isAuthError = true;
    this.name = "AuthError";
    this.status = error.error;
    this.code = error.error_code;
  }
};

// node_modules/@cloudbase/oauth/dist/esm/index.js
var CloudbaseOAuth = class {
  constructor(authOptions) {
    const { apiOrigin, apiPath = AUTH_API_PREFIX, clientId, env, storage: storage2, request, baseRequest, anonymousSignInFunc, wxCloud, adapter: adapter2, onCredentialsError: onCredentialsError2, headers, i18n, useWxCloud, eventBus: eventBus2, detectSessionInUrl, debug } = authOptions;
    this.detectSessionInUrl = detectSessionInUrl ?? false;
    this.oauth2client = new OAuth2Client({
      apiOrigin,
      apiPath,
      clientId,
      env,
      storage: storage2,
      baseRequest: baseRequest || request,
      anonymousSignInFunc,
      wxCloud,
      onCredentialsError: onCredentialsError2,
      headers: headers || {},
      i18n,
      useWxCloud,
      eventBus: eventBus2,
      debug
    });
    this.authApi = new Auth({
      credentialsClient: this.oauth2client,
      ...authOptions,
      request: request ? this.oauth2client.request.bind(this.oauth2client) : void 0,
      adapter: adapter2
    });
    if (detectSessionInUrl) {
      this.oauth2client.setGetInitialSession(this.authApi.getInitialSession.bind(this.authApi));
    }
  }
  initializeSession(onUserObtained) {
    if (!this.detectSessionInUrl) {
      this.oauth2client.initialize(Promise.resolve({ error: null }));
      return;
    }
    this.oauth2client.setOnInitialSessionObtained(onUserObtained);
    this.oauth2client.initialize();
  }
};

// node_modules/@cloudbase/auth/dist/esm/utilities.js
var import_util7 = __toESM(require_util());
var import_constants4 = __toESM(require_constants());
var import_helpers = __toESM(require_helpers());
var import_events3 = __toESM(require_events());
var import_cache3 = __toESM(require_cache());
var import_adapters = __toESM(require_adapters());

// node_modules/@cloudbase/auth/dist/esm/adapter.js
var __assign9 = function() {
  __assign9 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign9.apply(this, arguments);
};
var __awaiter7 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator7 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var OauthClientStorageBase = function() {
  function OauthClientStorageBase2(config) {
    var _a3, _b;
    try {
      this.localStorage = (config === null || config === void 0 ? void 0 : config.localStorage) || (((_b = (_a3 = config === null || config === void 0 ? void 0 : config.adapter) === null || _a3 === void 0 ? void 0 : _a3.root) === null || _b === void 0 ? void 0 : _b.globalThis) || globalThis).localStorage;
    } catch (error) {
      this.localStorage = (config === null || config === void 0 ? void 0 : config.localStorage) || {};
    }
  }
  OauthClientStorageBase2.prototype.getItem = function(key) {
    return __awaiter7(this, void 0, void 0, function() {
      return __generator7(this, function(_a3) {
        return [2, this.localStorage.getItem(key)];
      });
    });
  };
  OauthClientStorageBase2.prototype.removeItem = function(key) {
    return __awaiter7(this, void 0, void 0, function() {
      return __generator7(this, function(_a3) {
        this.localStorage.removeItem(key);
        return [2];
      });
    });
  };
  OauthClientStorageBase2.prototype.setItem = function(key, value) {
    return __awaiter7(this, void 0, void 0, function() {
      return __generator7(this, function(_a3) {
        this.localStorage.setItem(key, value);
        return [2];
      });
    });
  };
  OauthClientStorageBase2.prototype.getItemSync = function(key) {
    return this.localStorage.getItem(key);
  };
  OauthClientStorageBase2.prototype.setItemSync = function(key, value) {
    this.localStorage.setItem(key, value);
  };
  OauthClientStorageBase2.prototype.removeItemSync = function(key) {
    this.localStorage.removeItem(key);
  };
  return OauthClientStorageBase2;
}();
var URL_REG = /^[^:]+:\/\/[^/]+(\/[^?#]+)/;
var dealAdapterRequestData = function(res, options) {
  var _a3, _b, _c;
  var requestId = (_a3 = options === null || options === void 0 ? void 0 : options.headers) === null || _a3 === void 0 ? void 0 : _a3["x-request-id"];
  if (!res) {
    res = {};
  }
  if ((res === null || res === void 0 ? void 0 : res.code) || ((_b = res === null || res === void 0 ? void 0 : res.data) === null || _b === void 0 ? void 0 : _b.error_code)) {
    res = {
      error: res.code || res.data.error,
      error_description: res.data.error_description || res.message || res.code || res.data.error_code,
      request_id: res.requestId,
      error_code: (_c = res.data) === null || _c === void 0 ? void 0 : _c.error_code
    };
  }
  if (!(res === null || res === void 0 ? void 0 : res.request_id)) {
    res.request_id = res.request_id || requestId;
  }
  if (res === null || res === void 0 ? void 0 : res.error) {
    res.error_uri = getUrlPath(options === null || options === void 0 ? void 0 : options.url);
    return res;
  }
  return (res === null || res === void 0 ? void 0 : res.data) || {};
};
function generateOauthClientRequest(reqClass) {
  return function(url2, options) {
    return __awaiter7(this, void 0, void 0, function() {
      return __generator7(this, function(_a3) {
        return [2, new Promise(function(resolve, reject) {
          var copyOptions = Object.assign({}, options);
          if (copyOptions.body && typeof copyOptions.body !== "string") {
            copyOptions.body = JSON.stringify(copyOptions.body);
          }
          var task = wx.request({
            url: url2,
            data: copyOptions.body,
            timeout: reqClass._timeout,
            method: copyOptions.method || "GET",
            header: copyOptions.headers,
            success: function(res) {
              res = dealAdapterRequestData(res, __assign9(__assign9({}, options), { url: url2 }));
              if (res.error) {
                reject(res);
              }
              resolve(res);
            },
            fail: function(err) {
              reject({
                error: "unreachable",
                error_description: err.message
              });
            },
            complete: function(err) {
              if (!err || !err.errMsg) {
                return;
              }
              if (!reqClass._timeout || reqClass._restrictedMethods.indexOf("request") === -1) {
                return;
              }
              var errMsg = err.errMsg;
              if (errMsg === "request:fail timeout") {
                console.warn(reqClass._timeoutMsg);
                try {
                  task.abort();
                } catch (e3) {
                }
              }
            }
          });
        })];
      });
    });
  };
}
function getUrlPath(url2) {
  return URL_REG.test(url2) ? RegExp.$1 : url2;
}
var dealUserAdapter = function(config, adapter2) {
  var data2 = __assign9({}, config);
  try {
    if (!(config === null || config === void 0 ? void 0 : config.storage) && (adapter2 === null || adapter2 === void 0 ? void 0 : adapter2.localStorage)) {
      data2.storage = new OauthClientStorageBase({ localStorage: adapter2.localStorage, adapter: adapter2 });
    }
    if (!config.captchaOptions && (adapter2 === null || adapter2 === void 0 ? void 0 : adapter2.captchaOptions)) {
      data2.captchaOptions = adapter2.captchaOptions;
    }
    if (!config.baseRequest && !config.request && (adapter2 === null || adapter2 === void 0 ? void 0 : adapter2.reqClass)) {
      var reqClassParams = {
        timeout: 1e4,
        restrictedMethods: ["get", "post", "upload", "download", "request"]
      };
      var adapterReq_1 = new adapter2.reqClass(reqClassParams);
      data2.baseRequest = function(url2, options) {
        var _a3, _b, _c, _d, _e2;
        return __awaiter7(this, void 0, void 0, function() {
          var res, requestType, func, error_1;
          return __generator7(this, function(_f) {
            switch (_f.label) {
              case 0:
                res = {};
                requestType = ((_a3 = options.method) === null || _a3 === void 0 ? void 0 : _a3.toLocaleLowerCase()) || "post";
                func = (_c = (_b = adapterReq_1 === null || adapterReq_1 === void 0 ? void 0 : adapterReq_1[requestType]) === null || _b === void 0 ? void 0 : _b.bind) === null || _c === void 0 ? void 0 : _c.call(_b, adapterReq_1);
                if (typeof func !== "function") {
                  throw new Error("invalid ".concat(requestType, " request method"));
                }
                _f.label = 1;
              case 1:
                _f.trys.push([1, 3, , 4]);
                if ((!((_d = options.headers) === null || _d === void 0 ? void 0 : _d["content-type"]) || ((_e2 = options.headers) === null || _e2 === void 0 ? void 0 : _e2["content-type"].includes("application/json"))) && !["string", "undefined"].includes(typeof options.body)) {
                  options.data = options.data || options.body;
                  options.body = JSON.stringify(options.body);
                }
                return [4, func(__assign9({ url: url2 }, options))];
              case 2:
                res = _f.sent();
                res = dealAdapterRequestData(res, __assign9(__assign9({}, options), { url: url2 }));
                return [3, 4];
              case 3:
                error_1 = _f.sent();
                res = __assign9(__assign9({}, error_1 === null || error_1 === void 0 ? void 0 : error_1.data), error_1);
                throw res;
              case 4:
                if (res === null || res === void 0 ? void 0 : res.error) {
                  throw res;
                }
                return [2, res];
            }
          });
        });
      };
    }
  } catch (e3) {
    console.error("user adapter generate fail:", e3);
  }
  return data2;
};
var dealAuthAdapter = function(config, adapter2) {
  var data2 = __assign9({}, config);
  var authOptions = {};
  if (adapter2 === null || adapter2 === void 0 ? void 0 : adapter2.captchaOptions) {
    data2.captchaOptions = adapter2.captchaOptions;
  }
  if (!esm_default.isMatch() || config.storage && config.baseRequest)
    return data2;
  try {
    var _a3 = esm_default.genAdapter({}), localStorage_1 = _a3.localStorage, ReqClass = _a3.reqClass;
    if (localStorage_1) {
      authOptions.storage = new OauthClientStorageBase({ localStorage: localStorage_1, adapter: adapter2 });
    }
    if (ReqClass) {
      var reqClass = new ReqClass({
        timeout: 1e4,
        restrictedMethods: ["get", "post", "upload", "download", "request"]
      });
      authOptions.request = generateOauthClientRequest(reqClass);
    }
    if (data2.captchaOptions) {
      authOptions.baseRequest = authOptions.request;
      authOptions.request = void 0;
    }
    return __assign9(__assign9({}, data2), authOptions);
  } catch (e3) {
    console.error("adapter generate fail:", e3);
  }
  return data2;
};
var useAuthAdapter = function(config) {
  if (config.adapter && config.adapter.type !== "default") {
    return dealUserAdapter(config, config.adapter);
  }
  return dealAuthAdapter(config, config.adapter);
};

// node_modules/@cloudbase/auth/dist/esm/utils.js
function saveToBrowserSession(key, value) {
  try {
    sessionStorage.setItem(key, JSON.stringify(value));
  } catch (error) {
    console.error("Failed to save to browser session:", error);
  }
}
function getBrowserSession(key) {
  try {
    var data2 = JSON.parse(sessionStorage.getItem(key));
    return data2;
  } catch (error) {
    console.error("Failed to get browser session:", error);
    return null;
  }
}
function removeBrowserSession(key) {
  try {
    sessionStorage.removeItem(key);
    return true;
  } catch (error) {
    console.error("Failed to remove browser session:", error);
    return null;
  }
}
function addUrlSearch(search, hash) {
  if (search === void 0)
    return;
  var url2 = new URL(window.location.href);
  url2.search = search;
  url2.hash = hash || url2.hash;
  window.history.replaceState({}, "", url2.href);
}

// node_modules/@cloudbase/auth/dist/esm/sbaseApi.js
var __assign10 = function() {
  __assign10 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign10.apply(this, arguments);
};
var __awaiter8 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator8 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var __rest5 = function(s2, e3) {
  var t3 = {};
  for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e3.indexOf(p2) < 0)
    t3[p2] = s2[p2];
  if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
      if (e3.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
        t3[p2[i2]] = s2[p2[i2]];
    }
  return t3;
};
var isBrowser = function() {
  return typeof window !== "undefined" && typeof document !== "undefined";
};
var SbaseApi = function() {
  function SbaseApi2(config) {
    this.listeners = /* @__PURE__ */ new Map();
    this.hasListenerSetUp = false;
    this.config = config;
    this.oauthInstance = config.oauthInstance;
    this.cache = config.cache;
    this.init();
  }
  Object.defineProperty(SbaseApi2.prototype, "currentUser", {
    get: function() {
      var loginState = this.hasLoginState();
      if (loginState) {
        return loginState.user || null;
      }
      return null;
    },
    enumerable: false,
    configurable: true
  });
  SbaseApi2.prototype.hasLoginState = function() {
    throw new Error("Auth.hasLoginState() is not implemented");
  };
  SbaseApi2.prototype.setAccessKey = function() {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.setAccessKey() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.signIn = function(_params) {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.signIn() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.signInWithProvider = function(_params) {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.signInWithProvider() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.genProviderRedirectUri = function(_params) {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.genProviderRedirectUri() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.getAccessToken = function() {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.getAccessToken() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.getUserInfo = function() {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.getUserInfo() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.updateUserBasicInfo = function(_params) {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.updateUserBasicInfo() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.setCustomSignFunc = function(_getTickFn) {
    throw new Error("Auth.setCustomSignFunc() is not implemented");
  };
  SbaseApi2.prototype.grantProviderToken = function(_params) {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.grantProviderToken() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.bindWithProvider = function(_params) {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.bindWithProvider() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.signInWithUsername = function(_params) {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.signInWithUsername() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.getVerification = function(_params, _options) {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.getVerification() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.createLoginState = function(_params, _options) {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.createLoginState() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.verify = function(_params) {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        throw new Error("Auth.verify() is not implemented");
      });
    });
  };
  SbaseApi2.prototype.signInAnonymously = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var loginState, _a3, _b, session, error_1;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            _c.trys.push([0, 4, , 5]);
            return [4, this.oauthInstance.authApi.signInAnonymously(params)];
          case 1:
            _c.sent();
            return [4, this.createLoginState()];
          case 2:
            loginState = _c.sent();
            return [4, this.getSession()];
          case 3:
            _a3 = _c.sent().data, _b = _a3 === void 0 ? {} : _a3, session = _b.session;
            return [2, __assign10(__assign10({}, loginState), { data: { user: session.user, session }, error: null })];
          case 4:
            error_1 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_1) }];
          case 5:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.signUp = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var verificationInfo_1, error_2;
      var _this = this;
      return __generator8(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            if (!(params.phone_number || params.verification_code || params.verification_token || params.provider_token)) return [3, 2];
            return [4, this.oauthInstance.authApi.signUp(params)];
          case 1:
            _a3.sent();
            return [2, this.createLoginState()];
          case 2:
            _a3.trys.push([2, 4, , 5]);
            this.validateAtLeastOne(params, [["email"], ["phone"]], "You must provide either an email or phone number");
            return [4, this.getVerification(params.email ? { email: params.email } : { phone_number: this.formatPhone(params.phone) })];
          case 3:
            verificationInfo_1 = _a3.sent();
            return [2, {
              data: {
                verifyOtp: function(_a4) {
                  var token = _a4.token, _b = _a4.messageId, messageId = _b === void 0 ? verificationInfo_1.verification_id : _b;
                  return __awaiter8(_this, void 0, void 0, function() {
                    var verificationTokenRes, data2, _c, _d, session, error_3;
                    return __generator8(this, function(_e2) {
                      switch (_e2.label) {
                        case 0:
                          _e2.trys.push([0, 8, , 9]);
                          return [4, this.verify({
                            verification_id: messageId || verificationInfo_1.verification_id,
                            verification_code: token
                          })];
                        case 1:
                          verificationTokenRes = _e2.sent();
                          if (!verificationInfo_1.is_user) return [3, 3];
                          return [4, this.signIn({
                            username: params.email || this.formatPhone(params.phone),
                            verification_token: verificationTokenRes.verification_token
                          })];
                        case 2:
                          _e2.sent();
                          return [3, 6];
                        case 3:
                          data2 = JSON.parse(JSON.stringify(params));
                          delete data2.email;
                          delete data2.phone;
                          return [4, this.oauthInstance.authApi.signUp(__assign10(__assign10(__assign10({}, data2), params.email ? { email: params.email } : { phone_number: this.formatPhone(params.phone) }), { verification_token: verificationTokenRes.verification_token, verification_code: token }))];
                        case 4:
                          _e2.sent();
                          return [4, this.createLoginState()];
                        case 5:
                          _e2.sent();
                          _e2.label = 6;
                        case 6:
                          return [4, this.getSession()];
                        case 7:
                          _c = _e2.sent().data, _d = _c === void 0 ? {} : _c, session = _d.session;
                          return [2, { data: { user: session.user, session }, error: null }];
                        case 8:
                          error_3 = _e2.sent();
                          return [2, { data: {}, error: new AuthError(error_3) }];
                        case 9:
                          return [2];
                      }
                    });
                  });
                }
              },
              error: null
            }];
          case 4:
            error_2 = _a3.sent();
            return [2, { data: {}, error: new AuthError(error_2) }];
          case 5:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.signOut = function(params) {
    var _a3, _b;
    return __awaiter8(this, void 0, void 0, function() {
      var userInfoKey, res, error_4;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            _c.trys.push([0, 3, , 4]);
            userInfoKey = this.cache.keys.userInfoKey;
            return [4, this.oauthInstance.authApi.signOut(params)];
          case 1:
            res = _c.sent();
            return [4, this.cache.removeStoreAsync(userInfoKey)];
          case 2:
            _c.sent();
            this.setAccessKey();
            (_a3 = this.config.eventBus) === null || _a3 === void 0 ? void 0 : _a3.fire(EVENTS.LOGIN_STATE_CHANGED, { eventType: LOGIN_STATE_CHANGED_TYPE.SIGN_OUT });
            (_b = this.config.eventBus) === null || _b === void 0 ? void 0 : _b.fire(EVENTS.AUTH_STATE_CHANGED, { event: AUTH_STATE_CHANGED_TYPE.SIGNED_OUT });
            return [2, __assign10(__assign10({}, res), { data: {}, error: null })];
          case 3:
            error_4 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_4) }];
          case 4:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.onAuthStateChange = function(callback) {
    var _this = this;
    if (!this.hasListenerSetUp) {
      this.setupListeners();
      this.hasListenerSetUp = true;
    }
    var id2 = Math.random().toString(36);
    if (!this.listeners.has(id2)) {
      this.listeners.set(id2, /* @__PURE__ */ new Set());
    }
    this.listeners.get(id2).add(callback);
    var subscription = {
      id: id2,
      callback,
      unsubscribe: function() {
        var callbacks = _this.listeners.get(id2);
        if (callbacks) {
          callbacks.delete(callback);
          if (callbacks.size === 0) {
            _this.listeners.delete(id2);
          }
        }
      }
    };
    return {
      data: { subscription }
    };
  };
  SbaseApi2.prototype.signInWithPassword = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var _a3, _b, session, error_5;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            _c.trys.push([0, 3, , 4]);
            this.validateAtLeastOne(params, [["username"], ["email"], ["phone"]], "You must provide either username, email, or phone");
            this.validateParams(params, {
              password: { required: true, message: "Password is required" }
            });
            return [4, this.signIn(__assign10({ username: params.username || params.email || this.formatPhone(params.phone), password: params.password }, params.is_encrypt ? { isEncrypt: true, version: "v2" } : {}))];
          case 1:
            _c.sent();
            return [4, this.getSession()];
          case 2:
            _a3 = _c.sent().data, _b = _a3 === void 0 ? {} : _a3, session = _b.session;
            return [2, { data: { user: session.user, session }, error: null }];
          case 3:
            error_5 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_5) }];
          case 4:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.signInWithIdToken = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var _a3, _b, session, error_6;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            _c.trys.push([0, 3, , 4]);
            this.validateParams(params, {
              token: { required: true, message: "Token is required" }
            });
            return [4, this.signInWithProvider({
              provider_token: params.token
            })];
          case 1:
            _c.sent();
            return [4, this.getSession()];
          case 2:
            _a3 = _c.sent().data, _b = _a3 === void 0 ? {} : _a3, session = _b.session;
            return [2, { data: { user: session.user, session }, error: null }];
          case 3:
            error_6 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_6) }];
          case 4:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.signInWithOtp = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var verificationInfo_2, error_7;
      var _this = this;
      return __generator8(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            this.validateAtLeastOne(params, [["email"], ["phone"]], "You must provide either an email or phone number");
            return [4, this.getVerification(params.email ? { email: params.email } : { phone_number: this.formatPhone(params.phone) })];
          case 1:
            verificationInfo_2 = _a3.sent();
            return [2, {
              data: {
                user: null,
                session: null,
                verifyOtp: function(_a4) {
                  var token = _a4.token, _b = _a4.messageId, messageId = _b === void 0 ? verificationInfo_2.verification_id : _b;
                  return __awaiter8(_this, void 0, void 0, function() {
                    return __generator8(this, function(_c) {
                      return [2, this.verifyOtp({
                        email: params.email,
                        phone: params.phone,
                        token,
                        messageId
                      })];
                    });
                  });
                }
              },
              error: null
            }];
          case 2:
            error_7 = _a3.sent();
            return [2, { data: {}, error: new AuthError(error_7) }];
          case 3:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.verifyOAuth = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var data2, code2, state, cacheData, provider, token, res, localSearch, error_8;
      return __generator8(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            data2 = {};
            _a3.label = 1;
          case 1:
            _a3.trys.push([1, 7, , 8]);
            code2 = (params === null || params === void 0 ? void 0 : params.code) || util_exports.getQuery("code");
            state = (params === null || params === void 0 ? void 0 : params.state) || util_exports.getQuery("state");
            if (!code2) {
              return [2, { data: {}, error: new AuthError({ message: "Code is required" }) }];
            }
            if (!state) {
              return [2, { data: {}, error: new AuthError({ message: "State is required" }) }];
            }
            cacheData = getBrowserSession(state);
            data2.type = cacheData === null || cacheData === void 0 ? void 0 : cacheData.type;
            provider = (params === null || params === void 0 ? void 0 : params.provider) || (cacheData === null || cacheData === void 0 ? void 0 : cacheData.provider) || util_exports.getQuery("provider");
            if (!provider) {
              return [2, { data: data2, error: new AuthError({ message: "Provider is required" }) }];
            }
            return [4, this.grantProviderToken({
              provider_id: provider,
              provider_redirect_uri: location.origin + location.pathname,
              provider_code: code2
            })];
          case 2:
            token = _a3.sent().provider_token;
            res = void 0;
            if (!(cacheData.type === OAUTH_TYPE.BIND_IDENTITY)) return [3, 4];
            return [4, this.oauthInstance.authApi.toBindIdentity({ provider_token: token, provider, fireEvent: true })];
          case 3:
            res = _a3.sent();
            return [3, 6];
          case 4:
            return [4, this.signInWithIdToken({
              token
            })];
          case 5:
            res = _a3.sent();
            res.data = __assign10(__assign10({}, data2), res.data);
            _a3.label = 6;
          case 6:
            localSearch = new URLSearchParams(location === null || location === void 0 ? void 0 : location.search);
            localSearch.delete("code");
            localSearch.delete("state");
            addUrlSearch((cacheData === null || cacheData === void 0 ? void 0 : cacheData.search) === void 0 ? "?".concat(localSearch.toString()) : cacheData === null || cacheData === void 0 ? void 0 : cacheData.search, (cacheData === null || cacheData === void 0 ? void 0 : cacheData.hash) || location.hash);
            removeBrowserSession(state);
            return [2, res];
          case 7:
            error_8 = _a3.sent();
            return [2, { data: data2, error: new AuthError(error_8) }];
          case 8:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.signInWithOAuth = function(params) {
    var _a3, _b, _c, _d, _e2;
    return __awaiter8(this, void 0, void 0, function() {
      var href, urlObject, provider_redirect_uri, state, uri, decodedUri, finalUri, url_1, error_9;
      return __generator8(this, function(_f) {
        switch (_f.label) {
          case 0:
            _f.trys.push([0, 2, , 3]);
            this.validateParams(params, {
              provider: { required: true, message: "Provider is required" }
            });
            href = ((_a3 = params.options) === null || _a3 === void 0 ? void 0 : _a3.redirectTo) || location.href;
            urlObject = new URL(href);
            provider_redirect_uri = urlObject.origin + urlObject.pathname;
            state = ((_b = params.options) === null || _b === void 0 ? void 0 : _b.state) || "prd-".concat(params.provider, "-").concat(Math.random().toString(36).slice(2));
            return [4, this.genProviderRedirectUri({
              provider_id: params.provider,
              provider_redirect_uri,
              state
            })];
          case 1:
            uri = _f.sent().uri;
            decodedUri = decodeURIComponent(uri);
            finalUri = decodedUri;
            if ((_c = params.options) === null || _c === void 0 ? void 0 : _c.queryParams) {
              url_1 = new URL(decodedUri);
              Object.entries(params.options.queryParams).forEach(function(_a4) {
                var key = _a4[0], value = _a4[1];
                url_1.searchParams.set(key, value);
              });
              finalUri = url_1.toString();
            }
            saveToBrowserSession(state, {
              provider: params.provider,
              search: urlObject.search,
              hash: urlObject.hash,
              type: ((_d = params.options) === null || _d === void 0 ? void 0 : _d.type) || OAUTH_TYPE.SIGN_IN
            });
            if (isBrowser() && !((_e2 = params.options) === null || _e2 === void 0 ? void 0 : _e2.skipBrowserRedirect)) {
              window.location.assign(finalUri);
            }
            return [2, { data: { url: finalUri, provider: params.provider }, error: null }];
          case 2:
            error_9 = _f.sent();
            return [2, { data: {}, error: new AuthError(error_9) }];
          case 3:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.signInWithSSO = function() {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        return [2];
      });
    });
  };
  SbaseApi2.prototype.signInWithWeb3 = function() {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        return [2];
      });
    });
  };
  SbaseApi2.prototype.getClaims = function() {
    return __awaiter8(this, void 0, void 0, function() {
      var accessToken, parsedToken, error_10;
      return __generator8(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            return [4, this.getAccessToken()];
          case 1:
            accessToken = _a3.sent().accessToken;
            parsedToken = weappJwtDecodeAll(accessToken);
            return [2, { data: parsedToken, error: null }];
          case 2:
            error_10 = _a3.sent();
            return [2, { data: {}, error: new AuthError(error_10) }];
          case 3:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.resetPasswordForEmail = function(emailOrPhone, options) {
    return __awaiter8(this, void 0, void 0, function() {
      var redirectTo_1, isEmail_1, verificationParams, formattedPhone, verificationInfo_3, error_11;
      var _this = this;
      return __generator8(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            this.validateParams({ emailOrPhone }, {
              emailOrPhone: { required: true, message: "Email or phone is required" }
            });
            redirectTo_1 = (options || {}).redirectTo;
            isEmail_1 = emailOrPhone.includes("@");
            verificationParams = void 0;
            if (isEmail_1) {
              verificationParams = { email: emailOrPhone };
            } else {
              formattedPhone = this.formatPhone(emailOrPhone);
              verificationParams = { phone_number: formattedPhone };
            }
            return [4, this.getVerification(verificationParams)];
          case 1:
            verificationInfo_3 = _a3.sent();
            return [2, {
              data: {
                updateUser: function(attributes) {
                  return __awaiter8(_this, void 0, void 0, function() {
                    var verificationTokenRes, res, error_12;
                    var _a4;
                    return __generator8(this, function(_b) {
                      switch (_b.label) {
                        case 0:
                          this.validateParams(attributes, {
                            nonce: { required: true, message: "Nonce is required" },
                            password: { required: true, message: "Password is required" }
                          });
                          _b.label = 1;
                        case 1:
                          _b.trys.push([1, 5, , 6]);
                          return [4, this.verify({
                            verification_id: verificationInfo_3.verification_id,
                            verification_code: attributes.nonce
                          })];
                        case 2:
                          verificationTokenRes = _b.sent();
                          return [4, this.oauthInstance.authApi.resetPassword({
                            email: isEmail_1 ? emailOrPhone : void 0,
                            phone: !isEmail_1 ? emailOrPhone : void 0,
                            new_password: attributes.password,
                            verification_token: verificationTokenRes.verification_token
                          })];
                        case 3:
                          _b.sent();
                          (_a4 = this.config.eventBus) === null || _a4 === void 0 ? void 0 : _a4.fire(EVENTS.AUTH_STATE_CHANGED, { event: AUTH_STATE_CHANGED_TYPE.PASSWORD_RECOVERY });
                          return [4, this.signInWithPassword({
                            email: isEmail_1 ? emailOrPhone : void 0,
                            phone: !isEmail_1 ? emailOrPhone : void 0,
                            password: attributes.password
                          })];
                        case 4:
                          res = _b.sent();
                          if (redirectTo_1 && isBrowser()) {
                            window.location.assign(redirectTo_1);
                          }
                          return [2, res];
                        case 5:
                          error_12 = _b.sent();
                          return [2, { data: {}, error: new AuthError(error_12) }];
                        case 6:
                          return [2];
                      }
                    });
                  });
                }
              },
              error: null
            }];
          case 2:
            error_11 = _a3.sent();
            return [2, { data: {}, error: new AuthError(error_11) }];
          case 3:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.resetPasswordForOld = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var _a3, _b, session, error_13;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            _c.trys.push([0, 3, , 4]);
            return [4, this.oauthInstance.authApi.updatePasswordByOld({
              old_password: params.old_password,
              new_password: params.new_password
            })];
          case 1:
            _c.sent();
            return [4, this.getSession()];
          case 2:
            _a3 = _c.sent().data, _b = _a3 === void 0 ? {} : _a3, session = _b.session;
            return [2, { data: { user: session.user, session }, error: null }];
          case 3:
            error_13 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_13) }];
          case 4:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.verifyOtp = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var type, _a3, _b, session, error_14;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            _c.trys.push([0, 6, , 7]);
            type = params.type;
            this.validateParams(params, {
              token: { required: true, message: "Token is required" },
              messageId: { required: true, message: "messageId is required" }
            });
            if (!["phone_change", "email_change"].includes(type)) return [3, 2];
            return [4, this.verify({
              verification_id: params.messageId,
              verification_code: params.token
            })];
          case 1:
            _c.sent();
            return [3, 4];
          case 2:
            return [4, this.signInWithUsername({
              verificationInfo: { verification_id: params.messageId, is_user: true },
              verificationCode: params.token,
              username: params.email || this.formatPhone(params.phone) || "",
              loginType: params.email ? "email" : "phone"
            })];
          case 3:
            _c.sent();
            _c.label = 4;
          case 4:
            return [4, this.getSession()];
          case 5:
            _a3 = _c.sent().data, _b = _a3 === void 0 ? {} : _a3, session = _b.session;
            return [2, { data: { user: session.user, session }, error: null }];
          case 6:
            error_14 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_14) }];
          case 7:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.getSession = function() {
    return __awaiter8(this, void 0, void 0, function() {
      var credentials, _a3, _b, user, error_15;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            _c.trys.push([0, 3, , 4]);
            return [4, this.oauthInstance.oauth2client.getCredentials()];
          case 1:
            credentials = _c.sent();
            if (!credentials || credentials.scope === "accessKey") {
              return [2, { data: { session: null }, error: null }];
            }
            return [4, this.getUser()];
          case 2:
            _a3 = _c.sent().data, _b = _a3 === void 0 ? {} : _a3, user = _b.user;
            return [2, { data: { session: __assign10(__assign10({}, credentials), { user }) }, error: null }];
          case 3:
            error_15 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_15) }];
          case 4:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.refreshSession = function(refresh_token) {
    return __awaiter8(this, void 0, void 0, function() {
      var credentials, newTokens, _a3, _b, user, error_16;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            _c.trys.push([0, 4, , 5]);
            return [4, this.oauthInstance.oauth2client.localCredentials.getCredentials()];
          case 1:
            credentials = _c.sent();
            credentials.refresh_token = refresh_token || credentials.refresh_token;
            return [4, this.oauthInstance.oauth2client.refreshToken(credentials)];
          case 2:
            newTokens = _c.sent();
            return [4, this.getUser()];
          case 3:
            _a3 = _c.sent().data, _b = _a3 === void 0 ? {} : _a3, user = _b.user;
            return [2, { data: { user, session: __assign10(__assign10({}, newTokens), { user }) }, error: null }];
          case 4:
            error_16 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_16) }];
          case 5:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.getUser = function() {
    return __awaiter8(this, void 0, void 0, function() {
      var user, _a3, error_17;
      return __generator8(this, function(_b) {
        switch (_b.label) {
          case 0:
            _b.trys.push([0, 2, , 3]);
            _a3 = this.convertToUser;
            return [4, this.getUserInfo()];
          case 1:
            user = _a3.apply(this, [_b.sent()]);
            return [2, { data: { user }, error: null }];
          case 2:
            error_17 = _b.sent();
            return [2, { data: {}, error: new AuthError(error_17) }];
          case 3:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.refreshUser = function() {
    return __awaiter8(this, void 0, void 0, function() {
      var _a3, _b, session, error_18;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            _c.trys.push([0, 3, , 4]);
            return [4, this.currentUser.refresh()];
          case 1:
            _c.sent();
            return [4, this.getSession()];
          case 2:
            _a3 = _c.sent().data, _b = _a3 === void 0 ? {} : _a3, session = _b.session;
            return [2, { data: { user: session.user, session }, error: null }];
          case 3:
            error_18 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_18) }];
          case 4:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.updateUser = function(params) {
    var _a3;
    return __awaiter8(this, void 0, void 0, function() {
      var hasValue, email, phone, restParams, needsEmailVerification_1, needsPhoneVerification, extraRes, verificationParams, verificationType_1, formattedPhone, verificationInfo_4, _b, user, error_19;
      var _this = this;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            _c.trys.push([0, 8, , 9]);
            hasValue = Object.keys(params).some(function(key) {
              return params[key] !== void 0 && params[key] !== null && params[key] !== "";
            });
            if (!hasValue) {
              throw new AuthError({ message: "At least one field must be provided for update" });
            }
            email = params.email, phone = params.phone, restParams = __rest5(params, ["email", "phone"]);
            needsEmailVerification_1 = email !== void 0;
            needsPhoneVerification = phone !== void 0;
            extraRes = {};
            if (!(needsEmailVerification_1 || needsPhoneVerification)) return [3, 4];
            verificationParams = void 0;
            if (needsEmailVerification_1) {
              verificationParams = { email: params.email };
              verificationType_1 = "email_change";
            } else {
              formattedPhone = this.formatPhone(params.phone);
              verificationParams = { phone_number: formattedPhone };
              verificationType_1 = "phone_change";
            }
            return [4, this.getVerification(verificationParams)];
          case 1:
            verificationInfo_4 = _c.sent();
            _b = Object.keys(restParams).length > 0;
            if (!_b) return [3, 3];
            return [4, this.updateUserBasicInfo(restParams)];
          case 2:
            _b = _c.sent();
            _c.label = 3;
          case 3:
            _b;
            extraRes = {
              messageId: verificationInfo_4.verification_id,
              verifyOtp: function(verifyParams) {
                return __awaiter8(_this, void 0, void 0, function() {
                  var user_1, error_20;
                  var _a4;
                  return __generator8(this, function(_b2) {
                    switch (_b2.label) {
                      case 0:
                        _b2.trys.push([0, 11, , 12]);
                        if (!(verifyParams.email && params.email === verifyParams.email)) return [3, 3];
                        return [4, this.verifyOtp({
                          type: "email_change",
                          email: params.email,
                          token: verifyParams.token,
                          messageId: verificationInfo_4.verification_id
                        })];
                      case 1:
                        _b2.sent();
                        return [4, this.updateUserBasicInfo({ email: params.email })];
                      case 2:
                        _b2.sent();
                        return [3, 9];
                      case 3:
                        if (!(verifyParams.phone && params.phone === verifyParams.phone)) return [3, 6];
                        return [4, this.verifyOtp({
                          type: "phone_change",
                          phone: params.phone,
                          token: verifyParams.token,
                          messageId: verificationInfo_4.verification_id
                        })];
                      case 4:
                        _b2.sent();
                        return [4, this.updateUserBasicInfo({ phone: this.formatPhone(params.phone) })];
                      case 5:
                        _b2.sent();
                        return [3, 9];
                      case 6:
                        return [4, this.verifyOtp({
                          type: verificationType_1,
                          email: needsEmailVerification_1 ? params.email : void 0,
                          phone: !needsEmailVerification_1 ? params.phone : void 0,
                          token: verifyParams.token,
                          messageId: verificationInfo_4.verification_id
                        })];
                      case 7:
                        _b2.sent();
                        return [4, this.updateUserBasicInfo(params)];
                      case 8:
                        _b2.sent();
                        _b2.label = 9;
                      case 9:
                        return [4, this.getUser()];
                      case 10:
                        user_1 = _b2.sent().data.user;
                        (_a4 = this.config.eventBus) === null || _a4 === void 0 ? void 0 : _a4.fire(EVENTS.AUTH_STATE_CHANGED, { event: AUTH_STATE_CHANGED_TYPE.USER_UPDATED });
                        return [2, { data: { user: user_1 }, error: null }];
                      case 11:
                        error_20 = _b2.sent();
                        return [2, { data: {}, error: new AuthError(error_20) }];
                      case 12:
                        return [2];
                    }
                  });
                });
              }
            };
            return [3, 6];
          case 4:
            return [4, this.updateUserBasicInfo(params)];
          case 5:
            _c.sent();
            _c.label = 6;
          case 6:
            return [4, this.getUser()];
          case 7:
            user = _c.sent().data.user;
            (_a3 = this.config.eventBus) === null || _a3 === void 0 ? void 0 : _a3.fire(EVENTS.AUTH_STATE_CHANGED, { event: AUTH_STATE_CHANGED_TYPE.USER_UPDATED });
            return [2, { data: __assign10({ user }, extraRes), error: null }];
          case 8:
            error_19 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_19) }];
          case 9:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.getUserIdentities = function() {
    var _a3;
    return __awaiter8(this, void 0, void 0, function() {
      var providers, error_21;
      return __generator8(this, function(_b) {
        switch (_b.label) {
          case 0:
            _b.trys.push([0, 2, , 3]);
            return [4, this.oauthInstance.authApi.getProviders()];
          case 1:
            providers = _b.sent();
            return [2, { data: { identities: (_a3 = providers === null || providers === void 0 ? void 0 : providers.data) === null || _a3 === void 0 ? void 0 : _a3.filter(function(v2) {
              return !!v2.bind;
            }) }, error: null }];
          case 2:
            error_21 = _b.sent();
            return [2, { data: {}, error: new AuthError(error_21) }];
          case 3:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.linkIdentity = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var error_22;
      return __generator8(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            this.validateParams(params, {
              provider: { required: true, message: "Provider is required" }
            });
            return [4, this.signInWithOAuth({
              provider: params.provider,
              options: {
                type: OAUTH_TYPE.BIND_IDENTITY
              }
            })];
          case 1:
            _a3.sent();
            return [2, { data: { provider: params.provider }, error: null }];
          case 2:
            error_22 = _a3.sent();
            return [2, { data: {}, error: new AuthError(error_22) }];
          case 3:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.unlinkIdentity = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var error_23;
      return __generator8(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            this.validateParams(params, {
              provider: { required: true, message: "Provider is required" }
            });
            return [4, this.oauthInstance.authApi.unbindProvider({ provider_id: params.provider })];
          case 1:
            _a3.sent();
            return [2, { data: {}, error: null }];
          case 2:
            error_23 = _a3.sent();
            return [2, { data: {}, error: new AuthError(error_23) }];
          case 3:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.reauthenticate = function() {
    return __awaiter8(this, void 0, void 0, function() {
      var user, userInfo_1, verificationInfo_5, error_24;
      var _this = this;
      return __generator8(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 3, , 4]);
            return [4, this.getUser()];
          case 1:
            user = _a3.sent().data.user;
            this.validateAtLeastOne(user, [["email", "phone"]], "You must provide either an email or phone number");
            userInfo_1 = user.email ? { email: user.email } : { phone_number: this.formatPhone(user.phone) };
            return [4, this.getVerification(userInfo_1)];
          case 2:
            verificationInfo_5 = _a3.sent();
            return [2, {
              data: {
                updateUser: function(attributes) {
                  return __awaiter8(_this, void 0, void 0, function() {
                    var verificationTokenRes, sudoRes, _a4, _b, session, error_25;
                    return __generator8(this, function(_c) {
                      switch (_c.label) {
                        case 0:
                          this.validateParams(attributes, {
                            nonce: { required: true, message: "Nonce is required" }
                          });
                          _c.label = 1;
                        case 1:
                          _c.trys.push([1, 9, , 10]);
                          if (!attributes.password) return [3, 5];
                          return [4, this.verify({
                            verification_id: verificationInfo_5.verification_id,
                            verification_code: attributes.nonce
                          })];
                        case 2:
                          verificationTokenRes = _c.sent();
                          return [4, this.oauthInstance.authApi.sudo({
                            verification_token: verificationTokenRes.verification_token
                          })];
                        case 3:
                          sudoRes = _c.sent();
                          return [4, this.oauthInstance.authApi.setPassword({
                            new_password: attributes.password,
                            sudo_token: sudoRes.sudo_token
                          })];
                        case 4:
                          _c.sent();
                          return [3, 7];
                        case 5:
                          return [4, this.signInWithUsername(__assign10(__assign10({ verificationInfo: verificationInfo_5, verificationCode: attributes.nonce }, userInfo_1), { loginType: userInfo_1.email ? "email" : "phone" }))];
                        case 6:
                          _c.sent();
                          _c.label = 7;
                        case 7:
                          return [4, this.getSession()];
                        case 8:
                          _a4 = _c.sent().data, _b = _a4 === void 0 ? {} : _a4, session = _b.session;
                          return [2, { data: { user: session.user, session }, error: null }];
                        case 9:
                          error_25 = _c.sent();
                          return [2, { data: {}, error: new AuthError(error_25) }];
                        case 10:
                          return [2];
                      }
                    });
                  });
                }
              },
              error: null
            }];
          case 3:
            error_24 = _a3.sent();
            return [2, { data: {}, error: new AuthError(error_24) }];
          case 4:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.resend = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var target, data2, verificationId, error_26;
      return __generator8(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            this.validateAtLeastOne(params, [["email"], ["phone"]], "You must provide either an email or phone number");
            target = params.type === "signup" ? "ANY" : "USER";
            data2 = { target };
            if ("email" in params) {
              data2.email = params.email;
            }
            if ("phone" in params) {
              data2.phone_number = this.formatPhone(params.phone);
            }
            return [4, this.oauthInstance.authApi.getVerification(data2)];
          case 1:
            verificationId = _a3.sent().verification_id;
            return [2, {
              data: { messageId: verificationId },
              error: null
            }];
          case 2:
            error_26 = _a3.sent();
            return [2, {
              data: {},
              error: new AuthError(error_26)
            }];
          case 3:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.setSession = function(params) {
    var _a3;
    return __awaiter8(this, void 0, void 0, function() {
      var _b, _c, session, error_27;
      return __generator8(this, function(_d) {
        switch (_d.label) {
          case 0:
            _d.trys.push([0, 3, , 4]);
            this.validateParams(params, {
              access_token: { required: true, message: "Access token is required" },
              refresh_token: { required: true, message: "Refresh token is required" }
            });
            return [4, this.oauthInstance.oauth2client.refreshToken(params, { throwOnError: true })];
          case 1:
            _d.sent();
            return [4, this.getSession()];
          case 2:
            _b = _d.sent().data, _c = _b === void 0 ? {} : _b, session = _c.session;
            (_a3 = this.config.eventBus) === null || _a3 === void 0 ? void 0 : _a3.fire(EVENTS.AUTH_STATE_CHANGED, { event: AUTH_STATE_CHANGED_TYPE.SIGNED_IN });
            return [2, { data: { user: session.user, session }, error: null }];
          case 3:
            error_27 = _d.sent();
            return [2, { data: {}, error: new AuthError(error_27) }];
          case 4:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.exchangeCodeForSession = function() {
    return __awaiter8(this, void 0, void 0, function() {
      return __generator8(this, function(_a3) {
        return [2];
      });
    });
  };
  SbaseApi2.prototype.deleteUser = function(params) {
    return __awaiter8(this, void 0, void 0, function() {
      var sudo_token, error_28;
      return __generator8(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 3, , 4]);
            this.validateParams(params, {
              password: { required: true, message: "Password is required" }
            });
            return [4, this.oauthInstance.authApi.sudo(params)];
          case 1:
            sudo_token = _a3.sent().sudo_token;
            return [4, this.oauthInstance.authApi.deleteMe({ sudo_token })];
          case 2:
            _a3.sent();
            return [2, { data: {}, error: null }];
          case 3:
            error_28 = _a3.sent();
            return [2, { data: {}, error: new AuthError(error_28) }];
          case 4:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.toDefaultLoginPage = function(params) {
    if (params === void 0) {
      params = {};
    }
    return __awaiter8(this, void 0, void 0, function() {
      var configVersion, query, redirectUri, urlObj, loginPage;
      return __generator8(this, function(_a3) {
        try {
          configVersion = params.config_version || "env";
          query = Object.keys(params.query || {}).map(function(key) {
            return "".concat(key, "=").concat(params.query[key]);
          }).join("&");
          if (esm_default.isMatch()) {
            wx.navigateTo({ url: "/packages/$wd_system/pages/login/index".concat(query ? "?".concat(query) : "") });
          } else {
            redirectUri = params.redirect_uri || window.location.href;
            urlObj = new URL(redirectUri);
            loginPage = "".concat(urlObj.origin, "/__auth/?app_id=").concat(params.app_id || "", "&env_id=").concat(this.config.env, "&client_id=").concat(this.config.clientId || this.config.env, "&config_version=").concat(configVersion, "&redirect_uri=").concat(encodeURIComponent(redirectUri)).concat(query ? "&".concat(query) : "");
            window.location.href = loginPage;
          }
          return [2, { data: {}, error: null }];
        } catch (error) {
          return [2, { data: {}, error: new AuthError(error) }];
        }
        return [2];
      });
    });
  };
  SbaseApi2.prototype.signInWithCustomTicket = function(getTickFn) {
    return __awaiter8(this, void 0, void 0, function() {
      var loginState, _a3, _b, session, error_29;
      return __generator8(this, function(_c) {
        switch (_c.label) {
          case 0:
            if (getTickFn) {
              this.setCustomSignFunc(getTickFn);
            }
            _c.label = 1;
          case 1:
            _c.trys.push([1, 5, , 6]);
            return [4, this.oauthInstance.authApi.signInWithCustomTicket()];
          case 2:
            _c.sent();
            return [4, this.createLoginState()];
          case 3:
            loginState = _c.sent();
            return [4, this.getSession()];
          case 4:
            _a3 = _c.sent().data, _b = _a3 === void 0 ? {} : _a3, session = _b.session;
            return [2, __assign10(__assign10({}, loginState), { data: { user: session.user, session }, error: null })];
          case 5:
            error_29 = _c.sent();
            return [2, { data: {}, error: new AuthError(error_29) }];
          case 6:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.signInWithOpenId = function(_a3) {
    var _b = _a3 === void 0 ? {} : _a3, _c = _b.useWxCloud, useWxCloud = _c === void 0 ? true : _c;
    return __awaiter8(this, void 0, void 0, function() {
      var wxInfo, mainFunc, loginState, _d, _e2, session, error_30;
      var _this = this;
      return __generator8(this, function(_f) {
        switch (_f.label) {
          case 0:
            if (!esm_default.isMatch()) {
              throw Error("wx api undefined");
            }
            wxInfo = wx.getAccountInfoSync().miniProgram;
            mainFunc = function(code2) {
              return __awaiter8(_this, void 0, void 0, function() {
                var result, credentials, error_31;
                return __generator8(this, function(_a4) {
                  switch (_a4.label) {
                    case 0:
                      result = void 0;
                      credentials = void 0;
                      _a4.label = 1;
                    case 1:
                      _a4.trys.push([1, 4, , 5]);
                      return [4, this.oauthInstance.authApi.grantProviderToken({
                        provider_id: wxInfo === null || wxInfo === void 0 ? void 0 : wxInfo.appId,
                        provider_code: code2,
                        provider_params: {
                          provider_code_type: "open_id",
                          appid: wxInfo === null || wxInfo === void 0 ? void 0 : wxInfo.appId
                        }
                      }, useWxCloud)];
                    case 2:
                      result = _a4.sent();
                      if ((result === null || result === void 0 ? void 0 : result.error_code) || !result.provider_token) {
                        throw result;
                      }
                      return [4, this.oauthInstance.authApi.signInWithProvider({ provider_token: result.provider_token }, useWxCloud)];
                    case 3:
                      credentials = _a4.sent();
                      if (credentials === null || credentials === void 0 ? void 0 : credentials.error_code) {
                        throw credentials;
                      }
                      return [3, 5];
                    case 4:
                      error_31 = _a4.sent();
                      throw error_31;
                    case 5:
                      return [4, this.oauthInstance.oauth2client.setCredentials(credentials)];
                    case 6:
                      _a4.sent();
                      return [2];
                  }
                });
              });
            };
            _f.label = 1;
          case 1:
            _f.trys.push([1, 5, , 6]);
            return [4, new Promise(function(resolve, reject) {
              wx.login({
                success: function(res) {
                  return __awaiter8(_this, void 0, void 0, function() {
                    var error_32;
                    return __generator8(this, function(_a4) {
                      switch (_a4.label) {
                        case 0:
                          _a4.trys.push([0, 2, , 3]);
                          return [4, mainFunc(res.code)];
                        case 1:
                          _a4.sent();
                          resolve(true);
                          return [3, 3];
                        case 2:
                          error_32 = _a4.sent();
                          reject(error_32);
                          return [3, 3];
                        case 3:
                          return [2];
                      }
                    });
                  });
                },
                fail: function(res) {
                  var error = new Error(res === null || res === void 0 ? void 0 : res.errMsg);
                  error.code = res === null || res === void 0 ? void 0 : res.errno;
                  reject(error);
                }
              });
            })];
          case 2:
            _f.sent();
            return [4, this.createLoginState()];
          case 3:
            loginState = _f.sent();
            return [4, this.getSession()];
          case 4:
            _d = _f.sent().data, _e2 = _d === void 0 ? {} : _d, session = _e2.session;
            return [2, __assign10(__assign10({}, loginState), { data: { user: session.user, session }, error: null })];
          case 5:
            error_30 = _f.sent();
            return [2, { data: {}, error: new AuthError(error_30) }];
          case 6:
            return [2];
        }
      });
    });
  };
  SbaseApi2.prototype.signInWithPhoneAuth = function(_a3) {
    var _b = _a3.phoneCode, phoneCode = _b === void 0 ? "" : _b;
    return __awaiter8(this, void 0, void 0, function() {
      var wxInfo, providerInfo, code2, providerToken, signInRes, error_33, loginState, _c, _d, session;
      return __generator8(this, function(_e2) {
        switch (_e2.label) {
          case 0:
            if (!esm_default.isMatch()) {
              return [2, { data: {}, error: new AuthError({ message: "wx api undefined" }) }];
            }
            wxInfo = wx.getAccountInfoSync().miniProgram;
            providerInfo = {
              provider_params: { provider_code_type: "phone" },
              provider_id: wxInfo.appId
            };
            return [4, wx.login()];
          case 1:
            code2 = _e2.sent().code;
            providerInfo.provider_code = code2;
            _e2.label = 2;
          case 2:
            _e2.trys.push([2, 6, , 7]);
            return [4, this.oauthInstance.authApi.grantProviderToken(providerInfo)];
          case 3:
            providerToken = _e2.sent();
            if (providerToken.error_code) {
              throw providerToken;
            }
            return [4, this.oauthInstance.authApi.patchProviderToken({
              provider_token: providerToken.provider_token,
              provider_id: wxInfo.appId,
              provider_params: {
                code: phoneCode,
                provider_code_type: "phone"
              }
            })];
          case 4:
            providerToken = _e2.sent();
            if (providerToken.error_code) {
              throw providerToken;
            }
            return [4, this.oauthInstance.authApi.signInWithProvider({
              provider_token: providerToken.provider_token
            })];
          case 5:
            signInRes = _e2.sent();
            if (signInRes === null || signInRes === void 0 ? void 0 : signInRes.error_code) {
              throw signInRes;
            }
            return [3, 7];
          case 6:
            error_33 = _e2.sent();
            return [2, { data: {}, error: new AuthError(error_33) }];
          case 7:
            return [4, this.createLoginState()];
          case 8:
            loginState = _e2.sent();
            return [4, this.getSession()];
          case 9:
            _c = _e2.sent().data, _d = _c === void 0 ? {} : _c, session = _d.session;
            return [2, __assign10(__assign10({}, loginState), { data: { user: session.user, session }, error: null })];
        }
      });
    });
  };
  SbaseApi2.prototype.formatPhone = function(phone) {
    if (!/\s+/.test(phone) && /^\+\d{1,3}\d+/.test(phone)) {
      return phone.replace(/^(\+\d{1,2})(\d+)$/, "$1 $2");
    }
    return /^\+\d{1,3}\s+/.test(phone) ? phone : "+86 ".concat(phone);
  };
  SbaseApi2.prototype.notifyListeners = function(event, session, info) {
    this.listeners.forEach(function(callbacks) {
      callbacks.forEach(function(callback) {
        try {
          callback(event, session, info);
        } catch (error) {
          console.error("Error in auth state change callback:", error);
        }
      });
    });
    return;
  };
  SbaseApi2.prototype.init = function() {
    var _a3;
    return __awaiter8(this, void 0, void 0, function() {
      var credentials, error_34;
      return __generator8(this, function(_b) {
        switch (_b.label) {
          case 0:
            _b.trys.push([0, 2, , 3]);
            return [4, this.oauthInstance.oauth2client.localCredentials.getCredentials()];
          case 1:
            credentials = _b.sent();
            if (credentials) {
              (_a3 = this.config.eventBus) === null || _a3 === void 0 ? void 0 : _a3.fire(EVENTS.AUTH_STATE_CHANGED, { event: AUTH_STATE_CHANGED_TYPE.INITIAL_SESSION });
            }
            return [3, 3];
          case 2:
            error_34 = _b.sent();
            return [3, 3];
          case 3:
            return [2, { error: null }];
        }
      });
    });
  };
  SbaseApi2.prototype.setupListeners = function() {
    var _this = this;
    var _a3;
    (_a3 = this.config.eventBus) === null || _a3 === void 0 ? void 0 : _a3.on(EVENTS.AUTH_STATE_CHANGED, function(params) {
      return __awaiter8(_this, void 0, void 0, function() {
        var event, info, session;
        var _a4, _b;
        return __generator8(this, function(_c) {
          switch (_c.label) {
            case 0:
              event = (_a4 = params === null || params === void 0 ? void 0 : params.data) === null || _a4 === void 0 ? void 0 : _a4.event;
              info = (_b = params === null || params === void 0 ? void 0 : params.data) === null || _b === void 0 ? void 0 : _b.info;
              return [4, this.getSession()];
            case 1:
              session = _c.sent().data.session;
              this.notifyListeners(event, session, info);
              return [2];
          }
        });
      });
    });
  };
  SbaseApi2.prototype.convertToUser = function(userInfo) {
    var _a3, _b, _c;
    if (!userInfo)
      return null;
    var email = (userInfo === null || userInfo === void 0 ? void 0 : userInfo.email) || (userInfo === null || userInfo === void 0 ? void 0 : userInfo.username);
    var phone = userInfo === null || userInfo === void 0 ? void 0 : userInfo.phone_number;
    var userId = (userInfo === null || userInfo === void 0 ? void 0 : userInfo.sub) || (userInfo === null || userInfo === void 0 ? void 0 : userInfo.uid) || "";
    return {
      id: userId,
      aud: "authenticated",
      role: userInfo.groups,
      email: email || "",
      email_confirmed_at: (userInfo === null || userInfo === void 0 ? void 0 : userInfo.email_verified) ? userInfo.created_at : userInfo.created_at,
      phone,
      phone_confirmed_at: phone ? userInfo.created_at : void 0,
      confirmed_at: userInfo.created_at,
      last_sign_in_at: userInfo.last_sign_in_at,
      app_metadata: {
        provider: ((_a3 = userInfo.loginType) === null || _a3 === void 0 ? void 0 : _a3.toLowerCase()) || "cloudbase",
        providers: [((_b = userInfo.loginType) === null || _b === void 0 ? void 0 : _b.toLowerCase()) || "cloudbase"]
      },
      user_metadata: {
        name: userInfo === null || userInfo === void 0 ? void 0 : userInfo.name,
        picture: userInfo === null || userInfo === void 0 ? void 0 : userInfo.picture,
        username: userInfo === null || userInfo === void 0 ? void 0 : userInfo.username,
        gender: userInfo === null || userInfo === void 0 ? void 0 : userInfo.gender,
        locale: userInfo === null || userInfo === void 0 ? void 0 : userInfo.locale,
        uid: userInfo.uid,
        nickName: userInfo.nickName,
        avatarUrl: userInfo.avatarUrl || userInfo.picture,
        location: userInfo.location,
        hasPassword: userInfo.hasPassword
      },
      identities: ((_c = userInfo === null || userInfo === void 0 ? void 0 : userInfo.providers) === null || _c === void 0 ? void 0 : _c.map(function(p2) {
        return {
          id: p2.id || "",
          identity_id: p2.id || "",
          user_id: userId,
          identity_data: {
            provider_id: p2.id,
            provider_user_id: p2.provider_user_id,
            name: p2.name
          },
          provider: p2.id || "cloudbase",
          created_at: userInfo.created_at,
          updated_at: userInfo.updated_at,
          last_sign_in_at: userInfo.last_sign_in_at
        };
      })) || [],
      created_at: userInfo.created_at,
      updated_at: userInfo.updated_at,
      is_anonymous: userInfo.name === "anonymous"
    };
  };
  SbaseApi2.prototype.validateParams = function(params, rules) {
    for (var _i = 0, _a3 = Object.entries(rules); _i < _a3.length; _i++) {
      var _b = _a3[_i], key = _b[0], rule = _b[1];
      if (rule.required && ((params === null || params === void 0 ? void 0 : params[key]) === void 0 || (params === null || params === void 0 ? void 0 : params[key]) === null || (params === null || params === void 0 ? void 0 : params[key]) === "")) {
        throw new AuthError({ message: rule.message });
      }
    }
  };
  SbaseApi2.prototype.validateAtLeastOne = function(params, fieldGroups, message) {
    var hasValue = fieldGroups.some(function(group) {
      return group.some(function(field) {
        return (params === null || params === void 0 ? void 0 : params[field]) !== void 0 && (params === null || params === void 0 ? void 0 : params[field]) !== null && (params === null || params === void 0 ? void 0 : params[field]) !== "";
      });
    });
    if (!hasValue) {
      throw new AuthError({ message });
    }
  };
  return SbaseApi2;
}();

// node_modules/@cloudbase/auth/dist/esm/index.js
var __extends5 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var __assign11 = function() {
  __assign11 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign11.apply(this, arguments);
};
var __decorate2 = function(decorators, target, key, desc) {
  var c2 = arguments.length, r3 = c2 < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d2;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r3 = Reflect.decorate(decorators, target, key, desc);
  else for (var i2 = decorators.length - 1; i2 >= 0; i2--) if (d2 = decorators[i2]) r3 = (c2 < 3 ? d2(r3) : c2 > 3 ? d2(target, key, r3) : d2(target, key)) || r3;
  return c2 > 3 && r3 && Object.defineProperty(target, key, r3), r3;
};
var __metadata2 = function(k2, v2) {
  if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k2, v2);
};
var __awaiter9 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator9 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var COMPONENT_NAME = "auth";
var onCredentialsError = function(eventBus2) {
  return function(params) {
    eventBus2.fire(EVENTS.LOGIN_STATE_CHANGED, __assign11(__assign11({}, params), { eventType: LOGIN_STATE_CHANGED_TYPE.CREDENTIALS_ERROR }));
  };
};
var User = function() {
  function User2(options) {
    var cache = options.cache, oauthInstance = options.oauthInstance;
    this.cache = cache;
    this.oauthInstance = oauthInstance;
    this.setUserInfo();
  }
  User2.prototype.checkLocalInfo = function() {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        this.uid = this.getLocalUserInfo("uid");
        this.gender = this.getLocalUserInfo("gender");
        this.picture = this.getLocalUserInfo("picture");
        this.email = this.getLocalUserInfo("email");
        this.emailVerified = this.getLocalUserInfo("email_verified");
        this.phoneNumber = this.getLocalUserInfo("phone_number");
        this.username = this.getLocalUserInfo("username");
        this.name = this.getLocalUserInfo("name");
        this.birthdate = this.getLocalUserInfo("birthdate");
        this.zoneinfo = this.getLocalUserInfo("zoneinfo");
        this.locale = this.getLocalUserInfo("locale");
        this.sub = this.getLocalUserInfo("sub");
        this.createdFrom = this.getLocalUserInfo("created_from");
        this.providers = this.getLocalUserInfo("providers");
        return [2];
      });
    });
  };
  User2.prototype.checkLocalInfoAsync = function() {
    return __awaiter9(this, void 0, void 0, function() {
      var _a3, _b, _c, _d;
      return __generator9(this, function(_e2) {
        switch (_e2.label) {
          case 0:
            _a3 = this;
            return [4, this.getLocalUserInfoAsync("uid")];
          case 1:
            _a3.uid = _e2.sent();
            _b = this;
            return [4, this.getLocalUserInfoAsync("gender")];
          case 2:
            _b.gender = _e2.sent();
            this.picture = this.getLocalUserInfo("picture");
            _c = this;
            return [4, this.getLocalUserInfoAsync("email")];
          case 3:
            _c.email = _e2.sent();
            this.emailVerified = this.getLocalUserInfo("email_verified");
            this.phoneNumber = this.getLocalUserInfo("phone_number");
            _d = this;
            return [4, this.getLocalUserInfoAsync("username")];
          case 4:
            _d.username = _e2.sent();
            this.name = this.getLocalUserInfo("name");
            this.birthdate = this.getLocalUserInfo("birthdate");
            this.zoneinfo = this.getLocalUserInfo("zoneinfo");
            this.locale = this.getLocalUserInfo("locale");
            this.sub = this.getLocalUserInfo("sub");
            this.createdFrom = this.getLocalUserInfo("created_from");
            this.providers = this.getLocalUserInfo("providers");
            return [2];
        }
      });
    });
  };
  User2.prototype.update = function(userInfo) {
    return __awaiter9(this, void 0, void 0, function() {
      var newUserInfo;
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.oauthInstance.authApi.setUserProfile(__assign11({}, userInfo))];
          case 1:
            newUserInfo = _a3.sent();
            this.setLocalUserInfo(newUserInfo);
            return [2];
        }
      });
    });
  };
  User2.prototype.updateUserBasicInfo = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.oauthInstance.authApi.updateUserBasicInfo(__assign11({}, params))];
          case 1:
            _a3.sent();
            return [4, this.refresh()];
          case 2:
            _a3.sent();
            return [2];
        }
      });
    });
  };
  User2.prototype.updatePassword = function(newPassword, oldPassword) {
    return this.oauthInstance.authApi.updatePasswordByOld({
      old_password: oldPassword,
      new_password: newPassword
    });
  };
  User2.prototype.updateUsername = function(username) {
    if (typeof username !== "string") {
      (0, import_util7.throwError)(import_constants4.ERRORS.INVALID_PARAMS, "username must be a string");
    }
    return this.update({
      username
    });
  };
  User2.prototype.refresh = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      var newUserInfo;
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.oauthInstance.authApi.getUserInfo(params)];
          case 1:
            newUserInfo = _a3.sent();
            if (newUserInfo.code === "INVALID_ACCESS_TOKEN") {
              this.setLocalUserInfo({});
              throw newUserInfo;
            }
            this.setLocalUserInfo(newUserInfo);
            return [2, newUserInfo];
        }
      });
    });
  };
  User2.prototype.getLocalUserInfo = function(key) {
    var userInfoKey = this.cache.keys.userInfoKey;
    var userInfo = this.cache.getStore(userInfoKey);
    if (!key)
      return userInfo || {};
    return userInfo[key];
  };
  User2.prototype.setLocalUserInfo = function(userInfo) {
    var userInfoKey = this.cache.keys.userInfoKey;
    this.cache.setStore(userInfoKey, userInfo);
    this.setUserInfo();
  };
  User2.prototype.getLocalUserInfoAsync = function(key) {
    return __awaiter9(this, void 0, void 0, function() {
      var userInfoKey, userInfo;
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            userInfoKey = this.cache.keys.userInfoKey;
            return [4, this.cache.getStoreAsync(userInfoKey)];
          case 1:
            userInfo = _a3.sent();
            return [2, userInfo[key]];
        }
      });
    });
  };
  User2.prototype.setUserInfo = function() {
    var _this = this;
    var userInfoKey = this.cache.keys.userInfoKey;
    var userInfo = this.cache.getStore(userInfoKey);
    [
      "uid",
      "email",
      "name",
      "gender",
      "picture",
      "email_verified",
      "phone_number",
      "birthdate",
      "zoneinfo",
      "locale",
      "sub",
      "created_from",
      "providers",
      "username",
      "created_at"
    ].forEach(function(infoKey) {
      _this[infoKey] = userInfo[infoKey];
    });
  };
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  User.update() ",
        "  2 - ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object]),
    __metadata2("design:returntype", Promise)
  ], User2.prototype, "update", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  User.updatePassword() ",
        "  3 - ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [String, String]),
    __metadata2("design:returntype", void 0)
  ], User2.prototype, "updatePassword", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  User.updateUsername() ",
        "  2 - ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [String]),
    __metadata2("design:returntype", void 0)
  ], User2.prototype, "updateUsername", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  User.refresh() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object]),
    __metadata2("design:returntype", Promise)
  ], User2.prototype, "refresh", null);
  return User2;
}();
var LoginState = function() {
  function LoginState2(options) {
    var envId = options.envId, cache = options.cache, oauthInstance = options.oauthInstance;
    if (!envId) {
      (0, import_util7.throwError)(import_constants4.ERRORS.INVALID_PARAMS, "envId is not defined");
    }
    this.cache = cache;
    this.oauthInstance = oauthInstance;
    this.user = new User({
      cache: this.cache,
      oauthInstance
    });
  }
  LoginState2.prototype.checkLocalState = function() {
    var _a3;
    this.oauthLoginState = (_a3 = this.oauthInstance) === null || _a3 === void 0 ? void 0 : _a3.authApi.hasLoginStateSync();
    this.user.checkLocalInfo();
  };
  LoginState2.prototype.checkLocalStateAsync = function() {
    var _a3;
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_b) {
        switch (_b.label) {
          case 0:
            return [4, (_a3 = this.oauthInstance) === null || _a3 === void 0 ? void 0 : _a3.authApi.getLoginState()];
          case 1:
            _b.sent();
            return [4, this.user.checkLocalInfoAsync()];
          case 2:
            _b.sent();
            return [2];
        }
      });
    });
  };
  return LoginState2;
}();
var Auth2 = function(_super) {
  __extends5(Auth3, _super);
  function Auth3(config) {
    var _this = _super.call(this, config) || this;
    _this.setAccessKey();
    return _this;
  }
  Auth3.prototype.bindPhoneNumber = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.editContact(params)];
      });
    });
  };
  Auth3.prototype.unbindProvider = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.unbindProvider(params)];
      });
    });
  };
  Auth3.prototype.bindEmail = function(params) {
    return this.oauthInstance.authApi.editContact(params);
  };
  Auth3.prototype.verify = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.verify(params)];
      });
    });
  };
  Auth3.prototype.getVerification = function(params, options) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.getVerification(params, options)];
      });
    });
  };
  Object.defineProperty(Auth3.prototype, "currentUser", {
    get: function() {
      if (this.cache.mode === "async") {
        (0, import_util7.printWarn)(import_constants4.ERRORS.INVALID_OPERATION, "current platform's storage is asynchronous, please use getCurrentUser instead");
        return;
      }
      var loginState = this.hasLoginState();
      if (loginState) {
        return loginState.user || null;
      }
      return null;
    },
    enumerable: false,
    configurable: true
  });
  Auth3.prototype.getCurrentUser = function() {
    return __awaiter9(this, void 0, void 0, function() {
      var loginState, userInfo;
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.getLoginState()];
          case 1:
            loginState = _a3.sent();
            if (!loginState) return [3, 3];
            userInfo = loginState.user.getLocalUserInfo();
            return [4, loginState.user.checkLocalInfoAsync()];
          case 2:
            _a3.sent();
            return [2, __assign11(__assign11({}, loginState.user), userInfo)];
          case 3:
            return [2, null];
        }
      });
    });
  };
  Auth3.prototype.signInAnonymouslyInWx = function(_a3) {
    var _b = _a3 === void 0 ? {} : _a3, useWxCloud = _b.useWxCloud;
    return __awaiter9(this, void 0, void 0, function() {
      var wxInfo, mainFunc;
      var _this = this;
      return __generator9(this, function(_c) {
        switch (_c.label) {
          case 0:
            if (!esm_default.isMatch()) {
              throw Error("wx api undefined");
            }
            wxInfo = wx.getAccountInfoSync().miniProgram;
            mainFunc = function(code2) {
              return __awaiter9(_this, void 0, void 0, function() {
                var result, credentials, error_1;
                return __generator9(this, function(_a4) {
                  switch (_a4.label) {
                    case 0:
                      result = void 0;
                      credentials = void 0;
                      _a4.label = 1;
                    case 1:
                      _a4.trys.push([1, 4, , 5]);
                      return [4, this.oauthInstance.authApi.grantProviderToken({
                        provider_id: wxInfo === null || wxInfo === void 0 ? void 0 : wxInfo.appId,
                        provider_code: code2,
                        provider_params: {
                          provider_code_type: "open_id",
                          appid: wxInfo === null || wxInfo === void 0 ? void 0 : wxInfo.appId
                        }
                      }, useWxCloud)];
                    case 2:
                      result = _a4.sent();
                      if ((result === null || result === void 0 ? void 0 : result.error_code) || !result.provider_token) {
                        throw result;
                      }
                      return [4, this.oauthInstance.authApi.signInAnonymously({ provider_token: result.provider_token }, useWxCloud)];
                    case 3:
                      credentials = _a4.sent();
                      if (credentials === null || credentials === void 0 ? void 0 : credentials.error_code) {
                        throw credentials;
                      }
                      return [3, 5];
                    case 4:
                      error_1 = _a4.sent();
                      throw error_1;
                    case 5:
                      return [2];
                  }
                });
              });
            };
            return [4, new Promise(function(resolve, reject) {
              wx.login({
                success: function(res) {
                  return __awaiter9(_this, void 0, void 0, function() {
                    var error_2;
                    return __generator9(this, function(_a4) {
                      switch (_a4.label) {
                        case 0:
                          _a4.trys.push([0, 2, , 3]);
                          return [4, mainFunc(res.code)];
                        case 1:
                          _a4.sent();
                          resolve(true);
                          return [3, 3];
                        case 2:
                          error_2 = _a4.sent();
                          reject(error_2);
                          return [3, 3];
                        case 3:
                          return [2];
                      }
                    });
                  });
                },
                fail: function(res) {
                  var error = new Error(res === null || res === void 0 ? void 0 : res.errMsg);
                  error.code = res === null || res === void 0 ? void 0 : res.errno;
                  reject(error);
                }
              });
            })];
          case 1:
            _c.sent();
            return [2, this.createLoginState(void 0, { asyncRefreshUser: true })];
        }
      });
    });
  };
  Auth3.prototype.bindOpenId = function() {
    return __awaiter9(this, void 0, void 0, function() {
      var wxInfo, mainFunc;
      var _this = this;
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            if (!esm_default.isMatch()) {
              throw Error("wx api undefined");
            }
            wxInfo = wx.getAccountInfoSync().miniProgram;
            mainFunc = function(code2) {
              return __awaiter9(_this, void 0, void 0, function() {
                var result, error_3;
                return __generator9(this, function(_a4) {
                  switch (_a4.label) {
                    case 0:
                      result = void 0;
                      _a4.label = 1;
                    case 1:
                      _a4.trys.push([1, 4, , 5]);
                      return [4, this.oauthInstance.authApi.grantProviderToken({
                        provider_id: wxInfo === null || wxInfo === void 0 ? void 0 : wxInfo.appId,
                        provider_code: code2,
                        provider_params: {
                          provider_code_type: "open_id",
                          appid: wxInfo === null || wxInfo === void 0 ? void 0 : wxInfo.appId
                        }
                      })];
                    case 2:
                      result = _a4.sent();
                      if ((result === null || result === void 0 ? void 0 : result.error_code) || !result.provider_token) {
                        throw result;
                      }
                      return [4, this.oauthInstance.authApi.bindWithProvider({ provider_token: result.provider_token })];
                    case 3:
                      _a4.sent();
                      return [3, 5];
                    case 4:
                      error_3 = _a4.sent();
                      throw error_3;
                    case 5:
                      return [2];
                  }
                });
              });
            };
            return [4, new Promise(function(resolve, reject) {
              wx.login({
                success: function(res) {
                  return __awaiter9(_this, void 0, void 0, function() {
                    var error_4;
                    return __generator9(this, function(_a4) {
                      switch (_a4.label) {
                        case 0:
                          _a4.trys.push([0, 2, , 3]);
                          return [4, mainFunc(res.code)];
                        case 1:
                          _a4.sent();
                          resolve(true);
                          return [3, 3];
                        case 2:
                          error_4 = _a4.sent();
                          reject(error_4);
                          return [3, 3];
                        case 3:
                          return [2];
                      }
                    });
                  });
                },
                fail: function(res) {
                  var error = new Error(res === null || res === void 0 ? void 0 : res.errMsg);
                  error.code = res === null || res === void 0 ? void 0 : res.errno;
                  reject(error);
                }
              });
            })];
          case 1:
            _a3.sent();
            return [2];
        }
      });
    });
  };
  Auth3.prototype.signInWithUnionId = function() {
    return __awaiter9(this, void 0, void 0, function() {
      var error_5;
      var _this = this;
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            if (!esm_default.isMatch()) {
              throw Error("wx api undefined");
            }
            _a3.label = 1;
          case 1:
            _a3.trys.push([1, 3, , 4]);
            return [4, new Promise(function(resolve, reject) {
              var wxInfo = wx.getAccountInfoSync().miniProgram;
              wx.login({
                success: function(res) {
                  return __awaiter9(_this, void 0, void 0, function() {
                    var providerId, result, providerToken, signInRes, error_6;
                    return __generator9(this, function(_a4) {
                      switch (_a4.label) {
                        case 0:
                          providerId = wxInfo === null || wxInfo === void 0 ? void 0 : wxInfo.appId;
                          _a4.label = 1;
                        case 1:
                          _a4.trys.push([1, 4, , 5]);
                          return [4, this.oauthInstance.authApi.grantProviderToken({
                            provider_code: res.code,
                            provider_id: providerId,
                            provider_params: {
                              provider_code_type: "union_id",
                              appid: wxInfo === null || wxInfo === void 0 ? void 0 : wxInfo.appId
                            }
                          })];
                        case 2:
                          result = _a4.sent();
                          providerToken = result.provider_token;
                          if (!providerToken) {
                            reject(result);
                            return [2];
                          }
                          return [4, this.oauthInstance.authApi.signInWithProvider({
                            provider_id: providerId,
                            provider_token: providerToken
                          })];
                        case 3:
                          signInRes = _a4.sent();
                          if (signInRes === null || signInRes === void 0 ? void 0 : signInRes.error_code) {
                            reject(signInRes);
                            return [2];
                          }
                          resolve(true);
                          return [3, 5];
                        case 4:
                          error_6 = _a4.sent();
                          reject(error_6);
                          return [3, 5];
                        case 5:
                          return [2];
                      }
                    });
                  });
                },
                fail: function(res) {
                  var error = new Error(res === null || res === void 0 ? void 0 : res.errMsg);
                  error.code = res === null || res === void 0 ? void 0 : res.errno;
                  reject(error);
                }
              });
            })];
          case 2:
            _a3.sent();
            return [3, 4];
          case 3:
            error_5 = _a3.sent();
            throw error_5;
          case 4:
            return [2, this.createLoginState()];
        }
      });
    });
  };
  Auth3.prototype.signInWithSms = function(_a3) {
    var _b = _a3.verificationInfo, verificationInfo = _b === void 0 ? { verification_id: "", is_user: false } : _b, _c = _a3.verificationCode, verificationCode = _c === void 0 ? "" : _c, _d = _a3.phoneNum, phoneNum = _d === void 0 ? "" : _d, _e2 = _a3.bindInfo, bindInfo = _e2 === void 0 ? void 0 : _e2;
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_f) {
        try {
          return [2, this.signInWithUsername({
            verificationInfo,
            verificationCode,
            bindInfo,
            username: phoneNum,
            loginType: "sms"
          })];
        } catch (error) {
          throw error;
        }
        return [2];
      });
    });
  };
  Auth3.prototype.signInWithEmail = function(_a3) {
    var _b = _a3.verificationInfo, verificationInfo = _b === void 0 ? { verification_id: "", is_user: false } : _b, _c = _a3.verificationCode, verificationCode = _c === void 0 ? "" : _c, _d = _a3.bindInfo, bindInfo = _d === void 0 ? void 0 : _d, _e2 = _a3.email, email = _e2 === void 0 ? "" : _e2;
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_f) {
        try {
          return [2, this.signInWithUsername({
            verificationInfo,
            verificationCode,
            bindInfo,
            username: email,
            loginType: "email"
          })];
        } catch (error) {
          throw error;
        }
        return [2];
      });
    });
  };
  Auth3.prototype.setCustomSignFunc = function(getTickFn) {
    this.oauthInstance.authApi.setCustomSignFunc(getTickFn);
  };
  Auth3.prototype.signIn = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.oauthInstance.authApi.signIn(params)];
          case 1:
            _a3.sent();
            return [2, this.createLoginState(params)];
        }
      });
    });
  };
  Auth3.prototype.setPassword = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.setPassword(params)];
      });
    });
  };
  Auth3.prototype.isUsernameRegistered = function(username) {
    return __awaiter9(this, void 0, void 0, function() {
      var exist;
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            if (typeof username !== "string") {
              (0, import_util7.throwError)(import_constants4.ERRORS.INVALID_PARAMS, "username must be a string");
            }
            return [4, this.oauthInstance.authApi.checkIfUserExist({ username })];
          case 1:
            exist = _a3.sent().exist;
            return [2, exist];
        }
      });
    });
  };
  Auth3.prototype.hasLoginState = function() {
    var _a3;
    if (this.cache.mode === "async") {
      (0, import_util7.printWarn)(import_constants4.ERRORS.INVALID_OPERATION, "current platform's storage is asynchronous, please use getLoginState insteed");
      return;
    }
    var oauthLoginState = (_a3 = this.oauthInstance) === null || _a3 === void 0 ? void 0 : _a3.authApi.hasLoginStateSync();
    if (oauthLoginState) {
      var loginState = new LoginState({
        envId: this.config.env,
        cache: this.cache,
        oauthInstance: this.oauthInstance
      });
      return loginState;
    }
    return null;
  };
  Auth3.prototype.getLoginState = function() {
    return __awaiter9(this, void 0, void 0, function() {
      var oauthLoginState, error_7, loginState;
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            oauthLoginState = null;
            _a3.label = 1;
          case 1:
            _a3.trys.push([1, 3, , 4]);
            return [4, this.oauthInstance.authApi.getLoginState()];
          case 2:
            oauthLoginState = _a3.sent();
            return [3, 4];
          case 3:
            error_7 = _a3.sent();
            return [2, null];
          case 4:
            if (oauthLoginState) {
              loginState = new LoginState({
                envId: this.config.env,
                cache: this.cache,
                oauthInstance: this.oauthInstance
              });
              return [2, loginState];
            }
            return [2, null];
        }
      });
    });
  };
  Auth3.prototype.getUserInfo = function() {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.getCurrentUser()];
      });
    });
  };
  Auth3.prototype.getWedaUserInfo = function() {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.getWedaUserInfo()];
      });
    });
  };
  Auth3.prototype.updateUserBasicInfo = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      var loginState;
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.getLoginState()];
          case 1:
            loginState = _a3.sent();
            if (!loginState) return [3, 3];
            return [4, loginState.user.updateUserBasicInfo(params)];
          case 2:
            _a3.sent();
            _a3.label = 3;
          case 3:
            return [2];
        }
      });
    });
  };
  Auth3.prototype.getAuthHeader = function() {
    console.error("Auth.getAuthHeader API ");
    return {};
  };
  Auth3.prototype.bindWithProvider = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.bindWithProvider(params)];
      });
    });
  };
  Auth3.prototype.queryUser = function(queryObj) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.queryUserProfile(queryObj)];
      });
    });
  };
  Auth3.prototype.getAccessToken = function() {
    return __awaiter9(this, void 0, void 0, function() {
      var oauthAccessTokenRes;
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.oauthInstance.oauth2client.getAccessToken()];
          case 1:
            oauthAccessTokenRes = _a3.sent();
            return [2, {
              accessToken: oauthAccessTokenRes,
              env: this.config.env
            }];
        }
      });
    });
  };
  Auth3.prototype.grantProviderToken = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.grantProviderToken(params)];
      });
    });
  };
  Auth3.prototype.patchProviderToken = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.patchProviderToken(params)];
      });
    });
  };
  Auth3.prototype.signInWithProvider = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.oauthInstance.authApi.signInWithProvider(params)];
          case 1:
            _a3.sent();
            return [2, this.createLoginState(params)];
        }
      });
    });
  };
  Auth3.prototype.signInWithWechat = function(params) {
    if (params === void 0) {
      params = {};
    }
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.oauthInstance.authApi.signInWithWechat(params)];
          case 1:
            _a3.sent();
            return [2, this.createLoginState(params)];
        }
      });
    });
  };
  Auth3.prototype.grantToken = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.oauthInstance.authApi.grantToken(params)];
          case 1:
            _a3.sent();
            return [2, this.createLoginState()];
        }
      });
    });
  };
  Auth3.prototype.genProviderRedirectUri = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.genProviderRedirectUri(params)];
      });
    });
  };
  Auth3.prototype.resetPassword = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.resetPassword(params)];
      });
    });
  };
  Auth3.prototype.deviceAuthorize = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.deviceAuthorize(params)];
      });
    });
  };
  Auth3.prototype.sudo = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.sudo(params)];
      });
    });
  };
  Auth3.prototype.deleteMe = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.deleteMe(params)];
      });
    });
  };
  Auth3.prototype.getProviders = function() {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.getProviders()];
      });
    });
  };
  Auth3.prototype.loginScope = function() {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.loginScope()];
      });
    });
  };
  Auth3.prototype.loginGroups = function() {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.loginGroups()];
      });
    });
  };
  Auth3.prototype.onLoginStateChanged = function(callback) {
    var _a3;
    return __awaiter9(this, void 0, void 0, function() {
      var loginState;
      var _this = this;
      return __generator9(this, function(_b) {
        switch (_b.label) {
          case 0:
            (_a3 = this.config.eventBus) === null || _a3 === void 0 ? void 0 : _a3.on(EVENTS.LOGIN_STATE_CHANGED, function(params) {
              return __awaiter9(_this, void 0, void 0, function() {
                var loginState2, _a4;
                var _b2;
                return __generator9(this, function(_c) {
                  switch (_c.label) {
                    case 0:
                      if (!(((_b2 = params === null || params === void 0 ? void 0 : params.data) === null || _b2 === void 0 ? void 0 : _b2.eventType) !== LOGIN_STATE_CHANGED_TYPE.CREDENTIALS_ERROR)) return [3, 2];
                      return [4, this.getLoginState()];
                    case 1:
                      _a4 = _c.sent();
                      return [3, 3];
                    case 2:
                      _a4 = {};
                      _c.label = 3;
                    case 3:
                      loginState2 = _a4;
                      callback.call(this, __assign11(__assign11({}, params), loginState2));
                      return [2];
                  }
                });
              });
            });
            return [4, this.getLoginState()];
          case 1:
            loginState = _b.sent();
            callback.call(this, loginState);
            return [2];
        }
      });
    });
  };
  Auth3.prototype.refreshTokenForce = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.refreshTokenForce(params)];
      });
    });
  };
  Auth3.prototype.getCredentials = function() {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.getCredentials()];
      });
    });
  };
  Auth3.prototype.setCredentials = function(credentials) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.oauthInstance.oauth2client.setCredentials(credentials)];
          case 1:
            _a3.sent();
            return [2];
        }
      });
    });
  };
  Auth3.prototype.getProviderSubType = function() {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.getProviderSubType()];
      });
    });
  };
  Auth3.prototype.createCaptchaData = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.createCaptchaData(params)];
      });
    });
  };
  Auth3.prototype.verifyCaptchaData = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.verifyCaptchaData(params)];
      });
    });
  };
  Auth3.prototype.getMiniProgramQrCode = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.getMiniProgramCode(params)];
      });
    });
  };
  Auth3.prototype.getMiniProgramQrCodeStatus = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.getMiniProgramQrCodeStatus(params)];
      });
    });
  };
  Auth3.prototype.modifyPassword = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.modifyPassword(params)];
      });
    });
  };
  Auth3.prototype.modifyPasswordWithoutLogin = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.modifyPasswordWithoutLogin(params)];
      });
    });
  };
  Auth3.prototype.getUserBehaviorLog = function(params) {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        return [2, this.oauthInstance.authApi.getUserBehaviorLog(params)];
      });
    });
  };
  Auth3.prototype.signInWithUsername = function(_a3) {
    var _b = _a3.verificationInfo, verificationInfo = _b === void 0 ? { verification_id: "", is_user: false } : _b, _c = _a3.verificationCode, verificationCode = _c === void 0 ? "" : _c, _d = _a3.username, rawUsername = _d === void 0 ? "" : _d, _e2 = _a3.bindInfo, bindInfo = _e2 === void 0 ? void 0 : _e2, _f = _a3.loginType, loginType = _f === void 0 ? "" : _f;
    return __awaiter9(this, void 0, void 0, function() {
      var verifyRes, verification_token, username, signUpParam, signInRes, bindRes, signUpRes, error_8;
      return __generator9(this, function(_g) {
        switch (_g.label) {
          case 0:
            _g.trys.push([0, 8, , 9]);
            return [4, this.oauthInstance.authApi.verify({
              verification_id: verificationInfo.verification_id,
              verification_code: verificationCode
            })];
          case 1:
            verifyRes = _g.sent();
            if (verifyRes === null || verifyRes === void 0 ? void 0 : verifyRes.error_code) {
              throw verifyRes;
            }
            verification_token = verifyRes.verification_token;
            username = /^\+\d{1,3}\s+/.test(rawUsername) ? rawUsername : "+86 ".concat(rawUsername);
            signUpParam = { phone_number: username };
            if (loginType === "email") {
              username = rawUsername;
              signUpParam = { email: username };
            }
            if (!verificationInfo.is_user) return [3, 5];
            return [4, this.oauthInstance.authApi.signIn({
              username,
              verification_token
            })];
          case 2:
            signInRes = _g.sent();
            if (signInRes === null || signInRes === void 0 ? void 0 : signInRes.error_code) {
              throw signInRes;
            }
            if (!bindInfo) return [3, 4];
            return [4, this.oauthInstance.authApi.bindWithProvider({
              provider_token: bindInfo === null || bindInfo === void 0 ? void 0 : bindInfo.providerToken
            })];
          case 3:
            bindRes = _g.sent();
            if (bindRes === null || bindRes === void 0 ? void 0 : bindRes.error_code) {
              throw bindRes;
            }
            _g.label = 4;
          case 4:
            return [3, 7];
          case 5:
            return [4, this.oauthInstance.authApi.signUp(__assign11(__assign11({}, signUpParam), { verification_token, provider_token: bindInfo === null || bindInfo === void 0 ? void 0 : bindInfo.providerId }))];
          case 6:
            signUpRes = _g.sent();
            if (signUpRes === null || signUpRes === void 0 ? void 0 : signUpRes.error_code) {
              throw signUpRes;
            }
            _g.label = 7;
          case 7:
            return [2, this.createLoginState()];
          case 8:
            error_8 = _g.sent();
            throw error_8;
          case 9:
            return [2];
        }
      });
    });
  };
  Auth3.prototype.createLoginState = function(params, options) {
    var _a3, _b;
    return __awaiter9(this, void 0, void 0, function() {
      var loginState;
      return __generator9(this, function(_c) {
        switch (_c.label) {
          case 0:
            loginState = new LoginState({
              envId: this.config.env,
              cache: this.cache,
              oauthInstance: this.oauthInstance
            });
            return [4, loginState.checkLocalStateAsync()];
          case 1:
            _c.sent();
            if (!(options === null || options === void 0 ? void 0 : options.userInfo)) return [3, 2];
            loginState.user.setLocalUserInfo(options.userInfo);
            return [3, 5];
          case 2:
            if (!(options === null || options === void 0 ? void 0 : options.asyncRefreshUser)) return [3, 3];
            loginState.user.refresh(params);
            return [3, 5];
          case 3:
            return [4, loginState.user.refresh(params)];
          case 4:
            _c.sent();
            _c.label = 5;
          case 5:
            (_a3 = this.config.eventBus) === null || _a3 === void 0 ? void 0 : _a3.fire(EVENTS.LOGIN_STATE_CHANGED, { eventType: LOGIN_STATE_CHANGED_TYPE.SIGN_IN });
            (_b = this.config.eventBus) === null || _b === void 0 ? void 0 : _b.fire(EVENTS.AUTH_STATE_CHANGED, { event: AUTH_STATE_CHANGED_TYPE.SIGNED_IN });
            return [2, loginState];
        }
      });
    });
  };
  Auth3.prototype.setAccessKey = function() {
    return __awaiter9(this, void 0, void 0, function() {
      return __generator9(this, function(_a3) {
        if (this.config.accessKey) {
          try {
            this.oauthInstance.oauth2client.setAccessKeyCredentials({
              access_token: this.config.accessKey,
              token_type: "Bearer",
              scope: "accessKey",
              expires_at: /* @__PURE__ */ new Date(+/* @__PURE__ */ new Date() + +/* @__PURE__ */ new Date()),
              expires_in: +/* @__PURE__ */ new Date() + +/* @__PURE__ */ new Date()
            });
          } catch (error) {
            console.warn("accessKey error: ", error);
          }
        }
        return [2];
      });
    });
  };
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  auth().bindPhoneNumber() ",
        "  2 - ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object]),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "bindPhoneNumber", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  auth().unbindProvider() ",
        "  2 - ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object]),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "unbindProvider", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  auth().bindEmail() ",
        "  2 - ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object]),
    __metadata2("design:returntype", void 0)
  ], Auth3.prototype, "bindEmail", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  auth().verify() ",
        "  2 - /",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object]),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "verify", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  auth().getVerification() ",
        "  2 - /",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object, Object]),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "getVerification", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  auth().getCurrentUser() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", []),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "getCurrentUser", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 - ",
        "  2 -  auth().signInAnonymouslyInWx() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object]),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "signInAnonymouslyInWx", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "OpenID",
      messages: [
        "",
        "  1 - openId",
        "  2 -  auth().bindOpenId() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", []),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "bindOpenId", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "unionId",
      messages: [
        "",
        "  1 - unionId",
        "  2 -  auth().signInWithUnionId() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", []),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "signInWithUnionId", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 - ",
        "  2 -  auth().signInWithSms() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object]),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "signInWithSms", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 - ",
        "  2 -  auth().signInWithEmail() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object]),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "signInWithEmail", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  auth().isUsernameRegistered() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [String]),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "isUsernameRegistered", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  auth().getLoginState() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", []),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "getLoginState", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 - ",
        "  2 -  auth().getUserInfo() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", []),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "getUserInfo", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 - ",
        "  2 -  auth().getWedaUserInfo() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", []),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "getWedaUserInfo", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  auth().bindWithProvider() ",
        "  2 - ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", [Object]),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "bindWithProvider", null);
  __decorate2([
    (0, import_helpers.catchErrorsDecorator)({
      title: "",
      messages: [
        "",
        "  1 -  auth().getProviderSubType() ",
        "".concat(import_constants4.COMMUNITY_SITE_URL)
      ]
    }),
    __metadata2("design:type", Function),
    __metadata2("design:paramtypes", []),
    __metadata2("design:returntype", Promise)
  ], Auth3.prototype, "getProviderSubType", null);
  return Auth3;
}(SbaseApi);
function generateAuthInstance(config, options) {
  var _this = this;
  var _a3 = config.region, region = _a3 === void 0 ? "ap-shanghai" : _a3, i18n = config.i18n, accessKey = config.accessKey, useWxCloud = config.useWxCloud;
  var platform = (options === null || options === void 0 ? void 0 : options.platform) || import_adapters.useDefaultAdapter.bind(options)();
  var runtime2 = platform.runtime, adapter2 = platform.adapter;
  var _b = options || {}, env = _b.env, clientId = _b.clientId, debug = _b.debug, cache = _b.cache, cloudbase3 = _b.app;
  var apiOrigin = (options || {}).apiOrigin;
  if (!apiOrigin) {
    apiOrigin = "https://".concat(env, ".").concat(region, ".tcb-api.tencentcloudapi.com");
  }
  var commonOpts = {
    env,
    clientId,
    i18n,
    accessKey,
    useWxCloud,
    eventBus: new import_events3.CloudbaseEventEmitter()
  };
  var oauthInstance = new CloudbaseOAuth(useAuthAdapter(__assign11(__assign11({}, commonOpts), { apiOrigin, apiPath: (config === null || config === void 0 ? void 0 : config.apiPath) || AUTH_API_PREFIX, storage: config === null || config === void 0 ? void 0 : config.storage, baseRequest: config === null || config === void 0 ? void 0 : config.baseRequest, request: config === null || config === void 0 ? void 0 : config.request, anonymousSignInFunc: config === null || config === void 0 ? void 0 : config.anonymousSignInFunc, captchaOptions: config === null || config === void 0 ? void 0 : config.captchaOptions, wxCloud: config === null || config === void 0 ? void 0 : config.wxCloud, adapter: adapter2, onCredentialsError: onCredentialsError(commonOpts.eventBus), headers: __assign11({ "X-SDK-Version": "@cloudbase/js-sdk/".concat(config.sdkVersion) }, config.headers || {}), detectSessionInUrl: config.detectSessionInUrl, debug })));
  var authInstance = new Auth2(__assign11(__assign11({}, commonOpts), { region, persistence: config.persistence, debug, cache: cache || new import_cache3.CloudbaseCache({
    persistence: config.persistence,
    keys: { userInfoKey: "user_info_".concat(env) },
    platformInfo: platform
  }), runtime: runtime2 || "web", _fromApp: cloudbase3, oauthInstance }));
  oauthInstance.initializeSession(function(data2, error) {
    return __awaiter9(_this, void 0, void 0, function() {
      return __generator9(this, function(_a4) {
        if (!data2)
          return [2];
        if (data2.type === OAUTH_TYPE.SIGN_IN) {
          if (error) {
            commonOpts.eventBus.fire(EVENTS.AUTH_STATE_CHANGED, {
              event: AUTH_STATE_CHANGED_TYPE.SIGNED_IN,
              info: __assign11(__assign11({}, data2), { error })
            });
          } else if (data2.user) {
            authInstance.createLoginState({}, { userInfo: data2.user });
          }
        } else if (data2.type === OAUTH_TYPE.BIND_IDENTITY) {
          commonOpts.eventBus.fire(EVENTS.AUTH_STATE_CHANGED, {
            event: AUTH_STATE_CHANGED_TYPE.BIND_IDENTITY,
            info: __assign11(__assign11({}, data2), { error })
          });
        }
        return [2];
      });
    });
  });
  return { authInstance, oauthInstance };
}
var NAMESPACE = "auth";
var component = {
  name: COMPONENT_NAME,
  namespace: NAMESPACE,
  entity: function(config) {
    var auth = function(config2) {
      var _a3;
      if (this.authInstance && !config2) {
        return this.authInstance;
      }
      config2 = config2 || {
        region: "",
        persistence: "local",
        apiPath: AUTH_API_PREFIX
      };
      var adapter2 = this.platform.adapter;
      var newPersistence = config2.persistence || adapter2.primaryStorage;
      if (newPersistence && newPersistence !== this.config.persistence) {
        this.updateConfig({ persistence: newPersistence });
      }
      var _b = generateAuthInstance(__assign11(__assign11({ wxCloud: this.config.wxCloud, storage: this.config.storage }, config2), { persistence: this.config.persistence, i18n: this.config.i18n, accessKey: this.config.accessKey, useWxCloud: this.config.useWxCloud, sdkVersion: this.version, detectSessionInUrl: (_a3 = this.config.auth) === null || _a3 === void 0 ? void 0 : _a3.detectSessionInUrl }), {
        env: this.config.env,
        clientId: this.config.clientId,
        apiOrigin: this.request.getBaseEndPoint(this.config.endPointMode || "CLOUD_API"),
        platform: this.platform,
        cache: this.cache,
        app: this,
        debug: this.config.debug
      }), authInstance = _b.authInstance, oauthInstance = _b.oauthInstance;
      this.oauthInstance = oauthInstance;
      this.authInstance = authInstance;
      return this.authInstance;
    };
    var authProto = auth.call(this, config);
    Object.assign(auth, authProto);
    Object.setPrototypeOf(auth, Object.getPrototypeOf(authProto));
    this[NAMESPACE] = auth;
    return auth;
  }
};
try {
  cloudbase.registerComponent(component);
} catch (e3) {
}
function registerAuth(app) {
  try {
    app.registerComponent(component);
  } catch (e3) {
    console.warn(e3);
  }
}

// node_modules/@cloudbase/cloudrun/dist/esm/index.js
var __assign12 = function() {
  __assign12 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign12.apply(this, arguments);
};
var __awaiter10 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator10 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var ERRORS6 = constants_exports.ERRORS;
var COMPONENT_NAME2 = "cloudrun";
var CloudbaseRun = function() {
  function CloudbaseRun2() {
  }
  CloudbaseRun2.prototype.callContainer = function(options, customReqOpts) {
    return __awaiter10(this, void 0, void 0, function() {
      var name, data2, jsonData;
      return __generator10(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            name = options.name, data2 = options.data;
            if (!name) {
              throw new Error(JSON.stringify({
                code: ERRORS6.INVALID_PARAMS,
                msg: "[".concat(COMPONENT_NAME2, ".callContainer] invalid name")
              }));
            }
            try {
              jsonData = data2 ? JSON.stringify(data2) : "";
            } catch (e3) {
              throw new Error(JSON.stringify({
                code: ERRORS6.INVALID_PARAMS,
                msg: "[".concat(COMPONENT_NAME2, ".callContainer] invalid data")
              }));
            }
            return [4, requestContainer.call(this, __assign12(__assign12({}, options), { data: jsonData }), customReqOpts)];
          case 1:
            return [2, _a3.sent()];
        }
      });
    });
  };
  return CloudbaseRun2;
}();
function requestContainer(options, customReqOpts) {
  return __awaiter10(this, void 0, void 0, function() {
    var name, data2, _a3, path2, method, _b, header, _c, BASE_URL, PROTOCOL2, endpoint, reqPath, response;
    return __generator10(this, function(_d) {
      switch (_d.label) {
        case 0:
          name = options.name, data2 = options.data, _a3 = options.path, path2 = _a3 === void 0 ? "" : _a3, method = options.method, _b = options.header, header = _b === void 0 ? {} : _b;
          _c = this.getEndPointWithKey("GATEWAY"), BASE_URL = _c.BASE_URL, PROTOCOL2 = _c.PROTOCOL;
          endpoint = "".concat(PROTOCOL2).concat(BASE_URL, "/cloudrun/").concat(name);
          reqPath = path2.startsWith("/") ? path2 : "/".concat(path2);
          return [4, this.request.fetch({
            method: method || "POST",
            headers: Object.assign({}, {
              "Content-Type": "application/json; charset=utf-8"
            }, header),
            body: data2,
            url: "".concat(endpoint).concat(reqPath),
            customReqOpts
          })];
        case 1:
          response = _d.sent();
          if ((customReqOpts === null || customReqOpts === void 0 ? void 0 : customReqOpts.from) === "node-sdk") {
            return [2, response];
          }
          return [4, response.data];
        case 2:
          return [2, _d.sent()];
      }
    });
  });
}
var cloudbaseRun = new CloudbaseRun();
var component2 = {
  name: COMPONENT_NAME2,
  entity: {
    callContainer: cloudbaseRun.callContainer
  }
};
try {
  cloudbase.registerComponent(component2);
} catch (e3) {
}
function registerCloudrun(app) {
  try {
    app.registerComponent(component2);
  } catch (e3) {
    console.warn(e3);
  }
}
try {
  window.registerCloudrun = registerCloudrun;
} catch (e3) {
}

// node_modules/@cloudbase/functions/dist/esm/index.js
var __assign13 = function() {
  __assign13 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign13.apply(this, arguments);
};
var __decorate3 = function(decorators, target, key, desc) {
  var c2 = arguments.length, r3 = c2 < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d2;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r3 = Reflect.decorate(decorators, target, key, desc);
  else for (var i2 = decorators.length - 1; i2 >= 0; i2--) if (d2 = decorators[i2]) r3 = (c2 < 3 ? d2(r3) : c2 > 3 ? d2(target, key, r3) : d2(target, key)) || r3;
  return c2 > 3 && r3 && Object.defineProperty(target, key, r3), r3;
};
var __metadata3 = function(k2, v2) {
  if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k2, v2);
};
var __awaiter11 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator11 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var getSdkName3 = constants_exports.getSdkName;
var ERRORS7 = constants_exports.ERRORS;
var COMMUNITY_SITE_URL4 = constants_exports.COMMUNITY_SITE_URL;
var execCallback2 = util_exports.execCallback;
var catchErrorsDecorator4 = helpers_exports.catchErrorsDecorator;
var COMPONENT_NAME3 = "functions";
var CloudbaseFunctions = function() {
  function CloudbaseFunctions2() {
  }
  CloudbaseFunctions2.prototype.callFunction = function(options, callback, customReqOpts) {
    var _a3, _b, _c;
    return __awaiter11(this, void 0, void 0, function() {
      var name, data2, query, parse2, search, type, _d, path2, method, _e2, header, jsonData, requestId, result, _f, request, config, action, params, res, response, result, e_1;
      return __generator11(this, function(_g) {
        switch (_g.label) {
          case 0:
            name = options.name, data2 = options.data, query = options.query, parse2 = options.parse, search = options.search, type = options.type, _d = options.path, path2 = _d === void 0 ? "" : _d, method = options.method, _e2 = options.header, header = _e2 === void 0 ? {} : _e2;
            if (!name) {
              throw new Error(JSON.stringify({
                code: ERRORS7.INVALID_PARAMS,
                msg: "[".concat(COMPONENT_NAME3, ".callFunction] invalid function name")
              }));
            }
            try {
              jsonData = data2 ? JSON.stringify(data2) : "";
            } catch (e3) {
              throw new Error(JSON.stringify({
                code: ERRORS7.INVALID_PARAMS,
                msg: "[".concat(COMPONENT_NAME3, ".callFunction] invalid data")
              }));
            }
            if (!(type === "cloudrun")) return [3, 2];
            requestId = util_exports.generateRequestId();
            return [4, requestContainer.call(this, {
              name,
              data: jsonData,
              path: path2,
              method,
              header: __assign13(__assign13({}, header), { "X-Request-Id": requestId })
            })];
          case 1:
            result = _g.sent();
            return [2, {
              result,
              requestId
            }];
          case 2:
            _f = this, request = _f.request, config = _f.config;
            action = "functions.invokeFunction";
            params = {
              inQuery: query,
              parse: parse2,
              search,
              function_name: name,
              request_data: jsonData
            };
            res = {};
            _g.label = 3;
          case 3:
            _g.trys.push([3, 8, , 9]);
            if (!(config.endPointMode === "GATEWAY")) return [3, 5];
            return [4, request.gateWay(__assign13(__assign13({}, options), { path: "functions" }), customReqOpts)];
          case 4:
            response = _g.sent();
            res = __assign13({ requestId: response.requestId }, ((_a3 = response.data) === null || _a3 === void 0 ? void 0 : _a3.code) ? response.data : {
              data: {
                response_data: response.data
              }
            });
            return [3, 7];
          case 5:
            return [4, request.send(action, params, {
              defaultQuery: ((_b = data2 === null || data2 === void 0 ? void 0 : data2.params) === null || _b === void 0 ? void 0 : _b.action) ? { action: (_c = data2 === null || data2 === void 0 ? void 0 : data2.params) === null || _c === void 0 ? void 0 : _c.action } : {}
            }, customReqOpts)];
          case 6:
            res = _g.sent();
            _g.label = 7;
          case 7:
            if (res.code) {
              return [2, execCallback2(callback, null, res)];
            }
            result = res.data.response_data;
            if (parse2 || config.endPointMode === "GATEWAY") {
              return [2, execCallback2(callback, null, {
                result,
                requestId: res.requestId
              })];
            }
            try {
              result = JSON.parse(res.data.response_data);
              return [2, execCallback2(callback, null, {
                result,
                requestId: res.requestId
              })];
            } catch (e3) {
              execCallback2(callback, new Error("[".concat(getSdkName3(), "][").concat(ERRORS7.INVALID_PARAMS, "][").concat(COMPONENT_NAME3, ".callFunction] response data must be json")));
            }
            return [3, 9];
          case 8:
            e_1 = _g.sent();
            execCallback2(callback, e_1);
            return [3, 9];
          case 9:
            return [2];
        }
      });
    });
  };
  __decorate3([
    catchErrorsDecorator4({
      customInfo: {
        className: "Cloudbase",
        methodName: "callFunction"
      },
      title: "",
      messages: [
        "",
        "  1 -  callFunction() ",
        "  2 - ",
        "  3 - ",
        "".concat(COMMUNITY_SITE_URL4)
      ]
    }),
    __metadata3("design:type", Function),
    __metadata3("design:paramtypes", [Object, Function, Object]),
    __metadata3("design:returntype", Promise)
  ], CloudbaseFunctions2.prototype, "callFunction", null);
  return CloudbaseFunctions2;
}();
var cloudbaseFunctions = new CloudbaseFunctions();
var component3 = {
  name: COMPONENT_NAME3,
  entity: {
    callFunction: cloudbaseFunctions.callFunction
  }
};
try {
  cloudbase.registerComponent(component3);
} catch (e3) {
}
function registerFunctions(app) {
  try {
    app.registerComponent(component3);
  } catch (e3) {
    console.warn(e3);
  }
}

// node_modules/@cloudbase/storage/dist/esm/storage.js
var __assign14 = function() {
  __assign14 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign14.apply(this, arguments);
};
var __decorate4 = function(decorators, target, key, desc) {
  var c2 = arguments.length, r3 = c2 < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d2;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r3 = Reflect.decorate(decorators, target, key, desc);
  else for (var i2 = decorators.length - 1; i2 >= 0; i2--) if (d2 = decorators[i2]) r3 = (c2 < 3 ? d2(r3) : c2 > 3 ? d2(target, key, r3) : d2(target, key)) || r3;
  return c2 > 3 && r3 && Object.defineProperty(target, key, r3), r3;
};
var __metadata4 = function(k2, v2) {
  if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k2, v2);
};
var __awaiter12 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator12 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var EUploadMethod;
(function(EUploadMethod2) {
  EUploadMethod2["put"] = "put";
  EUploadMethod2["post"] = "post";
})(EUploadMethod || (EUploadMethod = {}));
var getSdkName4 = constants_exports.getSdkName;
var ERRORS8 = constants_exports.ERRORS;
var COMMUNITY_SITE_URL5 = constants_exports.COMMUNITY_SITE_URL;
var isArray2 = util_exports.isArray;
var isString2 = util_exports.isString;
var isPalinObject2 = util_exports.isPalinObject;
var execCallback3 = util_exports.execCallback;
var catchErrorsDecorator5 = helpers_exports.catchErrorsDecorator;
var COMPONENT_NAME4 = "storage";
var storageGateWay = {
  getUploadInfo: function(request, params, customReqOpts) {
    return __awaiter12(void 0, void 0, void 0, function() {
      var res, data2;
      var _a3;
      return __generator12(this, function(_b) {
        switch (_b.label) {
          case 0:
            return [4, request.gateWay({
              path: "storages",
              name: "get-objects-upload-info",
              data: [
                __assign14({ objectId: params.path }, params.headers ? { signedHeader: params.headers } : {})
              ]
            }, customReqOpts)];
          case 1:
            res = _b.sent();
            data2 = ((_a3 = res.data) === null || _a3 === void 0 ? void 0 : _a3[0]) || {};
            res = __assign14(__assign14({}, res), { data: __assign14(__assign14({}, data2.code ? __assign14({}, data2) : {}), { authorization: data2.authorization, token: data2.token, url: data2.uploadUrl, fileId: data2.cloudObjectId, cosFileId: data2.cloudObjectMeta, download_url: data2.downloadUrl }) });
            return [2, res];
        }
      });
    });
  },
  getDownLoadInfo: function(request, params, customReqOpts) {
    return __awaiter12(void 0, void 0, void 0, function() {
      var res;
      var _a3;
      return __generator12(this, function(_b) {
        switch (_b.label) {
          case 0:
            return [4, request.gateWay({
              path: "storages",
              name: "get-objects-download-info",
              data: params.convertedFileList.map(function(v2) {
                return { cloudObjectId: v2.fileid };
              })
            }, customReqOpts)];
          case 1:
            res = _b.sent();
            res = __assign14(__assign14({}, res), { data: {
              download_list: (_a3 = res.data) === null || _a3 === void 0 ? void 0 : _a3.map(function(v2) {
                return {
                  code: v2.code || "SUCCESS",
                  message: v2.message,
                  fileid: v2.cloudObjectId,
                  download_url: v2.downloadUrl,
                  fileID: v2.cloudObjectId,
                  tempFileURL: v2.downloadUrl
                };
              })
            } });
            return [2, res];
        }
      });
    });
  },
  delete: function(request, params, customReqOpts) {
    return __awaiter12(void 0, void 0, void 0, function() {
      var res;
      var _a3;
      return __generator12(this, function(_b) {
        switch (_b.label) {
          case 0:
            return [4, request.gateWay({
              path: "storages",
              name: "delete-objects",
              data: params.fileList.map(function(v2) {
                return { cloudObjectId: v2 };
              })
            }, customReqOpts)];
          case 1:
            res = _b.sent();
            res = __assign14(__assign14({}, res), { data: {
              delete_list: (_a3 = res.data) === null || _a3 === void 0 ? void 0 : _a3.map(function(v2) {
                return {
                  code: v2.code || "SUCCESS",
                  fileID: v2.cloudObjectId,
                  message: v2.message
                };
              })
            } });
            return [2, res];
        }
      });
    });
  },
  copyFile: function(request, params, customReqOpts) {
    return __awaiter12(void 0, void 0, void 0, function() {
      var res;
      var _a3;
      return __generator12(this, function(_b) {
        switch (_b.label) {
          case 0:
            return [4, request.gateWay({
              path: "storages",
              name: "copy-objects",
              data: params.convertedFileList.map(function(v2) {
                return {
                  srcPath: v2.src_path,
                  dstPath: v2.dst_path,
                  overwrite: v2.overwrite,
                  removeOriginal: v2.remove_original
                };
              })
            }, customReqOpts)];
          case 1:
            res = _b.sent();
            res = __assign14(__assign14({}, res), { data: {
              copy_list: (_a3 = res.data) === null || _a3 === void 0 ? void 0 : _a3.map(function(v2) {
                return {
                  code: v2.code || "SUCCESS",
                  fileID: v2.cloudObjectId,
                  message: v2.message
                };
              })
            } });
            return [2, res];
        }
      });
    });
  }
};
var CloudbaseStorage = function() {
  function CloudbaseStorage2() {
  }
  CloudbaseStorage2.prototype.isGateWay = function() {
    var config = this.config;
    var endPointMode = config.endPointMode || "CLOUD_API";
    return endPointMode === "GATEWAY";
  };
  CloudbaseStorage2.prototype.uploadFile = function(params, callback) {
    return __awaiter12(this, void 0, void 0, function() {
      var cloudPath, filePath, onUploadProgress, method, headers, fileContent, uploadMethod, metadataResult, metadata, requestId, url2, authorization, token, fileId, cosFileId, downloadUrl, commonParams, putParams, postParams, uploadConfig, res;
      var _a3, _b, _c;
      return __generator12(this, function(_d) {
        switch (_d.label) {
          case 0:
            cloudPath = params.cloudPath, filePath = params.filePath, onUploadProgress = params.onUploadProgress, method = (_a3 = params.method, _a3 === void 0 ? "put" : _a3), headers = (_b = params.headers, _b === void 0 ? {} : _b), fileContent = params.fileContent;
            if (!isString2(cloudPath) || !filePath && !fileContent) {
              throw new Error(JSON.stringify({
                code: ERRORS8.INVALID_PARAMS,
                msg: "[".concat(COMPONENT_NAME4, ".uploadFile] invalid params")
              }));
            }
            uploadMethod = { put: EUploadMethod.put, post: EUploadMethod.post }[method.toLocaleLowerCase()] || EUploadMethod.put;
            return [4, this.getUploadMetadata({
              cloudPath,
              method: uploadMethod,
              headers: uploadMethod === EUploadMethod.put ? headers : void 0,
              customReqOpts: params.customReqOpts
            })];
          case 1:
            metadataResult = _d.sent();
            metadata = metadataResult.data, requestId = metadataResult.requestId;
            url2 = metadata.url, authorization = metadata.authorization, token = metadata.token, fileId = metadata.fileId, cosFileId = metadata.cosFileId, downloadUrl = metadata.download_url;
            commonParams = {
              url: url2,
              file: filePath,
              name: cloudPath,
              onUploadProgress,
              fileContent,
              fileId,
              requestId
            };
            putParams = __assign14(__assign14({}, commonParams), { method: EUploadMethod.put, headers: __assign14(__assign14({}, headers), { authorization, "x-cos-meta-fileid": cosFileId, "x-cos-security-token": token }) });
            postParams = __assign14(__assign14({}, commonParams), { method: EUploadMethod.post, data: {
              key: cloudPath,
              signature: authorization,
              "x-cos-meta-fileid": cosFileId,
              success_action_status: "201",
              "x-cos-security-token": token
            } });
            uploadConfig = (_c = {}, _c[EUploadMethod.put] = {
              params: putParams,
              isSuccess: function(code2) {
                return code2 >= 200 && code2 < 300;
              }
            }, _c[EUploadMethod.post] = {
              params: postParams,
              isSuccess: function(code2) {
                return code2 === 201;
              }
            }, _c);
            return [4, this.request.upload(uploadConfig[uploadMethod].params)];
          case 2:
            res = _d.sent();
            if (uploadConfig[uploadMethod].isSuccess(res.statusCode)) {
              return [2, execCallback3(callback, null, {
                fileID: fileId,
                download_url: downloadUrl,
                requestId
              })];
            }
            return [2, execCallback3(callback, new Error("[".concat(getSdkName4(), "][").concat(ERRORS8.OPERATION_FAIL, "][").concat(COMPONENT_NAME4, "]:").concat(res.data)))];
        }
      });
    });
  };
  CloudbaseStorage2.prototype.getUploadMetadata = function(params, callback) {
    return __awaiter12(this, void 0, void 0, function() {
      var cloudPath, method, headers, request, action, metaData, metaDataParam, err_1;
      return __generator12(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            cloudPath = params.cloudPath, method = params.method, headers = params.headers;
            if (!isString2(cloudPath)) {
              throw new Error(JSON.stringify({
                code: ERRORS8.INVALID_PARAMS,
                msg: "[".concat(COMPONENT_NAME4, ".getUploadMetadata] invalid cloudPath")
              }));
            }
            request = this.request;
            action = "storage.getUploadMetadata";
            _a3.label = 1;
          case 1:
            _a3.trys.push([1, 6, , 7]);
            metaData = void 0;
            metaDataParam = { path: cloudPath };
            if (method) {
              metaDataParam.method = method;
            }
            if (method === EUploadMethod.put && headers) {
              metaDataParam.headers = headers;
            }
            if (!this.isGateWay()) return [3, 3];
            return [4, storageGateWay.getUploadInfo(request, metaDataParam, params.customReqOpts)];
          case 2:
            metaData = _a3.sent();
            return [3, 5];
          case 3:
            return [4, request.send(action, metaDataParam, params.customReqOpts)];
          case 4:
            metaData = _a3.sent();
            _a3.label = 5;
          case 5:
            return [2, execCallback3(callback, null, metaData)];
          case 6:
            err_1 = _a3.sent();
            return [2, execCallback3(callback, err_1)];
          case 7:
            return [2];
        }
      });
    });
  };
  CloudbaseStorage2.prototype.deleteFile = function(params, callback) {
    return __awaiter12(this, void 0, void 0, function() {
      var fileList, _i, fileList_1, fileId, action, request, res, data2;
      return __generator12(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            fileList = params.fileList;
            if (!fileList || !isArray2(fileList) || fileList.length === 0) {
              throw new Error(JSON.stringify({
                code: ERRORS8.INVALID_PARAMS,
                msg: "[".concat(COMPONENT_NAME4, ".deleteFile] fileList must not be empty")
              }));
            }
            for (_i = 0, fileList_1 = fileList; _i < fileList_1.length; _i++) {
              fileId = fileList_1[_i];
              if (!fileId || !isString2(fileId)) {
                throw new Error(JSON.stringify({
                  code: ERRORS8.INVALID_PARAMS,
                  msg: "[".concat(COMPONENT_NAME4, ".deleteFile] fileID must be string")
                }));
              }
            }
            action = "storage.batchDeleteFile";
            request = this.request;
            res = {};
            if (!this.isGateWay()) return [3, 2];
            return [4, storageGateWay.delete(request, { fileList }, params.customReqOpts)];
          case 1:
            res = _a3.sent();
            return [3, 4];
          case 2:
            return [4, request.send(action, {
              fileid_list: fileList
            }, params.customReqOpts)];
          case 3:
            res = _a3.sent();
            _a3.label = 4;
          case 4:
            if (res.code) {
              return [2, execCallback3(callback, null, res)];
            }
            data2 = {
              fileList: res.data.delete_list,
              requestId: res.requestId
            };
            return [2, execCallback3(callback, null, data2)];
        }
      });
    });
  };
  CloudbaseStorage2.prototype.getTempFileURL = function(params, callback) {
    return __awaiter12(this, void 0, void 0, function() {
      var fileList, convertedFileList, _i, fileList_2, file, action, request, res;
      return __generator12(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            fileList = params.fileList;
            if (!fileList || !isArray2(fileList) || fileList.length === 0) {
              throw new Error(JSON.stringify({
                code: ERRORS8.INVALID_PARAMS,
                msg: "[".concat(COMPONENT_NAME4, ".getTempFileURL] fileList must not be empty")
              }));
            }
            convertedFileList = [];
            for (_i = 0, fileList_2 = fileList; _i < fileList_2.length; _i++) {
              file = fileList_2[_i];
              if (isPalinObject2(file)) {
                if (!Object.prototype.hasOwnProperty.call(file, "fileID")) {
                  throw new Error(JSON.stringify({
                    code: ERRORS8.INVALID_PARAMS,
                    msg: "[".concat(COMPONENT_NAME4, ".getTempFileURL] file info must include fileID")
                  }));
                }
                convertedFileList.push({
                  fileid: file.fileID,
                  max_age: file.maxAge || 7200
                });
              } else if (isString2(file)) {
                convertedFileList.push({
                  fileid: file
                });
              } else {
                throw new Error(JSON.stringify({
                  code: ERRORS8.INVALID_PARAMS,
                  msg: "[".concat(COMPONENT_NAME4, ".getTempFileURL] invalid fileList")
                }));
              }
            }
            action = "storage.batchGetDownloadUrl";
            request = this.request;
            res = {};
            if (!this.isGateWay()) return [3, 2];
            return [4, storageGateWay.getDownLoadInfo(request, { convertedFileList }, params.customReqOpts)];
          case 1:
            res = _a3.sent();
            return [3, 4];
          case 2:
            return [4, request.send(action, { file_list: convertedFileList }, params.customReqOpts)];
          case 3:
            res = _a3.sent();
            _a3.label = 4;
          case 4:
            if (res.code) {
              return [2, execCallback3(callback, null, res)];
            }
            return [2, execCallback3(callback, null, {
              fileList: res.data.download_list,
              requestId: res.requestId
            })];
        }
      });
    });
  };
  CloudbaseStorage2.prototype.downloadFile = function(params, callback) {
    return __awaiter12(this, void 0, void 0, function() {
      var fileID, tmpUrlRes, res, request, tmpUrl, result;
      return __generator12(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            fileID = params.fileID;
            if (!isString2(fileID)) {
              throw new Error(JSON.stringify({
                code: ERRORS8.INVALID_PARAMS,
                msg: "[".concat(COMPONENT_NAME4, ".getTempFileURL] fileID must be string")
              }));
            }
            return [4, this.getTempFileURL.call(this, {
              fileList: [
                {
                  fileID,
                  maxAge: 600
                }
              ],
              customReqOpts: params.customReqOpts
            })];
          case 1:
            tmpUrlRes = _a3.sent();
            res = tmpUrlRes.fileList[0];
            if (res.code !== "SUCCESS") {
              return [2, execCallback3(callback, res)];
            }
            request = this.request;
            tmpUrl = encodeURI(res.download_url);
            return [4, request.download({ url: tmpUrl, tempFilePath: params.tempFilePath })];
          case 2:
            result = _a3.sent();
            return [2, execCallback3(callback, null, result)];
        }
      });
    });
  };
  CloudbaseStorage2.prototype.copyFile = function(params, callback) {
    return __awaiter12(this, void 0, void 0, function() {
      var fileList, convertedFileList, _i, fileList_3, file, srcPath, dstPath, request, res, action;
      return __generator12(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            fileList = params.fileList;
            if (!fileList || !isArray2(fileList) || fileList.length === 0) {
              throw new Error(JSON.stringify({
                code: ERRORS8.INVALID_PARAMS,
                msg: "[".concat(COMPONENT_NAME4, ".copyFile] fileList must not be empty")
              }));
            }
            convertedFileList = [];
            for (_i = 0, fileList_3 = fileList; _i < fileList_3.length; _i++) {
              file = fileList_3[_i];
              srcPath = file.srcPath, dstPath = file.dstPath;
              if (!srcPath || !dstPath || typeof srcPath !== "string" || typeof dstPath !== "string") {
                throw new Error(JSON.stringify({
                  code: ERRORS8.INVALID_PARAMS,
                  msg: "[".concat(COMPONENT_NAME4, ".copyFile] srcPath and dstPath may not be empty")
                }));
              }
              if (srcPath === dstPath) {
                throw new Error(JSON.stringify({
                  code: ERRORS8.INVALID_PARAMS,
                  msg: "[".concat(COMPONENT_NAME4, ".copyFile] srcPath and dstPath can not be the same")
                }));
              }
              convertedFileList.push({
                src_path: srcPath,
                dst_path: dstPath,
                overwrite: file.overwrite,
                remove_original: file.removeOriginal
              });
            }
            request = this.request;
            res = {};
            if (!this.isGateWay()) return [3, 2];
            return [4, storageGateWay.copyFile(request, { convertedFileList }, params.customReqOpts)];
          case 1:
            res = _a3.sent();
            return [3, 4];
          case 2:
            action = "storage.batchCopyFile";
            return [4, request.send(action, { file_list: convertedFileList }, params.customReqOpts)];
          case 3:
            res = _a3.sent();
            _a3.label = 4;
          case 4:
            if (res.code) {
              return [2, execCallback3(callback, null, res)];
            }
            return [2, execCallback3(callback, null, {
              fileList: res.data.copy_list,
              requestId: res.requestId
            })];
        }
      });
    });
  };
  CloudbaseStorage2.prototype.getFileInfo = function(params) {
    var _a3;
    return __awaiter12(this, void 0, void 0, function() {
      var fileInfo, fileList;
      var _this = this;
      return __generator12(this, function(_b) {
        switch (_b.label) {
          case 0:
            return [4, this.getTempFileURL(params)];
          case 1:
            fileInfo = _b.sent();
            if (!((fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.fileList) && ((_a3 = fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.fileList) === null || _a3 === void 0 ? void 0 : _a3.length) > 0)) return [3, 3];
            return [4, Promise.all(fileInfo.fileList.map(function(item) {
              return __awaiter12(_this, void 0, void 0, function() {
                var request, res, header, fileSize, contentType, fileInfo_1, e_1;
                return __generator12(this, function(_a4) {
                  switch (_a4.label) {
                    case 0:
                      if (item.code !== "SUCCESS") {
                        return [2, {
                          code: item.code,
                          fileID: item.fileID,
                          tempFileURL: item.tempFileURL,
                          message: item.message
                        }];
                      }
                      _a4.label = 1;
                    case 1:
                      _a4.trys.push([1, 3, , 4]);
                      request = this.request;
                      return [4, request.fetch({ url: item.tempFileURL, method: "HEAD" })];
                    case 2:
                      res = _a4.sent();
                      header = res.header;
                      if (Headers && header instanceof Headers) {
                        header = Object.fromEntries(res.header.entries());
                      }
                      fileSize = parseInt(header["content-length"]) || 0;
                      contentType = header["content-type"] || "";
                      if ([400, 404].includes(Number(res.statusCode))) {
                        return [2, {
                          code: "FILE_NOT_FOUND",
                          fileID: item.fileID,
                          tempFileURL: item.tempFileURL,
                          message: "file not found"
                        }];
                      }
                      fileInfo_1 = {
                        code: item.code,
                        fileID: item.fileID,
                        tempFileURL: item.tempFileURL,
                        cloudId: item.fileID,
                        fileName: item.fileID.split("/").pop(),
                        contentType,
                        mime: contentType.split(";")[0].trim(),
                        size: fileSize,
                        etag: header.etag || "",
                        lastModified: header["last-modified"] || "",
                        cacheControl: header["cache-control"] || ""
                      };
                      return [2, fileInfo_1];
                    case 3:
                      e_1 = _a4.sent();
                      return [2, {
                        code: "FETCH_FILE_INFO_ERROR",
                        fileID: item.fileID,
                        tempFileURL: item.tempFileURL,
                        message: e_1.message
                      }];
                    case 4:
                      return [2];
                  }
                });
              });
            }))];
          case 2:
            fileList = _b.sent();
            return [2, {
              fileList,
              requestId: fileInfo.requestId
            }];
          case 3:
            return [2, {
              fileList: [],
              requestId: fileInfo.requestId
            }];
        }
      });
    });
  };
  __decorate4([
    catchErrorsDecorator5({
      customInfo: {
        className: "Cloudbase",
        methodName: "uploadFile"
      },
      title: "",
      messages: [
        "",
        "  1 -  uploadFile() ",
        "  2 - https://console.cloud.tencent.com/tcb/env/safety",
        "  3 - ",
        "".concat(COMMUNITY_SITE_URL5)
      ]
    }),
    __metadata4("design:type", Function),
    __metadata4("design:paramtypes", [Object, Function]),
    __metadata4("design:returntype", Promise)
  ], CloudbaseStorage2.prototype, "uploadFile", null);
  __decorate4([
    catchErrorsDecorator5({
      customInfo: {
        className: "Cloudbase",
        methodName: "getUploadMetadata"
      },
      title: "",
      messages: [
        "",
        "  1 -  getUploadMetadata() ",
        "  2 - https://console.cloud.tencent.com/tcb/env/safety",
        "  3 - ",
        "".concat(COMMUNITY_SITE_URL5)
      ]
    }),
    __metadata4("design:type", Function),
    __metadata4("design:paramtypes", [Object, Function]),
    __metadata4("design:returntype", Promise)
  ], CloudbaseStorage2.prototype, "getUploadMetadata", null);
  __decorate4([
    catchErrorsDecorator5({
      customInfo: {
        className: "Cloudbase",
        methodName: "deleteFile"
      },
      title: "",
      messages: [
        "",
        "  1 -  deleteFile() ",
        "  2 - https://console.cloud.tencent.com/tcb/env/safety",
        "  3 - ",
        "".concat(COMMUNITY_SITE_URL5)
      ]
    }),
    __metadata4("design:type", Function),
    __metadata4("design:paramtypes", [Object, Function]),
    __metadata4("design:returntype", Promise)
  ], CloudbaseStorage2.prototype, "deleteFile", null);
  __decorate4([
    catchErrorsDecorator5({
      customInfo: {
        className: "Cloudbase",
        methodName: "getTempFileURL"
      },
      title: "",
      messages: [
        "",
        "  1 -  getTempFileURL() ",
        "  2 - https://console.cloud.tencent.com/tcb/env/safety",
        "  3 - ",
        "".concat(COMMUNITY_SITE_URL5)
      ]
    }),
    __metadata4("design:type", Function),
    __metadata4("design:paramtypes", [Object, Function]),
    __metadata4("design:returntype", Promise)
  ], CloudbaseStorage2.prototype, "getTempFileURL", null);
  __decorate4([
    catchErrorsDecorator5({
      customInfo: {
        className: "Cloudbase",
        methodName: "downloadFile"
      },
      title: "",
      messages: [
        "",
        "  1 -  downloadFile() ",
        "  2 - https://console.cloud.tencent.com/tcb/env/safety",
        "  3 - ",
        "".concat(COMMUNITY_SITE_URL5)
      ]
    }),
    __metadata4("design:type", Function),
    __metadata4("design:paramtypes", [Object, Function]),
    __metadata4("design:returntype", Promise)
  ], CloudbaseStorage2.prototype, "downloadFile", null);
  __decorate4([
    catchErrorsDecorator5({
      customInfo: {
        className: "Cloudbase",
        methodName: "copyFile"
      },
      title: "",
      messages: [
        "",
        "  1 -  copyFile() ",
        "  2 - https://console.cloud.tencent.com/tcb/env/safety",
        "  3 - ",
        "".concat(COMMUNITY_SITE_URL5)
      ]
    }),
    __metadata4("design:type", Function),
    __metadata4("design:paramtypes", [Object, Function]),
    __metadata4("design:returntype", Promise)
  ], CloudbaseStorage2.prototype, "copyFile", null);
  return CloudbaseStorage2;
}();

// node_modules/@cloudbase/storage/dist/esm/supabase/errors.js
var __extends6 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var StorageError = function(_super) {
  __extends6(StorageError2, _super);
  function StorageError2(message) {
    var _this = _super.call(this, message) || this;
    _this.__isStorageError = true;
    _this.name = "StorageError";
    return _this;
  }
  return StorageError2;
}(Error);
function isStorageError(error) {
  return typeof error === "object" && error !== null && "__isStorageError" in error;
}
var StorageApiError = function(_super) {
  __extends6(StorageApiError2, _super);
  function StorageApiError2(message, status, statusCode) {
    var _this = _super.call(this, message) || this;
    _this.name = "StorageApiError";
    _this.status = status;
    _this.statusCode = statusCode;
    return _this;
  }
  StorageApiError2.prototype.toJSON = function() {
    return {
      name: this.name,
      message: this.message,
      status: this.status,
      statusCode: this.statusCode
    };
  };
  return StorageApiError2;
}(StorageError);
var StorageUnknownError = function(_super) {
  __extends6(StorageUnknownError2, _super);
  function StorageUnknownError2(message, originalError) {
    var _this = _super.call(this, message) || this;
    _this.name = "StorageUnknownError";
    _this.originalError = originalError;
    return _this;
  }
  return StorageUnknownError2;
}(StorageError);

// node_modules/@cloudbase/storage/dist/esm/supabase/index.js
var __extends7 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var __assign15 = function() {
  __assign15 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign15.apply(this, arguments);
};
var __awaiter13 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator13 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var ERRORS9 = constants_exports.ERRORS;
var SupabaseFileAPILikeStorage = function(_super) {
  __extends7(SupabaseFileAPILikeStorage2, _super);
  function SupabaseFileAPILikeStorage2(context) {
    var _this = _super.call(this) || this;
    _this.shouldThrowOnError = false;
    _this.bucketId = "";
    _this.context = context;
    return _this;
  }
  Object.defineProperty(SupabaseFileAPILikeStorage2.prototype, "config", {
    get: function() {
      var _a3;
      return (_a3 = this.context) === null || _a3 === void 0 ? void 0 : _a3.config;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(SupabaseFileAPILikeStorage2.prototype, "request", {
    get: function() {
      var _a3;
      return (_a3 = this.context) === null || _a3 === void 0 ? void 0 : _a3.request;
    },
    enumerable: false,
    configurable: true
  });
  SupabaseFileAPILikeStorage2.prototype.throwOnError = function() {
    this.shouldThrowOnError = true;
    return this;
  };
  SupabaseFileAPILikeStorage2.prototype.from = function(bucket) {
    this.bucketId = bucket || "";
    return this;
  };
  SupabaseFileAPILikeStorage2.prototype.upload = function(path2, fileBody, fileOptions) {
    return __awaiter13(this, void 0, void 0, function() {
      var options, cacheControl, contentType, metadata, cloudPath, uploadFileParams, headers, result, error_1;
      return __generator13(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            options = __assign15({ upsert: true }, fileOptions);
            cacheControl = options.cacheControl, contentType = options.contentType, metadata = options.metadata;
            _a3.label = 1;
          case 1:
            _a3.trys.push([1, 3, , 4]);
            cloudPath = this._getCloudPath(path2);
            uploadFileParams = {
              cloudPath,
              filePath: fileBody
            };
            if (cacheControl || contentType || metadata) {
              headers = {};
              if (cacheControl) {
                headers["cache-control"] = cacheControl;
              }
              if (contentType) {
                headers["content-type"] = contentType;
              }
              if (metadata) {
                headers["x-cos-metadata-metadata"] = this.toBase64(JSON.stringify(metadata));
              }
              uploadFileParams.headers = headers;
            }
            return [4, this.uploadFile(uploadFileParams)];
          case 2:
            result = _a3.sent();
            if (!result.fileID) {
              throw new Error(JSON.stringify({
                code: ERRORS9.OPERATION_FAIL,
                msg: "[".concat(COMPONENT_NAME4, ".update] no fileID returned")
              }));
            }
            return [2, {
              data: {
                id: result.fileID,
                path: path2,
                fullPath: path2
              },
              error: null
            }];
          case 3:
            error_1 = _a3.sent();
            if (this.shouldThrowOnError)
              throw error_1;
            if (isStorageError(error_1)) {
              return [2, {
                data: null,
                error: error_1
              }];
            }
            throw error_1;
          case 4:
            return [2];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.uploadToSignedUrl = function(path2, _token, fileBody, fileOptions) {
    return __awaiter13(this, void 0, void 0, function() {
      return __generator13(this, function(_a3) {
        return [2, this.upload(path2, fileBody, fileOptions)];
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.createSignedUploadUrl = function(path2) {
    return __awaiter13(this, void 0, void 0, function() {
      var cloudPath, metadata, error_2;
      return __generator13(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            cloudPath = this._getCloudPath(path2);
            return [4, this.getUploadMetadata({ cloudPath })];
          case 1:
            metadata = _a3.sent().data;
            return [2, {
              data: {
                signedUrl: metadata.url,
                token: metadata.token,
                path: path2,
                authorization: metadata.authorization,
                id: metadata.fileId,
                cosFileId: metadata.cosFileId,
                downloadUrl: metadata.download_url
              },
              error: null
            }];
          case 2:
            error_2 = _a3.sent();
            if (this.shouldThrowOnError)
              throw error_2;
            return [2, {
              data: null,
              error: error_2 instanceof StorageError ? error_2 : new StorageError(error_2.message)
            }];
          case 3:
            return [2];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.update = function(path2, fileBody, fileOptions) {
    return __awaiter13(this, void 0, void 0, function() {
      return __generator13(this, function(_a3) {
        return [2, this.upload(path2, fileBody, __assign15(__assign15({}, fileOptions), { upsert: true }))];
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.move = function(fromPath, toPath) {
    return __awaiter13(this, void 0, void 0, function() {
      var result, error_3;
      return __generator13(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            return [4, this.copyFile({
              fileList: [
                {
                  srcPath: this._getCloudPath(fromPath),
                  dstPath: this._getCloudPath(toPath),
                  overwrite: true,
                  removeOriginal: true
                }
              ]
            })];
          case 1:
            result = _a3.sent();
            if (result.fileList[0].code && result.fileList[0].code !== "SUCCESS") {
              throw new StorageError(result.fileList[0].message || "Move failed");
            }
            return [2, {
              data: { message: "File moved from ".concat(fromPath, " to ").concat(toPath) },
              error: null
            }];
          case 2:
            error_3 = _a3.sent();
            if (this.shouldThrowOnError)
              throw error_3;
            if (isStorageError(error_3)) {
              return [2, {
                data: null,
                error: error_3
              }];
            }
            throw error_3;
          case 3:
            return [2];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.copy = function(fromPath, toPath) {
    return __awaiter13(this, void 0, void 0, function() {
      var result, error_4;
      return __generator13(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            return [4, this.copyFile({
              fileList: [
                {
                  srcPath: this._getCloudPath(fromPath),
                  dstPath: this._getCloudPath(toPath),
                  overwrite: true,
                  removeOriginal: false
                }
              ]
            })];
          case 1:
            result = _a3.sent();
            if (result.fileList[0].code && result.fileList[0].code !== "SUCCESS") {
              throw new StorageError(result.fileList[0].message || "Copy failed");
            }
            return [2, {
              data: { path: this._getCloudPath(toPath) },
              error: null
            }];
          case 2:
            error_4 = _a3.sent();
            if (this.shouldThrowOnError)
              throw error_4;
            if (isStorageError(error_4)) {
              return [2, { data: null, error: error_4 }];
            }
            throw error_4;
          case 3:
            return [2];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.createSignedUrl = function(path2, expiresIn, options) {
    return __awaiter13(this, void 0, void 0, function() {
      var cloudPath, result, signedUrl, queryParams, transformQuery, separator, error_5;
      return __generator13(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            cloudPath = this._normalizeCloudId(path2);
            return [4, this.getTempFileURL({
              fileList: [
                {
                  fileID: cloudPath,
                  maxAge: expiresIn
                }
              ]
            })];
          case 1:
            result = _a3.sent();
            if (result.fileList[0].code !== "SUCCESS") {
              throw new StorageError("Failed to create signed URL: [".concat(result.fileList[0].code, "] ").concat(result.fileList[0].fileID));
            }
            signedUrl = result.fileList[0].download_url;
            queryParams = [];
            if ((options === null || options === void 0 ? void 0 : options.download) !== void 0) {
              if (typeof options.download === "string") {
                queryParams.push("download=".concat(encodeURIComponent(options.download)));
              } else if (options.download === true) {
                queryParams.push("download=true");
              }
            }
            if (options === null || options === void 0 ? void 0 : options.transform) {
              transformQuery = this._transformOptsToQueryString(options.transform);
              if (transformQuery) {
                queryParams.push(transformQuery);
              }
            }
            if (queryParams.length > 0) {
              separator = signedUrl.includes("?") ? "&" : "?";
              signedUrl = "".concat(signedUrl).concat(separator).concat(queryParams.join("&"));
            }
            return [2, {
              data: { signedUrl },
              error: null
            }];
          case 2:
            error_5 = _a3.sent();
            if (this.shouldThrowOnError)
              throw error_5;
            if (isStorageError(error_5)) {
              return [2, {
                data: null,
                error: error_5
              }];
            }
            throw error_5;
          case 3:
            return [2];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.createSignedUrls = function(paths, expiresIn) {
    return __awaiter13(this, void 0, void 0, function() {
      var fileList, result, error_6;
      var _this = this;
      return __generator13(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            fileList = paths.map(function(p2) {
              return {
                fileID: _this._normalizeCloudId(p2),
                maxAge: expiresIn
              };
            });
            return [4, this.getTempFileURL({ fileList })];
          case 1:
            result = _a3.sent();
            return [2, {
              data: result.fileList.map(function(item, index) {
                return {
                  path: paths[index],
                  signedUrl: item.tempFileURL || "",
                  error: item.code === "SUCCESS" ? null : item.message
                };
              }),
              error: null
            }];
          case 2:
            error_6 = _a3.sent();
            if (this.shouldThrowOnError)
              throw error_6;
            if (isStorageError(error_6)) {
              return [2, {
                data: null,
                error: error_6
              }];
            }
            throw error_6;
          case 3:
            return [2];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.download = function(path2, options) {
    return __awaiter13(this, void 0, void 0, function() {
      var error_7;
      var _a3;
      var _this = this;
      return __generator13(this, function(_b) {
        switch (_b.label) {
          case 0:
            _b.trys.push([0, 2, , 3]);
            _a3 = {};
            return [4, function() {
              return __awaiter13(_this, void 0, void 0, function() {
                var signedUrlResult, tmpUrl, data2;
                var _a4;
                return __generator13(this, function(_b2) {
                  switch (_b2.label) {
                    case 0:
                      return [4, this.createSignedUrl(path2, 600, { transform: options })];
                    case 1:
                      signedUrlResult = _b2.sent();
                      if (signedUrlResult.error) {
                        throw signedUrlResult.error;
                      }
                      tmpUrl = encodeURI((_a4 = signedUrlResult.data) === null || _a4 === void 0 ? void 0 : _a4.signedUrl);
                      return [4, this.request.reqClass.get({
                        url: tmpUrl,
                        headers: {},
                        responseType: "blob"
                      })];
                    case 2:
                      data2 = _b2.sent().data;
                      if (!data2) {
                        throw new StorageError("Download failed: no file content");
                      }
                      return [2, new Blob([data2])];
                  }
                });
              });
            }()];
          case 1:
            return [2, (_a3.data = _b.sent(), _a3.error = null, _a3)];
          case 2:
            error_7 = _b.sent();
            if (this.shouldThrowOnError)
              throw error_7;
            if (isStorageError(error_7)) {
              return [2, {
                data: null,
                error: error_7
              }];
            }
            throw error_7;
          case 3:
            return [2];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.info = function(pathOrFileId) {
    return __awaiter13(this, void 0, void 0, function() {
      var isFileId, displayName, bucketId, fileInfo, item, now, lastModified, error_8;
      return __generator13(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            isFileId = pathOrFileId.startsWith("cloud://");
            displayName = isFileId ? this._extractPathFromFileId(pathOrFileId) : pathOrFileId;
            bucketId = isFileId ? this._extractBucketFromFileId(pathOrFileId) : this.bucketId;
            return [4, this.getFileInfo({
              fileList: [this._normalizeCloudId(pathOrFileId)]
            })];
          case 1:
            fileInfo = _a3.sent();
            item = fileInfo.fileList[0];
            if (item.code !== "SUCCESS") {
              throw new StorageError(item.message);
            }
            now = (/* @__PURE__ */ new Date()).toISOString();
            lastModified = (item.lastModified ? new Date(item.lastModified) : /* @__PURE__ */ new Date()).toISOString();
            return [2, {
              data: {
                id: item.fileID,
                version: "1",
                name: displayName,
                bucketId,
                updatedAt: lastModified,
                createdAt: lastModified,
                lastAccessedAt: now,
                size: item.size,
                cacheControl: item.cacheControl,
                contentType: item.contentType,
                etag: item.etag,
                lastModified,
                metadata: {}
              },
              error: null
            }];
          case 2:
            error_8 = _a3.sent();
            if (this.shouldThrowOnError)
              throw error_8;
            return [2, {
              data: null,
              error: error_8 instanceof StorageError ? error_8 : new StorageError(error_8.message)
            }];
          case 3:
            return [2];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.exists = function(pathOrFileId) {
    return __awaiter13(this, void 0, void 0, function() {
      var fileInfo, item, error_9;
      return __generator13(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            return [4, this.getFileInfo({
              fileList: [this._normalizeCloudId(pathOrFileId)]
            })];
          case 1:
            fileInfo = _a3.sent();
            item = fileInfo.fileList[0];
            if (item.code === "FILE_NOT_FOUND") {
              return [2, {
                data: false,
                error: null
              }];
            }
            if (item.code !== "SUCCESS") {
              throw new StorageError(item.message);
            }
            return [2, { data: true, error: null }];
          case 2:
            error_9 = _a3.sent();
            if (this.shouldThrowOnError)
              throw error_9;
            throw error_9;
          case 3:
            return [2];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.getPublicUrl = function(path2, options) {
    return __awaiter13(this, void 0, void 0, function() {
      var res;
      return __generator13(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.createSignedUrl(path2, 600, options)];
          case 1:
            res = _a3.sent();
            if (res.data) {
              return [2, {
                data: { publicUrl: res.data.signedUrl }
              }];
            }
            return [2, { data: null, error: res.error }];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.remove = function(paths) {
    return __awaiter13(this, void 0, void 0, function() {
      var chunkSize_1, pathChunks, i2, fileInfoResults, fileInfoMap_1, fileList, result, failedFiles, now_1, error_10;
      var _this = this;
      return __generator13(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 3, , 4]);
            chunkSize_1 = 10;
            pathChunks = [];
            for (i2 = 0; i2 < paths.length; i2 += chunkSize_1) {
              pathChunks.push(paths.slice(i2, i2 + chunkSize_1));
            }
            return [4, Promise.all(pathChunks.map(function(chunk) {
              return Promise.all(chunk.map(function(path2) {
                return _this.info(path2);
              }));
            }))];
          case 1:
            fileInfoResults = _a3.sent();
            fileInfoMap_1 = /* @__PURE__ */ new Map();
            fileInfoResults.flat().forEach(function(result2, index) {
              if (result2.data) {
                fileInfoMap_1.set(paths[Math.floor(index / chunkSize_1) * chunkSize_1 + index % chunkSize_1], result2.data);
              }
            });
            fileList = paths.map(function(p2) {
              return _this._normalizeCloudId(p2);
            });
            return [4, this.deleteFile({ fileList })];
          case 2:
            result = _a3.sent();
            failedFiles = result.fileList.filter(function(item) {
              return item.code !== "SUCCESS";
            });
            if (failedFiles.length > 0) {
              throw new StorageError("Delete failed for ".concat(failedFiles.length, " file(s)"));
            }
            now_1 = (/* @__PURE__ */ new Date()).toISOString();
            return [2, {
              data: paths.map(function(p2) {
                var info = fileInfoMap_1.get(p2);
                return {
                  name: info === null || info === void 0 ? void 0 : info.name,
                  id: info === null || info === void 0 ? void 0 : info.id,
                  bucket_id: info === null || info === void 0 ? void 0 : info.bucketId,
                  owner: void 0,
                  updated_at: (info === null || info === void 0 ? void 0 : info.updatedAt) || now_1,
                  created_at: info === null || info === void 0 ? void 0 : info.createdAt,
                  last_accessed_at: (info === null || info === void 0 ? void 0 : info.lastAccessedAt) || now_1,
                  metadata: (info === null || info === void 0 ? void 0 : info.metadata) || {},
                  buckets: {
                    id: info === null || info === void 0 ? void 0 : info.bucketId,
                    name: info === null || info === void 0 ? void 0 : info.bucketId,
                    owner: void 0,
                    public: false,
                    created_at: "",
                    updated_at: now_1
                  }
                };
              }),
              error: null
            }];
          case 3:
            error_10 = _a3.sent();
            if (this.shouldThrowOnError)
              throw error_10;
            if (isStorageError(error_10)) {
              return [2, {
                data: null,
                error: error_10
              }];
            }
            throw error_10;
          case 4:
            return [2];
        }
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype.list = function() {
    return __awaiter13(this, void 0, void 0, function() {
      return __generator13(this, function(_a3) {
        throw new StorageError("Not implemented");
      });
    });
  };
  SupabaseFileAPILikeStorage2.prototype._getCloudPath = function(path2) {
    var cleanPath = path2.replace(/^\/|\/$/g, "").replace(/\/+/g, "/");
    return cleanPath;
  };
  SupabaseFileAPILikeStorage2.prototype._normalizeCloudId = function(path2) {
    var _a3;
    if (/^cloud:\/\//.test(path2)) {
      return path2;
    }
    var cleanPath = this._getCloudPath(path2);
    if (this.bucketId) {
      var envId = ((_a3 = this.config) === null || _a3 === void 0 ? void 0 : _a3.env) || "";
      if (envId) {
        return "cloud://".concat(envId, ".").concat(this.bucketId, "/").concat(cleanPath);
      }
    } else {
      throw new StorageError("bucketId is not set");
    }
  };
  SupabaseFileAPILikeStorage2.prototype.toBase64 = function(data2) {
    if (typeof Buffer !== "undefined") {
      return Buffer.from(data2).toString("base64");
    }
    return btoa(data2);
  };
  SupabaseFileAPILikeStorage2.prototype._transformOptsToQueryString = function(transform) {
    var params = ["imageMogr2"];
    if (transform.width || transform.height) {
      var width = transform.width || "";
      var height = transform.height || "";
      if (transform.resize === "fill") {
        params.push("thumbnail/".concat(width, "x").concat(height, "!"));
      } else if (transform.resize === "contain") {
        params.push("thumbnail/".concat(width, "x").concat(height));
      } else {
        params.push("thumbnail/".concat(width, "x").concat(height, "^"));
      }
    }
    if (transform.format && transform.format !== "origin") {
      params.push("format/".concat(transform.format));
    }
    if (transform.quality !== void 0) {
      var quality = Math.max(1, Math.min(100, transform.quality));
      params.push("quality/".concat(quality));
    }
    return params.join("/");
  };
  SupabaseFileAPILikeStorage2.prototype._extractPathFromFileId = function(fileId) {
    var withoutProtocol = fileId.replace(/^cloud:\/\//, "");
    var parts = withoutProtocol.split("/");
    if (parts.length < 2) {
      return fileId;
    }
    return parts.slice(1).join("/");
  };
  SupabaseFileAPILikeStorage2.prototype._extractBucketFromFileId = function(fileId) {
    var withoutProtocol = fileId.replace(/^cloud:\/\//, "");
    var parts = withoutProtocol.split("/");
    if (parts.length < 1) {
      return "";
    }
    var envAndBucket = parts[0];
    var dotIndex = envAndBucket.indexOf(".");
    if (dotIndex === -1) {
      return envAndBucket;
    }
    return envAndBucket.substring(dotIndex + 1);
  };
  return SupabaseFileAPILikeStorage2;
}(CloudbaseStorage);

// node_modules/@cloudbase/storage/dist/esm/index.js
var storage = new CloudbaseStorage();
var component4 = {
  name: COMPONENT_NAME4,
  entity: {
    uploadFile: storage.uploadFile,
    deleteFile: storage.deleteFile,
    getTempFileURL: storage.getTempFileURL,
    downloadFile: storage.downloadFile,
    getUploadMetadata: storage.getUploadMetadata,
    copyFile: storage.copyFile,
    getFileInfo: storage.getFileInfo,
    isGateWay: storage.isGateWay
  }
};
var supabaseComponent = {
  name: "".concat(COMPONENT_NAME4, "/supabase"),
  IIFE: true,
  entity: function() {
    var storageCache = /* @__PURE__ */ new WeakMap();
    Object.defineProperty(this.prototype, "storage", {
      get: function() {
        if (storageCache.has(this)) {
          return storageCache.get(this);
        }
        var instance = this;
        var context = new Proxy({}, {
          get: function(_target, prop) {
            if (prop === "config") {
              return instance.config;
            }
            if (prop === "request") {
              return instance.request;
            }
            return void 0;
          }
        });
        var storage2 = new SupabaseFileAPILikeStorage(context);
        storageCache.set(this, storage2);
        return storage2;
      },
      configurable: true,
      enumerable: true
    });
  }
};
try {
  cloudbase.registerComponent(component4);
  cloudbase.registerComponent(supabaseComponent);
} catch (e3) {
}
function registerStorage(app) {
  try {
    app.registerComponent(component4);
    app.registerComponent(supabaseComponent);
  } catch (e3) {
    console.warn(e3);
  }
}
try {
  window.registerStorage = registerStorage;
} catch (e3) {
}

// node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js
var import_set = __toESM(require_set());
var import_unset = __toESM(require_unset());
var import_cloneDeep = __toESM(require_cloneDeep());

// node_modules/@cloudbase/realtime/dist/esm/message.js
function genRequestId(prefix) {
  if (prefix === void 0) {
    prefix = "";
  }
  return "".concat(prefix ? "".concat(prefix, "_") : "").concat(+/* @__PURE__ */ new Date(), "_").concat(Math.random());
}

// node_modules/@cloudbase/realtime/dist/esm/listener.js
var RealtimeListener = /* @__PURE__ */ function() {
  function RealtimeListener2(options) {
    this.close = options.close;
    this.onChange = options.onChange;
    this.onError = options.onError;
    if (options.debug) {
      Object.defineProperty(this, "virtualClient", {
        get: function() {
          return options.virtualClient;
        }
      });
    }
  }
  return RealtimeListener2;
}();

// node_modules/@cloudbase/realtime/dist/esm/snapshot.js
var Snapshot = /* @__PURE__ */ function() {
  function Snapshot2(options) {
    var id2 = options.id, docChanges = options.docChanges, docs = options.docs, msgType = options.msgType, type = options.type;
    var cachedDocChanges;
    var cachedDocs;
    Object.defineProperties(this, {
      id: {
        get: function() {
          return id2;
        },
        enumerable: true
      },
      docChanges: {
        get: function() {
          if (!cachedDocChanges) {
            cachedDocChanges = JSON.parse(JSON.stringify(docChanges));
          }
          return cachedDocChanges;
        },
        enumerable: true
      },
      docs: {
        get: function() {
          if (!cachedDocs) {
            cachedDocs = JSON.parse(JSON.stringify(docs));
          }
          return cachedDocs;
        },
        enumerable: true
      },
      msgType: {
        get: function() {
          return msgType;
        },
        enumerable: true
      },
      type: {
        get: function() {
          return type;
        },
        enumerable: true
      }
    });
  }
  return Snapshot2;
}();

// node_modules/@cloudbase/realtime/dist/esm/error.js
var __extends8 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var RealtimeErrorMessageError = function(_super) {
  __extends8(RealtimeErrorMessageError2, _super);
  function RealtimeErrorMessageError2(serverErrorMsg) {
    var _this = _super.call(this, "Watch Error ".concat(JSON.stringify(serverErrorMsg.msgData), " (requestid: ").concat(serverErrorMsg.requestId, ")")) || this;
    _this.isRealtimeErrorMessageError = true;
    _this.payload = serverErrorMsg;
    return _this;
  }
  return RealtimeErrorMessageError2;
}(Error);
var isRealtimeErrorMessageError = function(e3) {
  return e3 === null || e3 === void 0 ? void 0 : e3.isRealtimeErrorMessageError;
};
var TimeoutError = function(_super) {
  __extends8(TimeoutError2, _super);
  function TimeoutError2() {
    var _this = _super !== null && _super.apply(this, arguments) || this;
    _this.type = "timeout";
    _this.payload = null;
    _this.generic = true;
    return _this;
  }
  return TimeoutError2;
}(Error);
var isTimeoutError = function(e3) {
  return e3.type === "timeout";
};
var CancelledError = function(_super) {
  __extends8(CancelledError2, _super);
  function CancelledError2() {
    var _this = _super !== null && _super.apply(this, arguments) || this;
    _this.type = "cancelled";
    _this.payload = null;
    _this.generic = true;
    return _this;
  }
  return CancelledError2;
}(Error);
var isCancelledError = function(e3) {
  return e3.type === "cancelled";
};
var CloudSDKError = function(_super) {
  __extends8(CloudSDKError2, _super);
  function CloudSDKError2(options) {
    var _this = _super.call(this, options.errMsg) || this;
    _this.errCode = "UNKNOWN_ERROR";
    Object.defineProperties(_this, {
      message: {
        get: function() {
          return "errCode: ".concat(this.errCode, " ").concat(ERR_CODE[this.errCode] || "", " | errMsg: ").concat(this.errMsg);
        },
        set: function(msg) {
          this.errMsg = msg;
        }
      }
    });
    _this.errCode = options.errCode || "UNKNOWN_ERROR";
    _this.errMsg = options.errMsg;
    return _this;
  }
  Object.defineProperty(CloudSDKError2.prototype, "message", {
    get: function() {
      return "errCode: ".concat(this.errCode, " | errMsg: ").concat(this.errMsg);
    },
    set: function(msg) {
      this.errMsg = msg;
    },
    enumerable: false,
    configurable: true
  });
  return CloudSDKError2;
}(Error);
var ERR_CODE = {
  UNKNOWN_ERROR: "UNKNOWN_ERROR",
  SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL: "SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL",
  SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL: "SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL",
  SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL: "SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL",
  SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL: "SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL",
  SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG: "SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG",
  SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA: "SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA",
  SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR: "SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR",
  SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED: "SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED",
  SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL: "SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL",
  SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR: "SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR"
};

// node_modules/@cloudbase/realtime/dist/esm/utils.js
var sleep2 = function(ms) {
  if (ms === void 0) {
    ms = 0;
  }
  return new Promise(function(r3) {
    return setTimeout(r3, ms);
  });
};

// node_modules/@cloudbase/realtime/dist/esm/virtual-websocket-client.js
var __awaiter14 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator14 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var __spreadArray3 = function(to2, from2, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from2.length, ar2; i2 < l2; i2++) {
    if (ar2 || !(i2 in from2)) {
      if (!ar2) ar2 = Array.prototype.slice.call(from2, 0, i2);
      ar2[i2] = from2[i2];
    }
  }
  return to2.concat(ar2 || Array.prototype.slice.call(from2));
};
var WatchStatus;
(function(WatchStatus2) {
  WatchStatus2["LOGGINGIN"] = "LOGGINGIN";
  WatchStatus2["INITING"] = "INITING";
  WatchStatus2["REBUILDING"] = "REBUILDING";
  WatchStatus2["ACTIVE"] = "ACTIVE";
  WatchStatus2["ERRORED"] = "ERRORED";
  WatchStatus2["CLOSING"] = "CLOSING";
  WatchStatus2["CLOSED"] = "CLOSED";
  WatchStatus2["PAUSED"] = "PAUSED";
  WatchStatus2["RESUMING"] = "RESUMING";
})(WatchStatus || (WatchStatus = {}));
var DEFAULT_WAIT_TIME_ON_UNKNOWN_ERROR = 100;
var DEFAULT_MAX_AUTO_RETRY_ON_ERROR = 2;
var DEFAULT_MAX_SEND_ACK_AUTO_RETRY_ON_ERROR = 2;
var DEFAULT_SEND_ACK_DEBOUNCE_TIMEOUT = 10 * 1e3;
var DEFAULT_INIT_WATCH_TIMEOUT = 10 * 1e3;
var DEFAULT_REBUILD_WATCH_TIMEOUT = 10 * 1e3;
var VirtualWebSocketClient = function() {
  function VirtualWebSocketClient2(options) {
    var _this = this;
    this.watchStatus = WatchStatus.INITING;
    this.wsLogin = function(envId, refresh) {
      return __awaiter14(_this, void 0, void 0, function() {
        var loginResult;
        return __generator14(this, function(_a3) {
          switch (_a3.label) {
            case 0:
              this.watchStatus = WatchStatus.LOGGINGIN;
              return [4, this.login(envId, refresh)];
            case 1:
              loginResult = _a3.sent();
              if (!this.envId) {
                this.envId = loginResult.envId;
              }
              return [2, loginResult];
          }
        });
      });
    };
    this.initWatch = function(forceRefreshLogin) {
      return __awaiter14(_this, void 0, void 0, function() {
        var success;
        var _this2 = this;
        return __generator14(this, function(_a3) {
          switch (_a3.label) {
            case 0:
              if (this.initWatchPromise !== null && this.initWatchPromise !== void 0) {
                return [2, this.initWatchPromise];
              }
              this.initWatchPromise = new Promise(function(resolve, reject) {
                void function() {
                  return __awaiter14(_this2, void 0, void 0, function() {
                    var envId, initWatchMsg, initEventMsg, _a4, events, currEvent, _i, events_1, e3, snapshot, e_1;
                    return __generator14(this, function(_b) {
                      switch (_b.label) {
                        case 0:
                          _b.trys.push([0, 3, , 4]);
                          if (this.watchStatus === WatchStatus.PAUSED) {
                            console.log("[realtime] initWatch cancelled on pause");
                            return [2, resolve()];
                          }
                          return [4, this.wsLogin(this.envId, forceRefreshLogin)];
                        case 1:
                          envId = _b.sent().envId;
                          if (this.watchStatus === WatchStatus.PAUSED) {
                            console.log("[realtime] initWatch cancelled on pause");
                            return [2, resolve()];
                          }
                          this.watchStatus = WatchStatus.INITING;
                          initWatchMsg = {
                            watchId: this.watchId,
                            requestId: genRequestId(),
                            msgType: "INIT_WATCH",
                            msgData: {
                              envId,
                              collName: this.collectionName,
                              query: this.query,
                              limit: this.limit,
                              orderBy: this.orderBy
                            }
                          };
                          return [4, this.send({
                            msg: initWatchMsg,
                            waitResponse: true,
                            skipOnMessage: true,
                            timeout: DEFAULT_INIT_WATCH_TIMEOUT
                          })];
                        case 2:
                          initEventMsg = _b.sent();
                          _a4 = initEventMsg.msgData, events = _a4.events, currEvent = _a4.currEvent;
                          this.sessionInfo = {
                            queryID: initEventMsg.msgData.queryID,
                            currentEventId: currEvent - 1,
                            currentDocs: []
                          };
                          if (events.length > 0) {
                            for (_i = 0, events_1 = events; _i < events_1.length; _i++) {
                              e3 = events_1[_i];
                              e3.ID = currEvent;
                            }
                            this.handleServerEvents(initEventMsg);
                          } else {
                            this.sessionInfo.currentEventId = currEvent;
                            snapshot = new Snapshot({
                              id: currEvent,
                              docChanges: [],
                              docs: [],
                              type: "init"
                            });
                            this.listener.onChange(snapshot);
                            this.scheduleSendACK();
                          }
                          this.onWatchStart(this, this.sessionInfo.queryID);
                          this.watchStatus = WatchStatus.ACTIVE;
                          this.availableRetries.INIT_WATCH = DEFAULT_MAX_AUTO_RETRY_ON_ERROR;
                          resolve();
                          return [3, 4];
                        case 3:
                          e_1 = _b.sent();
                          this.handleWatchEstablishmentError(e_1, {
                            operationName: "INIT_WATCH",
                            resolve,
                            reject
                          });
                          return [3, 4];
                        case 4:
                          return [2];
                      }
                    });
                  });
                }();
              });
              success = false;
              _a3.label = 1;
            case 1:
              _a3.trys.push([1, , 3, 4]);
              return [4, this.initWatchPromise];
            case 2:
              _a3.sent();
              success = true;
              return [3, 4];
            case 3:
              this.initWatchPromise = void 0;
              return [7];
            case 4:
              console.log("[realtime] initWatch ".concat(success ? "success" : "fail"));
              return [2];
          }
        });
      });
    };
    this.rebuildWatch = function(forceRefreshLogin) {
      return __awaiter14(_this, void 0, void 0, function() {
        var success;
        var _this2 = this;
        return __generator14(this, function(_a3) {
          switch (_a3.label) {
            case 0:
              if (this.rebuildWatchPromise !== null && this.rebuildWatchPromise !== void 0) {
                return [2, this.rebuildWatchPromise];
              }
              this.rebuildWatchPromise = new Promise(function(resolve, reject) {
                void function() {
                  return __awaiter14(_this2, void 0, void 0, function() {
                    var envId, rebuildWatchMsg, nextEventMsg, e_2;
                    return __generator14(this, function(_a4) {
                      switch (_a4.label) {
                        case 0:
                          _a4.trys.push([0, 3, , 4]);
                          if (this.watchStatus === WatchStatus.PAUSED) {
                            console.log("[realtime] rebuildWatch cancelled on pause");
                            return [2, resolve()];
                          }
                          return [4, this.wsLogin(this.envId, forceRefreshLogin)];
                        case 1:
                          envId = _a4.sent().envId;
                          if (!this.sessionInfo) {
                            throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");
                          }
                          if (this.watchStatus === WatchStatus.PAUSED) {
                            console.log("[realtime] rebuildWatch cancelled on pause");
                            return [2, resolve()];
                          }
                          this.watchStatus = WatchStatus.REBUILDING;
                          rebuildWatchMsg = {
                            watchId: this.watchId,
                            requestId: genRequestId(),
                            msgType: "REBUILD_WATCH",
                            msgData: {
                              envId,
                              collName: this.collectionName,
                              queryID: this.sessionInfo.queryID,
                              eventID: this.sessionInfo.currentEventId
                            }
                          };
                          return [4, this.send({
                            msg: rebuildWatchMsg,
                            waitResponse: true,
                            skipOnMessage: false,
                            timeout: DEFAULT_REBUILD_WATCH_TIMEOUT
                          })];
                        case 2:
                          nextEventMsg = _a4.sent();
                          this.handleServerEvents(nextEventMsg);
                          this.watchStatus = WatchStatus.ACTIVE;
                          this.availableRetries.REBUILD_WATCH = DEFAULT_MAX_AUTO_RETRY_ON_ERROR;
                          resolve();
                          return [3, 4];
                        case 3:
                          e_2 = _a4.sent();
                          this.handleWatchEstablishmentError(e_2, {
                            operationName: "REBUILD_WATCH",
                            resolve,
                            reject
                          });
                          return [3, 4];
                        case 4:
                          return [2];
                      }
                    });
                  });
                }();
              });
              success = false;
              _a3.label = 1;
            case 1:
              _a3.trys.push([1, , 3, 4]);
              return [4, this.rebuildWatchPromise];
            case 2:
              _a3.sent();
              success = true;
              return [3, 4];
            case 3:
              this.rebuildWatchPromise = void 0;
              return [7];
            case 4:
              console.log("[realtime] rebuildWatch ".concat(success ? "success" : "fail"));
              return [2];
          }
        });
      });
    };
    this.handleWatchEstablishmentError = function(e3, options2) {
      return __awaiter14(_this, void 0, void 0, function() {
        var isInitWatch, abortWatch, retry;
        var _this2 = this;
        return __generator14(this, function(_a3) {
          isInitWatch = options2.operationName === "INIT_WATCH";
          abortWatch = function() {
            _this2.closeWithError(new CloudSDKError({
              errCode: isInitWatch ? ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL : ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,
              errMsg: e3
            }));
            options2.reject(e3);
          };
          retry = function(refreshLogin) {
            if (_this2.useRetryTicket(options2.operationName)) {
              if (isInitWatch) {
                _this2.initWatchPromise = void 0;
                options2.resolve(_this2.initWatch(refreshLogin));
              } else {
                _this2.rebuildWatchPromise = void 0;
                options2.resolve(_this2.rebuildWatch(refreshLogin));
              }
            } else {
              abortWatch();
            }
          };
          this.handleCommonError(e3, {
            onSignError: function() {
              return retry(true);
            },
            onTimeoutError: function() {
              return retry(false);
            },
            onNotRetryableError: abortWatch,
            onCancelledError: options2.reject,
            onUnknownError: function() {
              (function() {
                return __awaiter14(_this2, void 0, void 0, function() {
                  var onWSDisconnected, e_3;
                  var _this3 = this;
                  return __generator14(this, function(_a4) {
                    switch (_a4.label) {
                      case 0:
                        _a4.trys.push([0, 8, , 9]);
                        onWSDisconnected = function() {
                          return __awaiter14(_this3, void 0, void 0, function() {
                            return __generator14(this, function(_a5) {
                              switch (_a5.label) {
                                case 0:
                                  this.pause();
                                  return [4, this.onceWSConnected()];
                                case 1:
                                  _a5.sent();
                                  retry(true);
                                  return [2];
                              }
                            });
                          });
                        };
                        if (!!this.isWSConnected()) return [3, 2];
                        return [4, onWSDisconnected()];
                      case 1:
                        _a4.sent();
                        return [3, 7];
                      case 2:
                        return [4, sleep2(DEFAULT_WAIT_TIME_ON_UNKNOWN_ERROR)];
                      case 3:
                        _a4.sent();
                        if (!(this.watchStatus === WatchStatus.PAUSED)) return [3, 4];
                        options2.reject(new CancelledError("".concat(options2.operationName, " cancelled due to pause after unknownError")));
                        return [3, 7];
                      case 4:
                        if (!!this.isWSConnected()) return [3, 6];
                        return [4, onWSDisconnected()];
                      case 5:
                        _a4.sent();
                        return [3, 7];
                      case 6:
                        retry(false);
                        _a4.label = 7;
                      case 7:
                        return [3, 9];
                      case 8:
                        e_3 = _a4.sent();
                        retry(true);
                        return [3, 9];
                      case 9:
                        return [2];
                    }
                  });
                });
              })();
            }
          });
          return [2];
        });
      });
    };
    this.closeWatch = function() {
      return __awaiter14(_this, void 0, void 0, function() {
        var queryId, closeWatchMsg, e_4;
        return __generator14(this, function(_a3) {
          switch (_a3.label) {
            case 0:
              queryId = this.sessionInfo ? this.sessionInfo.queryID : "";
              if (this.watchStatus !== WatchStatus.ACTIVE) {
                this.watchStatus = WatchStatus.CLOSED;
                this.onWatchClose(this, queryId);
                return [2];
              }
              _a3.label = 1;
            case 1:
              _a3.trys.push([1, 3, 4, 5]);
              this.watchStatus = WatchStatus.CLOSING;
              closeWatchMsg = {
                watchId: this.watchId,
                requestId: genRequestId(),
                msgType: "CLOSE_WATCH",
                msgData: null
              };
              return [4, this.send({
                msg: closeWatchMsg
              })];
            case 2:
              _a3.sent();
              this.sessionInfo = void 0;
              this.watchStatus = WatchStatus.CLOSED;
              return [3, 5];
            case 3:
              e_4 = _a3.sent();
              this.closeWithError(new CloudSDKError({
                errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL,
                errMsg: e_4
              }));
              return [3, 5];
            case 4:
              this.onWatchClose(this, queryId);
              return [7];
            case 5:
              return [2];
          }
        });
      });
    };
    this.scheduleSendACK = function() {
      _this.clearACKSchedule();
      _this.ackTimeoutId = setTimeout(function() {
        if (_this.waitExpectedTimeoutId) {
          _this.scheduleSendACK();
        } else {
          _this.sendACK();
        }
      }, DEFAULT_SEND_ACK_DEBOUNCE_TIMEOUT);
    };
    this.clearACKSchedule = function() {
      if (_this.ackTimeoutId) {
        clearTimeout(_this.ackTimeoutId);
      }
    };
    this.sendACK = function() {
      return __awaiter14(_this, void 0, void 0, function() {
        var ackMsg, e_5, msg;
        return __generator14(this, function(_a3) {
          switch (_a3.label) {
            case 0:
              _a3.trys.push([0, 2, , 3]);
              if (this.watchStatus !== WatchStatus.ACTIVE) {
                this.scheduleSendACK();
                return [2];
              }
              if (!this.sessionInfo) {
                console.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)");
                return [2];
              }
              ackMsg = {
                watchId: this.watchId,
                requestId: genRequestId(),
                msgType: "CHECK_LAST",
                msgData: {
                  queryID: this.sessionInfo.queryID,
                  eventID: this.sessionInfo.currentEventId
                }
              };
              return [4, this.send({
                msg: ackMsg
              })];
            case 1:
              _a3.sent();
              this.scheduleSendACK();
              return [3, 3];
            case 2:
              e_5 = _a3.sent();
              if (isRealtimeErrorMessageError(e_5)) {
                msg = e_5.payload;
                switch (msg.msgData.code) {
                  case "CHECK_LOGIN_FAILED":
                  case "SIGN_EXPIRED_ERROR":
                  case "SIGN_INVALID_ERROR":
                  case "SIGN_PARAM_INVALID": {
                    this.rebuildWatch();
                    return [2];
                  }
                  case "QUERYID_INVALID_ERROR":
                  case "SYS_ERR":
                  case "INVALIID_ENV":
                  case "COLLECTION_PERMISSION_DENIED": {
                    this.closeWithError(new CloudSDKError({
                      errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,
                      errMsg: msg.msgData.code
                    }));
                    return [2];
                  }
                  default: {
                    break;
                  }
                }
              }
              if (this.availableRetries.CHECK_LAST && this.availableRetries.CHECK_LAST > 0) {
                this.availableRetries.CHECK_LAST -= 1;
                this.scheduleSendACK();
              } else {
                this.closeWithError(new CloudSDKError({
                  errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,
                  errMsg: e_5
                }));
              }
              return [3, 3];
            case 3:
              return [2];
          }
        });
      });
    };
    this.handleCommonError = function(e3, options2) {
      if (isRealtimeErrorMessageError(e3)) {
        var msg = e3.payload;
        switch (msg.msgData.code) {
          case "CHECK_LOGIN_FAILED":
          case "SIGN_EXPIRED_ERROR":
          case "SIGN_INVALID_ERROR":
          case "SIGN_PARAM_INVALID": {
            options2.onSignError(e3);
            return;
          }
          case "QUERYID_INVALID_ERROR":
          case "SYS_ERR":
          case "INVALIID_ENV":
          case "COLLECTION_PERMISSION_DENIED": {
            options2.onNotRetryableError(e3);
            return;
          }
          default: {
            options2.onNotRetryableError(e3);
            return;
          }
        }
      } else if (isTimeoutError(e3)) {
        options2.onTimeoutError(e3);
        return;
      } else if (isCancelledError(e3)) {
        options2.onCancelledError(e3);
        return;
      }
      options2.onUnknownError(e3);
    };
    this.watchId = "watchid_".concat(+/* @__PURE__ */ new Date(), "_").concat(Math.random());
    this.envId = options.envId;
    this.collectionName = options.collectionName;
    this.query = options.query;
    this.limit = options.limit;
    this.orderBy = options.orderBy;
    this.send = options.send;
    this.login = options.login;
    this.isWSConnected = options.isWSConnected;
    this.onceWSConnected = options.onceWSConnected;
    this.getWaitExpectedTimeoutLength = options.getWaitExpectedTimeoutLength;
    this.onWatchStart = options.onWatchStart;
    this.onWatchClose = options.onWatchClose;
    this.debug = options.debug;
    this.availableRetries = {
      INIT_WATCH: DEFAULT_MAX_AUTO_RETRY_ON_ERROR,
      REBUILD_WATCH: DEFAULT_MAX_AUTO_RETRY_ON_ERROR,
      CHECK_LAST: DEFAULT_MAX_SEND_ACK_AUTO_RETRY_ON_ERROR
    };
    this.listener = new RealtimeListener({
      close: function() {
        _this.closeWatch();
      },
      onChange: options.onChange,
      onError: options.onError,
      debug: this.debug,
      virtualClient: this
    });
    this.initWatch();
  }
  VirtualWebSocketClient2.prototype.onMessage = function(msg) {
    var _this = this;
    switch (this.watchStatus) {
      case WatchStatus.PAUSED: {
        if (msg.msgType !== "ERROR") {
          return;
        }
        break;
      }
      case WatchStatus.LOGGINGIN:
      case WatchStatus.INITING:
      case WatchStatus.REBUILDING: {
        console.warn("[realtime listener] internal non-fatal error: unexpected message received while ".concat(this.watchStatus));
        return;
      }
      case WatchStatus.CLOSED: {
        console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has closed");
        return;
      }
      case WatchStatus.ERRORED: {
        console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has ended with error");
        return;
      }
    }
    if (!this.sessionInfo) {
      console.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.");
      return;
    }
    this.scheduleSendACK();
    switch (msg.msgType) {
      case "NEXT_EVENT": {
        console.warn("nextevent ".concat(msg.msgData.currEvent, " ignored"), msg);
        this.handleServerEvents(msg);
        break;
      }
      case "CHECK_EVENT": {
        if (this.sessionInfo.currentEventId < msg.msgData.currEvent) {
          this.sessionInfo.expectEventId = msg.msgData.currEvent;
          this.clearWaitExpectedEvent();
          this.waitExpectedTimeoutId = setTimeout(function() {
            _this.rebuildWatch();
          }, this.getWaitExpectedTimeoutLength());
          console.log("[realtime] waitExpectedTimeoutLength ".concat(this.getWaitExpectedTimeoutLength()));
        }
        break;
      }
      case "ERROR": {
        this.closeWithError(new CloudSDKError({
          errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,
          errMsg: "".concat(msg.msgData.code, " - ").concat(msg.msgData.message)
        }));
        break;
      }
      default: {
        console.warn("[realtime listener] virtual client receive unexpected msg ".concat(msg.msgType, ": "), msg);
        break;
      }
    }
  };
  VirtualWebSocketClient2.prototype.closeWithError = function(error) {
    var _a3;
    this.watchStatus = WatchStatus.ERRORED;
    this.clearACKSchedule();
    this.listener.onError(error);
    this.onWatchClose(this, ((_a3 = this.sessionInfo) === null || _a3 === void 0 ? void 0 : _a3.queryID) || "");
    console.log("[realtime] client closed (".concat(this.collectionName, " ").concat(this.query, ") (watchId ").concat(this.watchId, ")"));
  };
  VirtualWebSocketClient2.prototype.pause = function() {
    this.watchStatus = WatchStatus.PAUSED;
    console.log("[realtime] client paused (".concat(this.collectionName, " ").concat(this.query, ") (watchId ").concat(this.watchId, ")"));
  };
  VirtualWebSocketClient2.prototype.resume = function() {
    return __awaiter14(this, void 0, void 0, function() {
      var e_6;
      return __generator14(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            this.watchStatus = WatchStatus.RESUMING;
            console.log("[realtime] client resuming with ".concat(this.sessionInfo ? "REBUILD_WATCH" : "INIT_WATCH", " (").concat(this.collectionName, " ").concat(this.query, ") (").concat(this.watchId, ")"));
            _a3.label = 1;
          case 1:
            _a3.trys.push([1, 3, , 4]);
            return [4, this.sessionInfo ? this.rebuildWatch() : this.initWatch()];
          case 2:
            _a3.sent();
            console.log("[realtime] client successfully resumed (".concat(this.collectionName, " ").concat(this.query, ") (").concat(this.watchId, ")"));
            return [3, 4];
          case 3:
            e_6 = _a3.sent();
            console.error("[realtime] client resume failed (".concat(this.collectionName, " ").concat(this.query, ") (").concat(this.watchId, ")"), e_6);
            return [3, 4];
          case 4:
            return [2];
        }
      });
    });
  };
  VirtualWebSocketClient2.prototype.useRetryTicket = function(operationName) {
    if (this.availableRetries[operationName] && this.availableRetries[operationName] > 0) {
      this.availableRetries[operationName] -= 1;
      console.log("[realtime] ".concat(operationName, " use a retry ticket, now only ").concat(this.availableRetries[operationName], " retry left"));
      return true;
    }
    return false;
  };
  VirtualWebSocketClient2.prototype.handleServerEvents = function(msg) {
    return __awaiter14(this, void 0, void 0, function() {
      var e_7;
      return __generator14(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            _a3.trys.push([0, 2, , 3]);
            this.scheduleSendACK();
            return [4, this.handleServerEventsInternel(msg)];
          case 1:
            _a3.sent();
            this.postHandleServerEventsValidityCheck(msg);
            return [3, 3];
          case 2:
            e_7 = _a3.sent();
            console.error("[realtime listener] internal non-fatal error: handle server events failed with error: ", e_7);
            throw e_7;
          case 3:
            return [2];
        }
      });
    });
  };
  VirtualWebSocketClient2.prototype.handleServerEventsInternel = function(msg) {
    return __awaiter14(this, void 0, void 0, function() {
      var requestId, events, msgType, sessionInfo, allChangeEvents, docs, initEncountered, _loop_1, this_1, i2, len, state_1;
      return __generator14(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            requestId = msg.requestId;
            events = msg.msgData.events;
            msgType = msg.msgType;
            if (!events.length || !this.sessionInfo) {
              return [2];
            }
            sessionInfo = this.sessionInfo;
            try {
              allChangeEvents = events.map(getPublicEvent);
            } catch (e3) {
              this.closeWithError(new CloudSDKError({
                errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,
                errMsg: e3
              }));
              return [2];
            }
            docs = __spreadArray3([], sessionInfo.currentDocs, true);
            initEncountered = false;
            _loop_1 = function(i3, len2) {
              var change, localDoc, doc_1, _i, _b, fieldPath, err, err, doc, doc, err, ind, ind, docsSnapshot, docChanges, snapshot;
              return __generator14(this, function(_c) {
                switch (_c.label) {
                  case 0:
                    change = allChangeEvents[i3];
                    if (!(sessionInfo.currentEventId >= change.id)) return [3, 1];
                    if (!allChangeEvents[i3 - 1] || change.id > allChangeEvents[i3 - 1].id) {
                      console.warn("[realtime] duplicate event received, cur ".concat(sessionInfo.currentEventId, " but got ").concat(change.id));
                    } else {
                      console.error("[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId ".concat(requestId, ")"));
                    }
                    return [2, "continue"];
                  case 1:
                    if (!(sessionInfo.currentEventId === change.id - 1)) return [3, 2];
                    switch (change.dataType) {
                      case "update": {
                        if (!change.doc) {
                          switch (change.queueType) {
                            case "update":
                            case "dequeue": {
                              localDoc = docs.find(function(doc2) {
                                return doc2._id === change.docId;
                              });
                              if (localDoc) {
                                doc_1 = (0, import_cloneDeep.default)(localDoc);
                                if (change.updatedFields) {
                                  Object.keys(change.updatedFields).forEach(function(fieldPath2) {
                                    (0, import_set.default)(doc_1, fieldPath2, change.updatedFields[fieldPath2]);
                                  });
                                }
                                if (change.removedFields) {
                                  for (_i = 0, _b = change.removedFields; _i < _b.length; _i++) {
                                    fieldPath = _b[_i];
                                    (0, import_unset.default)(doc_1, fieldPath);
                                  }
                                }
                                change.doc = doc_1;
                              } else {
                                console.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated.");
                              }
                              break;
                            }
                            case "enqueue": {
                              err = new CloudSDKError({
                                errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,
                                errMsg: 'HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId '.concat(msg.requestId, ")")
                              });
                              this_1.closeWithError(err);
                              throw err;
                            }
                            default: {
                              break;
                            }
                          }
                        }
                        break;
                      }
                      case "replace": {
                        if (!change.doc) {
                          err = new CloudSDKError({
                            errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,
                            errMsg: 'HandleServerEvents: full doc is not provided with dataType="replace" (requestId '.concat(msg.requestId, ")")
                          });
                          this_1.closeWithError(err);
                          throw err;
                        }
                        break;
                      }
                      case "remove": {
                        doc = docs.find(function(doc2) {
                          return doc2._id === change.docId;
                        });
                        if (doc) {
                          change.doc = doc;
                        } else {
                          console.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated.");
                        }
                        break;
                      }
                      case "limit": {
                        if (!change.doc) {
                          switch (change.queueType) {
                            case "dequeue": {
                              doc = docs.find(function(doc2) {
                                return doc2._id === change.docId;
                              });
                              if (doc) {
                                change.doc = doc;
                              } else {
                                console.error("[realtime listener] internal non-fatal server error: unexpected limit dataType event where no doc is associated.");
                              }
                              break;
                            }
                            case "enqueue": {
                              err = new CloudSDKError({
                                errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,
                                errMsg: 'HandleServerEvents: full doc is not provided with dataType="limit" and queueType="enqueue" (requestId '.concat(msg.requestId, ")")
                              });
                              this_1.closeWithError(err);
                              throw err;
                            }
                            default: {
                              break;
                            }
                          }
                        }
                        break;
                      }
                    }
                    switch (change.queueType) {
                      case "init": {
                        if (!initEncountered) {
                          initEncountered = true;
                          docs = [change.doc];
                        } else {
                          docs.push(change.doc);
                        }
                        break;
                      }
                      case "enqueue": {
                        docs.push(change.doc);
                        break;
                      }
                      case "dequeue": {
                        ind = docs.findIndex(function(doc2) {
                          return doc2._id === change.docId;
                        });
                        if (ind > -1) {
                          docs.splice(ind, 1);
                        } else {
                          console.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated.");
                        }
                        break;
                      }
                      case "update": {
                        ind = docs.findIndex(function(doc2) {
                          return doc2._id === change.docId;
                        });
                        if (ind > -1) {
                          docs[ind] = change.doc;
                        } else {
                          console.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated.");
                        }
                        break;
                      }
                    }
                    if (i3 === len2 - 1 || allChangeEvents[i3 + 1] && allChangeEvents[i3 + 1].id !== change.id) {
                      docsSnapshot = __spreadArray3([], docs, true);
                      docChanges = allChangeEvents.slice(0, i3 + 1).filter(function(c2) {
                        return c2.id === change.id;
                      });
                      this_1.sessionInfo.currentEventId = change.id;
                      this_1.sessionInfo.currentDocs = docs;
                      snapshot = new Snapshot({
                        id: change.id,
                        docChanges,
                        docs: docsSnapshot,
                        msgType
                      });
                      this_1.listener.onChange(snapshot);
                    }
                    return [3, 4];
                  case 2:
                    console.warn("[realtime listener] event received is out of order, cur ".concat(this_1.sessionInfo.currentEventId, " but got ").concat(change.id));
                    return [4, this_1.rebuildWatch()];
                  case 3:
                    _c.sent();
                    return [2, { value: void 0 }];
                  case 4:
                    return [2];
                }
              });
            };
            this_1 = this;
            i2 = 0, len = allChangeEvents.length;
            _a3.label = 1;
          case 1:
            if (!(i2 < len)) return [3, 4];
            return [5, _loop_1(i2, len)];
          case 2:
            state_1 = _a3.sent();
            if (typeof state_1 === "object")
              return [2, state_1.value];
            _a3.label = 3;
          case 3:
            i2++;
            return [3, 1];
          case 4:
            return [2];
        }
      });
    });
  };
  VirtualWebSocketClient2.prototype.postHandleServerEventsValidityCheck = function(msg) {
    if (!this.sessionInfo) {
      console.error("[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur");
      return;
    }
    if (this.sessionInfo.expectEventId && this.sessionInfo.currentEventId >= this.sessionInfo.expectEventId) {
      this.clearWaitExpectedEvent();
    }
    if (this.sessionInfo.currentEventId < msg.msgData.currEvent) {
      console.warn("[realtime listener] internal non-fatal error: client eventId does not match with server event id after server event handling");
      return;
    }
  };
  VirtualWebSocketClient2.prototype.clearWaitExpectedEvent = function() {
    if (this.waitExpectedTimeoutId) {
      clearTimeout(this.waitExpectedTimeoutId);
      this.waitExpectedTimeoutId = void 0;
    }
  };
  return VirtualWebSocketClient2;
}();
function getPublicEvent(event) {
  var e3 = {
    id: event.ID,
    dataType: event.DataType,
    queueType: event.QueueType,
    docId: event.DocID,
    doc: event.Doc && event.Doc !== "{}" ? JSON.parse(event.Doc) : void 0
  };
  if (event.DataType === "update") {
    if (event.UpdatedFields) {
      e3.updatedFields = JSON.parse(event.UpdatedFields);
    }
    if (event.removedFields || event.RemovedFields) {
      e3.removedFields = JSON.parse(event.removedFields);
    }
  }
  return e3;
}

// node_modules/@cloudbase/realtime/dist/esm/ws-event.js
var CLOSE_EVENT_CODE_INFO = {
  1e3: {
    code: 1e3,
    name: "Normal Closure",
    description: "Normal closure; the connection successfully completed whatever purpose for which it was created."
  },
  1001: {
    code: 1001,
    name: "Going Away",
    description: "The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."
  },
  1002: {
    code: 1002,
    name: "Protocol Error",
    description: "The endpoint is terminating the connection due to a protocol error."
  },
  1003: {
    code: 1003,
    name: "Unsupported Data",
    description: "The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."
  },
  1005: {
    code: 1005,
    name: "No Status Received",
    description: "Indicates that no status code was provided even though one was expected."
  },
  1006: {
    code: 1006,
    name: "Abnormal Closure",
    description: "Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."
  },
  1007: {
    code: 1007,
    name: "Invalid frame payload data",
    description: "The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."
  },
  1008: {
    code: 1008,
    name: "Policy Violation",
    description: "The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."
  },
  1009: {
    code: 1009,
    name: "Message too big",
    description: "The endpoint is terminating the connection because a data frame was received that is too large."
  },
  1010: {
    code: 1010,
    name: "Missing Extension",
    description: "The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."
  },
  1011: {
    code: 1011,
    name: "Internal Error",
    description: "The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."
  },
  1012: {
    code: 1012,
    name: "Service Restart",
    description: "The server is terminating the connection because it is restarting."
  },
  1013: {
    code: 1013,
    name: "Try Again Later",
    description: "The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."
  },
  1014: {
    code: 1014,
    name: "Bad Gateway",
    description: "The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."
  },
  1015: {
    code: 1015,
    name: "TLS Handshake",
    description: "Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."
  },
  3e3: {
    code: 3e3,
    name: "Reconnect WebSocket",
    description: "The client is terminating the connection because it wants to reconnect"
  },
  3001: {
    code: 3001,
    name: "No Realtime Listeners",
    description: "The client is terminating the connection because no more realtime listeners exist"
  },
  3002: {
    code: 3002,
    name: "Heartbeat Ping Error",
    description: "The client is terminating the connection due to its failure in sending heartbeat messages"
  },
  3003: {
    code: 3003,
    name: "Heartbeat Pong Timeout Error",
    description: "The client is terminating the connection because no heartbeat response is received from the server"
  },
  3050: {
    code: 3050,
    name: "Server Close",
    description: "The client is terminating the connection because no heartbeat response is received from the server"
  }
};
var CloseEventCode;
(function(CloseEventCode2) {
  CloseEventCode2[CloseEventCode2["NormalClosure"] = 1e3] = "NormalClosure";
  CloseEventCode2[CloseEventCode2["GoingAway"] = 1001] = "GoingAway";
  CloseEventCode2[CloseEventCode2["ProtocolError"] = 1002] = "ProtocolError";
  CloseEventCode2[CloseEventCode2["UnsupportedData"] = 1003] = "UnsupportedData";
  CloseEventCode2[CloseEventCode2["NoStatusReceived"] = 1005] = "NoStatusReceived";
  CloseEventCode2[CloseEventCode2["AbnormalClosure"] = 1006] = "AbnormalClosure";
  CloseEventCode2[CloseEventCode2["InvalidFramePayloadData"] = 1007] = "InvalidFramePayloadData";
  CloseEventCode2[CloseEventCode2["PolicyViolation"] = 1008] = "PolicyViolation";
  CloseEventCode2[CloseEventCode2["MessageTooBig"] = 1009] = "MessageTooBig";
  CloseEventCode2[CloseEventCode2["MissingExtension"] = 1010] = "MissingExtension";
  CloseEventCode2[CloseEventCode2["InternalError"] = 1011] = "InternalError";
  CloseEventCode2[CloseEventCode2["ServiceRestart"] = 1012] = "ServiceRestart";
  CloseEventCode2[CloseEventCode2["TryAgainLater"] = 1013] = "TryAgainLater";
  CloseEventCode2[CloseEventCode2["BadGateway"] = 1014] = "BadGateway";
  CloseEventCode2[CloseEventCode2["TLSHandshake"] = 1015] = "TLSHandshake";
  CloseEventCode2[CloseEventCode2["ReconnectWebSocket"] = 3e3] = "ReconnectWebSocket";
  CloseEventCode2[CloseEventCode2["NoRealtimeListeners"] = 3001] = "NoRealtimeListeners";
  CloseEventCode2[CloseEventCode2["HeartbeatPingError"] = 3002] = "HeartbeatPingError";
  CloseEventCode2[CloseEventCode2["HeartbeatPongTimeoutError"] = 3003] = "HeartbeatPongTimeoutError";
  CloseEventCode2[CloseEventCode2["NoAuthentication"] = 3050] = "NoAuthentication";
})(CloseEventCode || (CloseEventCode = {}));
var getWSCloseError = function(code2, reason) {
  var info = CLOSE_EVENT_CODE_INFO[code2];
  var errMsg = !info ? "code ".concat(code2) : "".concat(info.name, ", code ").concat(code2, ", reason ").concat(reason || info.description);
  return new CloudSDKError({
    errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,
    errMsg
  });
};

// node_modules/@cloudbase/realtime/dist/esm/common.js
var wsClass = null;
var runtime = "web";
function getWsClass() {
  return wsClass;
}
function setWsClass(val) {
  wsClass = val;
}
function getRuntime() {
  return runtime;
}
function setRuntime(val) {
  runtime = val;
}

// node_modules/@cloudbase/realtime/dist/esm/websocket-client.js
var __assign16 = function() {
  __assign16 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign16.apply(this, arguments);
};
var __awaiter15 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator15 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var WS_READY_STATE = {
  CONNECTING: 0,
  OPEN: 1,
  CLOSING: 2,
  CLOSED: 3
};
var MAX_RTT_OBSERVED = 3;
var DEFAULT_EXPECTED_EVENT_WAIT_TIME = 5e3;
var DEFAULT_UNTRUSTED_RTT_THRESHOLD = 1e4;
var DEFAULT_MAX_RECONNECT = 5;
var DEFAULT_WS_RECONNECT_INTERVAL = 1e4;
var DEFAULT_PING_FAIL_TOLERANCE = 2;
var DEFAULT_PONG_MISS_TOLERANCE = 2;
var DEFAULT_LOGIN_TIMEOUT = 5e3;
var RealtimeWebSocketClient = function() {
  function RealtimeWebSocketClient2(options) {
    var _this = this;
    this.virtualWSClient = /* @__PURE__ */ new Set();
    this.queryIdClientMap = /* @__PURE__ */ new Map();
    this.watchIdClientMap = /* @__PURE__ */ new Map();
    this.pingFailed = 0;
    this.pongMissed = 0;
    this.logins = /* @__PURE__ */ new Map();
    this.wsReadySubsribers = [];
    this.wsResponseWait = /* @__PURE__ */ new Map();
    this.rttObserved = [];
    this.send = function(opts) {
      return __awaiter15(_this, void 0, void 0, function() {
        var _this2 = this;
        return __generator15(this, function(_a3) {
          return [2, new Promise(function(_resolve, _reject) {
            void function() {
              return __awaiter15(_this2, void 0, void 0, function() {
                var timeoutId, hasResolved, hasRejected, resolve, reject, respWaitSpec, err_1, e_1;
                var _this3 = this;
                return __generator15(this, function(_a4) {
                  switch (_a4.label) {
                    case 0:
                      hasResolved = false;
                      hasRejected = false;
                      resolve = function(value) {
                        hasResolved = true;
                        timeoutId && clearTimeout(timeoutId);
                        _resolve(value);
                      };
                      reject = function(error) {
                        hasRejected = true;
                        timeoutId && clearTimeout(timeoutId);
                        _reject(error);
                      };
                      if (opts.timeout) {
                        timeoutId = setTimeout(function() {
                          (function() {
                            return __awaiter15(_this3, void 0, void 0, function() {
                              return __generator15(this, function(_a5) {
                                switch (_a5.label) {
                                  case 0:
                                    if (!(!hasResolved || !hasRejected)) return [3, 2];
                                    return [4, sleep2(0)];
                                  case 1:
                                    _a5.sent();
                                    if (!hasResolved || !hasRejected) {
                                      reject(new TimeoutError("wsclient.send timedout"));
                                    }
                                    _a5.label = 2;
                                  case 2:
                                    return [2];
                                }
                              });
                            });
                          })();
                        }, opts.timeout);
                      }
                      _a4.label = 1;
                    case 1:
                      _a4.trys.push([1, 8, , 9]);
                      if (!(this.wsInitPromise !== void 0 || this.wsInitPromise !== null)) return [3, 3];
                      return [4, this.wsInitPromise];
                    case 2:
                      _a4.sent();
                      _a4.label = 3;
                    case 3:
                      if (!this.ws) {
                        reject(new Error("invalid state: ws connection not exists, can not send message"));
                        return [2];
                      }
                      if (this.ws.readyState !== WS_READY_STATE.OPEN) {
                        reject(new Error("ws readyState invalid: ".concat(this.ws.readyState, ", can not send message")));
                        return [2];
                      }
                      if (opts.waitResponse) {
                        respWaitSpec = {
                          resolve,
                          reject,
                          skipOnMessage: opts.skipOnMessage
                        };
                        this.wsResponseWait.set(opts.msg.requestId, respWaitSpec);
                      }
                      _a4.label = 4;
                    case 4:
                      _a4.trys.push([4, 6, , 7]);
                      return [4, this.ws.send(JSON.stringify(opts.msg))];
                    case 5:
                      _a4.sent();
                      if (!opts.waitResponse) {
                        resolve(void 0);
                      }
                      return [3, 7];
                    case 6:
                      err_1 = _a4.sent();
                      if (err_1) {
                        reject(err_1);
                        if (opts.waitResponse) {
                          this.wsResponseWait.delete(opts.msg.requestId);
                        }
                      }
                      return [3, 7];
                    case 7:
                      return [3, 9];
                    case 8:
                      e_1 = _a4.sent();
                      reject(e_1);
                      return [3, 9];
                    case 9:
                      return [2];
                  }
                });
              });
            }();
          })];
        });
      });
    };
    this.closeAllClients = function(error) {
      _this.virtualWSClient.forEach(function(client) {
        client.closeWithError(error);
      });
    };
    this.pauseClients = function(clients) {
      (clients || _this.virtualWSClient).forEach(function(client) {
        client.pause();
      });
    };
    this.resumeClients = function(clients) {
      (clients || _this.virtualWSClient).forEach(function(client) {
        client.resume();
      });
    };
    this.initWebSocketConnection = function(reconnect, availableRetries) {
      if (availableRetries === void 0) {
        availableRetries = _this.maxReconnect;
      }
      return __awaiter15(_this, void 0, void 0, function() {
        var e_2;
        var _this2 = this;
        return __generator15(this, function(_a3) {
          switch (_a3.label) {
            case 0:
              if (reconnect && this.reconnectState) {
                return [2];
              }
              if (reconnect) {
                this.reconnectState = true;
              }
              if (this.wsInitPromise !== void 0 && this.wsInitPromise !== null) {
                return [2, this.wsInitPromise];
              }
              if (reconnect) {
                this.pauseClients();
              }
              this.close(CloseEventCode.ReconnectWebSocket);
              this.wsInitPromise = new Promise(function(resolve, reject) {
                (function() {
                  return __awaiter15(_this2, void 0, void 0, function() {
                    var wsSign_1, e_3, isConnected;
                    var _this3 = this;
                    return __generator15(this, function(_a4) {
                      switch (_a4.label) {
                        case 0:
                          _a4.trys.push([0, 6, , 11]);
                          return [4, this.getWsSign()];
                        case 1:
                          wsSign_1 = _a4.sent();
                          return [4, new Promise(function(success) {
                            var url2 = wsSign_1.wsUrl || "wss://tcb-ws.tencentcloudapi.com";
                            var wsClass2 = getWsClass();
                            _this3.ws = wsClass2 ? new wsClass2(url2) : new WebSocket(url2);
                            success(void 0);
                          })];
                        case 2:
                          _a4.sent();
                          if (!this.ws.connect) return [3, 4];
                          return [4, this.ws.connect()];
                        case 3:
                          _a4.sent();
                          _a4.label = 4;
                        case 4:
                          return [4, this.initWebSocketEvent()];
                        case 5:
                          _a4.sent();
                          resolve();
                          if (reconnect) {
                            this.resumeClients();
                            this.reconnectState = false;
                          }
                          return [3, 11];
                        case 6:
                          e_3 = _a4.sent();
                          console.error("[realtime] initWebSocketConnection connect fail", e_3);
                          if (!(availableRetries > 0)) return [3, 9];
                          isConnected = true;
                          this.wsInitPromise = void 0;
                          if (!isConnected) return [3, 8];
                          return [4, sleep2(this.reconnectInterval)];
                        case 7:
                          _a4.sent();
                          if (reconnect) {
                            this.reconnectState = false;
                          }
                          _a4.label = 8;
                        case 8:
                          resolve(this.initWebSocketConnection(reconnect, availableRetries - 1));
                          return [3, 10];
                        case 9:
                          reject(e_3);
                          if (reconnect) {
                            this.closeAllClients(new CloudSDKError({
                              errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL,
                              errMsg: e_3
                            }));
                          }
                          _a4.label = 10;
                        case 10:
                          return [3, 11];
                        case 11:
                          return [2];
                      }
                    });
                  });
                })();
              });
              _a3.label = 1;
            case 1:
              _a3.trys.push([1, 3, 4, 5]);
              return [4, this.wsInitPromise];
            case 2:
              _a3.sent();
              this.wsReadySubsribers.forEach(function(_a4) {
                var resolve = _a4.resolve;
                return resolve();
              });
              return [3, 5];
            case 3:
              e_2 = _a3.sent();
              this.wsReadySubsribers.forEach(function(_a4) {
                var reject = _a4.reject;
                return reject();
              });
              return [3, 5];
            case 4:
              this.wsInitPromise = void 0;
              this.wsReadySubsribers = [];
              return [7];
            case 5:
              return [2];
          }
        });
      });
    };
    this.initWebSocketEvent = function() {
      return new Promise(function(resolve, reject) {
        if (!_this.ws) {
          throw new Error("can not initWebSocketEvent, ws not exists");
        }
        var wsOpened = false;
        _this.ws.onopen = function(event) {
          console.warn("[realtime] ws event: open", event);
          wsOpened = true;
          resolve();
        };
        _this.ws.onerror = function(event) {
          _this.logins = /* @__PURE__ */ new Map();
          if (!wsOpened) {
            console.error("[realtime] ws open failed with ws event: error", event);
            reject(event);
          } else {
            console.error("[realtime] ws event: error", event);
            _this.clearHeartbeat();
            _this.virtualWSClient.forEach(function(client) {
              return client.closeWithError(new CloudSDKError({
                errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR,
                errMsg: event
              }));
            });
          }
        };
        _this.ws.onclose = function(closeEvent) {
          console.warn("[realtime] ws event: close", closeEvent);
          _this.logins = /* @__PURE__ */ new Map();
          _this.clearHeartbeat();
          switch (closeEvent.code) {
            case CloseEventCode.ReconnectWebSocket: {
              break;
            }
            case CloseEventCode.NoRealtimeListeners: {
              break;
            }
            case CloseEventCode.HeartbeatPingError:
            case CloseEventCode.HeartbeatPongTimeoutError:
            case CloseEventCode.NormalClosure:
            case CloseEventCode.AbnormalClosure: {
              if (_this.maxReconnect > 0) {
                _this.initWebSocketConnection(true, _this.maxReconnect);
              } else {
                _this.closeAllClients(getWSCloseError(closeEvent.code));
              }
              break;
            }
            case CloseEventCode.NoAuthentication: {
              _this.closeAllClients(getWSCloseError(closeEvent.code, closeEvent.reason));
              break;
            }
            default: {
              if (_this.maxReconnect > 0) {
                _this.initWebSocketConnection(true, _this.maxReconnect);
              } else {
                _this.closeAllClients(getWSCloseError(closeEvent.code));
              }
            }
          }
        };
        _this.ws.onmessage = function(res) {
          var _a3;
          var rawMsg = ((_a3 = res.data) === null || _a3 === void 0 ? void 0 : _a3.data) || res.data;
          _this.heartbeat();
          var msg;
          try {
            msg = typeof rawMsg === "string" ? JSON.parse(rawMsg) : rawMsg;
          } catch (e3) {
            throw new Error("[realtime] onMessage parse res.data error: ".concat(e3));
          }
          if (msg.msgType === "ERROR") {
            var virtualWatch_1 = null;
            _this.virtualWSClient.forEach(function(item) {
              if (item.watchId === msg.watchId) {
                virtualWatch_1 = item;
              }
            });
            if (virtualWatch_1) {
              virtualWatch_1.listener.onError(msg);
            }
          }
          var responseWaitSpec = _this.wsResponseWait.get(msg.requestId);
          if (responseWaitSpec) {
            try {
              if (msg.msgType === "ERROR") {
                responseWaitSpec.reject(new RealtimeErrorMessageError(msg));
              } else {
                responseWaitSpec.resolve(msg);
              }
            } catch (e3) {
              console.error("ws onMessage responseWaitSpec.resolve(msg) errored:", e3);
            } finally {
              _this.wsResponseWait.delete(msg.requestId);
            }
            if (responseWaitSpec.skipOnMessage) {
              return;
            }
          }
          if (msg.msgType === "PONG") {
            if (_this.lastPingSendTS) {
              var rtt = Date.now() - _this.lastPingSendTS;
              if (rtt > DEFAULT_UNTRUSTED_RTT_THRESHOLD) {
                console.warn("[realtime] untrusted rtt observed: ".concat(rtt));
                return;
              }
              if (_this.rttObserved.length >= MAX_RTT_OBSERVED) {
                _this.rttObserved.splice(0, _this.rttObserved.length - MAX_RTT_OBSERVED + 1);
              }
              _this.rttObserved.push(rtt);
            }
            return;
          }
          var client = msg.watchId && _this.watchIdClientMap.get(msg.watchId);
          if (client) {
            client.onMessage(msg);
          } else {
            console.error("[realtime] no realtime listener found responsible for watchId ".concat(msg.watchId, ": "), msg);
            switch (msg.msgType) {
              case "INIT_EVENT":
              case "NEXT_EVENT":
              case "CHECK_EVENT": {
                client = _this.queryIdClientMap.get(msg.msgData.queryID);
                if (client) {
                  client.onMessage(msg);
                }
                break;
              }
              default: {
                for (var _i = 0, _b = Array.from(_this.watchIdClientMap.entries()); _i < _b.length; _i++) {
                  var _c = _b[_i], client_1 = _c[1];
                  client_1.onMessage(msg);
                  break;
                }
              }
            }
          }
        };
        _this.heartbeat();
      });
    };
    this.isWSConnected = function() {
      return Boolean(_this.ws && _this.ws.readyState === WS_READY_STATE.OPEN);
    };
    this.onceWSConnected = function() {
      return __awaiter15(_this, void 0, void 0, function() {
        var _this2 = this;
        return __generator15(this, function(_a3) {
          if (this.isWSConnected()) {
            return [2];
          }
          if (this.wsInitPromise !== null && this.wsInitPromise !== void 0) {
            return [2, this.wsInitPromise];
          }
          return [2, new Promise(function(resolve, reject) {
            _this2.wsReadySubsribers.push({
              resolve,
              reject
            });
          })];
        });
      });
    };
    this.webLogin = function(envId, refresh) {
      return __awaiter15(_this, void 0, void 0, function() {
        var loginInfo_1, emptyEnvLoginInfo, promise, loginInfo, loginStartTS, loginResult, curLoginInfo, e_4;
        var _this2 = this;
        return __generator15(this, function(_a3) {
          switch (_a3.label) {
            case 0:
              if (!refresh) {
                if (envId) {
                  loginInfo_1 = this.logins.get(envId);
                  if (loginInfo_1) {
                    if (loginInfo_1.loggedIn && loginInfo_1.loginResult) {
                      return [2, loginInfo_1.loginResult];
                    }
                    if (loginInfo_1.loggingInPromise !== null && loginInfo_1.loggingInPromise !== void 0) {
                      return [2, loginInfo_1.loggingInPromise];
                    }
                  }
                } else {
                  emptyEnvLoginInfo = this.logins.get("");
                  if ((emptyEnvLoginInfo === null || emptyEnvLoginInfo === void 0 ? void 0 : emptyEnvLoginInfo.loggingInPromise) !== null && (emptyEnvLoginInfo === null || emptyEnvLoginInfo === void 0 ? void 0 : emptyEnvLoginInfo.loggingInPromise) !== void 0) {
                    return [2, emptyEnvLoginInfo.loggingInPromise];
                  }
                }
              }
              promise = new Promise(function(resolve, reject) {
                (function() {
                  return __awaiter15(_this2, void 0, void 0, function() {
                    var wsSign, msgData, loginMsg, loginResMsg, e_5;
                    return __generator15(this, function(_a4) {
                      switch (_a4.label) {
                        case 0:
                          _a4.trys.push([0, 3, , 4]);
                          return [4, this.getWsSign()];
                        case 1:
                          wsSign = _a4.sent();
                          msgData = {
                            envId: wsSign.envId || "",
                            accessToken: "",
                            referrer: "web",
                            sdkVersion: "",
                            dataVersion: ""
                          };
                          loginMsg = {
                            watchId: void 0,
                            requestId: genRequestId(),
                            msgType: "LOGIN",
                            msgData,
                            exMsgData: {
                              runtime: getRuntime(),
                              signStr: wsSign.signStr,
                              secretVersion: wsSign.secretVersion
                            }
                          };
                          return [4, this.send({
                            msg: loginMsg,
                            waitResponse: true,
                            skipOnMessage: true,
                            timeout: DEFAULT_LOGIN_TIMEOUT
                          })];
                        case 2:
                          loginResMsg = _a4.sent();
                          if (!loginResMsg.msgData.code) {
                            resolve({
                              envId: wsSign.envId
                            });
                          } else {
                            reject(new Error("".concat(loginResMsg.msgData.code, " ").concat(loginResMsg.msgData.message)));
                          }
                          return [3, 4];
                        case 3:
                          e_5 = _a4.sent();
                          reject(e_5);
                          return [3, 4];
                        case 4:
                          return [2];
                      }
                    });
                  });
                })();
              });
              loginInfo = envId && this.logins.get(envId);
              loginStartTS = Date.now();
              if (loginInfo) {
                loginInfo.loggedIn = false;
                loginInfo.loggingInPromise = promise;
                loginInfo.loginStartTS = loginStartTS;
              } else {
                loginInfo = {
                  loggedIn: false,
                  loggingInPromise: promise,
                  loginStartTS
                };
                this.logins.set(envId || "", loginInfo);
              }
              _a3.label = 1;
            case 1:
              _a3.trys.push([1, 3, , 4]);
              return [4, promise];
            case 2:
              loginResult = _a3.sent();
              curLoginInfo = envId && this.logins.get(envId);
              if (curLoginInfo && curLoginInfo === loginInfo && curLoginInfo.loginStartTS === loginStartTS) {
                loginInfo.loggedIn = true;
                loginInfo.loggingInPromise = void 0;
                loginInfo.loginStartTS = void 0;
                loginInfo.loginResult = loginResult;
                return [2, loginResult];
              }
              if (curLoginInfo) {
                if (curLoginInfo.loggedIn && curLoginInfo.loginResult) {
                  return [2, curLoginInfo.loginResult];
                }
                if (curLoginInfo.loggingInPromise !== null && curLoginInfo.loggingInPromise !== void 0) {
                  return [2, curLoginInfo.loggingInPromise];
                }
                throw new Error("ws unexpected login info");
              } else {
                throw new Error("ws login info reset");
              }
              return [3, 4];
            case 3:
              e_4 = _a3.sent();
              loginInfo.loggedIn = false;
              loginInfo.loggingInPromise = void 0;
              loginInfo.loginStartTS = void 0;
              loginInfo.loginResult = void 0;
              throw e_4;
            case 4:
              return [2];
          }
        });
      });
    };
    this.getWsSign = function() {
      return __awaiter15(_this, void 0, void 0, function() {
        var expiredTs, res, _a3, signStr, wsUrl, secretVersion, envId;
        return __generator15(this, function(_b) {
          switch (_b.label) {
            case 0:
              if (this.wsSign && this.wsSign.expiredTs > Date.now()) {
                return [2, this.wsSign];
              }
              expiredTs = Date.now() + 6e4;
              return [4, this.context.appConfig.request.send("auth.wsWebSign", { runtime: getRuntime() })];
            case 1:
              res = _b.sent();
              if (res.code) {
                throw new Error("[tcb-js-sdk] : ".concat(res.code));
              }
              if (res.data) {
                _a3 = res.data, signStr = _a3.signStr, wsUrl = _a3.wsUrl, secretVersion = _a3.secretVersion, envId = _a3.envId;
                return [2, {
                  signStr,
                  wsUrl,
                  secretVersion,
                  envId,
                  expiredTs
                }];
              }
              throw new Error("[tcb-js-sdk] ");
          }
        });
      });
    };
    this.getWaitExpectedTimeoutLength = function() {
      if (!_this.rttObserved.length) {
        return DEFAULT_EXPECTED_EVENT_WAIT_TIME;
      }
      return _this.rttObserved.reduce(function(acc, cur) {
        return acc + cur;
      }) / _this.rttObserved.length * 1.5;
    };
    this.ping = function() {
      return __awaiter15(_this, void 0, void 0, function() {
        var msg;
        return __generator15(this, function(_a3) {
          switch (_a3.label) {
            case 0:
              msg = {
                watchId: void 0,
                requestId: genRequestId(),
                msgType: "PING",
                msgData: null
              };
              return [4, this.send({
                msg
              })];
            case 1:
              _a3.sent();
              return [2];
          }
        });
      });
    };
    this.onWatchStart = function(client, queryID) {
      _this.queryIdClientMap.set(queryID, client);
    };
    this.onWatchClose = function(client, queryID) {
      if (queryID) {
        _this.queryIdClientMap.delete(queryID);
      }
      _this.watchIdClientMap.delete(client.watchId);
      _this.virtualWSClient.delete(client);
      if (!_this.virtualWSClient.size) {
        _this.close(CloseEventCode.NoRealtimeListeners);
      }
    };
    this.maxReconnect = options.maxReconnect || DEFAULT_MAX_RECONNECT;
    this.reconnectInterval = options.reconnectInterval || DEFAULT_WS_RECONNECT_INTERVAL;
    this.context = options.context;
  }
  RealtimeWebSocketClient2.prototype.clearHeartbeat = function() {
    this.pingTimeoutId && clearTimeout(this.pingTimeoutId);
    this.pongTimeoutId && clearTimeout(this.pongTimeoutId);
  };
  RealtimeWebSocketClient2.prototype.close = function(code2) {
    this.clearHeartbeat();
    if (this.ws) {
      this.ws.close(code2, CLOSE_EVENT_CODE_INFO[code2].name);
      this.ws = void 0;
    }
  };
  RealtimeWebSocketClient2.prototype.watch = function(options) {
    if (!this.ws && (this.wsInitPromise === void 0 || this.wsInitPromise === null)) {
      this.initWebSocketConnection(false);
    }
    var virtualClient = new VirtualWebSocketClient(__assign16(__assign16({}, options), { send: this.send, login: this.webLogin, isWSConnected: this.isWSConnected, onceWSConnected: this.onceWSConnected, getWaitExpectedTimeoutLength: this.getWaitExpectedTimeoutLength, onWatchStart: this.onWatchStart, onWatchClose: this.onWatchClose, debug: true }));
    this.virtualWSClient.add(virtualClient);
    this.watchIdClientMap.set(virtualClient.watchId, virtualClient);
    return virtualClient.listener;
  };
  RealtimeWebSocketClient2.prototype.heartbeat = function(immediate) {
    var _this = this;
    this.clearHeartbeat();
    this.pingTimeoutId = setTimeout(function() {
      (function() {
        return __awaiter15(_this, void 0, void 0, function() {
          var e_6;
          var _this2 = this;
          return __generator15(this, function(_a3) {
            switch (_a3.label) {
              case 0:
                _a3.trys.push([0, 2, , 3]);
                if (!this.ws || this.ws.readyState !== WS_READY_STATE.OPEN) {
                  return [2];
                }
                this.lastPingSendTS = Date.now();
                return [4, this.ping()];
              case 1:
                _a3.sent();
                this.pingFailed = 0;
                this.pongTimeoutId = setTimeout(function() {
                  console.error("pong timed out");
                  if (_this2.pongMissed < DEFAULT_PONG_MISS_TOLERANCE) {
                    _this2.pongMissed += 1;
                    _this2.heartbeat(true);
                  } else {
                    _this2.initWebSocketConnection(true);
                  }
                }, this.context.appConfig.realtimePongWaitTimeout);
                return [3, 3];
              case 2:
                e_6 = _a3.sent();
                if (this.pingFailed < DEFAULT_PING_FAIL_TOLERANCE) {
                  this.pingFailed += 1;
                  this.heartbeat();
                } else {
                  this.close(CloseEventCode.HeartbeatPingError);
                }
                return [3, 3];
              case 3:
                return [2];
            }
          });
        });
      })();
    }, immediate ? 0 : this.context.appConfig.realtimePingInterval);
  };
  return RealtimeWebSocketClient2;
}();

// node_modules/@cloudbase/realtime/dist/esm/index.js
var hook = {
  target: "database",
  entity: function() {
    var _a3 = this.platform, adapter2 = _a3.adapter, runtime2 = _a3.runtime;
    setWsClass(adapter2.wsClass);
    setRuntime(runtime2);
  }
};
var component5 = {
  name: "realtime",
  IIFE: true,
  entity: function() {
    this.prototype.wsClientClass = RealtimeWebSocketClient;
  }
};
try {
  cloudbase.registerComponent(component5);
  cloudbase.registerHook(hook);
} catch (e3) {
}
function registerRealtime(app) {
  try {
    app.registerComponent(component5);
    app.registerHook(hook);
  } catch (e3) {
    console.warn(e3);
  }
}

// node_modules/@cloudbase/analytics/dist/esm/index.js
var __decorate5 = function(decorators, target, key, desc) {
  var c2 = arguments.length, r3 = c2 < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d2;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r3 = Reflect.decorate(decorators, target, key, desc);
  else for (var i2 = decorators.length - 1; i2 >= 0; i2--) if (d2 = decorators[i2]) r3 = (c2 < 3 ? d2(r3) : c2 > 3 ? d2(target, key, r3) : d2(target, key)) || r3;
  return c2 > 3 && r3 && Object.defineProperty(target, key, r3), r3;
};
var __metadata5 = function(k2, v2) {
  if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k2, v2);
};
var __awaiter16 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator16 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var ERRORS10 = constants_exports.ERRORS;
var COMMUNITY_SITE_URL6 = constants_exports.COMMUNITY_SITE_URL;
var catchErrorsDecorator6 = helpers_exports.catchErrorsDecorator;
var COMPONENT_NAME5 = "analytics";
var reportTypes = ["mall"];
function validateAnalyticsData(data2) {
  if (Object.prototype.toString.call(data2).slice(8, -1) !== "Object") {
    return false;
  }
  var reportData = data2.report_data, reportType = data2.report_type;
  if (reportTypes.includes(reportType) === false) {
    return false;
  }
  if (Object.prototype.toString.call(reportData).slice(8, -1) !== "Object") {
    return false;
  }
  if (reportData.action_time !== void 0 && !Number.isInteger(reportData.action_time)) {
    return false;
  }
  if (typeof reportData.action_type !== "string") {
    return false;
  }
  return true;
}
var CloudbaseAnalytics = function() {
  function CloudbaseAnalytics2() {
  }
  CloudbaseAnalytics2.prototype.analytics = function(requestData) {
    return __awaiter16(this, void 0, void 0, function() {
      var action, actionTime, transformData, params, request;
      return __generator16(this, function(_a3) {
        if (!validateAnalyticsData(requestData)) {
          throw new Error(JSON.stringify({
            code: ERRORS10.INVALID_PARAMS,
            msg: "[".concat(COMPONENT_NAME5, ".analytics] invalid report data")
          }));
        }
        action = "analytics.report";
        actionTime = requestData.report_data.action_time === void 0 ? Math.floor(Date.now() / 1e3) : requestData.report_data.action_time;
        transformData = {
          analytics_scene: requestData.report_type,
          analytics_data: Object.assign({}, requestData.report_data, {
            action_time: actionTime
          })
        };
        params = {
          requestData: transformData
        };
        request = this.request;
        request.send(action, params);
        return [2];
      });
    });
  };
  __decorate5([
    catchErrorsDecorator6({
      customInfo: {
        className: "Cloudbase",
        methodName: "analytics"
      },
      title: "",
      messages: [
        "",
        "  1 -  analytics() ",
        "".concat(COMMUNITY_SITE_URL6)
      ]
    }),
    __metadata5("design:type", Function),
    __metadata5("design:paramtypes", [Object]),
    __metadata5("design:returntype", Promise)
  ], CloudbaseAnalytics2.prototype, "analytics", null);
  return CloudbaseAnalytics2;
}();
var cloudbaseAnalytics = new CloudbaseAnalytics();
var component6 = {
  name: COMPONENT_NAME5,
  entity: {
    analytics: cloudbaseAnalytics.analytics
  }
};
try {
  cloudbase.registerComponent(component6);
} catch (e3) {
}
function registerAnalytics(app) {
  try {
    app.registerComponent(component6);
  } catch (e3) {
    console.warn(e3);
  }
}

// node_modules/@cloudbase/wx-cloud-client-sdk/lib/wxCloudClientSDK.esm.js
var extendStatics = function(d2, b2) {
  extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
    d3.__proto__ = b3;
  } || function(d3, b3) {
    for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
  };
  return extendStatics(d2, b2);
};
function __extends9(d2, b2) {
  if (typeof b2 !== "function" && b2 !== null)
    throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
  extendStatics(d2, b2);
  function __() {
    this.constructor = d2;
  }
  d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
}
var __assign17 = function() {
  __assign17 = Object.assign || function __assign43(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2)) t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign17.apply(this, arguments);
};
function __awaiter17(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, [])).next());
  });
}
function __generator17(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (_2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
}
var WxCloudSDKError = (
  /** @class */
  function(_super) {
    __extends9(WxCloudSDKError2, _super);
    function WxCloudSDKError2(message, extra) {
      var _this = _super.call(this, message) || this;
      _this.name = "WxCloudSDKError";
      _this.code = extra === null || extra === void 0 ? void 0 : extra.code;
      _this.requestId = extra === null || extra === void 0 ? void 0 : extra.requestId;
      _this.originError = extra === null || extra === void 0 ? void 0 : extra.originError;
      return _this;
    }
    return WxCloudSDKError2;
  }(Error)
);
function getGlobalObj() {
  return typeof window !== "undefined" && window || typeof globalThis !== "undefined" && globalThis;
}
function getReferrer() {
  try {
    var globalObj = getGlobalObj();
    if (!globalObj)
      return;
    if (typeof wx === "undefined") {
      return getGlobalObj().location.href;
    }
    return globalObj.__wxRoute;
  } catch (_a3) {
  }
}
function getUserAgent() {
  var globalObj = getGlobalObj();
  if (globalObj === null || globalObj === void 0 ? void 0 : globalObj.navigator)
    return globalObj.navigator.userAgent;
  if (typeof wx !== "undefined" && wx.getSystemInfo) {
    var ua_1;
    wx.getSystemInfo({
      success: function(res) {
        if (!res)
          return;
        ua_1 = ["brand", "model", "version", "system", "platform", "SDKVersion", "language"].map(function(k2) {
          return "".concat(k2, ": ").concat(res[k2]);
        }).join(", ");
      }
    });
    return ua_1;
  }
}
var VERSION = "1.7.2";
var callDataSource = function(_a3) {
  var dataSourceName = _a3.dataSourceName, methodName = _a3.methodName, params = _a3.params, realMethodName = _a3.realMethodName, callFunction = _a3.callFunction, _b = _a3.envType, envType = _b === void 0 ? "prod" : _b, mode = _a3.mode;
  return __awaiter17(void 0, void 0, void 0, function() {
    var result, response, requestId, error_1;
    var _c, _d;
    return __generator17(this, function(_e2) {
      switch (_e2.label) {
        case 0:
          result = {
            data: {},
            requestId: ""
          };
          _e2.label = 1;
        case 1:
          _e2.trys.push([1, 3, , 4]);
          return [4, callFunction({
            name: "lowcode-datasource",
            data: {
              dataSourceName,
              methodName,
              params,
              userAgent: getUserAgent(),
              referrer: getReferrer(),
              "x-sdk-version": VERSION,
              /**
               * todo 
               */
              envType,
              mode
            }
          })];
        case 2:
          response = _e2.sent();
          requestId = ((_c = response === null || response === void 0 ? void 0 : response.result) === null || _c === void 0 ? void 0 : _c.requestId) || (response === null || response === void 0 ? void 0 : response.requestId) || (response === null || response === void 0 ? void 0 : response.requestID);
          if (response === null || response === void 0 ? void 0 : response.result.code) {
            throw new WxCloudSDKError("".concat(response === null || response === void 0 ? void 0 : response.result.message, "\n models.").concat(dataSourceName ? "".concat(dataSourceName, ".") : "").concat(realMethodName, "\n").concat(response === null || response === void 0 ? void 0 : response.result.code, "\nID").concat(requestId || "N/A"), {
              code: response === null || response === void 0 ? void 0 : response.result.code,
              requestId
            });
          } else {
            result.data = ((_d = response === null || response === void 0 ? void 0 : response.result) === null || _d === void 0 ? void 0 : _d.data) || {};
            result.requestId = requestId;
          }
          return [3, 4];
        case 3:
          error_1 = _e2.sent();
          if (error_1.name === "WxCloudSDKError") {
            throw error_1;
          } else {
            console.log(error_1);
            throw new WxCloudSDKError("".concat(error_1.message, "\n       models.").concat(dataSourceName ? "".concat(dataSourceName, ".") : "").concat(realMethodName, "\n      IDN/A"), {
              code: "UnknownError",
              originError: error_1
            });
          }
        case 4:
          return [2, result];
      }
    });
  });
};
var runMysqlCommand = function(_a3) {
  var sql = _a3.sql, params = _a3.params, config = _a3.config, callFunction = _a3.callFunction, _b = _a3.unsafe, unsafe = _b === void 0 ? false : _b;
  return __awaiter17(void 0, void 0, void 0, function() {
    return __generator17(this, function(_c) {
      return [2, callDataSource({
        realMethodName: "$runSQL",
        methodName: "callWedaApi",
        params: {
          action: "RunMysqlCommand",
          data: {
            sqlTemplate: sql,
            config,
            parameter: unsafe ? "" : Object.entries(params || {}).reduce(function(list, _a4) {
              var key = _a4[0], value = _a4[1];
              if (value !== void 0) {
                var type = "OBJECT";
                var typeofValue = typeof value;
                switch (typeofValue) {
                  case "boolean": {
                    type = "BOOLEAN";
                    break;
                  }
                  case "number": {
                    type = "NUMBER";
                    break;
                  }
                  case "string": {
                    type = "STRING";
                    break;
                  }
                  default: {
                    if (Array.isArray(value)) {
                      type = "ARRAY";
                    } else {
                      type = "OBJECT";
                    }
                  }
                }
                list.push({
                  key,
                  type,
                  value: type === "STRING" ? value : JSON.stringify(value)
                });
              }
              return list;
            }, []) || []
          }
        },
        callFunction,
        mode: "sdk"
      })];
    });
  });
};
var createRawQueryClient = function(callFunction) {
  return {
    $runSQL: function(sql, params, config) {
      return __awaiter17(this, void 0, void 0, function() {
        var res;
        return __generator17(this, function(_a3) {
          switch (_a3.label) {
            case 0:
              return [4, runMysqlCommand({
                sql,
                params,
                config: __assign17(__assign17({}, config), { preparedStatements: true }),
                callFunction
              })];
            case 1:
              res = _a3.sent();
              return [2, res];
          }
        });
      });
    },
    $runSQLRaw: function(sql, config) {
      return __awaiter17(this, void 0, void 0, function() {
        var res;
        return __generator17(this, function(_a3) {
          switch (_a3.label) {
            case 0:
              return [4, runMysqlCommand({
                sql,
                params: [],
                config: __assign17(__assign17({}, config), { preparedStatements: false }),
                callFunction
              })];
            case 1:
              res = _a3.sent();
              return [2, res];
          }
        });
      });
    }
  };
};
var READ_DEFAULT_PARAMS = {
  filter: {
    where: {}
  },
  select: {
    $master: true
  }
};
function createDefaultMethod(methodName) {
  return {
    getUrl: function(modelName) {
      return "".concat(modelName, "/").concat(methodName);
    },
    method: "post"
  };
}
var HTTP_DATA_MODEL_METHODS = {
  get: __assign17(__assign17({}, createDefaultMethod("get")), { defaultParams: __assign17({}, READ_DEFAULT_PARAMS) }),
  list: __assign17(__assign17({}, createDefaultMethod("list")), { defaultParams: __assign17({}, READ_DEFAULT_PARAMS) }),
  create: createDefaultMethod("create"),
  createMany: createDefaultMethod("createMany"),
  update: __assign17(__assign17({}, createDefaultMethod("update")), { method: "put" }),
  updateMany: __assign17(__assign17({}, createDefaultMethod("updateMany")), { method: "put" }),
  upsert: createDefaultMethod("upsert"),
  "delete": createDefaultMethod("delete"),
  deleteMany: createDefaultMethod("deleteMany")
};
var UNKNOWN_ERROR_MESSAGE = "Unknown error occurred";
var NOT_SUPPORTED_CODE = "NotSupported";
var generateHTTPClient = function(callFunction, fetch2, baseUrl, options) {
  var rawQueryClient = createRawQueryClient(callFunction);
  return new Proxy({}, {
    get: function(_2, modelName) {
      if (typeof modelName !== "string")
        return void 0;
      if (Object.prototype.hasOwnProperty.call(rawQueryClient, modelName)) {
        return rawQueryClient[modelName];
      }
      return generateHTTPClientByDataSourceName(baseUrl, modelName, fetch2, options);
    }
  });
};
var createWxCloudSDKError = function(message, modelName, methodName, code2, requestId) {
  return new WxCloudSDKError("".concat(message, "\n models.").concat(modelName, ".").concat(methodName, "\n").concat(code2, "\nID").concat(requestId), {
    code: code2,
    requestId
  });
};
var generateHTTPClientByDataSourceName = function(baseUrl, modelName, fetch2, options) {
  var client = new Proxy({}, {
    get: function(_2, methodName) {
      if (methodName !== "runSQLTemplate") {
        var httpDataModelMethod_1 = HTTP_DATA_MODEL_METHODS[methodName];
        if (!httpDataModelMethod_1) {
          var error = new Error(": ".concat(methodName));
          throw new WxCloudSDKError(error.message || UNKNOWN_ERROR_MESSAGE, {
            originError: error,
            code: NOT_SUPPORTED_CODE,
            requestId: "N/A"
          });
        }
        return function(params) {
          if (params === void 0) {
            params = {};
          }
          return __awaiter17(void 0, void 0, void 0, function() {
            var getUrl, method, _a3, defaultParams, effectiveParams, envType, url2, result, error_1;
            var _b;
            return __generator17(this, function(_c) {
              switch (_c.label) {
                case 0:
                  getUrl = httpDataModelMethod_1.getUrl, method = httpDataModelMethod_1.method, _a3 = httpDataModelMethod_1.defaultParams, defaultParams = _a3 === void 0 ? {} : _a3;
                  effectiveParams = Object.assign({}, defaultParams, params);
                  envType = effectiveParams.envType === "pre" ? "pre" : "prod";
                  url2 = [baseUrl, envType, getUrl(modelName)].join("/");
                  _c.label = 1;
                case 1:
                  _c.trys.push([1, 3, , 4]);
                  return [4, fetch2({
                    url: url2,
                    body: JSON.stringify(effectiveParams),
                    method
                  })];
                case 2:
                  result = _c.sent();
                  if (result.code) {
                    throw createWxCloudSDKError(result === null || result === void 0 ? void 0 : result.message, modelName, methodName, result === null || result === void 0 ? void 0 : result.code, result === null || result === void 0 ? void 0 : result.requestId);
                  }
                  if (methodName === "get") {
                    Object.assign(result, { data: (_b = result.data.record) !== null && _b !== void 0 ? _b : result.data });
                  }
                  return [2, result];
                case 3:
                  error_1 = _c.sent();
                  throw new WxCloudSDKError((error_1 === null || error_1 === void 0 ? void 0 : error_1.message) || UNKNOWN_ERROR_MESSAGE, {
                    originError: error_1
                  });
                case 4:
                  return [
                    2
                    /*return*/
                  ];
              }
            });
          });
        };
      } else {
        if (!(options === null || options === void 0 ? void 0 : options.sqlBaseUrl)) {
          var error = new Error(": ".concat(methodName));
          throw new WxCloudSDKError(error.message || UNKNOWN_ERROR_MESSAGE, {
            originError: error,
            code: NOT_SUPPORTED_CODE,
            requestId: "N/A"
          });
        }
        return function(props) {
          return __awaiter17(void 0, void 0, void 0, function() {
            var params, templateName, _envType, envType, url2, parameter, result, error_2;
            var _a3, _b, _c, _d, _e2, _f, _g, _h;
            return __generator17(this, function(_j) {
              switch (_j.label) {
                case 0:
                  params = props.params, templateName = props.templateName, _envType = props.envType;
                  envType = _envType === "pre" ? "pre" : "prod";
                  url2 = [options.sqlBaseUrl, envType, templateName, "run"].join("/");
                  parameter = Object.entries(params || {}).reduce(function(list, _a4) {
                    var key = _a4[0], value = _a4[1];
                    if (value !== void 0) {
                      var type = "OBJECT";
                      var typeofValue = typeof value;
                      switch (typeofValue) {
                        case "boolean": {
                          type = "BOOLEAN";
                          break;
                        }
                        case "number": {
                          type = "NUMBER";
                          break;
                        }
                        case "string": {
                          type = "STRING";
                          break;
                        }
                        default: {
                          if (Array.isArray(value)) {
                            type = "ARRAY";
                          } else {
                            type = "OBJECT";
                          }
                        }
                      }
                      list.push({
                        key,
                        type,
                        value: type === "STRING" ? value : JSON.stringify(value)
                      });
                    }
                    return list;
                  }, []);
                  _j.label = 1;
                case 1:
                  _j.trys.push([1, 3, , 4]);
                  return [4, fetch2({
                    url: url2,
                    body: JSON.stringify({ parameter }),
                    method: "POST"
                  })];
                case 2:
                  result = _j.sent();
                  if ((_a3 = result === null || result === void 0 ? void 0 : result.Response) === null || _a3 === void 0 ? void 0 : _a3.Error) {
                    throw createWxCloudSDKError((_c = (_b = result === null || result === void 0 ? void 0 : result.Response) === null || _b === void 0 ? void 0 : _b.Error) === null || _c === void 0 ? void 0 : _c.Message, modelName, methodName, (_e2 = (_d = result === null || result === void 0 ? void 0 : result.Response) === null || _d === void 0 ? void 0 : _d.Error) === null || _e2 === void 0 ? void 0 : _e2.Code, (_f = result === null || result === void 0 ? void 0 : result.Response) === null || _f === void 0 ? void 0 : _f.RequestId);
                  }
                  return [2, __assign17(__assign17({}, (_g = result === null || result === void 0 ? void 0 : result.Response) !== null && _g !== void 0 ? _g : {}), { data: (_h = result === null || result === void 0 ? void 0 : result.Response) === null || _h === void 0 ? void 0 : _h.Data })];
                case 3:
                  error_2 = _j.sent();
                  throw new WxCloudSDKError((error_2 === null || error_2 === void 0 ? void 0 : error_2.message) || UNKNOWN_ERROR_MESSAGE, {
                    originError: error_2
                  });
                case 4:
                  return [
                    2
                    /*return*/
                  ];
              }
            });
          });
        };
      }
    }
  });
  return client;
};
var _Headers = (
  /** @class */
  function() {
    function _Headers2(init) {
      var _this = this;
      this.map = /* @__PURE__ */ new Map();
      if (!init)
        return;
      if (init instanceof Headers) {
        init.forEach(function(value, key) {
          _this.append(key, value);
        });
      } else if (Array.isArray(init)) {
        init.forEach(function(_a3) {
          var key = _a3[0], value = _a3[1];
          _this.append(key, value);
        });
      } else if (typeof init === "object") {
        Object.keys(init).forEach(function(key) {
          _this.append(key, init[key]);
        });
      }
    }
    _Headers2.prototype.append = function(name, value) {
      var key = name.toLowerCase();
      var current = this.map.get(key);
      if (current) {
        this.map.set(key, "".concat(current, ", ").concat(value));
      } else {
        this.map.set(key, String(value));
      }
    };
    _Headers2.prototype["delete"] = function(name) {
      this.map["delete"](name.toLowerCase());
    };
    _Headers2.prototype.forEach = function(callback, thisArg) {
      var _this = this;
      this.map.forEach(function(value, key) {
        callback.call(thisArg, value, key, _this);
      });
    };
    _Headers2.prototype.get = function(name) {
      return this.map.get(name.toLowerCase()) || null;
    };
    _Headers2.prototype.has = function(name) {
      return this.map.has(name.toLowerCase());
    };
    _Headers2.prototype.set = function(name, value) {
      this.map.set(name.toLowerCase(), String(value));
    };
    _Headers2.prototype.entries = function() {
      return this.map.entries();
    };
    _Headers2.prototype.keys = function() {
      return this.map.keys();
    };
    _Headers2.prototype.values = function() {
      return this.map.values();
    };
    _Headers2.prototype.getSetCookie = function() {
      var values2 = [];
      this.map.forEach(function(value, key) {
        if (key === "set-cookie") {
          values2.push(value);
        }
      });
      return values2;
    };
    _Headers2.prototype.toJSON = function() {
      var obj = {};
      this.map.forEach(function(value, key) {
        obj[key] = value;
      });
      return obj;
    };
    _Headers2.prototype[Symbol.iterator] = function() {
      return this.entries();
    };
    return _Headers2;
  }()
);
if (typeof globalThis === "object" && !globalThis.Headers) {
  globalThis.Headers = _Headers;
}
var commonjsGlobal = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
function getDefaultExportFromCjs(x2) {
  return x2 && x2.__esModule && Object.prototype.hasOwnProperty.call(x2, "default") ? x2["default"] : x2;
}
var fails$d = function(exec2) {
  try {
    return !!exec2();
  } catch (error) {
    return true;
  }
};
var fails$c = fails$d;
var functionBindNative = !fails$c(function() {
  var test2 = (function() {
  }).bind();
  return typeof test2 != "function" || test2.hasOwnProperty("prototype");
});
var NATIVE_BIND$3 = functionBindNative;
var FunctionPrototype$2 = Function.prototype;
var call$b = FunctionPrototype$2.call;
var uncurryThisWithBind = NATIVE_BIND$3 && FunctionPrototype$2.bind.bind(call$b, call$b);
var functionUncurryThis = NATIVE_BIND$3 ? uncurryThisWithBind : function(fn) {
  return function() {
    return call$b.apply(fn, arguments);
  };
};
var uncurryThis$h = functionUncurryThis;
var toString$7 = uncurryThis$h({}.toString);
var stringSlice$3 = uncurryThis$h("".slice);
var classofRaw$2 = function(it2) {
  return stringSlice$3(toString$7(it2), 8, -1);
};
var uncurryThis$g = functionUncurryThis;
var fails$b = fails$d;
var classof$6 = classofRaw$2;
var $Object$4 = Object;
var split$3 = uncurryThis$g("".split);
var indexedObject = fails$b(function() {
  return !$Object$4("z").propertyIsEnumerable(0);
}) ? function(it2) {
  return classof$6(it2) === "String" ? split$3(it2, "") : $Object$4(it2);
} : $Object$4;
var isNullOrUndefined$3 = function(it2) {
  return it2 === null || it2 === void 0;
};
var isNullOrUndefined$2 = isNullOrUndefined$3;
var $TypeError$8 = TypeError;
var requireObjectCoercible$3 = function(it2) {
  if (isNullOrUndefined$2(it2)) throw new $TypeError$8("Can't call method on " + it2);
  return it2;
};
var IndexedObject$1 = indexedObject;
var requireObjectCoercible$2 = requireObjectCoercible$3;
var toIndexedObject$5 = function(it2) {
  return IndexedObject$1(requireObjectCoercible$2(it2));
};
var iterators = {};
var check = function(it2) {
  return it2 && it2.Math === Math && it2;
};
var globalThis_1 = (
  // eslint-disable-next-line es/no-global-this -- safe
  check(typeof globalThis == "object" && globalThis) || check(typeof window == "object" && window) || // eslint-disable-next-line no-restricted-globals -- safe
  check(typeof self == "object" && self) || check(typeof commonjsGlobal == "object" && commonjsGlobal) || check(typeof commonjsGlobal == "object" && commonjsGlobal) || // eslint-disable-next-line no-new-func -- fallback
  /* @__PURE__ */ function() {
    return this;
  }() || Function("return this")()
);
var documentAll = typeof document == "object" && document.all;
var isCallable$e = typeof documentAll == "undefined" && documentAll !== void 0 ? function(argument) {
  return typeof argument == "function" || argument === documentAll;
} : function(argument) {
  return typeof argument == "function";
};
var globalThis$e = globalThis_1;
var isCallable$d = isCallable$e;
var WeakMap$1 = globalThis$e.WeakMap;
var weakMapBasicDetection = isCallable$d(WeakMap$1) && /native code/.test(String(WeakMap$1));
var isCallable$c = isCallable$e;
var isObject$7 = function(it2) {
  return typeof it2 == "object" ? it2 !== null : isCallable$c(it2);
};
var fails$a = fails$d;
var descriptors = !fails$a(function() {
  return Object.defineProperty({}, 1, { get: function() {
    return 7;
  } })[1] !== 7;
});
var objectDefineProperty = {};
var globalThis$d = globalThis_1;
var isObject$6 = isObject$7;
var document$1 = globalThis$d.document;
var EXISTS$1 = isObject$6(document$1) && isObject$6(document$1.createElement);
var documentCreateElement$1 = function(it2) {
  return EXISTS$1 ? document$1.createElement(it2) : {};
};
var DESCRIPTORS$c = descriptors;
var fails$9 = fails$d;
var createElement = documentCreateElement$1;
var ie8DomDefine = !DESCRIPTORS$c && !fails$9(function() {
  return Object.defineProperty(createElement("div"), "a", {
    get: function() {
      return 7;
    }
  }).a !== 7;
});
var DESCRIPTORS$b = descriptors;
var fails$8 = fails$d;
var v8PrototypeDefineBug = DESCRIPTORS$b && fails$8(function() {
  return Object.defineProperty(function() {
  }, "prototype", {
    value: 42,
    writable: false
  }).prototype !== 42;
});
var isObject$5 = isObject$7;
var $String$3 = String;
var $TypeError$7 = TypeError;
var anObject$7 = function(argument) {
  if (isObject$5(argument)) return argument;
  throw new $TypeError$7($String$3(argument) + " is not an object");
};
var NATIVE_BIND$2 = functionBindNative;
var call$a = Function.prototype.call;
var functionCall = NATIVE_BIND$2 ? call$a.bind(call$a) : function() {
  return call$a.apply(call$a, arguments);
};
var path$3 = {};
var path$2 = path$3;
var globalThis$c = globalThis_1;
var isCallable$b = isCallable$e;
var aFunction = function(variable) {
  return isCallable$b(variable) ? variable : void 0;
};
var getBuiltIn$6 = function(namespace, method) {
  return arguments.length < 2 ? aFunction(path$2[namespace]) || aFunction(globalThis$c[namespace]) : path$2[namespace] && path$2[namespace][method] || globalThis$c[namespace] && globalThis$c[namespace][method];
};
var uncurryThis$f = functionUncurryThis;
var objectIsPrototypeOf = uncurryThis$f({}.isPrototypeOf);
var globalThis$b = globalThis_1;
var navigator2 = globalThis$b.navigator;
var userAgent$1 = navigator2 && navigator2.userAgent;
var environmentUserAgent = userAgent$1 ? String(userAgent$1) : "";
var globalThis$a = globalThis_1;
var userAgent = environmentUserAgent;
var process2 = globalThis$a.process;
var Deno = globalThis$a.Deno;
var versions = process2 && process2.versions || Deno && Deno.version;
var v8 = versions && versions.v8;
var match;
var version;
if (v8) {
  match = v8.split(".");
  version = match[0] > 0 && match[0] < 4 ? 1 : +(match[0] + match[1]);
}
if (!version && userAgent) {
  match = userAgent.match(/Edge\/(\d+)/);
  if (!match || match[1] >= 74) {
    match = userAgent.match(/Chrome\/(\d+)/);
    if (match) version = +match[1];
  }
}
var environmentV8Version = version;
var V8_VERSION = environmentV8Version;
var fails$7 = fails$d;
var globalThis$9 = globalThis_1;
var $String$2 = globalThis$9.String;
var symbolConstructorDetection = !!Object.getOwnPropertySymbols && !fails$7(function() {
  var symbol = Symbol("symbol detection");
  return !$String$2(symbol) || !(Object(symbol) instanceof Symbol) || // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances
  !Symbol.sham && V8_VERSION && V8_VERSION < 41;
});
var NATIVE_SYMBOL$1 = symbolConstructorDetection;
var useSymbolAsUid = NATIVE_SYMBOL$1 && !Symbol.sham && typeof Symbol.iterator == "symbol";
var getBuiltIn$5 = getBuiltIn$6;
var isCallable$a = isCallable$e;
var isPrototypeOf$1 = objectIsPrototypeOf;
var USE_SYMBOL_AS_UID$1 = useSymbolAsUid;
var $Object$3 = Object;
var isSymbol$2 = USE_SYMBOL_AS_UID$1 ? function(it2) {
  return typeof it2 == "symbol";
} : function(it2) {
  var $Symbol = getBuiltIn$5("Symbol");
  return isCallable$a($Symbol) && isPrototypeOf$1($Symbol.prototype, $Object$3(it2));
};
var $String$1 = String;
var tryToString$2 = function(argument) {
  try {
    return $String$1(argument);
  } catch (error) {
    return "Object";
  }
};
var isCallable$9 = isCallable$e;
var tryToString$1 = tryToString$2;
var $TypeError$6 = TypeError;
var aCallable$3 = function(argument) {
  if (isCallable$9(argument)) return argument;
  throw new $TypeError$6(tryToString$1(argument) + " is not a function");
};
var aCallable$2 = aCallable$3;
var isNullOrUndefined$1 = isNullOrUndefined$3;
var getMethod$3 = function(V2, P2) {
  var func = V2[P2];
  return isNullOrUndefined$1(func) ? void 0 : aCallable$2(func);
};
var call$9 = functionCall;
var isCallable$8 = isCallable$e;
var isObject$4 = isObject$7;
var $TypeError$5 = TypeError;
var ordinaryToPrimitive$1 = function(input, pref) {
  var fn, val;
  if (pref === "string" && isCallable$8(fn = input.toString) && !isObject$4(val = call$9(fn, input))) return val;
  if (isCallable$8(fn = input.valueOf) && !isObject$4(val = call$9(fn, input))) return val;
  if (pref !== "string" && isCallable$8(fn = input.toString) && !isObject$4(val = call$9(fn, input))) return val;
  throw new $TypeError$5("Can't convert object to primitive value");
};
var sharedStore = { exports: {} };
var isPure = true;
var globalThis$8 = globalThis_1;
var defineProperty$3 = Object.defineProperty;
var defineGlobalProperty$1 = function(key, value) {
  try {
    defineProperty$3(globalThis$8, key, { value, configurable: true, writable: true });
  } catch (error) {
    globalThis$8[key] = value;
  }
  return value;
};
var globalThis$7 = globalThis_1;
var defineGlobalProperty = defineGlobalProperty$1;
var SHARED = "__core-js_shared__";
var store$3 = sharedStore.exports = globalThis$7[SHARED] || defineGlobalProperty(SHARED, {});
(store$3.versions || (store$3.versions = [])).push({
  version: "3.45.0",
  mode: "pure",
  copyright: " 2014-2025 Denis Pushkarev (zloirock.ru)",
  license: "https://github.com/zloirock/core-js/blob/v3.45.0/LICENSE",
  source: "https://github.com/zloirock/core-js"
});
var sharedStoreExports = sharedStore.exports;
var store$2 = sharedStoreExports;
var shared$3 = function(key, value) {
  return store$2[key] || (store$2[key] = value || {});
};
var requireObjectCoercible$1 = requireObjectCoercible$3;
var $Object$2 = Object;
var toObject$4 = function(argument) {
  return $Object$2(requireObjectCoercible$1(argument));
};
var uncurryThis$e = functionUncurryThis;
var toObject$3 = toObject$4;
var hasOwnProperty = uncurryThis$e({}.hasOwnProperty);
var hasOwnProperty_1 = Object.hasOwn || function hasOwn(it2, key) {
  return hasOwnProperty(toObject$3(it2), key);
};
var uncurryThis$d = functionUncurryThis;
var id = 0;
var postfix = Math.random();
var toString$6 = uncurryThis$d(1.1.toString);
var uid$2 = function(key) {
  return "Symbol(" + (key === void 0 ? "" : key) + ")_" + toString$6(++id + postfix, 36);
};
var globalThis$6 = globalThis_1;
var shared$2 = shared$3;
var hasOwn$9 = hasOwnProperty_1;
var uid$1 = uid$2;
var NATIVE_SYMBOL = symbolConstructorDetection;
var USE_SYMBOL_AS_UID = useSymbolAsUid;
var Symbol$1 = globalThis$6.Symbol;
var WellKnownSymbolsStore = shared$2("wks");
var createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol$1["for"] || Symbol$1 : Symbol$1 && Symbol$1.withoutSetter || uid$1;
var wellKnownSymbol$a = function(name) {
  if (!hasOwn$9(WellKnownSymbolsStore, name)) {
    WellKnownSymbolsStore[name] = NATIVE_SYMBOL && hasOwn$9(Symbol$1, name) ? Symbol$1[name] : createWellKnownSymbol("Symbol." + name);
  }
  return WellKnownSymbolsStore[name];
};
var call$8 = functionCall;
var isObject$3 = isObject$7;
var isSymbol$1 = isSymbol$2;
var getMethod$2 = getMethod$3;
var ordinaryToPrimitive = ordinaryToPrimitive$1;
var wellKnownSymbol$9 = wellKnownSymbol$a;
var $TypeError$4 = TypeError;
var TO_PRIMITIVE = wellKnownSymbol$9("toPrimitive");
var toPrimitive$1 = function(input, pref) {
  if (!isObject$3(input) || isSymbol$1(input)) return input;
  var exoticToPrim = getMethod$2(input, TO_PRIMITIVE);
  var result;
  if (exoticToPrim) {
    if (pref === void 0) pref = "default";
    result = call$8(exoticToPrim, input, pref);
    if (!isObject$3(result) || isSymbol$1(result)) return result;
    throw new $TypeError$4("Can't convert object to primitive value");
  }
  if (pref === void 0) pref = "number";
  return ordinaryToPrimitive(input, pref);
};
var toPrimitive = toPrimitive$1;
var isSymbol = isSymbol$2;
var toPropertyKey$2 = function(argument) {
  var key = toPrimitive(argument, "string");
  return isSymbol(key) ? key : key + "";
};
var DESCRIPTORS$a = descriptors;
var IE8_DOM_DEFINE$1 = ie8DomDefine;
var V8_PROTOTYPE_DEFINE_BUG$1 = v8PrototypeDefineBug;
var anObject$6 = anObject$7;
var toPropertyKey$1 = toPropertyKey$2;
var $TypeError$3 = TypeError;
var $defineProperty = Object.defineProperty;
var $getOwnPropertyDescriptor$1 = Object.getOwnPropertyDescriptor;
var ENUMERABLE = "enumerable";
var CONFIGURABLE$1 = "configurable";
var WRITABLE = "writable";
objectDefineProperty.f = DESCRIPTORS$a ? V8_PROTOTYPE_DEFINE_BUG$1 ? function defineProperty(O2, P2, Attributes) {
  anObject$6(O2);
  P2 = toPropertyKey$1(P2);
  anObject$6(Attributes);
  if (typeof O2 === "function" && P2 === "prototype" && "value" in Attributes && WRITABLE in Attributes && !Attributes[WRITABLE]) {
    var current = $getOwnPropertyDescriptor$1(O2, P2);
    if (current && current[WRITABLE]) {
      O2[P2] = Attributes.value;
      Attributes = {
        configurable: CONFIGURABLE$1 in Attributes ? Attributes[CONFIGURABLE$1] : current[CONFIGURABLE$1],
        enumerable: ENUMERABLE in Attributes ? Attributes[ENUMERABLE] : current[ENUMERABLE],
        writable: false
      };
    }
  }
  return $defineProperty(O2, P2, Attributes);
} : $defineProperty : function defineProperty2(O2, P2, Attributes) {
  anObject$6(O2);
  P2 = toPropertyKey$1(P2);
  anObject$6(Attributes);
  if (IE8_DOM_DEFINE$1) try {
    return $defineProperty(O2, P2, Attributes);
  } catch (error) {
  }
  if ("get" in Attributes || "set" in Attributes) throw new $TypeError$3("Accessors not supported");
  if ("value" in Attributes) O2[P2] = Attributes.value;
  return O2;
};
var createPropertyDescriptor$5 = function(bitmap, value) {
  return {
    enumerable: !(bitmap & 1),
    configurable: !(bitmap & 2),
    writable: !(bitmap & 4),
    value
  };
};
var DESCRIPTORS$9 = descriptors;
var definePropertyModule$2 = objectDefineProperty;
var createPropertyDescriptor$4 = createPropertyDescriptor$5;
var createNonEnumerableProperty$4 = DESCRIPTORS$9 ? function(object, key, value) {
  return definePropertyModule$2.f(object, key, createPropertyDescriptor$4(1, value));
} : function(object, key, value) {
  object[key] = value;
  return object;
};
var shared$1 = shared$3;
var uid = uid$2;
var keys = shared$1("keys");
var sharedKey$3 = function(key) {
  return keys[key] || (keys[key] = uid(key));
};
var hiddenKeys$3 = {};
var NATIVE_WEAK_MAP = weakMapBasicDetection;
var globalThis$5 = globalThis_1;
var isObject$2 = isObject$7;
var createNonEnumerableProperty$3 = createNonEnumerableProperty$4;
var hasOwn$8 = hasOwnProperty_1;
var shared = sharedStoreExports;
var sharedKey$2 = sharedKey$3;
var hiddenKeys$2 = hiddenKeys$3;
var OBJECT_ALREADY_INITIALIZED = "Object already initialized";
var TypeError$3 = globalThis$5.TypeError;
var WeakMap2 = globalThis$5.WeakMap;
var set2;
var get;
var has;
var enforce = function(it2) {
  return has(it2) ? get(it2) : set2(it2, {});
};
var getterFor = function(TYPE) {
  return function(it2) {
    var state;
    if (!isObject$2(it2) || (state = get(it2)).type !== TYPE) {
      throw new TypeError$3("Incompatible receiver, " + TYPE + " required");
    }
    return state;
  };
};
if (NATIVE_WEAK_MAP || shared.state) {
  store$1 = shared.state || (shared.state = new WeakMap2());
  store$1.get = store$1.get;
  store$1.has = store$1.has;
  store$1.set = store$1.set;
  set2 = function(it2, metadata) {
    if (store$1.has(it2)) throw new TypeError$3(OBJECT_ALREADY_INITIALIZED);
    metadata.facade = it2;
    store$1.set(it2, metadata);
    return metadata;
  };
  get = function(it2) {
    return store$1.get(it2) || {};
  };
  has = function(it2) {
    return store$1.has(it2);
  };
} else {
  STATE = sharedKey$2("state");
  hiddenKeys$2[STATE] = true;
  set2 = function(it2, metadata) {
    if (hasOwn$8(it2, STATE)) throw new TypeError$3(OBJECT_ALREADY_INITIALIZED);
    metadata.facade = it2;
    createNonEnumerableProperty$3(it2, STATE, metadata);
    return metadata;
  };
  get = function(it2) {
    return hasOwn$8(it2, STATE) ? it2[STATE] : {};
  };
  has = function(it2) {
    return hasOwn$8(it2, STATE);
  };
}
var store$1;
var STATE;
var internalState = {
  set: set2,
  get,
  has,
  enforce,
  getterFor
};
var NATIVE_BIND$1 = functionBindNative;
var FunctionPrototype$1 = Function.prototype;
var apply$1 = FunctionPrototype$1.apply;
var call$7 = FunctionPrototype$1.call;
var functionApply = typeof Reflect == "object" && Reflect.apply || (NATIVE_BIND$1 ? call$7.bind(apply$1) : function() {
  return call$7.apply(apply$1, arguments);
});
var classofRaw$1 = classofRaw$2;
var uncurryThis$c = functionUncurryThis;
var functionUncurryThisClause = function(fn) {
  if (classofRaw$1(fn) === "Function") return uncurryThis$c(fn);
};
var objectGetOwnPropertyDescriptor = {};
var objectPropertyIsEnumerable = {};
var $propertyIsEnumerable = {}.propertyIsEnumerable;
var getOwnPropertyDescriptor$2 = Object.getOwnPropertyDescriptor;
var NASHORN_BUG = getOwnPropertyDescriptor$2 && !$propertyIsEnumerable.call({ 1: 2 }, 1);
objectPropertyIsEnumerable.f = NASHORN_BUG ? function propertyIsEnumerable(V2) {
  var descriptor = getOwnPropertyDescriptor$2(this, V2);
  return !!descriptor && descriptor.enumerable;
} : $propertyIsEnumerable;
var DESCRIPTORS$8 = descriptors;
var call$6 = functionCall;
var propertyIsEnumerableModule$1 = objectPropertyIsEnumerable;
var createPropertyDescriptor$3 = createPropertyDescriptor$5;
var toIndexedObject$4 = toIndexedObject$5;
var toPropertyKey = toPropertyKey$2;
var hasOwn$7 = hasOwnProperty_1;
var IE8_DOM_DEFINE = ie8DomDefine;
var $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;
objectGetOwnPropertyDescriptor.f = DESCRIPTORS$8 ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O2, P2) {
  O2 = toIndexedObject$4(O2);
  P2 = toPropertyKey(P2);
  if (IE8_DOM_DEFINE) try {
    return $getOwnPropertyDescriptor(O2, P2);
  } catch (error) {
  }
  if (hasOwn$7(O2, P2)) return createPropertyDescriptor$3(!call$6(propertyIsEnumerableModule$1.f, O2, P2), O2[P2]);
};
var fails$6 = fails$d;
var isCallable$7 = isCallable$e;
var replacement = /#|\.prototype\./;
var isForced$1 = function(feature, detection) {
  var value = data[normalize(feature)];
  return value === POLYFILL ? true : value === NATIVE ? false : isCallable$7(detection) ? fails$6(detection) : !!detection;
};
var normalize = isForced$1.normalize = function(string) {
  return String(string).replace(replacement, ".").toLowerCase();
};
var data = isForced$1.data = {};
var NATIVE = isForced$1.NATIVE = "N";
var POLYFILL = isForced$1.POLYFILL = "P";
var isForced_1 = isForced$1;
var uncurryThis$b = functionUncurryThisClause;
var aCallable$1 = aCallable$3;
var NATIVE_BIND = functionBindNative;
var bind$4 = uncurryThis$b(uncurryThis$b.bind);
var functionBindContext = function(fn, that) {
  aCallable$1(fn);
  return that === void 0 ? fn : NATIVE_BIND ? bind$4(fn, that) : function() {
    return fn.apply(that, arguments);
  };
};
var globalThis$4 = globalThis_1;
var apply = functionApply;
var uncurryThis$a = functionUncurryThisClause;
var isCallable$6 = isCallable$e;
var getOwnPropertyDescriptor$1 = objectGetOwnPropertyDescriptor.f;
var isForced = isForced_1;
var path$1 = path$3;
var bind$3 = functionBindContext;
var createNonEnumerableProperty$2 = createNonEnumerableProperty$4;
var hasOwn$6 = hasOwnProperty_1;
var wrapConstructor = function(NativeConstructor) {
  var Wrapper = function(a2, b2, c2) {
    if (this instanceof Wrapper) {
      switch (arguments.length) {
        case 0:
          return new NativeConstructor();
        case 1:
          return new NativeConstructor(a2);
        case 2:
          return new NativeConstructor(a2, b2);
      }
      return new NativeConstructor(a2, b2, c2);
    }
    return apply(NativeConstructor, this, arguments);
  };
  Wrapper.prototype = NativeConstructor.prototype;
  return Wrapper;
};
var _export = function(options, source) {
  var TARGET = options.target;
  var GLOBAL = options.global;
  var STATIC = options.stat;
  var PROTO = options.proto;
  var nativeSource = GLOBAL ? globalThis$4 : STATIC ? globalThis$4[TARGET] : globalThis$4[TARGET] && globalThis$4[TARGET].prototype;
  var target = GLOBAL ? path$1 : path$1[TARGET] || createNonEnumerableProperty$2(path$1, TARGET, {})[TARGET];
  var targetPrototype = target.prototype;
  var FORCED, USE_NATIVE, VIRTUAL_PROTOTYPE;
  var key, sourceProperty, targetProperty, nativeProperty, resultProperty, descriptor;
  for (key in source) {
    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? "." : "#") + key, options.forced);
    USE_NATIVE = !FORCED && nativeSource && hasOwn$6(nativeSource, key);
    targetProperty = target[key];
    if (USE_NATIVE) if (options.dontCallGetSet) {
      descriptor = getOwnPropertyDescriptor$1(nativeSource, key);
      nativeProperty = descriptor && descriptor.value;
    } else nativeProperty = nativeSource[key];
    sourceProperty = USE_NATIVE && nativeProperty ? nativeProperty : source[key];
    if (!FORCED && !PROTO && typeof targetProperty == typeof sourceProperty) continue;
    if (options.bind && USE_NATIVE) resultProperty = bind$3(sourceProperty, globalThis$4);
    else if (options.wrap && USE_NATIVE) resultProperty = wrapConstructor(sourceProperty);
    else if (PROTO && isCallable$6(sourceProperty)) resultProperty = uncurryThis$a(sourceProperty);
    else resultProperty = sourceProperty;
    if (options.sham || sourceProperty && sourceProperty.sham || targetProperty && targetProperty.sham) {
      createNonEnumerableProperty$2(resultProperty, "sham", true);
    }
    createNonEnumerableProperty$2(target, key, resultProperty);
    if (PROTO) {
      VIRTUAL_PROTOTYPE = TARGET + "Prototype";
      if (!hasOwn$6(path$1, VIRTUAL_PROTOTYPE)) {
        createNonEnumerableProperty$2(path$1, VIRTUAL_PROTOTYPE, {});
      }
      createNonEnumerableProperty$2(path$1[VIRTUAL_PROTOTYPE], key, sourceProperty);
      if (options.real && targetPrototype && (FORCED || !targetPrototype[key])) {
        createNonEnumerableProperty$2(targetPrototype, key, sourceProperty);
      }
    }
  }
};
var DESCRIPTORS$7 = descriptors;
var hasOwn$5 = hasOwnProperty_1;
var FunctionPrototype = Function.prototype;
var getDescriptor = DESCRIPTORS$7 && Object.getOwnPropertyDescriptor;
var EXISTS = hasOwn$5(FunctionPrototype, "name");
var PROPER = EXISTS && (function something() {
}).name === "something";
var CONFIGURABLE = EXISTS && (!DESCRIPTORS$7 || DESCRIPTORS$7 && getDescriptor(FunctionPrototype, "name").configurable);
var functionName = {
  EXISTS,
  PROPER,
  CONFIGURABLE
};
var objectDefineProperties = {};
var ceil = Math.ceil;
var floor$3 = Math.floor;
var mathTrunc = Math.trunc || function trunc(x2) {
  var n3 = +x2;
  return (n3 > 0 ? floor$3 : ceil)(n3);
};
var trunc2 = mathTrunc;
var toIntegerOrInfinity$3 = function(argument) {
  var number = +argument;
  return number !== number || number === 0 ? 0 : trunc2(number);
};
var toIntegerOrInfinity$2 = toIntegerOrInfinity$3;
var max = Math.max;
var min$1 = Math.min;
var toAbsoluteIndex$2 = function(index, length) {
  var integer = toIntegerOrInfinity$2(index);
  return integer < 0 ? max(integer + length, 0) : min$1(integer, length);
};
var toIntegerOrInfinity$1 = toIntegerOrInfinity$3;
var min = Math.min;
var toLength$1 = function(argument) {
  var len = toIntegerOrInfinity$1(argument);
  return len > 0 ? min(len, 9007199254740991) : 0;
};
var toLength = toLength$1;
var lengthOfArrayLike$2 = function(obj) {
  return toLength(obj.length);
};
var toIndexedObject$3 = toIndexedObject$5;
var toAbsoluteIndex$1 = toAbsoluteIndex$2;
var lengthOfArrayLike$1 = lengthOfArrayLike$2;
var createMethod$1 = function(IS_INCLUDES) {
  return function($this, el, fromIndex) {
    var O2 = toIndexedObject$3($this);
    var length = lengthOfArrayLike$1(O2);
    if (length === 0) return !IS_INCLUDES && -1;
    var index = toAbsoluteIndex$1(fromIndex, length);
    var value;
    if (IS_INCLUDES && el !== el) while (length > index) {
      value = O2[index++];
      if (value !== value) return true;
    }
    else for (; length > index; index++) {
      if ((IS_INCLUDES || index in O2) && O2[index] === el) return IS_INCLUDES || index || 0;
    }
    return !IS_INCLUDES && -1;
  };
};
var arrayIncludes = {
  // `Array.prototype.includes` method
  // https://tc39.es/ecma262/#sec-array.prototype.includes
  includes: createMethod$1(true),
  // `Array.prototype.indexOf` method
  // https://tc39.es/ecma262/#sec-array.prototype.indexof
  indexOf: createMethod$1(false)
};
var uncurryThis$9 = functionUncurryThis;
var hasOwn$4 = hasOwnProperty_1;
var toIndexedObject$2 = toIndexedObject$5;
var indexOf = arrayIncludes.indexOf;
var hiddenKeys$1 = hiddenKeys$3;
var push$3 = uncurryThis$9([].push);
var objectKeysInternal = function(object, names) {
  var O2 = toIndexedObject$2(object);
  var i2 = 0;
  var result = [];
  var key;
  for (key in O2) !hasOwn$4(hiddenKeys$1, key) && hasOwn$4(O2, key) && push$3(result, key);
  while (names.length > i2) if (hasOwn$4(O2, key = names[i2++])) {
    ~indexOf(result, key) || push$3(result, key);
  }
  return result;
};
var enumBugKeys$2 = [
  "constructor",
  "hasOwnProperty",
  "isPrototypeOf",
  "propertyIsEnumerable",
  "toLocaleString",
  "toString",
  "valueOf"
];
var internalObjectKeys = objectKeysInternal;
var enumBugKeys$1 = enumBugKeys$2;
var objectKeys$2 = Object.keys || function keys2(O2) {
  return internalObjectKeys(O2, enumBugKeys$1);
};
var DESCRIPTORS$6 = descriptors;
var V8_PROTOTYPE_DEFINE_BUG = v8PrototypeDefineBug;
var definePropertyModule$1 = objectDefineProperty;
var anObject$5 = anObject$7;
var toIndexedObject$1 = toIndexedObject$5;
var objectKeys$1 = objectKeys$2;
objectDefineProperties.f = DESCRIPTORS$6 && !V8_PROTOTYPE_DEFINE_BUG ? Object.defineProperties : function defineProperties(O2, Properties) {
  anObject$5(O2);
  var props = toIndexedObject$1(Properties);
  var keys4 = objectKeys$1(Properties);
  var length = keys4.length;
  var index = 0;
  var key;
  while (length > index) definePropertyModule$1.f(O2, key = keys4[index++], props[key]);
  return O2;
};
var getBuiltIn$4 = getBuiltIn$6;
var html$1 = getBuiltIn$4("document", "documentElement");
var anObject$4 = anObject$7;
var definePropertiesModule = objectDefineProperties;
var enumBugKeys = enumBugKeys$2;
var hiddenKeys = hiddenKeys$3;
var html = html$1;
var documentCreateElement = documentCreateElement$1;
var sharedKey$1 = sharedKey$3;
var GT = ">";
var LT = "<";
var PROTOTYPE = "prototype";
var SCRIPT = "script";
var IE_PROTO$1 = sharedKey$1("IE_PROTO");
var EmptyConstructor = function() {
};
var scriptTag = function(content) {
  return LT + SCRIPT + GT + content + LT + "/" + SCRIPT + GT;
};
var NullProtoObjectViaActiveX = function(activeXDocument2) {
  activeXDocument2.write(scriptTag(""));
  activeXDocument2.close();
  var temp = activeXDocument2.parentWindow.Object;
  activeXDocument2 = null;
  return temp;
};
var NullProtoObjectViaIFrame = function() {
  var iframe = documentCreateElement("iframe");
  var JS = "java" + SCRIPT + ":";
  var iframeDocument;
  iframe.style.display = "none";
  html.appendChild(iframe);
  iframe.src = String(JS);
  iframeDocument = iframe.contentWindow.document;
  iframeDocument.open();
  iframeDocument.write(scriptTag("document.F=Object"));
  iframeDocument.close();
  return iframeDocument.F;
};
var activeXDocument;
var NullProtoObject = function() {
  try {
    activeXDocument = new ActiveXObject("htmlfile");
  } catch (error) {
  }
  NullProtoObject = typeof document != "undefined" ? document.domain && activeXDocument ? NullProtoObjectViaActiveX(activeXDocument) : NullProtoObjectViaIFrame() : NullProtoObjectViaActiveX(activeXDocument);
  var length = enumBugKeys.length;
  while (length--) delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];
  return NullProtoObject();
};
hiddenKeys[IE_PROTO$1] = true;
var objectCreate = Object.create || function create(O2, Properties) {
  var result;
  if (O2 !== null) {
    EmptyConstructor[PROTOTYPE] = anObject$4(O2);
    result = new EmptyConstructor();
    EmptyConstructor[PROTOTYPE] = null;
    result[IE_PROTO$1] = O2;
  } else result = NullProtoObject();
  return Properties === void 0 ? result : definePropertiesModule.f(result, Properties);
};
var fails$5 = fails$d;
var correctPrototypeGetter = !fails$5(function() {
  function F2() {
  }
  F2.prototype.constructor = null;
  return Object.getPrototypeOf(new F2()) !== F2.prototype;
});
var hasOwn$3 = hasOwnProperty_1;
var isCallable$5 = isCallable$e;
var toObject$2 = toObject$4;
var sharedKey = sharedKey$3;
var CORRECT_PROTOTYPE_GETTER = correctPrototypeGetter;
var IE_PROTO = sharedKey("IE_PROTO");
var $Object$1 = Object;
var ObjectPrototype = $Object$1.prototype;
var objectGetPrototypeOf = CORRECT_PROTOTYPE_GETTER ? $Object$1.getPrototypeOf : function(O2) {
  var object = toObject$2(O2);
  if (hasOwn$3(object, IE_PROTO)) return object[IE_PROTO];
  var constructor = object.constructor;
  if (isCallable$5(constructor) && object instanceof constructor) {
    return constructor.prototype;
  }
  return object instanceof $Object$1 ? ObjectPrototype : null;
};
var createNonEnumerableProperty$1 = createNonEnumerableProperty$4;
var defineBuiltIn$5 = function(target, key, value, options) {
  if (options && options.enumerable) target[key] = value;
  else createNonEnumerableProperty$1(target, key, value);
  return target;
};
var fails$4 = fails$d;
var isCallable$4 = isCallable$e;
var isObject$1 = isObject$7;
var create$2 = objectCreate;
var getPrototypeOf$1 = objectGetPrototypeOf;
var defineBuiltIn$4 = defineBuiltIn$5;
var wellKnownSymbol$8 = wellKnownSymbol$a;
var ITERATOR$5 = wellKnownSymbol$8("iterator");
var BUGGY_SAFARI_ITERATORS$1 = false;
var IteratorPrototype$1;
var PrototypeOfArrayIteratorPrototype;
var arrayIterator;
if ([].keys) {
  arrayIterator = [].keys();
  if (!("next" in arrayIterator)) BUGGY_SAFARI_ITERATORS$1 = true;
  else {
    PrototypeOfArrayIteratorPrototype = getPrototypeOf$1(getPrototypeOf$1(arrayIterator));
    if (PrototypeOfArrayIteratorPrototype !== Object.prototype) IteratorPrototype$1 = PrototypeOfArrayIteratorPrototype;
  }
}
var NEW_ITERATOR_PROTOTYPE = !isObject$1(IteratorPrototype$1) || fails$4(function() {
  var test2 = {};
  return IteratorPrototype$1[ITERATOR$5].call(test2) !== test2;
});
if (NEW_ITERATOR_PROTOTYPE) IteratorPrototype$1 = {};
else IteratorPrototype$1 = create$2(IteratorPrototype$1);
if (!isCallable$4(IteratorPrototype$1[ITERATOR$5])) {
  defineBuiltIn$4(IteratorPrototype$1, ITERATOR$5, function() {
    return this;
  });
}
var iteratorsCore = {
  IteratorPrototype: IteratorPrototype$1,
  BUGGY_SAFARI_ITERATORS: BUGGY_SAFARI_ITERATORS$1
};
var wellKnownSymbol$7 = wellKnownSymbol$a;
var TO_STRING_TAG$2 = wellKnownSymbol$7("toStringTag");
var test = {};
test[TO_STRING_TAG$2] = "z";
var toStringTagSupport = String(test) === "[object z]";
var TO_STRING_TAG_SUPPORT$2 = toStringTagSupport;
var isCallable$3 = isCallable$e;
var classofRaw = classofRaw$2;
var wellKnownSymbol$6 = wellKnownSymbol$a;
var TO_STRING_TAG$1 = wellKnownSymbol$6("toStringTag");
var $Object = Object;
var CORRECT_ARGUMENTS = classofRaw(/* @__PURE__ */ function() {
  return arguments;
}()) === "Arguments";
var tryGet = function(it2, key) {
  try {
    return it2[key];
  } catch (error) {
  }
};
var classof$5 = TO_STRING_TAG_SUPPORT$2 ? classofRaw : function(it2) {
  var O2, tag, result;
  return it2 === void 0 ? "Undefined" : it2 === null ? "Null" : typeof (tag = tryGet(O2 = $Object(it2), TO_STRING_TAG$1)) == "string" ? tag : CORRECT_ARGUMENTS ? classofRaw(O2) : (result = classofRaw(O2)) === "Object" && isCallable$3(O2.callee) ? "Arguments" : result;
};
var TO_STRING_TAG_SUPPORT$1 = toStringTagSupport;
var classof$4 = classof$5;
var objectToString = TO_STRING_TAG_SUPPORT$1 ? {}.toString : function toString() {
  return "[object " + classof$4(this) + "]";
};
var TO_STRING_TAG_SUPPORT = toStringTagSupport;
var defineProperty$2 = objectDefineProperty.f;
var createNonEnumerableProperty = createNonEnumerableProperty$4;
var hasOwn$2 = hasOwnProperty_1;
var toString$5 = objectToString;
var wellKnownSymbol$5 = wellKnownSymbol$a;
var TO_STRING_TAG = wellKnownSymbol$5("toStringTag");
var setToStringTag$4 = function(it2, TAG, STATIC, SET_METHOD) {
  var target = STATIC ? it2 : it2 && it2.prototype;
  if (target) {
    if (!hasOwn$2(target, TO_STRING_TAG)) {
      defineProperty$2(target, TO_STRING_TAG, { configurable: true, value: TAG });
    }
    if (SET_METHOD && !TO_STRING_TAG_SUPPORT) {
      createNonEnumerableProperty(target, "toString", toString$5);
    }
  }
};
var IteratorPrototype = iteratorsCore.IteratorPrototype;
var create$1 = objectCreate;
var createPropertyDescriptor$2 = createPropertyDescriptor$5;
var setToStringTag$3 = setToStringTag$4;
var Iterators$4 = iterators;
var returnThis$1 = function() {
  return this;
};
var iteratorCreateConstructor = function(IteratorConstructor, NAME, next3, ENUMERABLE_NEXT) {
  var TO_STRING_TAG2 = NAME + " Iterator";
  IteratorConstructor.prototype = create$1(IteratorPrototype, { next: createPropertyDescriptor$2(+!ENUMERABLE_NEXT, next3) });
  setToStringTag$3(IteratorConstructor, TO_STRING_TAG2, false, true);
  Iterators$4[TO_STRING_TAG2] = returnThis$1;
  return IteratorConstructor;
};
var $$5 = _export;
var call$5 = functionCall;
var FunctionName = functionName;
var createIteratorConstructor$1 = iteratorCreateConstructor;
var getPrototypeOf = objectGetPrototypeOf;
var setToStringTag$2 = setToStringTag$4;
var defineBuiltIn$3 = defineBuiltIn$5;
var wellKnownSymbol$4 = wellKnownSymbol$a;
var Iterators$3 = iterators;
var IteratorsCore = iteratorsCore;
var PROPER_FUNCTION_NAME = FunctionName.PROPER;
FunctionName.CONFIGURABLE;
IteratorsCore.IteratorPrototype;
var BUGGY_SAFARI_ITERATORS = IteratorsCore.BUGGY_SAFARI_ITERATORS;
var ITERATOR$4 = wellKnownSymbol$4("iterator");
var KEYS = "keys";
var VALUES = "values";
var ENTRIES = "entries";
var returnThis = function() {
  return this;
};
var iteratorDefine = function(Iterable, NAME, IteratorConstructor, next3, DEFAULT, IS_SET, FORCED) {
  createIteratorConstructor$1(IteratorConstructor, NAME, next3);
  var getIterationMethod = function(KIND) {
    if (KIND === DEFAULT && defaultIterator) return defaultIterator;
    if (!BUGGY_SAFARI_ITERATORS && KIND && KIND in IterablePrototype) return IterablePrototype[KIND];
    switch (KIND) {
      case KEYS:
        return function keys4() {
          return new IteratorConstructor(this, KIND);
        };
      case VALUES:
        return function values2() {
          return new IteratorConstructor(this, KIND);
        };
      case ENTRIES:
        return function entries2() {
          return new IteratorConstructor(this, KIND);
        };
    }
    return function() {
      return new IteratorConstructor(this);
    };
  };
  var TO_STRING_TAG2 = NAME + " Iterator";
  var INCORRECT_VALUES_NAME = false;
  var IterablePrototype = Iterable.prototype;
  var nativeIterator = IterablePrototype[ITERATOR$4] || IterablePrototype["@@iterator"] || DEFAULT && IterablePrototype[DEFAULT];
  var defaultIterator = !BUGGY_SAFARI_ITERATORS && nativeIterator || getIterationMethod(DEFAULT);
  var anyNativeIterator = NAME === "Array" ? IterablePrototype.entries || nativeIterator : nativeIterator;
  var CurrentIteratorPrototype, methods, KEY;
  if (anyNativeIterator) {
    CurrentIteratorPrototype = getPrototypeOf(anyNativeIterator.call(new Iterable()));
    if (CurrentIteratorPrototype !== Object.prototype && CurrentIteratorPrototype.next) {
      setToStringTag$2(CurrentIteratorPrototype, TO_STRING_TAG2, true, true);
      Iterators$3[TO_STRING_TAG2] = returnThis;
    }
  }
  if (PROPER_FUNCTION_NAME && DEFAULT === VALUES && nativeIterator && nativeIterator.name !== VALUES) {
    {
      INCORRECT_VALUES_NAME = true;
      defaultIterator = function values2() {
        return call$5(nativeIterator, this);
      };
    }
  }
  if (DEFAULT) {
    methods = {
      values: getIterationMethod(VALUES),
      keys: IS_SET ? defaultIterator : getIterationMethod(KEYS),
      entries: getIterationMethod(ENTRIES)
    };
    if (FORCED) for (KEY in methods) {
      if (BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME || !(KEY in IterablePrototype)) {
        defineBuiltIn$3(IterablePrototype, KEY, methods[KEY]);
      }
    }
    else $$5({ target: NAME, proto: true, forced: BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME }, methods);
  }
  if (FORCED && IterablePrototype[ITERATOR$4] !== defaultIterator) {
    defineBuiltIn$3(IterablePrototype, ITERATOR$4, defaultIterator, { name: DEFAULT });
  }
  Iterators$3[NAME] = defaultIterator;
  return methods;
};
var createIterResultObject$3 = function(value, done) {
  return { value, done };
};
var toIndexedObject = toIndexedObject$5;
var Iterators$2 = iterators;
var InternalStateModule$3 = internalState;
objectDefineProperty.f;
var defineIterator$1 = iteratorDefine;
var createIterResultObject$2 = createIterResultObject$3;
var ARRAY_ITERATOR = "Array Iterator";
var setInternalState$3 = InternalStateModule$3.set;
var getInternalState$1 = InternalStateModule$3.getterFor(ARRAY_ITERATOR);
defineIterator$1(Array, "Array", function(iterated, kind) {
  setInternalState$3(this, {
    type: ARRAY_ITERATOR,
    target: toIndexedObject(iterated),
    // target
    index: 0,
    // next index
    kind
    // kind
  });
}, function() {
  var state = getInternalState$1(this);
  var target = state.target;
  var index = state.index++;
  if (!target || index >= target.length) {
    state.target = null;
    return createIterResultObject$2(void 0, true);
  }
  switch (state.kind) {
    case "keys":
      return createIterResultObject$2(index, false);
    case "values":
      return createIterResultObject$2(target[index], false);
  }
  return createIterResultObject$2([index, target[index]], false);
}, "values");
Iterators$2.Arguments = Iterators$2.Array;
var $$4 = _export;
var uncurryThis$8 = functionUncurryThis;
var toAbsoluteIndex = toAbsoluteIndex$2;
var $RangeError$1 = RangeError;
var fromCharCode$2 = String.fromCharCode;
var $fromCodePoint = String.fromCodePoint;
var join$3 = uncurryThis$8([].join);
var INCORRECT_LENGTH = !!$fromCodePoint && $fromCodePoint.length !== 1;
$$4({ target: "String", stat: true, arity: 1, forced: INCORRECT_LENGTH }, {
  // eslint-disable-next-line no-unused-vars -- required for `.length`
  fromCodePoint: function fromCodePoint(x2) {
    var elements = [];
    var length = arguments.length;
    var i2 = 0;
    var code2;
    while (length > i2) {
      code2 = +arguments[i2++];
      if (toAbsoluteIndex(code2, 1114111) !== code2) throw new $RangeError$1(code2 + " is not a valid code point");
      elements[i2] = code2 < 65536 ? fromCharCode$2(code2) : fromCharCode$2(((code2 -= 65536) >> 10) + 55296, code2 % 1024 + 56320);
    }
    return join$3(elements, "");
  }
});
var globalThis$3 = globalThis_1;
var DESCRIPTORS$5 = descriptors;
var getOwnPropertyDescriptor2 = Object.getOwnPropertyDescriptor;
var safeGetBuiltIn$1 = function(name) {
  if (!DESCRIPTORS$5) return globalThis$3[name];
  var descriptor = getOwnPropertyDescriptor2(globalThis$3, name);
  return descriptor && descriptor.value;
};
var fails$3 = fails$d;
var wellKnownSymbol$3 = wellKnownSymbol$a;
var DESCRIPTORS$4 = descriptors;
var IS_PURE = isPure;
var ITERATOR$3 = wellKnownSymbol$3("iterator");
var urlConstructorDetection = !fails$3(function() {
  var url2 = new URL("b?a=1&b=2&c=3", "https://a");
  var params = url2.searchParams;
  var params2 = new URLSearchParams("a=1&a=2&b=3");
  var result = "";
  url2.pathname = "c%20d";
  params.forEach(function(value, key) {
    params["delete"]("b");
    result += key + value;
  });
  params2["delete"]("a", 2);
  params2["delete"]("b", void 0);
  return IS_PURE && (!url2.toJSON || !params2.has("a", 1) || params2.has("a", 2) || !params2.has("a", void 0) || params2.has("b")) || !params.size && (IS_PURE || !DESCRIPTORS$4) || !params.sort || url2.href !== "https://a/c%20d?a=1&c=3" || params.get("c") !== "3" || String(new URLSearchParams("?a=1")) !== "a=1" || !params[ITERATOR$3] || new URL("https://a@b").username !== "a" || new URLSearchParams(new URLSearchParams("a=b")).get("a") !== "b" || new URL("https://").host !== "xn--e1aybc" || new URL("https://a#").hash !== "#%D0%B1" || result !== "a1c3" || new URL("https://x", void 0).host !== "x";
});
var defineProperty$1 = objectDefineProperty;
var defineBuiltInAccessor$2 = function(target, name, descriptor) {
  return defineProperty$1.f(target, name, descriptor);
};
var defineBuiltIn$2 = defineBuiltIn$5;
var defineBuiltIns$1 = function(target, src, options) {
  for (var key in src) {
    if (options && options.unsafe && target[key]) target[key] = src[key];
    else defineBuiltIn$2(target, key, src[key], options);
  }
  return target;
};
var isPrototypeOf = objectIsPrototypeOf;
var $TypeError$2 = TypeError;
var anInstance$2 = function(it2, Prototype) {
  if (isPrototypeOf(Prototype, it2)) return it2;
  throw new $TypeError$2("Incorrect invocation");
};
var classof$3 = classof$5;
var $String = String;
var toString$4 = function(argument) {
  if (classof$3(argument) === "Symbol") throw new TypeError("Cannot convert a Symbol value to a string");
  return $String(argument);
};
var classof$2 = classof$5;
var getMethod$1 = getMethod$3;
var isNullOrUndefined = isNullOrUndefined$3;
var Iterators$1 = iterators;
var wellKnownSymbol$2 = wellKnownSymbol$a;
var ITERATOR$2 = wellKnownSymbol$2("iterator");
var getIteratorMethod$3 = function(it2) {
  if (!isNullOrUndefined(it2)) return getMethod$1(it2, ITERATOR$2) || getMethod$1(it2, "@@iterator") || Iterators$1[classof$2(it2)];
};
var call$4 = functionCall;
var aCallable = aCallable$3;
var anObject$3 = anObject$7;
var tryToString = tryToString$2;
var getIteratorMethod$2 = getIteratorMethod$3;
var $TypeError$1 = TypeError;
var getIterator$2 = function(argument, usingIterator) {
  var iteratorMethod = arguments.length < 2 ? getIteratorMethod$2(argument) : usingIterator;
  if (aCallable(iteratorMethod)) return anObject$3(call$4(iteratorMethod, argument));
  throw new $TypeError$1(tryToString(argument) + " is not iterable");
};
var $TypeError = TypeError;
var validateArgumentsLength$4 = function(passed, required) {
  if (passed < required) throw new $TypeError("Not enough arguments");
  return passed;
};
var uncurryThis$7 = functionUncurryThis;
var arraySlice$2 = uncurryThis$7([].slice);
var arraySlice$1 = arraySlice$2;
var floor$2 = Math.floor;
var sort = function(array, comparefn) {
  var length = array.length;
  if (length < 8) {
    var i2 = 1;
    var element, j2;
    while (i2 < length) {
      j2 = i2;
      element = array[i2];
      while (j2 && comparefn(array[j2 - 1], element) > 0) {
        array[j2] = array[--j2];
      }
      if (j2 !== i2++) array[j2] = element;
    }
  } else {
    var middle = floor$2(length / 2);
    var left = sort(arraySlice$1(array, 0, middle), comparefn);
    var right = sort(arraySlice$1(array, middle), comparefn);
    var llength = left.length;
    var rlength = right.length;
    var lindex = 0;
    var rindex = 0;
    while (lindex < llength || rindex < rlength) {
      array[lindex + rindex] = lindex < llength && rindex < rlength ? comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++] : lindex < llength ? left[lindex++] : right[rindex++];
    }
  }
  return array;
};
var arraySort$1 = sort;
var $$3 = _export;
var globalThis$2 = globalThis_1;
var safeGetBuiltIn = safeGetBuiltIn$1;
var getBuiltIn$3 = getBuiltIn$6;
var call$3 = functionCall;
var uncurryThis$6 = functionUncurryThis;
var DESCRIPTORS$3 = descriptors;
var USE_NATIVE_URL$3 = urlConstructorDetection;
var defineBuiltIn$1 = defineBuiltIn$5;
var defineBuiltInAccessor$1 = defineBuiltInAccessor$2;
var defineBuiltIns = defineBuiltIns$1;
var setToStringTag$1 = setToStringTag$4;
var createIteratorConstructor = iteratorCreateConstructor;
var InternalStateModule$2 = internalState;
var anInstance$1 = anInstance$2;
var isCallable$2 = isCallable$e;
var hasOwn$1 = hasOwnProperty_1;
var bind$2 = functionBindContext;
var classof$1 = classof$5;
var anObject$2 = anObject$7;
var isObject = isObject$7;
var $toString$1 = toString$4;
var create2 = objectCreate;
var createPropertyDescriptor$1 = createPropertyDescriptor$5;
var getIterator$1 = getIterator$2;
var getIteratorMethod$1 = getIteratorMethod$3;
var createIterResultObject$1 = createIterResultObject$3;
var validateArgumentsLength$3 = validateArgumentsLength$4;
var wellKnownSymbol$1 = wellKnownSymbol$a;
var arraySort = arraySort$1;
var ITERATOR$1 = wellKnownSymbol$1("iterator");
var URL_SEARCH_PARAMS = "URLSearchParams";
var URL_SEARCH_PARAMS_ITERATOR = URL_SEARCH_PARAMS + "Iterator";
var setInternalState$2 = InternalStateModule$2.set;
var getInternalParamsState = InternalStateModule$2.getterFor(URL_SEARCH_PARAMS);
var getInternalIteratorState = InternalStateModule$2.getterFor(URL_SEARCH_PARAMS_ITERATOR);
var nativeFetch = safeGetBuiltIn("fetch");
var NativeRequest = safeGetBuiltIn("Request");
var Headers$1 = safeGetBuiltIn("Headers");
var RequestPrototype = NativeRequest && NativeRequest.prototype;
var HeadersPrototype = Headers$1 && Headers$1.prototype;
var TypeError$2 = globalThis$2.TypeError;
var encodeURIComponent$1 = globalThis$2.encodeURIComponent;
var fromCharCode$1 = String.fromCharCode;
var fromCodePoint2 = getBuiltIn$3("String", "fromCodePoint");
var $parseInt = parseInt;
var charAt$3 = uncurryThis$6("".charAt);
var join$2 = uncurryThis$6([].join);
var push$2 = uncurryThis$6([].push);
var replace$2 = uncurryThis$6("".replace);
var shift$1 = uncurryThis$6([].shift);
var splice = uncurryThis$6([].splice);
var split$2 = uncurryThis$6("".split);
var stringSlice$2 = uncurryThis$6("".slice);
var exec$3 = uncurryThis$6(/./.exec);
var plus = /\+/g;
var FALLBACK_REPLACER = "";
var VALID_HEX = /^[0-9a-f]+$/i;
var parseHexOctet = function(string, start) {
  var substr = stringSlice$2(string, start, start + 2);
  if (!exec$3(VALID_HEX, substr)) return NaN;
  return $parseInt(substr, 16);
};
var getLeadingOnes = function(octet) {
  var count = 0;
  for (var mask = 128; mask > 0 && (octet & mask) !== 0; mask >>= 1) {
    count++;
  }
  return count;
};
var utf8Decode = function(octets) {
  var codePoint = null;
  switch (octets.length) {
    case 1:
      codePoint = octets[0];
      break;
    case 2:
      codePoint = (octets[0] & 31) << 6 | octets[1] & 63;
      break;
    case 3:
      codePoint = (octets[0] & 15) << 12 | (octets[1] & 63) << 6 | octets[2] & 63;
      break;
    case 4:
      codePoint = (octets[0] & 7) << 18 | (octets[1] & 63) << 12 | (octets[2] & 63) << 6 | octets[3] & 63;
      break;
  }
  return codePoint > 1114111 ? null : codePoint;
};
var decode = function(input) {
  input = replace$2(input, plus, " ");
  var length = input.length;
  var result = "";
  var i2 = 0;
  while (i2 < length) {
    var decodedChar = charAt$3(input, i2);
    if (decodedChar === "%") {
      if (charAt$3(input, i2 + 1) === "%" || i2 + 3 > length) {
        result += "%";
        i2++;
        continue;
      }
      var octet = parseHexOctet(input, i2 + 1);
      if (octet !== octet) {
        result += decodedChar;
        i2++;
        continue;
      }
      i2 += 2;
      var byteSequenceLength = getLeadingOnes(octet);
      if (byteSequenceLength === 0) {
        decodedChar = fromCharCode$1(octet);
      } else {
        if (byteSequenceLength === 1 || byteSequenceLength > 4) {
          result += FALLBACK_REPLACER;
          i2++;
          continue;
        }
        var octets = [octet];
        var sequenceIndex = 1;
        while (sequenceIndex < byteSequenceLength) {
          i2++;
          if (i2 + 3 > length || charAt$3(input, i2) !== "%") break;
          var nextByte = parseHexOctet(input, i2 + 1);
          if (nextByte !== nextByte) {
            i2 += 3;
            break;
          }
          if (nextByte > 191 || nextByte < 128) break;
          push$2(octets, nextByte);
          i2 += 2;
          sequenceIndex++;
        }
        if (octets.length !== byteSequenceLength) {
          result += FALLBACK_REPLACER;
          continue;
        }
        var codePoint = utf8Decode(octets);
        if (codePoint === null) {
          result += FALLBACK_REPLACER;
        } else {
          decodedChar = fromCodePoint2(codePoint);
        }
      }
    }
    result += decodedChar;
    i2++;
  }
  return result;
};
var find = /[!'()~]|%20/g;
var replacements = {
  "!": "%21",
  "'": "%27",
  "(": "%28",
  ")": "%29",
  "~": "%7E",
  "%20": "+"
};
var replacer = function(match2) {
  return replacements[match2];
};
var serialize = function(it2) {
  return replace$2(encodeURIComponent$1(it2), find, replacer);
};
var URLSearchParamsIterator = createIteratorConstructor(function Iterator(params, kind) {
  setInternalState$2(this, {
    type: URL_SEARCH_PARAMS_ITERATOR,
    target: getInternalParamsState(params).entries,
    index: 0,
    kind
  });
}, URL_SEARCH_PARAMS, function next() {
  var state = getInternalIteratorState(this);
  var target = state.target;
  var index = state.index++;
  if (!target || index >= target.length) {
    state.target = null;
    return createIterResultObject$1(void 0, true);
  }
  var entry = target[index];
  switch (state.kind) {
    case "keys":
      return createIterResultObject$1(entry.key, false);
    case "values":
      return createIterResultObject$1(entry.value, false);
  }
  return createIterResultObject$1([entry.key, entry.value], false);
}, true);
var URLSearchParamsState = function(init) {
  this.entries = [];
  this.url = null;
  if (init !== void 0) {
    if (isObject(init)) this.parseObject(init);
    else this.parseQuery(typeof init == "string" ? charAt$3(init, 0) === "?" ? stringSlice$2(init, 1) : init : $toString$1(init));
  }
};
URLSearchParamsState.prototype = {
  type: URL_SEARCH_PARAMS,
  bindURL: function(url2) {
    this.url = url2;
    this.update();
  },
  parseObject: function(object) {
    var entries2 = this.entries;
    var iteratorMethod = getIteratorMethod$1(object);
    var iterator, next3, step, entryIterator, entryNext, first, second;
    if (iteratorMethod) {
      iterator = getIterator$1(object, iteratorMethod);
      next3 = iterator.next;
      while (!(step = call$3(next3, iterator)).done) {
        entryIterator = getIterator$1(anObject$2(step.value));
        entryNext = entryIterator.next;
        if ((first = call$3(entryNext, entryIterator)).done || (second = call$3(entryNext, entryIterator)).done || !call$3(entryNext, entryIterator).done) throw new TypeError$2("Expected sequence with length 2");
        push$2(entries2, { key: $toString$1(first.value), value: $toString$1(second.value) });
      }
    } else for (var key in object) if (hasOwn$1(object, key)) {
      push$2(entries2, { key, value: $toString$1(object[key]) });
    }
  },
  parseQuery: function(query) {
    if (query) {
      var entries2 = this.entries;
      var attributes = split$2(query, "&");
      var index = 0;
      var attribute, entry;
      while (index < attributes.length) {
        attribute = attributes[index++];
        if (attribute.length) {
          entry = split$2(attribute, "=");
          push$2(entries2, {
            key: decode(shift$1(entry)),
            value: decode(join$2(entry, "="))
          });
        }
      }
    }
  },
  serialize: function() {
    var entries2 = this.entries;
    var result = [];
    var index = 0;
    var entry;
    while (index < entries2.length) {
      entry = entries2[index++];
      push$2(result, serialize(entry.key) + "=" + serialize(entry.value));
    }
    return join$2(result, "&");
  },
  update: function() {
    this.entries.length = 0;
    this.parseQuery(this.url.query);
  },
  updateURL: function() {
    if (this.url) this.url.update();
  }
};
var URLSearchParamsConstructor = function URLSearchParams2() {
  anInstance$1(this, URLSearchParamsPrototype);
  var init = arguments.length > 0 ? arguments[0] : void 0;
  var state = setInternalState$2(this, new URLSearchParamsState(init));
  if (!DESCRIPTORS$3) this.size = state.entries.length;
};
var URLSearchParamsPrototype = URLSearchParamsConstructor.prototype;
defineBuiltIns(URLSearchParamsPrototype, {
  // `URLSearchParams.prototype.append` method
  // https://url.spec.whatwg.org/#dom-urlsearchparams-append
  append: function append(name, value) {
    var state = getInternalParamsState(this);
    validateArgumentsLength$3(arguments.length, 2);
    push$2(state.entries, { key: $toString$1(name), value: $toString$1(value) });
    if (!DESCRIPTORS$3) this.length++;
    state.updateURL();
  },
  // `URLSearchParams.prototype.delete` method
  // https://url.spec.whatwg.org/#dom-urlsearchparams-delete
  "delete": function(name) {
    var state = getInternalParamsState(this);
    var length = validateArgumentsLength$3(arguments.length, 1);
    var entries2 = state.entries;
    var key = $toString$1(name);
    var $value = length < 2 ? void 0 : arguments[1];
    var value = $value === void 0 ? $value : $toString$1($value);
    var index = 0;
    while (index < entries2.length) {
      var entry = entries2[index];
      if (entry.key === key && (value === void 0 || entry.value === value)) {
        splice(entries2, index, 1);
        if (value !== void 0) break;
      } else index++;
    }
    if (!DESCRIPTORS$3) this.size = entries2.length;
    state.updateURL();
  },
  // `URLSearchParams.prototype.get` method
  // https://url.spec.whatwg.org/#dom-urlsearchparams-get
  get: function get2(name) {
    var entries2 = getInternalParamsState(this).entries;
    validateArgumentsLength$3(arguments.length, 1);
    var key = $toString$1(name);
    var index = 0;
    for (; index < entries2.length; index++) {
      if (entries2[index].key === key) return entries2[index].value;
    }
    return null;
  },
  // `URLSearchParams.prototype.getAll` method
  // https://url.spec.whatwg.org/#dom-urlsearchparams-getall
  getAll: function getAll(name) {
    var entries2 = getInternalParamsState(this).entries;
    validateArgumentsLength$3(arguments.length, 1);
    var key = $toString$1(name);
    var result = [];
    var index = 0;
    for (; index < entries2.length; index++) {
      if (entries2[index].key === key) push$2(result, entries2[index].value);
    }
    return result;
  },
  // `URLSearchParams.prototype.has` method
  // https://url.spec.whatwg.org/#dom-urlsearchparams-has
  has: function has2(name) {
    var entries2 = getInternalParamsState(this).entries;
    var length = validateArgumentsLength$3(arguments.length, 1);
    var key = $toString$1(name);
    var $value = length < 2 ? void 0 : arguments[1];
    var value = $value === void 0 ? $value : $toString$1($value);
    var index = 0;
    while (index < entries2.length) {
      var entry = entries2[index++];
      if (entry.key === key && (value === void 0 || entry.value === value)) return true;
    }
    return false;
  },
  // `URLSearchParams.prototype.set` method
  // https://url.spec.whatwg.org/#dom-urlsearchparams-set
  set: function set3(name, value) {
    var state = getInternalParamsState(this);
    validateArgumentsLength$3(arguments.length, 1);
    var entries2 = state.entries;
    var found = false;
    var key = $toString$1(name);
    var val = $toString$1(value);
    var index = 0;
    var entry;
    for (; index < entries2.length; index++) {
      entry = entries2[index];
      if (entry.key === key) {
        if (found) splice(entries2, index--, 1);
        else {
          found = true;
          entry.value = val;
        }
      }
    }
    if (!found) push$2(entries2, { key, value: val });
    if (!DESCRIPTORS$3) this.size = entries2.length;
    state.updateURL();
  },
  // `URLSearchParams.prototype.sort` method
  // https://url.spec.whatwg.org/#dom-urlsearchparams-sort
  sort: function sort2() {
    var state = getInternalParamsState(this);
    arraySort(state.entries, function(a2, b2) {
      return a2.key > b2.key ? 1 : -1;
    });
    state.updateURL();
  },
  // `URLSearchParams.prototype.forEach` method
  forEach: function forEach(callback) {
    var entries2 = getInternalParamsState(this).entries;
    var boundFunction = bind$2(callback, arguments.length > 1 ? arguments[1] : void 0);
    var index = 0;
    var entry;
    while (index < entries2.length) {
      entry = entries2[index++];
      boundFunction(entry.value, entry.key, this);
    }
  },
  // `URLSearchParams.prototype.keys` method
  keys: function keys3() {
    return new URLSearchParamsIterator(this, "keys");
  },
  // `URLSearchParams.prototype.values` method
  values: function values() {
    return new URLSearchParamsIterator(this, "values");
  },
  // `URLSearchParams.prototype.entries` method
  entries: function entries() {
    return new URLSearchParamsIterator(this, "entries");
  }
}, { enumerable: true });
defineBuiltIn$1(URLSearchParamsPrototype, ITERATOR$1, URLSearchParamsPrototype.entries, { name: "entries" });
defineBuiltIn$1(URLSearchParamsPrototype, "toString", function toString2() {
  return getInternalParamsState(this).serialize();
}, { enumerable: true });
if (DESCRIPTORS$3) defineBuiltInAccessor$1(URLSearchParamsPrototype, "size", {
  get: function size() {
    return getInternalParamsState(this).entries.length;
  },
  configurable: true,
  enumerable: true
});
setToStringTag$1(URLSearchParamsConstructor, URL_SEARCH_PARAMS);
$$3({ global: true, constructor: true, forced: !USE_NATIVE_URL$3 }, {
  URLSearchParams: URLSearchParamsConstructor
});
if (!USE_NATIVE_URL$3 && isCallable$2(Headers$1)) {
  headersHas = uncurryThis$6(HeadersPrototype.has);
  headersSet = uncurryThis$6(HeadersPrototype.set);
  wrapRequestOptions = function(init) {
    if (isObject(init)) {
      var body = init.body;
      var headers;
      if (classof$1(body) === URL_SEARCH_PARAMS) {
        headers = init.headers ? new Headers$1(init.headers) : new Headers$1();
        if (!headersHas(headers, "content-type")) {
          headersSet(headers, "content-type", "application/x-www-form-urlencoded;charset=UTF-8");
        }
        return create2(init, {
          body: createPropertyDescriptor$1(0, $toString$1(body)),
          headers: createPropertyDescriptor$1(0, headers)
        });
      }
    }
    return init;
  };
  if (isCallable$2(nativeFetch)) {
    $$3({ global: true, enumerable: true, dontCallGetSet: true, forced: true }, {
      fetch: function fetch2(input) {
        return nativeFetch(input, arguments.length > 1 ? wrapRequestOptions(arguments[1]) : {});
      }
    });
  }
  if (isCallable$2(NativeRequest)) {
    RequestConstructor = function Request(input) {
      anInstance$1(this, RequestPrototype);
      return new NativeRequest(input, arguments.length > 1 ? wrapRequestOptions(arguments[1]) : {});
    };
    RequestPrototype.constructor = RequestConstructor;
    RequestConstructor.prototype = RequestPrototype;
    $$3({ global: true, constructor: true, dontCallGetSet: true, forced: true }, {
      Request: RequestConstructor
    });
  }
}
var headersHas;
var headersSet;
var wrapRequestOptions;
var RequestConstructor;
var web_urlSearchParams_constructor = {
  URLSearchParams: URLSearchParamsConstructor,
  getState: getInternalParamsState
};
var uncurryThis$5 = functionUncurryThis;
var toIntegerOrInfinity = toIntegerOrInfinity$3;
var toString$3 = toString$4;
var requireObjectCoercible = requireObjectCoercible$3;
var charAt$2 = uncurryThis$5("".charAt);
var charCodeAt$1 = uncurryThis$5("".charCodeAt);
var stringSlice$1 = uncurryThis$5("".slice);
var createMethod = function(CONVERT_TO_STRING) {
  return function($this, pos) {
    var S2 = toString$3(requireObjectCoercible($this));
    var position = toIntegerOrInfinity(pos);
    var size2 = S2.length;
    var first, second;
    if (position < 0 || position >= size2) return CONVERT_TO_STRING ? "" : void 0;
    first = charCodeAt$1(S2, position);
    return first < 55296 || first > 56319 || position + 1 === size2 || (second = charCodeAt$1(S2, position + 1)) < 56320 || second > 57343 ? CONVERT_TO_STRING ? charAt$2(S2, position) : first : CONVERT_TO_STRING ? stringSlice$1(S2, position, position + 2) : (first - 55296 << 10) + (second - 56320) + 65536;
  };
};
var stringMultibyte = {
  // `String.prototype.codePointAt` method
  // https://tc39.es/ecma262/#sec-string.prototype.codepointat
  codeAt: createMethod(false),
  // `String.prototype.at` method
  // https://github.com/mathiasbynens/String.prototype.at
  charAt: createMethod(true)
};
var charAt$1 = stringMultibyte.charAt;
var toString$2 = toString$4;
var InternalStateModule$1 = internalState;
var defineIterator = iteratorDefine;
var createIterResultObject = createIterResultObject$3;
var STRING_ITERATOR = "String Iterator";
var setInternalState$1 = InternalStateModule$1.set;
var getInternalState = InternalStateModule$1.getterFor(STRING_ITERATOR);
defineIterator(String, "String", function(iterated) {
  setInternalState$1(this, {
    type: STRING_ITERATOR,
    string: toString$2(iterated),
    index: 0
  });
}, function next2() {
  var state = getInternalState(this);
  var string = state.string;
  var index = state.index;
  var point;
  if (index >= string.length) return createIterResultObject(void 0, true);
  point = charAt$1(string, index);
  state.index += point.length;
  return createIterResultObject(point, false);
});
var objectGetOwnPropertySymbols = {};
objectGetOwnPropertySymbols.f = Object.getOwnPropertySymbols;
var DESCRIPTORS$2 = descriptors;
var uncurryThis$4 = functionUncurryThis;
var call$2 = functionCall;
var fails$2 = fails$d;
var objectKeys = objectKeys$2;
var getOwnPropertySymbolsModule = objectGetOwnPropertySymbols;
var propertyIsEnumerableModule = objectPropertyIsEnumerable;
var toObject$1 = toObject$4;
var IndexedObject = indexedObject;
var $assign = Object.assign;
var defineProperty3 = Object.defineProperty;
var concat = uncurryThis$4([].concat);
var objectAssign = !$assign || fails$2(function() {
  if (DESCRIPTORS$2 && $assign({ b: 1 }, $assign(defineProperty3({}, "a", {
    enumerable: true,
    get: function() {
      defineProperty3(this, "b", {
        value: 3,
        enumerable: false
      });
    }
  }), { b: 2 })).b !== 1) return true;
  var A2 = {};
  var B2 = {};
  var symbol = Symbol("assign detection");
  var alphabet = "abcdefghijklmnopqrst";
  A2[symbol] = 7;
  alphabet.split("").forEach(function(chr) {
    B2[chr] = chr;
  });
  return $assign({}, A2)[symbol] !== 7 || objectKeys($assign({}, B2)).join("") !== alphabet;
}) ? function assign(target, source) {
  var T2 = toObject$1(target);
  var argumentsLength = arguments.length;
  var index = 1;
  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;
  var propertyIsEnumerable2 = propertyIsEnumerableModule.f;
  while (argumentsLength > index) {
    var S2 = IndexedObject(arguments[index++]);
    var keys4 = getOwnPropertySymbols ? concat(objectKeys(S2), getOwnPropertySymbols(S2)) : objectKeys(S2);
    var length = keys4.length;
    var j2 = 0;
    var key;
    while (length > j2) {
      key = keys4[j2++];
      if (!DESCRIPTORS$2 || call$2(propertyIsEnumerable2, S2, key)) T2[key] = S2[key];
    }
  }
  return T2;
} : $assign;
var call$1 = functionCall;
var anObject$1 = anObject$7;
var getMethod = getMethod$3;
var iteratorClose$1 = function(iterator, kind, value) {
  var innerResult, innerError;
  anObject$1(iterator);
  try {
    innerResult = getMethod(iterator, "return");
    if (!innerResult) {
      if (kind === "throw") throw value;
      return value;
    }
    innerResult = call$1(innerResult, iterator);
  } catch (error) {
    innerError = true;
    innerResult = error;
  }
  if (kind === "throw") throw value;
  if (innerError) throw innerResult;
  anObject$1(innerResult);
  return value;
};
var anObject = anObject$7;
var iteratorClose = iteratorClose$1;
var callWithSafeIterationClosing$1 = function(iterator, fn, value, ENTRIES2) {
  try {
    return ENTRIES2 ? fn(anObject(value)[0], value[1]) : fn(value);
  } catch (error) {
    iteratorClose(iterator, "throw", error);
  }
};
var wellKnownSymbol = wellKnownSymbol$a;
var Iterators = iterators;
var ITERATOR = wellKnownSymbol("iterator");
var ArrayPrototype = Array.prototype;
var isArrayIteratorMethod$1 = function(it2) {
  return it2 !== void 0 && (Iterators.Array === it2 || ArrayPrototype[ITERATOR] === it2);
};
var uncurryThis$3 = functionUncurryThis;
var isCallable$1 = isCallable$e;
var store = sharedStoreExports;
var functionToString = uncurryThis$3(Function.toString);
if (!isCallable$1(store.inspectSource)) {
  store.inspectSource = function(it2) {
    return functionToString(it2);
  };
}
var inspectSource$1 = store.inspectSource;
var uncurryThis$2 = functionUncurryThis;
var fails$1 = fails$d;
var isCallable = isCallable$e;
var classof = classof$5;
var getBuiltIn$2 = getBuiltIn$6;
var inspectSource = inspectSource$1;
var noop = function() {
};
var construct = getBuiltIn$2("Reflect", "construct");
var constructorRegExp = /^\s*(?:class|function)\b/;
var exec$2 = uncurryThis$2(constructorRegExp.exec);
var INCORRECT_TO_STRING = !constructorRegExp.test(noop);
var isConstructorModern = function isConstructor(argument) {
  if (!isCallable(argument)) return false;
  try {
    construct(noop, [], argument);
    return true;
  } catch (error) {
    return false;
  }
};
var isConstructorLegacy = function isConstructor2(argument) {
  if (!isCallable(argument)) return false;
  switch (classof(argument)) {
    case "AsyncFunction":
    case "GeneratorFunction":
    case "AsyncGeneratorFunction":
      return false;
  }
  try {
    return INCORRECT_TO_STRING || !!exec$2(constructorRegExp, inspectSource(argument));
  } catch (error) {
    return true;
  }
};
isConstructorLegacy.sham = true;
var isConstructor$1 = !construct || fails$1(function() {
  var called;
  return isConstructorModern(isConstructorModern.call) || !isConstructorModern(Object) || !isConstructorModern(function() {
    called = true;
  }) || called;
}) ? isConstructorLegacy : isConstructorModern;
var DESCRIPTORS$1 = descriptors;
var definePropertyModule = objectDefineProperty;
var createPropertyDescriptor = createPropertyDescriptor$5;
var createProperty$1 = function(object, key, value) {
  if (DESCRIPTORS$1) definePropertyModule.f(object, key, createPropertyDescriptor(0, value));
  else object[key] = value;
};
var bind$1 = functionBindContext;
var call = functionCall;
var toObject = toObject$4;
var callWithSafeIterationClosing = callWithSafeIterationClosing$1;
var isArrayIteratorMethod = isArrayIteratorMethod$1;
var isConstructor3 = isConstructor$1;
var lengthOfArrayLike = lengthOfArrayLike$2;
var createProperty = createProperty$1;
var getIterator = getIterator$2;
var getIteratorMethod = getIteratorMethod$3;
var $Array = Array;
var arrayFrom$1 = function from(arrayLike) {
  var O2 = toObject(arrayLike);
  var IS_CONSTRUCTOR = isConstructor3(this);
  var argumentsLength = arguments.length;
  var mapfn = argumentsLength > 1 ? arguments[1] : void 0;
  var mapping = mapfn !== void 0;
  if (mapping) mapfn = bind$1(mapfn, argumentsLength > 2 ? arguments[2] : void 0);
  var iteratorMethod = getIteratorMethod(O2);
  var index = 0;
  var length, result, step, iterator, next3, value;
  if (iteratorMethod && !(this === $Array && isArrayIteratorMethod(iteratorMethod))) {
    result = IS_CONSTRUCTOR ? new this() : [];
    iterator = getIterator(O2, iteratorMethod);
    next3 = iterator.next;
    for (; !(step = call(next3, iterator)).done; index++) {
      value = mapping ? callWithSafeIterationClosing(iterator, mapfn, [step.value, index], true) : step.value;
      createProperty(result, index, value);
    }
  } else {
    length = lengthOfArrayLike(O2);
    result = IS_CONSTRUCTOR ? new this(length) : $Array(length);
    for (; length > index; index++) {
      value = mapping ? mapfn(O2[index], index) : O2[index];
      createProperty(result, index, value);
    }
  }
  result.length = index;
  return result;
};
var uncurryThis$1 = functionUncurryThis;
var maxInt = 2147483647;
var base = 36;
var tMin = 1;
var tMax = 26;
var skew = 38;
var damp = 700;
var initialBias = 72;
var initialN = 128;
var delimiter = "-";
var regexNonASCII = /[^\0-\u007E]/;
var regexSeparators = /[.\u3002\uFF0E\uFF61]/g;
var OVERFLOW_ERROR = "Overflow: input needs wider integers to process";
var baseMinusTMin = base - tMin;
var $RangeError = RangeError;
var exec$1 = uncurryThis$1(regexSeparators.exec);
var floor$1 = Math.floor;
var fromCharCode = String.fromCharCode;
var charCodeAt = uncurryThis$1("".charCodeAt);
var join$1 = uncurryThis$1([].join);
var push$1 = uncurryThis$1([].push);
var replace$1 = uncurryThis$1("".replace);
var split$1 = uncurryThis$1("".split);
var toLowerCase$1 = uncurryThis$1("".toLowerCase);
var ucs2decode = function(string) {
  var output = [];
  var counter = 0;
  var length = string.length;
  while (counter < length) {
    var value = charCodeAt(string, counter++);
    if (value >= 55296 && value <= 56319 && counter < length) {
      var extra = charCodeAt(string, counter++);
      if ((extra & 64512) === 56320) {
        push$1(output, ((value & 1023) << 10) + (extra & 1023) + 65536);
      } else {
        push$1(output, value);
        counter--;
      }
    } else {
      push$1(output, value);
    }
  }
  return output;
};
var digitToBasic = function(digit) {
  return digit + 22 + 75 * (digit < 26);
};
var adapt = function(delta, numPoints, firstTime) {
  var k2 = 0;
  delta = firstTime ? floor$1(delta / damp) : delta >> 1;
  delta += floor$1(delta / numPoints);
  while (delta > baseMinusTMin * tMax >> 1) {
    delta = floor$1(delta / baseMinusTMin);
    k2 += base;
  }
  return floor$1(k2 + (baseMinusTMin + 1) * delta / (delta + skew));
};
var encode = function(input) {
  var output = [];
  input = ucs2decode(input);
  var inputLength = input.length;
  var n3 = initialN;
  var delta = 0;
  var bias = initialBias;
  var i2, currentValue;
  for (i2 = 0; i2 < input.length; i2++) {
    currentValue = input[i2];
    if (currentValue < 128) {
      push$1(output, fromCharCode(currentValue));
    }
  }
  var basicLength = output.length;
  var handledCPCount = basicLength;
  if (basicLength) {
    push$1(output, delimiter);
  }
  while (handledCPCount < inputLength) {
    var m2 = maxInt;
    for (i2 = 0; i2 < input.length; i2++) {
      currentValue = input[i2];
      if (currentValue >= n3 && currentValue < m2) {
        m2 = currentValue;
      }
    }
    var handledCPCountPlusOne = handledCPCount + 1;
    if (m2 - n3 > floor$1((maxInt - delta) / handledCPCountPlusOne)) {
      throw new $RangeError(OVERFLOW_ERROR);
    }
    delta += (m2 - n3) * handledCPCountPlusOne;
    n3 = m2;
    for (i2 = 0; i2 < input.length; i2++) {
      currentValue = input[i2];
      if (currentValue < n3 && ++delta > maxInt) {
        throw new $RangeError(OVERFLOW_ERROR);
      }
      if (currentValue === n3) {
        var q2 = delta;
        var k2 = base;
        while (true) {
          var t3 = k2 <= bias ? tMin : k2 >= bias + tMax ? tMax : k2 - bias;
          if (q2 < t3) break;
          var qMinusT = q2 - t3;
          var baseMinusT = base - t3;
          push$1(output, fromCharCode(digitToBasic(t3 + qMinusT % baseMinusT)));
          q2 = floor$1(qMinusT / baseMinusT);
          k2 += base;
        }
        push$1(output, fromCharCode(digitToBasic(q2)));
        bias = adapt(delta, handledCPCountPlusOne, handledCPCount === basicLength);
        delta = 0;
        handledCPCount++;
      }
    }
    delta++;
    n3++;
  }
  return join$1(output, "");
};
var stringPunycodeToAscii = function(input) {
  var encoded = [];
  var labels = split$1(replace$1(toLowerCase$1(input), regexSeparators, "."), ".");
  var i2, label;
  for (i2 = 0; i2 < labels.length; i2++) {
    label = labels[i2];
    push$1(encoded, exec$1(regexNonASCII, label) ? "xn--" + encode(label) : label);
  }
  return join$1(encoded, ".");
};
var $$2 = _export;
var DESCRIPTORS = descriptors;
var USE_NATIVE_URL$2 = urlConstructorDetection;
var globalThis$1 = globalThis_1;
var bind = functionBindContext;
var uncurryThis = functionUncurryThis;
var defineBuiltIn = defineBuiltIn$5;
var defineBuiltInAccessor = defineBuiltInAccessor$2;
var anInstance = anInstance$2;
var hasOwn2 = hasOwnProperty_1;
var assign2 = objectAssign;
var arrayFrom = arrayFrom$1;
var arraySlice = arraySlice$2;
var codeAt = stringMultibyte.codeAt;
var toASCII = stringPunycodeToAscii;
var $toString = toString$4;
var setToStringTag = setToStringTag$4;
var validateArgumentsLength$2 = validateArgumentsLength$4;
var URLSearchParamsModule = web_urlSearchParams_constructor;
var InternalStateModule = internalState;
var setInternalState = InternalStateModule.set;
var getInternalURLState = InternalStateModule.getterFor("URL");
var URLSearchParams$1 = URLSearchParamsModule.URLSearchParams;
var getInternalSearchParamsState = URLSearchParamsModule.getState;
var NativeURL = globalThis$1.URL;
var TypeError$1 = globalThis$1.TypeError;
var parseInt$1 = globalThis$1.parseInt;
var floor = Math.floor;
var pow = Math.pow;
var charAt = uncurryThis("".charAt);
var exec = uncurryThis(/./.exec);
var join = uncurryThis([].join);
var numberToString = uncurryThis(1.1.toString);
var pop = uncurryThis([].pop);
var push = uncurryThis([].push);
var replace = uncurryThis("".replace);
var shift = uncurryThis([].shift);
var split = uncurryThis("".split);
var stringSlice = uncurryThis("".slice);
var toLowerCase = uncurryThis("".toLowerCase);
var unshift = uncurryThis([].unshift);
var INVALID_AUTHORITY = "Invalid authority";
var INVALID_SCHEME = "Invalid scheme";
var INVALID_HOST = "Invalid host";
var INVALID_PORT = "Invalid port";
var ALPHA = /[a-z]/i;
var ALPHANUMERIC = /[\d+-.a-z]/i;
var DIGIT = /\d/;
var HEX_START = /^0x/i;
var OCT = /^[0-7]+$/;
var DEC = /^\d+$/;
var HEX = /^[\da-f]+$/i;
var FORBIDDEN_HOST_CODE_POINT = /[\0\t\n\r #%/:<>?@[\\\]^|]/;
var FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT = /[\0\t\n\r #/:<>?@[\\\]^|]/;
var LEADING_C0_CONTROL_OR_SPACE = /^[\u0000-\u0020]+/;
var TRAILING_C0_CONTROL_OR_SPACE = /(^|[^\u0000-\u0020])[\u0000-\u0020]+$/;
var TAB_AND_NEW_LINE = /[\t\n\r]/g;
var EOF;
var parseIPv4 = function(input) {
  var parts = split(input, ".");
  var partsLength, numbers, index, part, radix, number, ipv4;
  if (parts.length && parts[parts.length - 1] === "") {
    parts.length--;
  }
  partsLength = parts.length;
  if (partsLength > 4) return input;
  numbers = [];
  for (index = 0; index < partsLength; index++) {
    part = parts[index];
    if (part === "") return input;
    radix = 10;
    if (part.length > 1 && charAt(part, 0) === "0") {
      radix = exec(HEX_START, part) ? 16 : 8;
      part = stringSlice(part, radix === 8 ? 1 : 2);
    }
    if (part === "") {
      number = 0;
    } else {
      if (!exec(radix === 10 ? DEC : radix === 8 ? OCT : HEX, part)) return input;
      number = parseInt$1(part, radix);
    }
    push(numbers, number);
  }
  for (index = 0; index < partsLength; index++) {
    number = numbers[index];
    if (index === partsLength - 1) {
      if (number >= pow(256, 5 - partsLength)) return null;
    } else if (number > 255) return null;
  }
  ipv4 = pop(numbers);
  for (index = 0; index < numbers.length; index++) {
    ipv4 += numbers[index] * pow(256, 3 - index);
  }
  return ipv4;
};
var parseIPv6 = function(input) {
  var address = [0, 0, 0, 0, 0, 0, 0, 0];
  var pieceIndex = 0;
  var compress = null;
  var pointer = 0;
  var value, length, numbersSeen, ipv4Piece, number, swaps, swap;
  var chr = function() {
    return charAt(input, pointer);
  };
  if (chr() === ":") {
    if (charAt(input, 1) !== ":") return;
    pointer += 2;
    pieceIndex++;
    compress = pieceIndex;
  }
  while (chr()) {
    if (pieceIndex === 8) return;
    if (chr() === ":") {
      if (compress !== null) return;
      pointer++;
      pieceIndex++;
      compress = pieceIndex;
      continue;
    }
    value = length = 0;
    while (length < 4 && exec(HEX, chr())) {
      value = value * 16 + parseInt$1(chr(), 16);
      pointer++;
      length++;
    }
    if (chr() === ".") {
      if (length === 0) return;
      pointer -= length;
      if (pieceIndex > 6) return;
      numbersSeen = 0;
      while (chr()) {
        ipv4Piece = null;
        if (numbersSeen > 0) {
          if (chr() === "." && numbersSeen < 4) pointer++;
          else return;
        }
        if (!exec(DIGIT, chr())) return;
        while (exec(DIGIT, chr())) {
          number = parseInt$1(chr(), 10);
          if (ipv4Piece === null) ipv4Piece = number;
          else if (ipv4Piece === 0) return;
          else ipv4Piece = ipv4Piece * 10 + number;
          if (ipv4Piece > 255) return;
          pointer++;
        }
        address[pieceIndex] = address[pieceIndex] * 256 + ipv4Piece;
        numbersSeen++;
        if (numbersSeen === 2 || numbersSeen === 4) pieceIndex++;
      }
      if (numbersSeen !== 4) return;
      break;
    } else if (chr() === ":") {
      pointer++;
      if (!chr()) return;
    } else if (chr()) return;
    address[pieceIndex++] = value;
  }
  if (compress !== null) {
    swaps = pieceIndex - compress;
    pieceIndex = 7;
    while (pieceIndex !== 0 && swaps > 0) {
      swap = address[pieceIndex];
      address[pieceIndex--] = address[compress + swaps - 1];
      address[compress + --swaps] = swap;
    }
  } else if (pieceIndex !== 8) return;
  return address;
};
var findLongestZeroSequence = function(ipv6) {
  var maxIndex = null;
  var maxLength = 1;
  var currStart = null;
  var currLength = 0;
  var index = 0;
  for (; index < 8; index++) {
    if (ipv6[index] !== 0) {
      if (currLength > maxLength) {
        maxIndex = currStart;
        maxLength = currLength;
      }
      currStart = null;
      currLength = 0;
    } else {
      if (currStart === null) currStart = index;
      ++currLength;
    }
  }
  return currLength > maxLength ? currStart : maxIndex;
};
var serializeHost = function(host) {
  var result, index, compress, ignore0;
  if (typeof host == "number") {
    result = [];
    for (index = 0; index < 4; index++) {
      unshift(result, host % 256);
      host = floor(host / 256);
    }
    return join(result, ".");
  }
  if (typeof host == "object") {
    result = "";
    compress = findLongestZeroSequence(host);
    for (index = 0; index < 8; index++) {
      if (ignore0 && host[index] === 0) continue;
      if (ignore0) ignore0 = false;
      if (compress === index) {
        result += index ? ":" : "::";
        ignore0 = true;
      } else {
        result += numberToString(host[index], 16);
        if (index < 7) result += ":";
      }
    }
    return "[" + result + "]";
  }
  return host;
};
var C0ControlPercentEncodeSet = {};
var fragmentPercentEncodeSet = assign2({}, C0ControlPercentEncodeSet, {
  " ": 1,
  '"': 1,
  "<": 1,
  ">": 1,
  "`": 1
});
var pathPercentEncodeSet = assign2({}, fragmentPercentEncodeSet, {
  "#": 1,
  "?": 1,
  "{": 1,
  "}": 1
});
var userinfoPercentEncodeSet = assign2({}, pathPercentEncodeSet, {
  "/": 1,
  ":": 1,
  ";": 1,
  "=": 1,
  "@": 1,
  "[": 1,
  "\\": 1,
  "]": 1,
  "^": 1,
  "|": 1
});
var percentEncode = function(chr, set4) {
  var code2 = codeAt(chr, 0);
  return code2 > 32 && code2 < 127 && !hasOwn2(set4, chr) ? chr : encodeURIComponent(chr);
};
var specialSchemes = {
  ftp: 21,
  file: null,
  http: 80,
  https: 443,
  ws: 80,
  wss: 443
};
var isWindowsDriveLetter = function(string, normalized) {
  var second;
  return string.length === 2 && exec(ALPHA, charAt(string, 0)) && ((second = charAt(string, 1)) === ":" || !normalized && second === "|");
};
var startsWithWindowsDriveLetter = function(string) {
  var third;
  return string.length > 1 && isWindowsDriveLetter(stringSlice(string, 0, 2)) && (string.length === 2 || ((third = charAt(string, 2)) === "/" || third === "\\" || third === "?" || third === "#"));
};
var isSingleDot = function(segment) {
  return segment === "." || toLowerCase(segment) === "%2e";
};
var isDoubleDot = function(segment) {
  segment = toLowerCase(segment);
  return segment === ".." || segment === "%2e." || segment === ".%2e" || segment === "%2e%2e";
};
var SCHEME_START = {};
var SCHEME = {};
var NO_SCHEME = {};
var SPECIAL_RELATIVE_OR_AUTHORITY = {};
var PATH_OR_AUTHORITY = {};
var RELATIVE = {};
var RELATIVE_SLASH = {};
var SPECIAL_AUTHORITY_SLASHES = {};
var SPECIAL_AUTHORITY_IGNORE_SLASHES = {};
var AUTHORITY = {};
var HOST = {};
var HOSTNAME = {};
var PORT = {};
var FILE = {};
var FILE_SLASH = {};
var FILE_HOST = {};
var PATH_START = {};
var PATH = {};
var CANNOT_BE_A_BASE_URL_PATH = {};
var QUERY = {};
var FRAGMENT = {};
var URLState = function(url2, isBase, base2) {
  var urlString = $toString(url2);
  var baseState, failure, searchParams;
  if (isBase) {
    failure = this.parse(urlString);
    if (failure) throw new TypeError$1(failure);
    this.searchParams = null;
  } else {
    if (base2 !== void 0) baseState = new URLState(base2, true);
    failure = this.parse(urlString, null, baseState);
    if (failure) throw new TypeError$1(failure);
    searchParams = getInternalSearchParamsState(new URLSearchParams$1());
    searchParams.bindURL(this);
    this.searchParams = searchParams;
  }
};
URLState.prototype = {
  type: "URL",
  // https://url.spec.whatwg.org/#url-parsing
  // eslint-disable-next-line max-statements -- TODO
  parse: function(input, stateOverride, base2) {
    var url2 = this;
    var state = stateOverride || SCHEME_START;
    var pointer = 0;
    var buffer2 = "";
    var seenAt = false;
    var seenBracket = false;
    var seenPasswordToken = false;
    var codePoints, chr, bufferCodePoints, failure;
    input = $toString(input);
    if (!stateOverride) {
      url2.scheme = "";
      url2.username = "";
      url2.password = "";
      url2.host = null;
      url2.port = null;
      url2.path = [];
      url2.query = null;
      url2.fragment = null;
      url2.cannotBeABaseURL = false;
      input = replace(input, LEADING_C0_CONTROL_OR_SPACE, "");
      input = replace(input, TRAILING_C0_CONTROL_OR_SPACE, "$1");
    }
    input = replace(input, TAB_AND_NEW_LINE, "");
    codePoints = arrayFrom(input);
    while (pointer <= codePoints.length) {
      chr = codePoints[pointer];
      switch (state) {
        case SCHEME_START:
          if (chr && exec(ALPHA, chr)) {
            buffer2 += toLowerCase(chr);
            state = SCHEME;
          } else if (!stateOverride) {
            state = NO_SCHEME;
            continue;
          } else return INVALID_SCHEME;
          break;
        case SCHEME:
          if (chr && (exec(ALPHANUMERIC, chr) || chr === "+" || chr === "-" || chr === ".")) {
            buffer2 += toLowerCase(chr);
          } else if (chr === ":") {
            if (stateOverride && (url2.isSpecial() !== hasOwn2(specialSchemes, buffer2) || buffer2 === "file" && (url2.includesCredentials() || url2.port !== null) || url2.scheme === "file" && !url2.host)) return;
            url2.scheme = buffer2;
            if (stateOverride) {
              if (url2.isSpecial() && specialSchemes[url2.scheme] === url2.port) url2.port = null;
              return;
            }
            buffer2 = "";
            if (url2.scheme === "file") {
              state = FILE;
            } else if (url2.isSpecial() && base2 && base2.scheme === url2.scheme) {
              state = SPECIAL_RELATIVE_OR_AUTHORITY;
            } else if (url2.isSpecial()) {
              state = SPECIAL_AUTHORITY_SLASHES;
            } else if (codePoints[pointer + 1] === "/") {
              state = PATH_OR_AUTHORITY;
              pointer++;
            } else {
              url2.cannotBeABaseURL = true;
              push(url2.path, "");
              state = CANNOT_BE_A_BASE_URL_PATH;
            }
          } else if (!stateOverride) {
            buffer2 = "";
            state = NO_SCHEME;
            pointer = 0;
            continue;
          } else return INVALID_SCHEME;
          break;
        case NO_SCHEME:
          if (!base2 || base2.cannotBeABaseURL && chr !== "#") return INVALID_SCHEME;
          if (base2.cannotBeABaseURL && chr === "#") {
            url2.scheme = base2.scheme;
            url2.path = arraySlice(base2.path);
            url2.query = base2.query;
            url2.fragment = "";
            url2.cannotBeABaseURL = true;
            state = FRAGMENT;
            break;
          }
          state = base2.scheme === "file" ? FILE : RELATIVE;
          continue;
        case SPECIAL_RELATIVE_OR_AUTHORITY:
          if (chr === "/" && codePoints[pointer + 1] === "/") {
            state = SPECIAL_AUTHORITY_IGNORE_SLASHES;
            pointer++;
          } else {
            state = RELATIVE;
            continue;
          }
          break;
        case PATH_OR_AUTHORITY:
          if (chr === "/") {
            state = AUTHORITY;
            break;
          } else {
            state = PATH;
            continue;
          }
        case RELATIVE:
          url2.scheme = base2.scheme;
          if (chr === EOF) {
            url2.username = base2.username;
            url2.password = base2.password;
            url2.host = base2.host;
            url2.port = base2.port;
            url2.path = arraySlice(base2.path);
            url2.query = base2.query;
          } else if (chr === "/" || chr === "\\" && url2.isSpecial()) {
            state = RELATIVE_SLASH;
          } else if (chr === "?") {
            url2.username = base2.username;
            url2.password = base2.password;
            url2.host = base2.host;
            url2.port = base2.port;
            url2.path = arraySlice(base2.path);
            url2.query = "";
            state = QUERY;
          } else if (chr === "#") {
            url2.username = base2.username;
            url2.password = base2.password;
            url2.host = base2.host;
            url2.port = base2.port;
            url2.path = arraySlice(base2.path);
            url2.query = base2.query;
            url2.fragment = "";
            state = FRAGMENT;
          } else {
            url2.username = base2.username;
            url2.password = base2.password;
            url2.host = base2.host;
            url2.port = base2.port;
            url2.path = arraySlice(base2.path);
            url2.path.length--;
            state = PATH;
            continue;
          }
          break;
        case RELATIVE_SLASH:
          if (url2.isSpecial() && (chr === "/" || chr === "\\")) {
            state = SPECIAL_AUTHORITY_IGNORE_SLASHES;
          } else if (chr === "/") {
            state = AUTHORITY;
          } else {
            url2.username = base2.username;
            url2.password = base2.password;
            url2.host = base2.host;
            url2.port = base2.port;
            state = PATH;
            continue;
          }
          break;
        case SPECIAL_AUTHORITY_SLASHES:
          state = SPECIAL_AUTHORITY_IGNORE_SLASHES;
          if (chr !== "/" || charAt(buffer2, pointer + 1) !== "/") continue;
          pointer++;
          break;
        case SPECIAL_AUTHORITY_IGNORE_SLASHES:
          if (chr !== "/" && chr !== "\\") {
            state = AUTHORITY;
            continue;
          }
          break;
        case AUTHORITY:
          if (chr === "@") {
            if (seenAt) buffer2 = "%40" + buffer2;
            seenAt = true;
            bufferCodePoints = arrayFrom(buffer2);
            for (var i2 = 0; i2 < bufferCodePoints.length; i2++) {
              var codePoint = bufferCodePoints[i2];
              if (codePoint === ":" && !seenPasswordToken) {
                seenPasswordToken = true;
                continue;
              }
              var encodedCodePoints = percentEncode(codePoint, userinfoPercentEncodeSet);
              if (seenPasswordToken) url2.password += encodedCodePoints;
              else url2.username += encodedCodePoints;
            }
            buffer2 = "";
          } else if (chr === EOF || chr === "/" || chr === "?" || chr === "#" || chr === "\\" && url2.isSpecial()) {
            if (seenAt && buffer2 === "") return INVALID_AUTHORITY;
            pointer -= arrayFrom(buffer2).length + 1;
            buffer2 = "";
            state = HOST;
          } else buffer2 += chr;
          break;
        case HOST:
        case HOSTNAME:
          if (stateOverride && url2.scheme === "file") {
            state = FILE_HOST;
            continue;
          } else if (chr === ":" && !seenBracket) {
            if (buffer2 === "") return INVALID_HOST;
            failure = url2.parseHost(buffer2);
            if (failure) return failure;
            buffer2 = "";
            state = PORT;
            if (stateOverride === HOSTNAME) return;
          } else if (chr === EOF || chr === "/" || chr === "?" || chr === "#" || chr === "\\" && url2.isSpecial()) {
            if (url2.isSpecial() && buffer2 === "") return INVALID_HOST;
            if (stateOverride && buffer2 === "" && (url2.includesCredentials() || url2.port !== null)) return;
            failure = url2.parseHost(buffer2);
            if (failure) return failure;
            buffer2 = "";
            state = PATH_START;
            if (stateOverride) return;
            continue;
          } else {
            if (chr === "[") seenBracket = true;
            else if (chr === "]") seenBracket = false;
            buffer2 += chr;
          }
          break;
        case PORT:
          if (exec(DIGIT, chr)) {
            buffer2 += chr;
          } else if (chr === EOF || chr === "/" || chr === "?" || chr === "#" || chr === "\\" && url2.isSpecial() || stateOverride) {
            if (buffer2 !== "") {
              var port = parseInt$1(buffer2, 10);
              if (port > 65535) return INVALID_PORT;
              url2.port = url2.isSpecial() && port === specialSchemes[url2.scheme] ? null : port;
              buffer2 = "";
            }
            if (stateOverride) return;
            state = PATH_START;
            continue;
          } else return INVALID_PORT;
          break;
        case FILE:
          url2.scheme = "file";
          if (chr === "/" || chr === "\\") state = FILE_SLASH;
          else if (base2 && base2.scheme === "file") {
            switch (chr) {
              case EOF:
                url2.host = base2.host;
                url2.path = arraySlice(base2.path);
                url2.query = base2.query;
                break;
              case "?":
                url2.host = base2.host;
                url2.path = arraySlice(base2.path);
                url2.query = "";
                state = QUERY;
                break;
              case "#":
                url2.host = base2.host;
                url2.path = arraySlice(base2.path);
                url2.query = base2.query;
                url2.fragment = "";
                state = FRAGMENT;
                break;
              default:
                if (!startsWithWindowsDriveLetter(join(arraySlice(codePoints, pointer), ""))) {
                  url2.host = base2.host;
                  url2.path = arraySlice(base2.path);
                  url2.shortenPath();
                }
                state = PATH;
                continue;
            }
          } else {
            state = PATH;
            continue;
          }
          break;
        case FILE_SLASH:
          if (chr === "/" || chr === "\\") {
            state = FILE_HOST;
            break;
          }
          if (base2 && base2.scheme === "file" && !startsWithWindowsDriveLetter(join(arraySlice(codePoints, pointer), ""))) {
            if (isWindowsDriveLetter(base2.path[0], true)) push(url2.path, base2.path[0]);
            else url2.host = base2.host;
          }
          state = PATH;
          continue;
        case FILE_HOST:
          if (chr === EOF || chr === "/" || chr === "\\" || chr === "?" || chr === "#") {
            if (!stateOverride && isWindowsDriveLetter(buffer2)) {
              state = PATH;
            } else if (buffer2 === "") {
              url2.host = "";
              if (stateOverride) return;
              state = PATH_START;
            } else {
              failure = url2.parseHost(buffer2);
              if (failure) return failure;
              if (url2.host === "localhost") url2.host = "";
              if (stateOverride) return;
              buffer2 = "";
              state = PATH_START;
            }
            continue;
          } else buffer2 += chr;
          break;
        case PATH_START:
          if (url2.isSpecial()) {
            state = PATH;
            if (chr !== "/" && chr !== "\\") continue;
          } else if (!stateOverride && chr === "?") {
            url2.query = "";
            state = QUERY;
          } else if (!stateOverride && chr === "#") {
            url2.fragment = "";
            state = FRAGMENT;
          } else if (chr !== EOF) {
            state = PATH;
            if (chr !== "/") continue;
          }
          break;
        case PATH:
          if (chr === EOF || chr === "/" || chr === "\\" && url2.isSpecial() || !stateOverride && (chr === "?" || chr === "#")) {
            if (isDoubleDot(buffer2)) {
              url2.shortenPath();
              if (chr !== "/" && !(chr === "\\" && url2.isSpecial())) {
                push(url2.path, "");
              }
            } else if (isSingleDot(buffer2)) {
              if (chr !== "/" && !(chr === "\\" && url2.isSpecial())) {
                push(url2.path, "");
              }
            } else {
              if (url2.scheme === "file" && !url2.path.length && isWindowsDriveLetter(buffer2)) {
                if (url2.host) url2.host = "";
                buffer2 = charAt(buffer2, 0) + ":";
              }
              push(url2.path, buffer2);
            }
            buffer2 = "";
            if (url2.scheme === "file" && (chr === EOF || chr === "?" || chr === "#")) {
              while (url2.path.length > 1 && url2.path[0] === "") {
                shift(url2.path);
              }
            }
            if (chr === "?") {
              url2.query = "";
              state = QUERY;
            } else if (chr === "#") {
              url2.fragment = "";
              state = FRAGMENT;
            }
          } else {
            buffer2 += percentEncode(chr, pathPercentEncodeSet);
          }
          break;
        case CANNOT_BE_A_BASE_URL_PATH:
          if (chr === "?") {
            url2.query = "";
            state = QUERY;
          } else if (chr === "#") {
            url2.fragment = "";
            state = FRAGMENT;
          } else if (chr !== EOF) {
            url2.path[0] += percentEncode(chr, C0ControlPercentEncodeSet);
          }
          break;
        case QUERY:
          if (!stateOverride && chr === "#") {
            url2.fragment = "";
            state = FRAGMENT;
          } else if (chr !== EOF) {
            if (chr === "'" && url2.isSpecial()) url2.query += "%27";
            else if (chr === "#") url2.query += "%23";
            else url2.query += percentEncode(chr, C0ControlPercentEncodeSet);
          }
          break;
        case FRAGMENT:
          if (chr !== EOF) url2.fragment += percentEncode(chr, fragmentPercentEncodeSet);
          break;
      }
      pointer++;
    }
  },
  // https://url.spec.whatwg.org/#host-parsing
  parseHost: function(input) {
    var result, codePoints, index;
    if (charAt(input, 0) === "[") {
      if (charAt(input, input.length - 1) !== "]") return INVALID_HOST;
      result = parseIPv6(stringSlice(input, 1, -1));
      if (!result) return INVALID_HOST;
      this.host = result;
    } else if (!this.isSpecial()) {
      if (exec(FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT, input)) return INVALID_HOST;
      result = "";
      codePoints = arrayFrom(input);
      for (index = 0; index < codePoints.length; index++) {
        result += percentEncode(codePoints[index], C0ControlPercentEncodeSet);
      }
      this.host = result;
    } else {
      input = toASCII(input);
      if (exec(FORBIDDEN_HOST_CODE_POINT, input)) return INVALID_HOST;
      result = parseIPv4(input);
      if (result === null) return INVALID_HOST;
      this.host = result;
    }
  },
  // https://url.spec.whatwg.org/#cannot-have-a-username-password-port
  cannotHaveUsernamePasswordPort: function() {
    return !this.host || this.cannotBeABaseURL || this.scheme === "file";
  },
  // https://url.spec.whatwg.org/#include-credentials
  includesCredentials: function() {
    return this.username !== "" || this.password !== "";
  },
  // https://url.spec.whatwg.org/#is-special
  isSpecial: function() {
    return hasOwn2(specialSchemes, this.scheme);
  },
  // https://url.spec.whatwg.org/#shorten-a-urls-path
  shortenPath: function() {
    var path2 = this.path;
    var pathSize = path2.length;
    if (pathSize && (this.scheme !== "file" || pathSize !== 1 || !isWindowsDriveLetter(path2[0], true))) {
      path2.length--;
    }
  },
  // https://url.spec.whatwg.org/#concept-url-serializer
  serialize: function() {
    var url2 = this;
    var scheme = url2.scheme;
    var username = url2.username;
    var password = url2.password;
    var host = url2.host;
    var port = url2.port;
    var path2 = url2.path;
    var query = url2.query;
    var fragment = url2.fragment;
    var output = scheme + ":";
    if (host !== null) {
      output += "//";
      if (url2.includesCredentials()) {
        output += username + (password ? ":" + password : "") + "@";
      }
      output += serializeHost(host);
      if (port !== null) output += ":" + port;
    } else if (scheme === "file") output += "//";
    output += url2.cannotBeABaseURL ? path2[0] : path2.length ? "/" + join(path2, "/") : "";
    if (query !== null) output += "?" + query;
    if (fragment !== null) output += "#" + fragment;
    return output;
  },
  // https://url.spec.whatwg.org/#dom-url-href
  setHref: function(href) {
    var failure = this.parse(href);
    if (failure) throw new TypeError$1(failure);
    this.searchParams.update();
  },
  // https://url.spec.whatwg.org/#dom-url-origin
  getOrigin: function() {
    var scheme = this.scheme;
    var port = this.port;
    if (scheme === "blob") try {
      return new URLConstructor(scheme.path[0]).origin;
    } catch (error) {
      return "null";
    }
    if (scheme === "file" || !this.isSpecial()) return "null";
    return scheme + "://" + serializeHost(this.host) + (port !== null ? ":" + port : "");
  },
  // https://url.spec.whatwg.org/#dom-url-protocol
  getProtocol: function() {
    return this.scheme + ":";
  },
  setProtocol: function(protocol) {
    this.parse($toString(protocol) + ":", SCHEME_START);
  },
  // https://url.spec.whatwg.org/#dom-url-username
  getUsername: function() {
    return this.username;
  },
  setUsername: function(username) {
    var codePoints = arrayFrom($toString(username));
    if (this.cannotHaveUsernamePasswordPort()) return;
    this.username = "";
    for (var i2 = 0; i2 < codePoints.length; i2++) {
      this.username += percentEncode(codePoints[i2], userinfoPercentEncodeSet);
    }
  },
  // https://url.spec.whatwg.org/#dom-url-password
  getPassword: function() {
    return this.password;
  },
  setPassword: function(password) {
    var codePoints = arrayFrom($toString(password));
    if (this.cannotHaveUsernamePasswordPort()) return;
    this.password = "";
    for (var i2 = 0; i2 < codePoints.length; i2++) {
      this.password += percentEncode(codePoints[i2], userinfoPercentEncodeSet);
    }
  },
  // https://url.spec.whatwg.org/#dom-url-host
  getHost: function() {
    var host = this.host;
    var port = this.port;
    return host === null ? "" : port === null ? serializeHost(host) : serializeHost(host) + ":" + port;
  },
  setHost: function(host) {
    if (this.cannotBeABaseURL) return;
    this.parse(host, HOST);
  },
  // https://url.spec.whatwg.org/#dom-url-hostname
  getHostname: function() {
    var host = this.host;
    return host === null ? "" : serializeHost(host);
  },
  setHostname: function(hostname) {
    if (this.cannotBeABaseURL) return;
    this.parse(hostname, HOSTNAME);
  },
  // https://url.spec.whatwg.org/#dom-url-port
  getPort: function() {
    var port = this.port;
    return port === null ? "" : $toString(port);
  },
  setPort: function(port) {
    if (this.cannotHaveUsernamePasswordPort()) return;
    port = $toString(port);
    if (port === "") this.port = null;
    else this.parse(port, PORT);
  },
  // https://url.spec.whatwg.org/#dom-url-pathname
  getPathname: function() {
    var path2 = this.path;
    return this.cannotBeABaseURL ? path2[0] : path2.length ? "/" + join(path2, "/") : "";
  },
  setPathname: function(pathname) {
    if (this.cannotBeABaseURL) return;
    this.path = [];
    this.parse(pathname, PATH_START);
  },
  // https://url.spec.whatwg.org/#dom-url-search
  getSearch: function() {
    var query = this.query;
    return query ? "?" + query : "";
  },
  setSearch: function(search) {
    search = $toString(search);
    if (search === "") {
      this.query = null;
    } else {
      if (charAt(search, 0) === "?") search = stringSlice(search, 1);
      this.query = "";
      this.parse(search, QUERY);
    }
    this.searchParams.update();
  },
  // https://url.spec.whatwg.org/#dom-url-searchparams
  getSearchParams: function() {
    return this.searchParams.facade;
  },
  // https://url.spec.whatwg.org/#dom-url-hash
  getHash: function() {
    var fragment = this.fragment;
    return fragment ? "#" + fragment : "";
  },
  setHash: function(hash) {
    hash = $toString(hash);
    if (hash === "") {
      this.fragment = null;
      return;
    }
    if (charAt(hash, 0) === "#") hash = stringSlice(hash, 1);
    this.fragment = "";
    this.parse(hash, FRAGMENT);
  },
  update: function() {
    this.query = this.searchParams.serialize() || null;
  }
};
var URLConstructor = function URL2(url2) {
  var that = anInstance(this, URLPrototype);
  var base2 = validateArgumentsLength$2(arguments.length, 1) > 1 ? arguments[1] : void 0;
  var state = setInternalState(that, new URLState(url2, false, base2));
  if (!DESCRIPTORS) {
    that.href = state.serialize();
    that.origin = state.getOrigin();
    that.protocol = state.getProtocol();
    that.username = state.getUsername();
    that.password = state.getPassword();
    that.host = state.getHost();
    that.hostname = state.getHostname();
    that.port = state.getPort();
    that.pathname = state.getPathname();
    that.search = state.getSearch();
    that.searchParams = state.getSearchParams();
    that.hash = state.getHash();
  }
};
var URLPrototype = URLConstructor.prototype;
var accessorDescriptor = function(getter, setter) {
  return {
    get: function() {
      return getInternalURLState(this)[getter]();
    },
    set: setter && function(value) {
      return getInternalURLState(this)[setter](value);
    },
    configurable: true,
    enumerable: true
  };
};
if (DESCRIPTORS) {
  defineBuiltInAccessor(URLPrototype, "href", accessorDescriptor("serialize", "setHref"));
  defineBuiltInAccessor(URLPrototype, "origin", accessorDescriptor("getOrigin"));
  defineBuiltInAccessor(URLPrototype, "protocol", accessorDescriptor("getProtocol", "setProtocol"));
  defineBuiltInAccessor(URLPrototype, "username", accessorDescriptor("getUsername", "setUsername"));
  defineBuiltInAccessor(URLPrototype, "password", accessorDescriptor("getPassword", "setPassword"));
  defineBuiltInAccessor(URLPrototype, "host", accessorDescriptor("getHost", "setHost"));
  defineBuiltInAccessor(URLPrototype, "hostname", accessorDescriptor("getHostname", "setHostname"));
  defineBuiltInAccessor(URLPrototype, "port", accessorDescriptor("getPort", "setPort"));
  defineBuiltInAccessor(URLPrototype, "pathname", accessorDescriptor("getPathname", "setPathname"));
  defineBuiltInAccessor(URLPrototype, "search", accessorDescriptor("getSearch", "setSearch"));
  defineBuiltInAccessor(URLPrototype, "searchParams", accessorDescriptor("getSearchParams"));
  defineBuiltInAccessor(URLPrototype, "hash", accessorDescriptor("getHash", "setHash"));
}
defineBuiltIn(URLPrototype, "toJSON", function toJSON() {
  return getInternalURLState(this).serialize();
}, { enumerable: true });
defineBuiltIn(URLPrototype, "toString", function toString3() {
  return getInternalURLState(this).serialize();
}, { enumerable: true });
if (NativeURL) {
  nativeCreateObjectURL = NativeURL.createObjectURL;
  nativeRevokeObjectURL = NativeURL.revokeObjectURL;
  if (nativeCreateObjectURL) defineBuiltIn(URLConstructor, "createObjectURL", bind(nativeCreateObjectURL, NativeURL));
  if (nativeRevokeObjectURL) defineBuiltIn(URLConstructor, "revokeObjectURL", bind(nativeRevokeObjectURL, NativeURL));
}
var nativeCreateObjectURL;
var nativeRevokeObjectURL;
setToStringTag(URLConstructor, "URL");
$$2({ global: true, constructor: true, forced: !USE_NATIVE_URL$2, sham: !DESCRIPTORS }, {
  URL: URLConstructor
});
var $$1 = _export;
var getBuiltIn$1 = getBuiltIn$6;
var fails = fails$d;
var validateArgumentsLength$1 = validateArgumentsLength$4;
var toString$1 = toString$4;
var USE_NATIVE_URL$1 = urlConstructorDetection;
var URL$3 = getBuiltIn$1("URL");
var THROWS_WITHOUT_ARGUMENTS = USE_NATIVE_URL$1 && fails(function() {
  URL$3.canParse();
});
var WRONG_ARITY = fails(function() {
  return URL$3.canParse.length !== 1;
});
$$1({ target: "URL", stat: true, forced: !THROWS_WITHOUT_ARGUMENTS || WRONG_ARITY }, {
  canParse: function canParse(url2) {
    var length = validateArgumentsLength$1(arguments.length, 1);
    var urlString = toString$1(url2);
    var base2 = length < 2 || arguments[1] === void 0 ? void 0 : toString$1(arguments[1]);
    try {
      return !!new URL$3(urlString, base2);
    } catch (error) {
      return false;
    }
  }
});
var $2 = _export;
var getBuiltIn = getBuiltIn$6;
var validateArgumentsLength = validateArgumentsLength$4;
var toString4 = toString$4;
var USE_NATIVE_URL = urlConstructorDetection;
var URL$2 = getBuiltIn("URL");
$2({ target: "URL", stat: true, forced: !USE_NATIVE_URL }, {
  parse: function parse(url2) {
    var length = validateArgumentsLength(arguments.length, 1);
    var urlString = toString4(url2);
    var base2 = length < 2 || arguments[1] === void 0 ? void 0 : toString4(arguments[1]);
    try {
      return new URL$2(urlString, base2);
    } catch (error) {
      return null;
    }
  }
});
var path = path$3;
var url$3 = path.URL;
var parent$2 = url$3;
var url$2 = parent$2;
var parent$1 = url$2;
var url$1 = parent$1;
var parent = url$1;
var url = parent;
var URL$1 = getDefaultExportFromCjs(url);
var PostgrestError = (
  /** @class */
  function(_super) {
    __extends9(PostgrestError2, _super);
    function PostgrestError2(context) {
      var _this = _super.call(this, context.message) || this;
      _this.name = "PostgrestError";
      _this.details = context.details;
      _this.hint = context.hint;
      _this.code = context.code;
      return _this;
    }
    return PostgrestError2;
  }(Error)
);
var PostgrestBuilder = (
  /** @class */
  function() {
    function PostgrestBuilder2(builder) {
      var _a3, _b;
      this.shouldThrowOnError = false;
      this.method = builder.method;
      this.url = builder.url;
      this.headers = new Headers(builder.headers);
      this.schema = builder.schema;
      this.body = builder.body;
      this.shouldThrowOnError = (_a3 = builder.shouldThrowOnError) !== null && _a3 !== void 0 ? _a3 : false;
      this.signal = builder.signal;
      this.isMaybeSingle = (_b = builder.isMaybeSingle) !== null && _b !== void 0 ? _b : false;
      if (builder.fetch) {
        this.fetch = builder.fetch;
      } else {
        this.fetch = fetch;
      }
    }
    PostgrestBuilder2.prototype.throwOnError = function() {
      this.shouldThrowOnError = true;
      return this;
    };
    PostgrestBuilder2.prototype.setHeader = function(name, value) {
      this.headers = new Headers(this.headers);
      this.headers.set(name, value);
      return this;
    };
    PostgrestBuilder2.prototype.then = function(onfulfilled, onrejected) {
      var _this = this;
      if (this.schema === void 0) ;
      else if (["GET", "HEAD"].includes(this.method)) {
        this.headers.set("Accept-Profile", this.schema);
      } else {
        this.headers.set("Content-Profile", this.schema);
      }
      if (this.method !== "GET" && this.method !== "HEAD") {
        this.headers.set("Content-Type", "application/json");
      }
      var _fetch = this.fetch;
      var res = _fetch(this.url.toString(), {
        method: this.method,
        headers: this.headers,
        body: JSON.stringify(this.body),
        signal: this.signal
      }).then(function(res2) {
        return __awaiter17(_this, void 0, void 0, function() {
          var error, data2, count, status, statusText, body, countHeader, contentRange, body, postgrestResponse;
          var _a3, _b, _c, _d;
          return __generator17(this, function(_e2) {
            switch (_e2.label) {
              case 0:
                error = null;
                data2 = null;
                count = null;
                status = res2.status;
                statusText = res2.statusText;
                if (!res2.ok) return [3, 3];
                if (!(this.method !== "HEAD")) return [3, 2];
                return [4, res2.text()];
              case 1:
                body = _e2.sent();
                if (body === "") ;
                else if (this.headers.get("Accept") === "text/csv") {
                  data2 = body;
                } else if (this.headers.get("Accept") && ((_a3 = this.headers.get("Accept")) === null || _a3 === void 0 ? void 0 : _a3.includes("application/vnd.pgrst.plan+text"))) {
                  data2 = body;
                } else {
                  data2 = JSON.parse(body);
                }
                _e2.label = 2;
              case 2:
                countHeader = (_b = this.headers.get("Prefer")) === null || _b === void 0 ? void 0 : _b.match(/count=(exact|planned|estimated)/);
                contentRange = (_c = res2.headers.get("content-range")) === null || _c === void 0 ? void 0 : _c.split("/");
                if (countHeader && contentRange && contentRange.length > 1) {
                  count = parseInt(contentRange[1]);
                }
                if (this.isMaybeSingle && this.method === "GET" && Array.isArray(data2)) {
                  if (data2.length > 1) {
                    error = {
                      // https://github.com/PostgREST/postgrest/blob/a867d79c42419af16c18c3fb019eba8df992626f/src/PostgREST/Error.hs#L553
                      code: "PGRST116",
                      details: "Results contain ".concat(data2.length, " rows, application/vnd.pgrst.object+json requires 1 row"),
                      hint: null,
                      message: "JSON object requested, multiple (or no) rows returned"
                    };
                    data2 = null;
                    count = null;
                    status = 406;
                    statusText = "Not Acceptable";
                  } else if (data2.length === 1) {
                    data2 = data2[0];
                  } else {
                    data2 = null;
                  }
                }
                return [3, 5];
              case 3:
                return [4, res2.text()];
              case 4:
                body = _e2.sent();
                try {
                  error = JSON.parse(body);
                  if (Array.isArray(error) && res2.status === 404) {
                    data2 = [];
                    error = null;
                    status = 200;
                    statusText = "OK";
                  }
                } catch (_f) {
                  if (res2.status === 404 && body === "") {
                    status = 204;
                    statusText = "No Content";
                  } else {
                    error = {
                      message: body
                    };
                  }
                }
                if (error && this.isMaybeSingle && ((_d = error === null || error === void 0 ? void 0 : error.details) === null || _d === void 0 ? void 0 : _d.includes("0 rows"))) {
                  error = null;
                  status = 200;
                  statusText = "OK";
                }
                if (error && this.shouldThrowOnError) {
                  throw new PostgrestError(error);
                }
                _e2.label = 5;
              case 5:
                postgrestResponse = {
                  error,
                  data: data2,
                  count,
                  status,
                  statusText
                };
                return [2, postgrestResponse];
            }
          });
        });
      });
      if (!this.shouldThrowOnError) {
        res = res["catch"](function(fetchError) {
          var _a3, _b, _c;
          return {
            error: {
              message: "".concat((_a3 = fetchError === null || fetchError === void 0 ? void 0 : fetchError.name) !== null && _a3 !== void 0 ? _a3 : "FetchError", ": ").concat(fetchError === null || fetchError === void 0 ? void 0 : fetchError.message),
              details: "".concat((_b = fetchError === null || fetchError === void 0 ? void 0 : fetchError.stack) !== null && _b !== void 0 ? _b : ""),
              hint: "",
              code: "".concat((_c = fetchError === null || fetchError === void 0 ? void 0 : fetchError.code) !== null && _c !== void 0 ? _c : "")
            },
            data: null,
            count: null,
            status: 0,
            statusText: ""
          };
        });
      }
      return res.then(onfulfilled, onrejected);
    };
    PostgrestBuilder2.prototype.returns = function() {
      return this;
    };
    PostgrestBuilder2.prototype.overrideTypes = function() {
      return this;
    };
    return PostgrestBuilder2;
  }()
);
var PostgrestTransformBuilder = (
  /** @class */
  function(_super) {
    __extends9(PostgrestTransformBuilder2, _super);
    function PostgrestTransformBuilder2() {
      return _super !== null && _super.apply(this, arguments) || this;
    }
    PostgrestTransformBuilder2.prototype.select = function(columns) {
      var quoted = false;
      var cleanedColumns = (columns !== null && columns !== void 0 ? columns : "*").split("").map(function(c2) {
        if (/\s/.test(c2) && !quoted) {
          return "";
        }
        if (c2 === '"') {
          quoted = !quoted;
        }
        return c2;
      }).join("");
      this.url.searchParams.set("select", cleanedColumns);
      this.headers.append("Prefer", "return=representation");
      return this;
    };
    PostgrestTransformBuilder2.prototype.order = function(column, _a3) {
      var _b = _a3 === void 0 ? {} : _a3, _c = _b.ascending, ascending = _c === void 0 ? true : _c, nullsFirst = _b.nullsFirst, foreignTable = _b.foreignTable, _d = _b.referencedTable, referencedTable = _d === void 0 ? foreignTable : _d;
      var key = referencedTable ? "".concat(referencedTable, ".order") : "order";
      var existingOrder = this.url.searchParams.get(key);
      this.url.searchParams.set(key, "".concat(existingOrder ? "".concat(existingOrder, ",") : "").concat(column, ".").concat(ascending ? "asc" : "desc").concat(nullsFirst === void 0 ? "" : nullsFirst ? ".nullsfirst" : ".nullslast"));
      return this;
    };
    PostgrestTransformBuilder2.prototype.limit = function(count, _a3) {
      var _b = _a3 === void 0 ? {} : _a3, foreignTable = _b.foreignTable, _c = _b.referencedTable, referencedTable = _c === void 0 ? foreignTable : _c;
      var key = typeof referencedTable === "undefined" ? "limit" : "".concat(referencedTable, ".limit");
      this.url.searchParams.set(key, "".concat(count));
      return this;
    };
    PostgrestTransformBuilder2.prototype.range = function(from2, to2, _a3) {
      var _b = _a3 === void 0 ? {} : _a3, foreignTable = _b.foreignTable, _c = _b.referencedTable, referencedTable = _c === void 0 ? foreignTable : _c;
      var keyOffset = typeof referencedTable === "undefined" ? "offset" : "".concat(referencedTable, ".offset");
      var keyLimit = typeof referencedTable === "undefined" ? "limit" : "".concat(referencedTable, ".limit");
      this.url.searchParams.set(keyOffset, "".concat(from2));
      this.url.searchParams.set(keyLimit, "".concat(to2 - from2 + 1));
      return this;
    };
    PostgrestTransformBuilder2.prototype.abortSignal = function(signal) {
      this.signal = signal;
      return this;
    };
    PostgrestTransformBuilder2.prototype.single = function() {
      this.headers.set("Accept", "application/vnd.pgrst.object+json");
      return this;
    };
    PostgrestTransformBuilder2.prototype.maybeSingle = function() {
      if (this.method === "GET") {
        this.headers.set("Accept", "application/json");
      } else {
        this.headers.set("Accept", "application/vnd.pgrst.object+json");
      }
      this.isMaybeSingle = true;
      return this;
    };
    PostgrestTransformBuilder2.prototype.csv = function() {
      this.headers.set("Accept", "text/csv");
      return this;
    };
    PostgrestTransformBuilder2.prototype.geojson = function() {
      this.headers.set("Accept", "application/geo+json");
      return this;
    };
    PostgrestTransformBuilder2.prototype.explain = function(_a3) {
      var _b;
      var _c = _a3 === void 0 ? {} : _a3, _d = _c.analyze, analyze = _d === void 0 ? false : _d, _e2 = _c.verbose, verbose = _e2 === void 0 ? false : _e2, _f = _c.settings, settings = _f === void 0 ? false : _f, _g = _c.buffers, buffers = _g === void 0 ? false : _g, _h = _c.wal, wal = _h === void 0 ? false : _h, _j = _c.format, format = _j === void 0 ? "text" : _j;
      var options = [
        analyze ? "analyze" : null,
        verbose ? "verbose" : null,
        settings ? "settings" : null,
        buffers ? "buffers" : null,
        wal ? "wal" : null
      ].filter(Boolean).join("|");
      var forMediatype = (_b = this.headers.get("Accept")) !== null && _b !== void 0 ? _b : "application/json";
      this.headers.set("Accept", "application/vnd.pgrst.plan+".concat(format, '; for="').concat(forMediatype, '"; options=').concat(options, ";"));
      if (format === "json") {
        return this;
      } else {
        return this;
      }
    };
    PostgrestTransformBuilder2.prototype.rollback = function() {
      this.headers.append("Prefer", "tx=rollback");
      return this;
    };
    PostgrestTransformBuilder2.prototype.returns = function() {
      return this;
    };
    PostgrestTransformBuilder2.prototype.maxAffected = function(value) {
      this.headers.append("Prefer", "handling=strict");
      this.headers.append("Prefer", "max-affected=".concat(value));
      return this;
    };
    return PostgrestTransformBuilder2;
  }(PostgrestBuilder)
);
var PostgrestFilterBuilder = (
  /** @class */
  function(_super) {
    __extends9(PostgrestFilterBuilder2, _super);
    function PostgrestFilterBuilder2() {
      return _super !== null && _super.apply(this, arguments) || this;
    }
    PostgrestFilterBuilder2.prototype.eq = function(column, value) {
      this.url.searchParams.append(column, "eq.".concat(value));
      return this;
    };
    PostgrestFilterBuilder2.prototype.neq = function(column, value) {
      this.url.searchParams.append(column, "neq.".concat(value));
      return this;
    };
    PostgrestFilterBuilder2.prototype.gt = function(column, value) {
      this.url.searchParams.append(column, "gt.".concat(value));
      return this;
    };
    PostgrestFilterBuilder2.prototype.gte = function(column, value) {
      this.url.searchParams.append(column, "gte.".concat(value));
      return this;
    };
    PostgrestFilterBuilder2.prototype.lt = function(column, value) {
      this.url.searchParams.append(column, "lt.".concat(value));
      return this;
    };
    PostgrestFilterBuilder2.prototype.lte = function(column, value) {
      this.url.searchParams.append(column, "lte.".concat(value));
      return this;
    };
    PostgrestFilterBuilder2.prototype.like = function(column, pattern) {
      this.url.searchParams.append(column, "like.".concat(pattern));
      return this;
    };
    PostgrestFilterBuilder2.prototype.likeAllOf = function(column, patterns) {
      this.url.searchParams.append(column, "like(all).{".concat(patterns.join(","), "}"));
      return this;
    };
    PostgrestFilterBuilder2.prototype.likeAnyOf = function(column, patterns) {
      this.url.searchParams.append(column, "like(any).{".concat(patterns.join(","), "}"));
      return this;
    };
    PostgrestFilterBuilder2.prototype.ilike = function(column, pattern) {
      this.url.searchParams.append(column, "ilike.".concat(pattern));
      return this;
    };
    PostgrestFilterBuilder2.prototype.ilikeAllOf = function(column, patterns) {
      this.url.searchParams.append(column, "ilike(all).{".concat(patterns.join(","), "}"));
      return this;
    };
    PostgrestFilterBuilder2.prototype.ilikeAnyOf = function(column, patterns) {
      this.url.searchParams.append(column, "ilike(any).{".concat(patterns.join(","), "}"));
      return this;
    };
    PostgrestFilterBuilder2.prototype.is = function(column, value) {
      this.url.searchParams.append(column, "is.".concat(value));
      return this;
    };
    PostgrestFilterBuilder2.prototype["in"] = function(column, values2) {
      var cleanedValues = Array.from(new Set(values2)).map(function(s2) {
        if (typeof s2 === "string" && new RegExp("[,()]").test(s2))
          return '"'.concat(s2, '"');
        else
          return "".concat(s2);
      }).join(",");
      this.url.searchParams.append(column, "in.(".concat(cleanedValues, ")"));
      return this;
    };
    PostgrestFilterBuilder2.prototype.contains = function(column, value) {
      if (typeof value === "string") {
        this.url.searchParams.append(column, "cs.".concat(value));
      } else if (Array.isArray(value)) {
        this.url.searchParams.append(column, "cs.{".concat(value.join(","), "}"));
      } else {
        this.url.searchParams.append(column, "cs.".concat(JSON.stringify(value)));
      }
      return this;
    };
    PostgrestFilterBuilder2.prototype.containedBy = function(column, value) {
      if (typeof value === "string") {
        this.url.searchParams.append(column, "cd.".concat(value));
      } else if (Array.isArray(value)) {
        this.url.searchParams.append(column, "cd.{".concat(value.join(","), "}"));
      } else {
        this.url.searchParams.append(column, "cd.".concat(JSON.stringify(value)));
      }
      return this;
    };
    PostgrestFilterBuilder2.prototype.rangeGt = function(column, range) {
      this.url.searchParams.append(column, "sr.".concat(range));
      return this;
    };
    PostgrestFilterBuilder2.prototype.rangeGte = function(column, range) {
      this.url.searchParams.append(column, "nxl.".concat(range));
      return this;
    };
    PostgrestFilterBuilder2.prototype.rangeLt = function(column, range) {
      this.url.searchParams.append(column, "sl.".concat(range));
      return this;
    };
    PostgrestFilterBuilder2.prototype.rangeLte = function(column, range) {
      this.url.searchParams.append(column, "nxr.".concat(range));
      return this;
    };
    PostgrestFilterBuilder2.prototype.rangeAdjacent = function(column, range) {
      this.url.searchParams.append(column, "adj.".concat(range));
      return this;
    };
    PostgrestFilterBuilder2.prototype.overlaps = function(column, value) {
      if (typeof value === "string") {
        this.url.searchParams.append(column, "ov.".concat(value));
      } else {
        this.url.searchParams.append(column, "ov.{".concat(value.join(","), "}"));
      }
      return this;
    };
    PostgrestFilterBuilder2.prototype.textSearch = function(column, query, _a3) {
      var _b = _a3 === void 0 ? {} : _a3, config = _b.config, type = _b.type;
      var typePart = "";
      if (type === "plain") {
        typePart = "pl";
      } else if (type === "phrase") {
        typePart = "ph";
      } else if (type === "websearch") {
        typePart = "w";
      }
      var configPart = config === void 0 ? "" : "(".concat(config, ")");
      this.url.searchParams.append(column, "".concat(typePart, "fts").concat(configPart, ".").concat(query));
      return this;
    };
    PostgrestFilterBuilder2.prototype.match = function(query) {
      var _this = this;
      Object.entries(query).forEach(function(_a3) {
        var column = _a3[0], value = _a3[1];
        _this.url.searchParams.append(column, "eq.".concat(value));
      });
      return this;
    };
    PostgrestFilterBuilder2.prototype.not = function(column, operator, value) {
      this.url.searchParams.append(column, "not.".concat(operator, ".").concat(value));
      return this;
    };
    PostgrestFilterBuilder2.prototype.or = function(filters, _a3) {
      var _b = _a3 === void 0 ? {} : _a3, foreignTable = _b.foreignTable, _c = _b.referencedTable, referencedTable = _c === void 0 ? foreignTable : _c;
      var key = referencedTable ? "".concat(referencedTable, ".or") : "or";
      this.url.searchParams.append(key, "(".concat(filters, ")"));
      return this;
    };
    PostgrestFilterBuilder2.prototype.filter = function(column, operator, value) {
      this.url.searchParams.append(column, "".concat(operator, ".").concat(value));
      return this;
    };
    return PostgrestFilterBuilder2;
  }(PostgrestTransformBuilder)
);
var PostgrestQueryBuilder = (
  /** @class */
  function() {
    function PostgrestQueryBuilder2(url2, _a3) {
      var _b = _a3.headers, headers = _b === void 0 ? {} : _b, schema = _a3.schema, fetch2 = _a3.fetch;
      this.url = url2;
      this.headers = new Headers(headers);
      this.schema = schema;
      this.fetch = fetch2;
    }
    PostgrestQueryBuilder2.prototype.select = function(columns, _a3) {
      var _b = _a3 === void 0 ? {} : _a3, _c = _b.head, head = _c === void 0 ? false : _c, count = _b.count;
      var method = head ? "HEAD" : "GET";
      var quoted = false;
      var cleanedColumns = (columns !== null && columns !== void 0 ? columns : "*").split("").map(function(c2) {
        if (/\s/.test(c2) && !quoted) {
          return "";
        }
        if (c2 === '"') {
          quoted = !quoted;
        }
        return c2;
      }).join("");
      this.url.searchParams.set("select", cleanedColumns);
      if (count) {
        this.headers.append("Prefer", "count=".concat(count));
      }
      return new PostgrestFilterBuilder({
        method,
        url: this.url,
        headers: this.headers,
        schema: this.schema,
        fetch: this.fetch
      });
    };
    PostgrestQueryBuilder2.prototype.insert = function(values2, _a3) {
      var _b;
      var _c = _a3 === void 0 ? {} : _a3, count = _c.count, _d = _c.defaultToNull, defaultToNull = _d === void 0 ? true : _d;
      var method = "POST";
      if (count) {
        this.headers.append("Prefer", "count=".concat(count));
      }
      if (!defaultToNull) {
        this.headers.append("Prefer", "missing=default");
      }
      if (Array.isArray(values2)) {
        var columns = values2.reduce(function(acc, x2) {
          return acc.concat(Object.keys(x2));
        }, []);
        if (columns.length > 0) {
          var uniqueColumns = Array.from(new Set(columns)).map(function(column) {
            return '"'.concat(column, '"');
          });
          this.url.searchParams.set("columns", uniqueColumns.join(","));
        }
      }
      return new PostgrestFilterBuilder({
        method,
        url: this.url,
        headers: this.headers,
        schema: this.schema,
        body: values2,
        fetch: (_b = this.fetch) !== null && _b !== void 0 ? _b : fetch
      });
    };
    PostgrestQueryBuilder2.prototype.upsert = function(values2, _a3) {
      var _b;
      var _c = _a3 === void 0 ? {} : _a3, onConflict = _c.onConflict, _d = _c.ignoreDuplicates, ignoreDuplicates = _d === void 0 ? false : _d, count = _c.count, _e2 = _c.defaultToNull, defaultToNull = _e2 === void 0 ? true : _e2;
      var method = "POST";
      this.headers.append("Prefer", "resolution=".concat(ignoreDuplicates ? "ignore" : "merge", "-duplicates"));
      if (onConflict !== void 0)
        this.url.searchParams.set("on_conflict", onConflict);
      if (count) {
        this.headers.append("Prefer", "count=".concat(count));
      }
      if (!defaultToNull) {
        this.headers.append("Prefer", "missing=default");
      }
      if (Array.isArray(values2)) {
        var columns = values2.reduce(function(acc, x2) {
          return acc.concat(Object.keys(x2));
        }, []);
        if (columns.length > 0) {
          var uniqueColumns = Array.from(new Set(columns)).map(function(column) {
            return '"'.concat(column, '"');
          });
          this.url.searchParams.set("columns", uniqueColumns.join(","));
        }
      }
      return new PostgrestFilterBuilder({
        method,
        url: this.url,
        headers: this.headers,
        schema: this.schema,
        body: values2,
        fetch: (_b = this.fetch) !== null && _b !== void 0 ? _b : fetch
      });
    };
    PostgrestQueryBuilder2.prototype.update = function(values2, _a3) {
      var _b;
      var _c = _a3 === void 0 ? {} : _a3, count = _c.count;
      var method = "PATCH";
      if (count) {
        this.headers.append("Prefer", "count=".concat(count));
      }
      return new PostgrestFilterBuilder({
        method,
        url: this.url,
        headers: this.headers,
        schema: this.schema,
        body: values2,
        fetch: (_b = this.fetch) !== null && _b !== void 0 ? _b : fetch
      });
    };
    PostgrestQueryBuilder2.prototype["delete"] = function(_a3) {
      var _b;
      var _c = _a3 === void 0 ? {} : _a3, count = _c.count;
      var method = "DELETE";
      if (count) {
        this.headers.append("Prefer", "count=".concat(count));
      }
      return new PostgrestFilterBuilder({
        method,
        url: this.url,
        headers: this.headers,
        schema: this.schema,
        fetch: (_b = this.fetch) !== null && _b !== void 0 ? _b : fetch
      });
    };
    return PostgrestQueryBuilder2;
  }()
);
var MySqlQueryBuilder = (
  /** @class */
  function(_super) {
    __extends9(MySqlQueryBuilder2, _super);
    function MySqlQueryBuilder2(url2, _a3) {
      var _b = _a3.headers, headers = _b === void 0 ? {} : _b, fetch2 = _a3.fetch;
      return _super.call(this, url2, {
        headers,
        schema: void 0,
        fetch: fetch2
      }) || this;
    }
    return MySqlQueryBuilder2;
  }(PostgrestQueryBuilder)
);
var MySqlClient = (
  /** @class */
  function() {
    function MySqlClient2(url2, _a3) {
      var _b = _a3 === void 0 ? {} : _a3, _c = _b.headers, headers = _c === void 0 ? {} : _c, fetch2 = _b.fetch;
      this.url = url2;
      this.headers = new Headers(headers);
      this.fetch = fetch2;
    }
    MySqlClient2.prototype.from = function(relation) {
      var url2 = new URL$1("".concat(this.url, "/").concat(relation));
      return new MySqlQueryBuilder(url2, {
        headers: this.headers,
        fetch: this.fetch
      });
    };
    return MySqlClient2;
  }()
);
function generateMySQLClient(cloud, options) {
  var envId = options === null || options === void 0 ? void 0 : options.envId;
  var mysqlBaseUrl = (options === null || options === void 0 ? void 0 : options.mysqlBaseUrl) || getDefaultGatewayBaseUrl(cloud, options === null || options === void 0 ? void 0 : options.envId).mysql;
  var customFetch = options === null || options === void 0 ? void 0 : options.fetch;
  return function(options2) {
    var _this = this;
    return new MySqlClient(mysqlBaseUrl, {
      fetch: customFetch || function(input, init) {
        return __awaiter17(_this, void 0, void 0, function() {
          var instance, database2, headers;
          return __generator17(this, function(_a3) {
            instance = (options2 === null || options2 === void 0 ? void 0 : options2.instance) || "default";
            database2 = (options2 === null || options2 === void 0 ? void 0 : options2.database) || envId;
            headers = {};
            if ((init === null || init === void 0 ? void 0 : init.headers) instanceof Headers) {
              init.headers.forEach(function(value, key) {
                headers[key] = value;
              });
            } else {
              headers = (init === null || init === void 0 ? void 0 : init.headers) || {};
            }
            return [2, cloud.callFunction({
              name: "httpOverCallFunction",
              data: {
                url: input.toString(),
                method: (init === null || init === void 0 ? void 0 : init.method) || "GET",
                headers: __assign17(__assign17({}, headers || {}), { "Content-Type": "application/json", "X-Db-Instance": instance, "Accept-Profile": database2, "Content-Profile": database2 }),
                body: init === null || init === void 0 ? void 0 : init.body
              }
            }).then(function(res) {
              var result = res === null || res === void 0 ? void 0 : res.result;
              var response = {
                ok: (result === null || result === void 0 ? void 0 : result.statusCode) >= 200 && (result === null || result === void 0 ? void 0 : result.statusCode) < 300,
                status: (result === null || result === void 0 ? void 0 : result.statusCode) || 200,
                statusText: (result === null || result === void 0 ? void 0 : result.statusMessage) || "OK",
                json: function() {
                  return Promise.resolve((result === null || result === void 0 ? void 0 : result.body) || {});
                },
                text: function() {
                  return Promise.resolve(typeof (result === null || result === void 0 ? void 0 : result.body) === "string" ? result.body : JSON.stringify((result === null || result === void 0 ? void 0 : result.body) || {}));
                },
                headers: new Headers((result === null || result === void 0 ? void 0 : result.headers) || {})
              };
              return response;
            })];
          });
        });
      }
    });
  };
}
function getDefaultGatewayBaseUrl(cloud, envId) {
  var _a3, _b, _c, _d;
  var env = envId || ((_b = (_a3 = cloud === null || cloud === void 0 ? void 0 : cloud.extend) === null || _a3 === void 0 ? void 0 : _a3.AI) === null || _b === void 0 ? void 0 : _b.env);
  if (typeof env !== "string" || !env.trim())
    env = (_c = cloud === null || cloud === void 0 ? void 0 : cloud.config) === null || _c === void 0 ? void 0 : _c.env;
  if (typeof env !== "string" || !env.trim())
    env = (_d = cloud === null || cloud === void 0 ? void 0 : cloud.config) === null || _d === void 0 ? void 0 : _d.envName;
  if (typeof env !== "string" || !env.trim()) {
    throw new Error("Generating default gateway base url failed: env not found");
  }
  env = env.trim();
  return {
    model: "https://".concat(env, ".api.tcloudbasegateway.com/v1/model"),
    sql: "https://".concat(env, ".api.tcloudbasegateway.com/v1/sql"),
    mysql: "https://".concat(env, ".api.tcloudbasegateway.com/v1/rdb/rest")
  };
}

// node_modules/@cloudbase/model/dist/esm/index.js
var __assign18 = function() {
  __assign18 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign18.apply(this, arguments);
};
var __awaiter18 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator18 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var CloudbaseEventEmitter4 = events_exports.CloudbaseEventEmitter;
var COMPONENT_NAME6 = "models";
function getEntity(cloudbase3) {
  var _this = this;
  var callFunction = cloudbase3.callFunction.bind(cloudbase3);
  var cloudbaseFetch = cloudbase3.request.fetch.bind(cloudbase3.request);
  var fetch2 = function(fetchOptions) {
    return __awaiter18(_this, void 0, void 0, function() {
      var res;
      return __generator18(this, function(_a4) {
        switch (_a4.label) {
          case 0:
            return [4, cloudbaseFetch(__assign18(__assign18({}, fetchOptions), { headers: __assign18({ "Content-Type": "application/json" }, fetchOptions.headers) }))];
          case 1:
            res = _a4.sent();
            return [4, res.data];
          case 2:
            return [2, _a4.sent()];
        }
      });
    });
  };
  var _a3 = cloudbase3.getEndPointWithKey("GATEWAY"), BASE_URL = _a3.BASE_URL, PROTOCOL2 = _a3.PROTOCOL;
  var baseUrl = "".concat(PROTOCOL2).concat(BASE_URL, "/model");
  var sqlBaseUrl = "".concat(PROTOCOL2).concat(BASE_URL, "/sql");
  var entity = generateHTTPClient(callFunction, fetch2, baseUrl, { sqlBaseUrl });
  return entity;
}
var cloudbaseModelMap = /* @__PURE__ */ new WeakMap();
function lazyGetEntity(cloudbase3) {
  return new Proxy({}, {
    get: function(_2, prop) {
      var _a3 = cloudbase3.getEndPointWithKey("GATEWAY"), BASE_URL = _a3.BASE_URL, PROTOCOL2 = _a3.PROTOCOL;
      var key = __assign18(__assign18({}, cloudbase3), { BASE_URL, PROTOCOL: PROTOCOL2 });
      var entity = cloudbaseModelMap.get(key);
      if (!entity) {
        entity = getEntity(cloudbase3);
        cloudbaseModelMap.set(key, entity);
      }
      return entity[prop];
    }
  });
}
var CLOUDBASE_INIT_EVENT = "cloudbase_init";
var bus2 = new CloudbaseEventEmitter4();
bus2.on(CLOUDBASE_INIT_EVENT, function(_a3) {
  var cloudbase3 = _a3.data;
  Object.assign(cloudbase3, { models: lazyGetEntity(cloudbase3) });
});
var component7 = {
  name: COMPONENT_NAME6,
  namespace: COMPONENT_NAME6,
  entity: new Proxy({}, {
    get: function(_2, prop) {
      console.warn("deprecatedAccessing Cloudbase.prototype.models.".concat(prop, "."));
    }
  }),
  injectEvents: {
    bus: bus2,
    events: [CLOUDBASE_INIT_EVENT]
  }
};
try {
  cloudbase.registerComponent(component7);
} catch (e3) {
}
function registerModel(app) {
  try {
    app.registerComponent(component7);
  } catch (e3) {
    console.warn(e3);
  }
}
try {
  window.registerModel = registerModel;
} catch (e3) {
}

// node_modules/@mattiasbuelens/web-streams-adapter/dist/web-streams-adapter.mjs
var extendStatics2 = function(d2, b2) {
  extendStatics2 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
    d3.__proto__ = b3;
  } || function(d3, b3) {
    for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
  };
  return extendStatics2(d2, b2);
};
function __extends10(d2, b2) {
  if (typeof b2 !== "function" && b2 !== null)
    throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
  extendStatics2(d2, b2);
  function __() {
    this.constructor = d2;
  }
  d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
}
function assert(test2) {
  if (!test2) {
    throw new TypeError("Assertion failed");
  }
}
function noop2() {
  return;
}
function typeIsObject(x2) {
  return typeof x2 === "object" && x2 !== null || typeof x2 === "function";
}
function isStreamConstructor(ctor) {
  if (typeof ctor !== "function") {
    return false;
  }
  var startCalled = false;
  try {
    new ctor({
      start: function() {
        startCalled = true;
      }
    });
  } catch (e3) {
  }
  return startCalled;
}
function isReadableStream(readable) {
  if (!typeIsObject(readable)) {
    return false;
  }
  if (typeof readable.getReader !== "function") {
    return false;
  }
  return true;
}
function isReadableStreamConstructor(ctor) {
  if (!isStreamConstructor(ctor)) {
    return false;
  }
  if (!isReadableStream(new ctor())) {
    return false;
  }
  return true;
}
function supportsByobReader(readable) {
  try {
    var reader = readable.getReader({ mode: "byob" });
    reader.releaseLock();
    return true;
  } catch (_a3) {
    return false;
  }
}
function supportsByteSource(ctor) {
  try {
    new ctor({ type: "bytes" });
    return true;
  } catch (_a3) {
    return false;
  }
}
function createReadableStreamWrapper(ctor) {
  assert(isReadableStreamConstructor(ctor));
  var byteSourceSupported = supportsByteSource(ctor);
  return function(readable, _a3) {
    var _b = _a3 === void 0 ? {} : _a3, type = _b.type;
    type = parseReadableType(type);
    if (type === "bytes" && !byteSourceSupported) {
      type = void 0;
    }
    if (readable.constructor === ctor) {
      if (type !== "bytes" || supportsByobReader(readable)) {
        return readable;
      }
    }
    if (type === "bytes") {
      var source = createWrappingReadableSource(readable, { type });
      return new ctor(source);
    } else {
      var source = createWrappingReadableSource(readable);
      return new ctor(source);
    }
  };
}
function createWrappingReadableSource(readable, _a3) {
  var _b = _a3 === void 0 ? {} : _a3, type = _b.type;
  assert(isReadableStream(readable));
  assert(readable.locked === false);
  type = parseReadableType(type);
  var source;
  if (type === "bytes") {
    source = new WrappingReadableByteStreamSource(readable);
  } else {
    source = new WrappingReadableStreamDefaultSource(readable);
  }
  return source;
}
function parseReadableType(type) {
  var typeString = String(type);
  if (typeString === "bytes") {
    return typeString;
  } else if (type === void 0) {
    return type;
  } else {
    throw new RangeError("Invalid type is specified");
  }
}
var AbstractWrappingReadableStreamSource = (
  /** @class */
  function() {
    function AbstractWrappingReadableStreamSource2(underlyingStream) {
      this._underlyingReader = void 0;
      this._readerMode = void 0;
      this._readableStreamController = void 0;
      this._pendingRead = void 0;
      this._underlyingStream = underlyingStream;
      this._attachDefaultReader();
    }
    AbstractWrappingReadableStreamSource2.prototype.start = function(controller) {
      this._readableStreamController = controller;
    };
    AbstractWrappingReadableStreamSource2.prototype.cancel = function(reason) {
      assert(this._underlyingReader !== void 0);
      return this._underlyingReader.cancel(reason);
    };
    AbstractWrappingReadableStreamSource2.prototype._attachDefaultReader = function() {
      if (this._readerMode === "default") {
        return;
      }
      this._detachReader();
      var reader = this._underlyingStream.getReader();
      this._readerMode = "default";
      this._attachReader(reader);
    };
    AbstractWrappingReadableStreamSource2.prototype._attachReader = function(reader) {
      var _this = this;
      assert(this._underlyingReader === void 0);
      this._underlyingReader = reader;
      var closed = this._underlyingReader.closed;
      if (!closed) {
        return;
      }
      closed.then(function() {
        return _this._finishPendingRead();
      }).then(function() {
        if (reader === _this._underlyingReader) {
          _this._readableStreamController.close();
        }
      }, function(reason) {
        if (reader === _this._underlyingReader) {
          _this._readableStreamController.error(reason);
        }
      }).catch(noop2);
    };
    AbstractWrappingReadableStreamSource2.prototype._detachReader = function() {
      if (this._underlyingReader === void 0) {
        return;
      }
      this._underlyingReader.releaseLock();
      this._underlyingReader = void 0;
      this._readerMode = void 0;
    };
    AbstractWrappingReadableStreamSource2.prototype._pullWithDefaultReader = function() {
      var _this = this;
      this._attachDefaultReader();
      var read3 = this._underlyingReader.read().then(function(result) {
        var controller = _this._readableStreamController;
        if (result.done) {
          _this._tryClose();
        } else {
          controller.enqueue(result.value);
        }
      });
      this._setPendingRead(read3);
      return read3;
    };
    AbstractWrappingReadableStreamSource2.prototype._tryClose = function() {
      try {
        this._readableStreamController.close();
      } catch (_a3) {
      }
    };
    AbstractWrappingReadableStreamSource2.prototype._setPendingRead = function(readPromise) {
      var _this = this;
      var pendingRead;
      var finishRead = function() {
        if (_this._pendingRead === pendingRead) {
          _this._pendingRead = void 0;
        }
      };
      this._pendingRead = pendingRead = readPromise.then(finishRead, finishRead);
    };
    AbstractWrappingReadableStreamSource2.prototype._finishPendingRead = function() {
      var _this = this;
      if (!this._pendingRead) {
        return void 0;
      }
      var afterRead = function() {
        return _this._finishPendingRead();
      };
      return this._pendingRead.then(afterRead, afterRead);
    };
    return AbstractWrappingReadableStreamSource2;
  }()
);
var WrappingReadableStreamDefaultSource = (
  /** @class */
  function(_super) {
    __extends10(WrappingReadableStreamDefaultSource2, _super);
    function WrappingReadableStreamDefaultSource2() {
      return _super !== null && _super.apply(this, arguments) || this;
    }
    WrappingReadableStreamDefaultSource2.prototype.pull = function() {
      return this._pullWithDefaultReader();
    };
    return WrappingReadableStreamDefaultSource2;
  }(AbstractWrappingReadableStreamSource)
);
function toUint8Array(view) {
  return new Uint8Array(view.buffer, view.byteOffset, view.byteLength);
}
function copyArrayBufferView(from2, to2) {
  var fromArray = toUint8Array(from2);
  var toArray = toUint8Array(to2);
  toArray.set(fromArray, 0);
}
var WrappingReadableByteStreamSource = (
  /** @class */
  function(_super) {
    __extends10(WrappingReadableByteStreamSource2, _super);
    function WrappingReadableByteStreamSource2(underlyingStream) {
      var _this = this;
      var supportsByob = supportsByobReader(underlyingStream);
      _this = _super.call(this, underlyingStream) || this;
      _this._supportsByob = supportsByob;
      return _this;
    }
    Object.defineProperty(WrappingReadableByteStreamSource2.prototype, "type", {
      get: function() {
        return "bytes";
      },
      enumerable: false,
      configurable: true
    });
    WrappingReadableByteStreamSource2.prototype._attachByobReader = function() {
      if (this._readerMode === "byob") {
        return;
      }
      assert(this._supportsByob);
      this._detachReader();
      var reader = this._underlyingStream.getReader({ mode: "byob" });
      this._readerMode = "byob";
      this._attachReader(reader);
    };
    WrappingReadableByteStreamSource2.prototype.pull = function() {
      if (this._supportsByob) {
        var byobRequest = this._readableStreamController.byobRequest;
        if (byobRequest) {
          return this._pullWithByobRequest(byobRequest);
        }
      }
      return this._pullWithDefaultReader();
    };
    WrappingReadableByteStreamSource2.prototype._pullWithByobRequest = function(byobRequest) {
      var _this = this;
      this._attachByobReader();
      var buffer2 = new Uint8Array(byobRequest.view.byteLength);
      var read3 = this._underlyingReader.read(buffer2).then(function(result) {
        _this._readableStreamController;
        if (result.done) {
          _this._tryClose();
          byobRequest.respond(0);
        } else {
          copyArrayBufferView(result.value, byobRequest.view);
          byobRequest.respond(result.value.byteLength);
        }
      });
      this._setPendingRead(read3);
      return read3;
    };
    return WrappingReadableByteStreamSource2;
  }(AbstractWrappingReadableStreamSource)
);
var WrappingWritableStreamSink = (
  /** @class */
  function() {
    function WrappingWritableStreamSink2(underlyingWriter) {
      var _this = this;
      this._writableStreamController = void 0;
      this._pendingWrite = void 0;
      this._state = "writable";
      this._storedError = void 0;
      this._underlyingWriter = underlyingWriter;
      this._errorPromise = new Promise(function(resolve, reject) {
        _this._errorPromiseReject = reject;
      });
      this._errorPromise.catch(noop2);
    }
    WrappingWritableStreamSink2.prototype.start = function(controller) {
      var _this = this;
      this._writableStreamController = controller;
      this._underlyingWriter.closed.then(function() {
        _this._state = "closed";
      }).catch(function(reason) {
        return _this._finishErroring(reason);
      });
    };
    WrappingWritableStreamSink2.prototype.write = function(chunk) {
      var _this = this;
      var writer = this._underlyingWriter;
      if (writer.desiredSize === null) {
        return writer.ready;
      }
      var writeRequest = writer.write(chunk);
      writeRequest.catch(function(reason) {
        return _this._finishErroring(reason);
      });
      writer.ready.catch(function(reason) {
        return _this._startErroring(reason);
      });
      var write3 = Promise.race([writeRequest, this._errorPromise]);
      this._setPendingWrite(write3);
      return write3;
    };
    WrappingWritableStreamSink2.prototype.close = function() {
      var _this = this;
      if (this._pendingWrite === void 0) {
        return this._underlyingWriter.close();
      }
      return this._finishPendingWrite().then(function() {
        return _this.close();
      });
    };
    WrappingWritableStreamSink2.prototype.abort = function(reason) {
      if (this._state === "errored") {
        return void 0;
      }
      var writer = this._underlyingWriter;
      return writer.abort(reason);
    };
    WrappingWritableStreamSink2.prototype._setPendingWrite = function(writePromise) {
      var _this = this;
      var pendingWrite;
      var finishWrite = function() {
        if (_this._pendingWrite === pendingWrite) {
          _this._pendingWrite = void 0;
        }
      };
      this._pendingWrite = pendingWrite = writePromise.then(finishWrite, finishWrite);
    };
    WrappingWritableStreamSink2.prototype._finishPendingWrite = function() {
      var _this = this;
      if (this._pendingWrite === void 0) {
        return Promise.resolve();
      }
      var afterWrite = function() {
        return _this._finishPendingWrite();
      };
      return this._pendingWrite.then(afterWrite, afterWrite);
    };
    WrappingWritableStreamSink2.prototype._startErroring = function(reason) {
      var _this = this;
      if (this._state === "writable") {
        this._state = "erroring";
        this._storedError = reason;
        var afterWrite = function() {
          return _this._finishErroring(reason);
        };
        if (this._pendingWrite === void 0) {
          afterWrite();
        } else {
          this._finishPendingWrite().then(afterWrite, afterWrite);
        }
        this._writableStreamController.error(reason);
      }
    };
    WrappingWritableStreamSink2.prototype._finishErroring = function(reason) {
      if (this._state === "writable") {
        this._startErroring(reason);
      }
      if (this._state === "erroring") {
        this._state = "errored";
        this._errorPromiseReject(this._storedError);
      }
    };
    return WrappingWritableStreamSink2;
  }()
);
var WrappingTransformStreamTransformer = (
  /** @class */
  function() {
    function WrappingTransformStreamTransformer2(reader, writer) {
      var _this = this;
      this._transformStreamController = void 0;
      this._onRead = function(result) {
        if (result.done) {
          return;
        }
        _this._transformStreamController.enqueue(result.value);
        return _this._reader.read().then(_this._onRead);
      };
      this._onError = function(reason) {
        _this._flushReject(reason);
        _this._transformStreamController.error(reason);
        _this._reader.cancel(reason).catch(noop2);
        _this._writer.abort(reason).catch(noop2);
      };
      this._onTerminate = function() {
        _this._flushResolve();
        _this._transformStreamController.terminate();
        var error = new TypeError("TransformStream terminated");
        _this._writer.abort(error).catch(noop2);
      };
      this._reader = reader;
      this._writer = writer;
      this._flushPromise = new Promise(function(resolve, reject) {
        _this._flushResolve = resolve;
        _this._flushReject = reject;
      });
    }
    WrappingTransformStreamTransformer2.prototype.start = function(controller) {
      this._transformStreamController = controller;
      this._reader.read().then(this._onRead).then(this._onTerminate, this._onError);
      var readerClosed = this._reader.closed;
      if (readerClosed) {
        readerClosed.then(this._onTerminate, this._onError);
      }
    };
    WrappingTransformStreamTransformer2.prototype.transform = function(chunk) {
      return this._writer.write(chunk);
    };
    WrappingTransformStreamTransformer2.prototype.flush = function() {
      var _this = this;
      return this._writer.close().then(function() {
        return _this._flushPromise;
      });
    };
    return WrappingTransformStreamTransformer2;
  }()
);

// node_modules/@cloudbase/ai/dist/esm/eventsource_parser/parse.js
function createParser(onParse) {
  var isFirstChunk;
  var buffer2;
  var startingPosition;
  var startingFieldLength;
  var eventId;
  var eventName;
  var data2;
  reset();
  return { feed, reset };
  function reset() {
    isFirstChunk = true;
    buffer2 = "";
    startingPosition = 0;
    startingFieldLength = -1;
    eventId = void 0;
    eventName = void 0;
    data2 = "";
  }
  function feed(chunk) {
    buffer2 = buffer2 ? buffer2 + chunk : chunk;
    if (isFirstChunk && hasBom(buffer2)) {
      buffer2 = buffer2.slice(BOM.length);
    }
    isFirstChunk = false;
    var length = buffer2.length;
    var position = 0;
    var discardTrailingNewline = false;
    while (position < length) {
      if (discardTrailingNewline) {
        if (buffer2[position] === "\n") {
          position += 1;
        }
        discardTrailingNewline = false;
      }
      var lineLength = -1;
      var fieldLength = startingFieldLength;
      var character = void 0;
      for (var index = startingPosition; lineLength < 0 && index < length; index++) {
        character = buffer2[index];
        if (character === ":" && fieldLength < 0) {
          fieldLength = index - position;
        } else if (character === "\r") {
          discardTrailingNewline = true;
          lineLength = index - position;
        } else if (character === "\n") {
          lineLength = index - position;
        }
      }
      if (lineLength < 0) {
        startingPosition = length - position;
        startingFieldLength = fieldLength;
        break;
      } else {
        startingPosition = 0;
        startingFieldLength = -1;
      }
      parseEventStreamLine(buffer2, position, fieldLength, lineLength);
      position += lineLength + 1;
    }
    if (position === length) {
      buffer2 = "";
    } else if (position > 0) {
      buffer2 = buffer2.slice(position);
    }
  }
  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {
    if (lineLength === 0) {
      if (data2.length > 0) {
        onParse({
          type: "event",
          id: eventId,
          event: eventName || void 0,
          data: data2.slice(0, -1)
        });
        data2 = "";
        eventId = void 0;
      }
      eventName = void 0;
      return;
    }
    var noValue = fieldLength < 0;
    var field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));
    var step = 0;
    if (noValue) {
      step = lineLength;
    } else if (lineBuffer[index + fieldLength + 1] === " ") {
      step = fieldLength + 2;
    } else {
      step = fieldLength + 1;
    }
    var position = index + step;
    var valueLength = lineLength - step;
    var value = lineBuffer.slice(position, position + valueLength).toString();
    if (field === "data") {
      data2 += value ? "".concat(value, "\n") : "\n";
    } else if (field === "event") {
      eventName = value;
    } else if (field === "id" && !value.includes("\0")) {
      eventId = value;
    } else if (field === "retry") {
      var retry = parseInt(value, 10);
      if (!Number.isNaN(retry)) {
        onParse({ type: "reconnect-interval", value: retry });
      }
    }
  }
}
var BOM = [239, 187, 191];
function hasBom(buffer2) {
  return BOM.every(function(charCode, index) {
    return buffer2.charCodeAt(index) === charCode;
  });
}

// node_modules/@cloudbase/ai/dist/esm/utils.js
var import_text_encoding_shim = __toESM(require_text_encoding_shim());
var __awaiter19 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator19 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var __asyncValues = function(o2) {
  if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
  var m2 = o2[Symbol.asyncIterator], i2;
  return m2 ? m2.call(o2) : (o2 = typeof __values === "function" ? __values(o2) : o2[Symbol.iterator](), i2 = {}, verb("next"), verb("throw"), verb("return"), i2[Symbol.asyncIterator] = function() {
    return this;
  }, i2);
  function verb(n3) {
    i2[n3] = o2[n3] && function(v2) {
      return new Promise(function(resolve, reject) {
        v2 = o2[n3](v2), settle(resolve, reject, v2.done, v2.value);
      });
    };
  }
  function settle(resolve, reject, d2, v2) {
    Promise.resolve(v2).then(function(v3) {
      resolve({ value: v3, done: d2 });
    }, reject);
  }
};
var ReadableStream2 = ReadableStream;
var TransformStream2 = TransformStream;
var createEventSourceParserTransformStream = function() {
  var parser;
  return new TransformStream2({
    start: function(controller) {
      parser = createParser(function(event) {
        if (event.type === "event") {
          controller.enqueue(event);
        }
      });
    },
    transform: function(chunk) {
      parser.feed(chunk);
    }
  });
};
var toPolyfillReadable = createReadableStreamWrapper(ReadableStream2);
var TextDecoderStream = function() {
  function TextDecoderStream2(encoding, options) {
    if (encoding === void 0) {
      encoding = "utf-8";
    }
    if (options === void 0) {
      options = {};
    }
    var _this = this;
    this.transform = new TransformStream2({
      transform: function(chunk, controller) {
        var value = _this.handle.decode(new Uint8Array(chunk), { stream: true });
        if (value) {
          controller.enqueue(value);
        }
      },
      flush: function(controller) {
        var value = _this.handle.decode();
        if (value) {
          controller.enqueue(value);
        }
        controller.terminate();
      }
    });
    this.handle = new import_text_encoding_shim.TextDecoder(encoding, options);
  }
  Object.defineProperty(TextDecoderStream2.prototype, "encoding", {
    get: function() {
      return this.handle.encoding;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(TextDecoderStream2.prototype, "fatal", {
    get: function() {
      return this.handle.fatal;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(TextDecoderStream2.prototype, "ignoreBOM", {
    get: function() {
      return this.handle.ignoreBOM;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(TextDecoderStream2.prototype, "readable", {
    get: function() {
      return this.transform.readable;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(TextDecoderStream2.prototype, "writable", {
    get: function() {
      return this.transform.writable;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(TextDecoderStream2.prototype, Symbol.toStringTag, {
    get: function() {
      return "TextDecoderStream";
    },
    enumerable: false,
    configurable: true
  });
  return TextDecoderStream2;
}();
function createAsyncIterable(stream) {
  var _stream = stream;
  _stream[Symbol.asyncIterator] = function() {
    var reader = stream.getReader();
    return {
      next: function() {
        return __awaiter19(this, void 0, void 0, function() {
          var _a3, done, value;
          return __generator19(this, function(_b) {
            switch (_b.label) {
              case 0:
                return [4, reader.read()];
              case 1:
                _a3 = _b.sent(), done = _a3.done, value = _a3.value;
                return [2, done ? { done: true, value: void 0 } : { done: false, value }];
            }
          });
        });
      }
    };
  };
  return _stream;
}
function intoStandardStream(stream) {
  return createAsyncIterable(stream.pipeThrough(new TextDecoderStream()).pipeThrough(createEventSourceParserTransformStream()).pipeThrough(new TransformStream2({
    transform: function(chunk, controller) {
      try {
        var data2 = JSON.parse(chunk.data);
        controller.enqueue(data2);
      } catch (e3) {
        if (chunk.data !== "[DONE]") {
          console.warn("Error when transforming event source data to json", e3, chunk);
        } else {
          controller.terminate();
        }
      }
    }
  })));
}
function intoTextStream(stream) {
  return createAsyncIterable(toPolyfillReadable(stream).pipeThrough(new TextDecoderStream()));
}
function readableStream2JsonObject(stream) {
  var _a3, e_1, _b, _c;
  return __awaiter19(this, void 0, void 0, function() {
    var s2, total, _d, s_1, s_1_1, chunk, e_1_1;
    return __generator19(this, function(_e2) {
      switch (_e2.label) {
        case 0:
          s2 = intoTextStream(stream);
          total = "";
          _e2.label = 1;
        case 1:
          _e2.trys.push([1, 6, 7, 12]);
          _d = true, s_1 = __asyncValues(s2);
          _e2.label = 2;
        case 2:
          return [4, s_1.next()];
        case 3:
          if (!(s_1_1 = _e2.sent(), _a3 = s_1_1.done, !_a3)) return [3, 5];
          _c = s_1_1.value;
          _d = false;
          try {
            chunk = _c;
            total += chunk;
          } finally {
            _d = true;
          }
          _e2.label = 4;
        case 4:
          return [3, 2];
        case 5:
          return [3, 12];
        case 6:
          e_1_1 = _e2.sent();
          e_1 = { error: e_1_1 };
          return [3, 12];
        case 7:
          _e2.trys.push([7, , 10, 11]);
          if (!(!_d && !_a3 && (_b = s_1.return))) return [3, 9];
          return [4, _b.call(s_1)];
        case 8:
          _e2.sent();
          _e2.label = 9;
        case 9:
          return [3, 11];
        case 10:
          if (e_1) throw e_1.error;
          return [7];
        case 11:
          return [7];
        case 12:
          return [2, JSON.parse(total)];
      }
    });
  });
}
function createPromise() {
  var res;
  var rej;
  var promise = new Promise(function(resolve, reject) {
    res = resolve;
    rej = reject;
  });
  return { promise, res, rej };
}
function isToolCallAssistantMessage(message) {
  var _a3;
  return message.role === "assistant" && "tool_calls" in message && ((_a3 = message.tool_calls) === null || _a3 === void 0 ? void 0 : _a3[0]) != null;
}
function functionToolToModelTool(tool) {
  return {
    type: "function",
    function: {
      description: tool.description,
      name: tool.name,
      parameters: tool.parameters
    }
  };
}

// node_modules/@cloudbase/ai/dist/esm/bot/index.js
var __assign19 = function() {
  __assign19 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign19.apply(this, arguments);
};
var __awaiter20 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator20 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var __rest6 = function(s2, e3) {
  var t3 = {};
  for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e3.indexOf(p2) < 0)
    t3[p2] = s2[p2];
  if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
      if (e3.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
        t3[p2[i2]] = s2[p2[i2]];
    }
  return t3;
};
var Bot = function() {
  function Bot2(req, baseUrl) {
    this.baseUrl = baseUrl;
    var token = arguments[2];
    if (typeof token === "string") {
      this.req = function(_a3) {
        var _b = _a3.headers, headers = _b === void 0 ? {} : _b, rest = __rest6(_a3, ["headers"]);
        return req(__assign19(__assign19({}, rest), { headers: __assign19(__assign19({}, headers), { Authorization: "Bearer ".concat(token) }) }));
      };
    } else {
      this.req = req;
    }
  }
  Bot2.prototype.list = function(props, options) {
    return this.req({
      method: "get",
      url: this.join("bots"),
      data: props,
      timeout: options === null || options === void 0 ? void 0 : options.timeout
    });
  };
  Bot2.prototype.create = function(_a3, options) {
    var botInfo = _a3.botInfo;
    return this.req({
      method: "post",
      url: this.join("bots"),
      data: botInfo,
      timeout: options === null || options === void 0 ? void 0 : options.timeout
    });
  };
  Bot2.prototype.get = function(_a3, options) {
    var botId = _a3.botId;
    return this.req({
      method: "get",
      url: this.join("bots/".concat(botId)),
      timeout: options === null || options === void 0 ? void 0 : options.timeout
    });
  };
  Bot2.prototype.update = function(_a3, options) {
    var botId = _a3.botId, botInfo = _a3.botInfo;
    return this.req({
      method: "PATCH",
      url: this.join("bots/".concat(botId)),
      data: botInfo,
      timeout: options === null || options === void 0 ? void 0 : options.timeout
    });
  };
  Bot2.prototype.delete = function(_a3, options) {
    var botId = _a3.botId;
    return this.req({ method: "delete", url: this.join("bots/".concat(botId)), timeout: options === null || options === void 0 ? void 0 : options.timeout });
  };
  Bot2.prototype.getChatRecords = function(props, options) {
    return this.req({
      method: "get",
      url: this.join("bots/".concat(props.botId, "/records")),
      data: props,
      timeout: options === null || options === void 0 ? void 0 : options.timeout
    });
  };
  Bot2.prototype.sendFeedback = function(_a3, options) {
    var userFeedback = _a3.userFeedback;
    return this.req({
      method: "post",
      url: this.join("bots/".concat(userFeedback.botId, "/feedback")),
      data: userFeedback,
      timeout: options === null || options === void 0 ? void 0 : options.timeout
    });
  };
  Bot2.prototype.getFeedback = function(props, options) {
    return this.req({
      method: "get",
      url: this.join("bots/".concat(props.botId, "/feedback")),
      data: props,
      timeout: options === null || options === void 0 ? void 0 : options.timeout
    });
  };
  Bot2.prototype.uploadFiles = function(props, options) {
    return __awaiter20(this, void 0, void 0, function() {
      return __generator20(this, function(_a3) {
        return [2, this.req({
          method: "post",
          url: this.join("bots/".concat(props.botId, "/files")),
          data: props,
          timeout: options === null || options === void 0 ? void 0 : options.timeout
        })];
      });
    });
  };
  Bot2.prototype.createConversation = function(_a3, options) {
    var botId = _a3.botId, rest = __rest6(_a3, ["botId"]);
    return __awaiter20(this, void 0, void 0, function() {
      return __generator20(this, function(_b) {
        return [2, this.req({
          method: "post",
          url: this.join("bots/".concat(botId, "/conversation")),
          data: rest,
          timeout: options === null || options === void 0 ? void 0 : options.timeout
        })];
      });
    });
  };
  Bot2.prototype.getConversation = function(_a3, options) {
    var _b = _a3.pageSize, pageSize = _b === void 0 ? 10 : _b, _c = _a3.pageNumber, pageNumber = _c === void 0 ? 1 : _c, botId = _a3.botId, rest = __rest6(_a3, ["pageSize", "pageNumber", "botId"]);
    return __awaiter20(this, void 0, void 0, function() {
      var offset, limit;
      return __generator20(this, function(_d) {
        if (pageNumber < 1)
          throw new Error("pageNumber must be greater than 0");
        offset = pageSize * (pageNumber - 1);
        limit = pageSize;
        return [2, this.req({
          method: "get",
          url: this.join("bots/".concat(botId, "/conversation")),
          data: __assign19(__assign19({}, rest), { offset, limit }),
          timeout: options === null || options === void 0 ? void 0 : options.timeout
        })];
      });
    });
  };
  Bot2.prototype.deleteConversation = function(_a3, options) {
    var botId = _a3.botId, conversationId = _a3.conversationId, rest = __rest6(_a3, ["botId", "conversationId"]);
    return __awaiter20(this, void 0, void 0, function() {
      return __generator20(this, function(_b) {
        return [2, this.req({
          method: "delete",
          url: this.join("bots/".concat(botId, "/conversation/").concat(conversationId)),
          data: rest,
          timeout: options === null || options === void 0 ? void 0 : options.timeout
        })];
      });
    });
  };
  Bot2.prototype.speechToText = function(props, options) {
    return __awaiter20(this, void 0, void 0, function() {
      return __generator20(this, function(_a3) {
        return [2, this.req({
          method: "post",
          url: this.join("bots/".concat(props.botId, "/speech-to-text")),
          data: props,
          timeout: options === null || options === void 0 ? void 0 : options.timeout
        })];
      });
    });
  };
  Bot2.prototype.textToSpeech = function(props, options) {
    return __awaiter20(this, void 0, void 0, function() {
      return __generator20(this, function(_a3) {
        return [2, this.req({
          method: "post",
          url: this.join("bots/".concat(props.botId, "/text-to-speech")),
          data: props,
          timeout: options === null || options === void 0 ? void 0 : options.timeout
        })];
      });
    });
  };
  Bot2.prototype.getTextToSpeechResult = function(props, options) {
    return __awaiter20(this, void 0, void 0, function() {
      return __generator20(this, function(_a3) {
        return [2, this.req({
          method: "get",
          url: this.join("bots/".concat(props.botId, "/text-to-speech")),
          data: props,
          timeout: options === null || options === void 0 ? void 0 : options.timeout
        })];
      });
    });
  };
  Bot2.prototype.getRecommendQuestions = function(props, options) {
    return __awaiter20(this, void 0, void 0, function() {
      var res;
      return __generator20(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              method: "post",
              url: this.join("bots/".concat(props.botId, "/recommend-questions")),
              data: props,
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, new StreamResult(res)];
        }
      });
    });
  };
  Bot2.prototype.generateBot = function(props, options) {
    return __awaiter20(this, void 0, void 0, function() {
      var res;
      return __generator20(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              method: "post",
              url: this.join("generate-bot"),
              data: props,
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, new StreamResult(res)];
        }
      });
    });
  };
  Bot2.prototype.getPreview = function(props, options) {
    return __awaiter20(this, void 0, void 0, function() {
      var res;
      return __generator20(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              method: "post",
              url: this.join("preview"),
              data: props,
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, new StreamResult(res)];
        }
      });
    });
  };
  Bot2.prototype.generateImage = function(props, options) {
    return this.req({ method: "post", url: this.join("generate-image"), data: props, timeout: options === null || options === void 0 ? void 0 : options.timeout });
  };
  Bot2.prototype.sendMessage = function(props, options) {
    return __awaiter20(this, void 0, void 0, function() {
      var res;
      return __generator20(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              method: "post",
              url: this.join("bots/".concat(props.botId, "/send-message")),
              data: props,
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, new StreamResult(res)];
        }
      });
    });
  };
  Bot2.prototype.join = function(url2) {
    return "".concat(this.baseUrl, "/").concat(url2);
  };
  return Bot2;
}();
var StreamResult = function() {
  function StreamResult2(_stream) {
    var stream = toPolyfillReadable(_stream);
    this._eventSourceStream = stream.pipeThrough(new TextDecoderStream()).pipeThrough(createEventSourceParserTransformStream());
  }
  Object.defineProperty(StreamResult2.prototype, "teeedStream", {
    get: function() {
      var _a3 = this._eventSourceStream.tee(), s1 = _a3[0], s2 = _a3[1];
      this._eventSourceStream = s2;
      return s1;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(StreamResult2.prototype, "eventSourceStream", {
    get: function() {
      return createAsyncIterable(this.teeedStream);
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(StreamResult2.prototype, "dataStream", {
    get: function() {
      return createAsyncIterable(this.eventSourceStream.pipeThrough(new TransformStream2({
        transform: function(chunk, controller) {
          try {
            var data2 = JSON.parse(chunk.data);
            controller.enqueue(data2);
          } catch (e3) {
            if (chunk.data !== "[DONE]") {
              console.warn("Error when transforming event source data to json", e3, chunk);
            } else {
              controller.terminate();
            }
          }
        }
      })));
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(StreamResult2.prototype, "textStream", {
    get: function() {
      return createAsyncIterable(this.dataStream.pipeThrough(new TransformStream2({
        transform: function(chunk, controller) {
          var _a3;
          controller.enqueue((_a3 = chunk === null || chunk === void 0 ? void 0 : chunk.content) !== null && _a3 !== void 0 ? _a3 : "");
        }
      })));
    },
    enumerable: false,
    configurable: true
  });
  return StreamResult2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/index.js
var models_exports2 = {};
__export(models_exports2, {
  ArkSimpleModel: () => ArkSimpleModel,
  DSSimpleModel: () => DSSimpleModel,
  DefaultImageModel: () => DefaultImageModel,
  DefaultSimpleModel: () => DefaultSimpleModel,
  HunYuanBetaSimpleModel: () => HunYuanBetaSimpleModel,
  HunYuanExpSimpleModel: () => HunYuanExpSimpleModel,
  HunYuanOpenSimpleModel: () => HunYuanOpenSimpleModel,
  HunYuanSimpleModel: () => HunYuanSimpleModel,
  MODELS: () => MODELS,
  MoonshotSimpleModel: () => MoonshotSimpleModel,
  ReactModel: () => ReactModel,
  YiSimpleModel: () => YiSimpleModel,
  ZhiPuSimpleModel: () => ZhiPuSimpleModel,
  toolMap: () => toolMap
});

// node_modules/@cloudbase/ai/dist/esm/models/ZhiPu/index.js
var __assign20 = function() {
  __assign20 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign20.apply(this, arguments);
};
var __awaiter21 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator21 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
function processInput(input) {
  var messages = input.messages, model = input.model, temperature = input.temperature, tool_choice = input.tool_choice, tools = input.tools, top_p = input.top_p;
  var processToolChoice = function() {
    if (tool_choice && tool_choice !== "auto") {
      console.warn("`tool_choice` is not 'auto'");
    }
    return tool_choice;
  };
  return __assign20(__assign20({}, input), { messages, model, temperature, tool_choice: processToolChoice(), tools, top_p });
}
var ZhiPuSimpleModel = function() {
  function ZhiPuSimpleModel2(req, baseUrl, subUrl) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = "zhipu/api/paas/v4/chat/completions";
    if (subUrl != null) {
      this.subUrl = subUrl;
    }
  }
  Object.defineProperty(ZhiPuSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  ZhiPuSimpleModel2.prototype.doGenerate = function(_data, options) {
    return __awaiter21(this, void 0, void 0, function() {
      var data2, res;
      return __generator21(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            data2 = processInput(_data);
            return [4, this.req({
              url: this.url,
              data: __assign20(__assign20({}, data2), { stream: false }),
              stream: false,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, __assign20(__assign20({}, res), { rawResponse: res })];
        }
      });
    });
  };
  ZhiPuSimpleModel2.prototype.doStream = function(_data, options) {
    return __awaiter21(this, void 0, void 0, function() {
      var data2, isToolCall, _stream, stream, zhipuStream, streamWithRaw;
      return __generator21(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            data2 = processInput(_data);
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              data: __assign20(__assign20({}, data2), { stream: true }),
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            zhipuStream = intoStandardStream(stream);
            streamWithRaw = zhipuStream.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var newChoices = chunk.choices.map(function(choice) {
                  var message = choice.delta;
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign20(__assign20({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return choice;
                });
                var newChunk = __assign20(__assign20({}, chunk), { choices: newChoices });
                controller.enqueue(__assign20(__assign20({}, newChunk), { rawResponse: chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return ZhiPuSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/HunYuan/util.js
var __assign21 = function() {
  __assign21 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign21.apply(this, arguments);
};
function processInput2(input) {
  var messages = input.messages, model = input.model, temperature = input.temperature, tool_choice = input.tool_choice, tools = input.tools, top_p = input.top_p;
  var handleTools = function() {
    if (!tools)
      return void 0;
    tools.forEach(function(tool) {
      if (tool.type !== "function")
        console.warn("`type` in tool is not 'function'", tool);
    });
    return tools;
  };
  var handleMessages = function() {
    messages.forEach(function(message) {
      if ("tool_calls" in message) {
        message.tool_calls.filter(function(tool_call) {
          return tool_call.type !== "function";
        }).forEach(function(tool_call) {
          return console.warn("`type` in tool_call is not 'function'", tool_call, message);
        });
      }
    });
    return messages;
  };
  return __assign21(__assign21({}, input), { messages: handleMessages(), model, tools: handleTools(), top_p, tool_choice, temperature });
}
function titleCaseToSnakeCase(obj) {
  if (typeof obj !== "object" || obj == null)
    return obj;
  if (Array.isArray(obj))
    return obj.map(function(item) {
      return titleCaseToSnakeCase(item);
    });
  return Object.entries(obj).reduce(function(acc, _a3) {
    var key = _a3[0], value = _a3[1];
    var snakeCaseKey = toSnakeCase(key);
    acc[snakeCaseKey] = typeof value === "object" ? titleCaseToSnakeCase(value) : value;
    return acc;
  }, {});
  function toSnakeCase(s2) {
    var ret = s2.replace(/[A-Z]/g, function(match2) {
      return "_".concat(match2.toLowerCase());
    });
    return ret.charAt(0) === "_" ? ret.slice(1) : ret;
  }
}

// node_modules/@cloudbase/ai/dist/esm/models/HunYuanBeta/index.js
var __assign22 = function() {
  __assign22 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign22.apply(this, arguments);
};
var __awaiter22 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator22 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var HunYuanBetaSimpleModel = function() {
  function HunYuanBetaSimpleModel2(req, baseUrl, subUrl) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = "hunyuan-beta/openapi/v1/chat/completions";
    if (subUrl != null) {
      this.subUrl = subUrl;
    }
  }
  Object.defineProperty(HunYuanBetaSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  HunYuanBetaSimpleModel2.prototype.doGenerate = function(data2, options) {
    return __awaiter22(this, void 0, void 0, function() {
      var res;
      return __generator22(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              url: this.url,
              data: __assign22(__assign22({}, processInput2(data2)), { stream: false }),
              stream: false,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, __assign22(__assign22({}, res), { rawResponse: res })];
        }
      });
    });
  };
  HunYuanBetaSimpleModel2.prototype.doStream = function(data2, options) {
    return __awaiter22(this, void 0, void 0, function() {
      var isToolCall, _stream, stream, hunyuanBetaStream, streamWithRaw;
      return __generator22(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              data: __assign22(__assign22({}, processInput2(data2)), { stream: true }),
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            hunyuanBetaStream = intoStandardStream(stream);
            streamWithRaw = hunyuanBetaStream.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var newChoices = chunk.choices.map(function(choice) {
                  var message = choice.delta;
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign22(__assign22({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return choice;
                });
                var newChunk = __assign22(__assign22({}, chunk), { choices: newChoices });
                controller.enqueue(__assign22(__assign22({}, newChunk), { rawResponse: chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return HunYuanBetaSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/HunYuan/index.js
var __assign23 = function() {
  __assign23 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign23.apply(this, arguments);
};
var __awaiter23 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator23 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var HunYuanSimpleModel = function() {
  function HunYuanSimpleModel2(req, baseUrl, subUrl) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = "hunyuan";
    if (subUrl != null) {
      this.subUrl = subUrl;
    }
  }
  Object.defineProperty(HunYuanSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  HunYuanSimpleModel2.prototype.doGenerate = function(data2, options) {
    return __awaiter23(this, void 0, void 0, function() {
      var res, output;
      return __generator23(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              url: this.url,
              headers: {
                "X-Tc-Action": "ChatCompletions"
              },
              data: __assign23(__assign23({}, processInput2(data2)), { stream: false }),
              stream: false,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            output = titleCaseToSnakeCase(res.Response);
            return [2, __assign23(__assign23({}, output), { rawResponse: res })];
        }
      });
    });
  };
  HunYuanSimpleModel2.prototype.doStream = function(data2, options) {
    return __awaiter23(this, void 0, void 0, function() {
      var isToolCall, _stream, stream, hunyuanStream, streamWithRaw;
      return __generator23(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              headers: {
                "X-Tc-Action": "ChatCompletions"
              },
              data: __assign23(__assign23({}, data2), { stream: true }),
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            hunyuanStream = intoStandardStream(stream);
            streamWithRaw = hunyuanStream.pipeThrough(new TransformStream2({
              transform: function(_chunk, controller) {
                var chunk = titleCaseToSnakeCase(_chunk);
                var newChoices = chunk.choices.map(function(choice) {
                  var message = choice.delta;
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign23(__assign23({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return choice;
                });
                var newChunk = __assign23(__assign23({}, chunk), { choices: newChoices });
                controller.enqueue(__assign23(__assign23({}, newChunk), { rawResponse: _chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return HunYuanSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/Ark/index.js
var __assign24 = function() {
  __assign24 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign24.apply(this, arguments);
};
var __awaiter24 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator24 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
function processInput3(input) {
  var messages = input.messages, model = input.model, temperature = input.temperature, tools = input.tools, top_p = input.top_p;
  return __assign24(__assign24({}, input), { messages, model, tools, top_p, temperature });
}
var ArkSimpleModel = function() {
  function ArkSimpleModel2(req, baseUrl, subUrl) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = "ark/api/v3/chat/completions";
    if (subUrl != null) {
      this.subUrl = subUrl;
    }
  }
  Object.defineProperty(ArkSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  ArkSimpleModel2.prototype.doGenerate = function(data2, options) {
    return __awaiter24(this, void 0, void 0, function() {
      var res;
      return __generator24(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              url: this.url,
              data: __assign24(__assign24({}, processInput3(data2)), { stream: false }),
              stream: false,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, __assign24(__assign24({}, res), { rawResponse: res })];
        }
      });
    });
  };
  ArkSimpleModel2.prototype.doStream = function(data2, options) {
    return __awaiter24(this, void 0, void 0, function() {
      var isToolCall, _stream, stream, arkStream, streamWithRaw;
      return __generator24(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              data: __assign24(__assign24({}, processInput3(data2)), { stream: true }),
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            arkStream = intoStandardStream(stream);
            streamWithRaw = arkStream.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var newChoices = chunk.choices.map(function(choice) {
                  var message = choice.delta;
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign24(__assign24({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return choice;
                });
                var newChunk = __assign24(__assign24({}, chunk), { choices: newChoices });
                controller.enqueue(__assign24(__assign24({}, newChunk), { rawResponse: chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return ArkSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/DashScope/index.js
var __assign25 = function() {
  __assign25 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign25.apply(this, arguments);
};
var __awaiter25 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator25 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
function processInput4(input) {
  var messages = input.messages, model = input.model, temperature = input.temperature, tools = input.tools, top_p = input.top_p;
  return __assign25(__assign25({}, input), { messages, model, tools, top_p, temperature });
}
var DSSimpleModel = function() {
  function DSSimpleModel2(req, baseUrl, subUrl) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = "dashscope/compatible-mode/v1/chat/completions";
    if (subUrl != null) {
      this.subUrl = subUrl;
    }
  }
  Object.defineProperty(DSSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  DSSimpleModel2.prototype.doGenerate = function(data2, options) {
    return __awaiter25(this, void 0, void 0, function() {
      var res;
      return __generator25(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              url: this.url,
              data: __assign25(__assign25({}, processInput4(data2)), { stream: false }),
              stream: false,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, __assign25(__assign25({}, res), { rawResponse: res })];
        }
      });
    });
  };
  DSSimpleModel2.prototype.doStream = function(data2, options) {
    return __awaiter25(this, void 0, void 0, function() {
      var isToolCall, _stream, stream, arkStream, streamWithRaw;
      return __generator25(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              data: __assign25(__assign25({}, processInput4(data2)), { stream: true }),
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            arkStream = intoStandardStream(stream);
            streamWithRaw = arkStream.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var newChoices = chunk.choices.map(function(choice) {
                  var message = Object.assign(choice.delta, { role: "assistant" });
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign25(__assign25({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return __assign25(__assign25({}, choice), { delta: message });
                });
                var newChunk = __assign25(__assign25({}, chunk), { choices: newChoices });
                controller.enqueue(__assign25(__assign25({}, newChunk), { rawResponse: chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return DSSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/Yi/index.js
var __assign26 = function() {
  __assign26 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign26.apply(this, arguments);
};
var __awaiter26 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator26 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
function processInput5(input) {
  var messages = input.messages, model = input.model, temperature = input.temperature, tools = input.tools, top_p = input.top_p;
  return __assign26(__assign26({}, input), { messages, model, tools, top_p, temperature });
}
var YiSimpleModel = function() {
  function YiSimpleModel2(req, baseUrl, subUrl) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = "01-ai/v1/chat/completions";
    if (subUrl != null) {
      this.subUrl = subUrl;
    }
  }
  Object.defineProperty(YiSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  YiSimpleModel2.prototype.doGenerate = function(data2, options) {
    return __awaiter26(this, void 0, void 0, function() {
      var res;
      return __generator26(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              url: this.url,
              data: __assign26(__assign26({}, processInput5(data2)), { stream: false }),
              stream: false,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, __assign26(__assign26({}, res), { rawResponse: res })];
        }
      });
    });
  };
  YiSimpleModel2.prototype.doStream = function(data2, options) {
    return __awaiter26(this, void 0, void 0, function() {
      var isToolCall, _stream, stream, arkStream, streamWithRaw;
      return __generator26(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              data: __assign26(__assign26({}, processInput5(data2)), { stream: true }),
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            arkStream = intoStandardStream(stream);
            streamWithRaw = arkStream.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var _a4, _b, _c, _d, _e2, _f;
                if (!(((_c = (_b = (_a4 = chunk === null || chunk === void 0 ? void 0 : chunk.choices) === null || _a4 === void 0 ? void 0 : _a4[0]) === null || _b === void 0 ? void 0 : _b.delta) === null || _c === void 0 ? void 0 : _c.content) || ((_f = (_e2 = (_d = chunk === null || chunk === void 0 ? void 0 : chunk.choices) === null || _d === void 0 ? void 0 : _d[0]) === null || _e2 === void 0 ? void 0 : _e2.delta) === null || _f === void 0 ? void 0 : _f.tool_calls)))
                  return;
                var newChoices = chunk.choices.map(function(choice) {
                  var message = Object.assign(choice.delta, { role: "assistant" });
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign26(__assign26({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return __assign26(__assign26({}, choice), { delta: message });
                });
                var newChunk = __assign26(__assign26({}, chunk), { choices: newChoices });
                controller.enqueue(__assign26(__assign26({}, newChunk), { rawResponse: chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return YiSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/Moonshot/index.js
var __assign27 = function() {
  __assign27 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign27.apply(this, arguments);
};
var __awaiter27 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator27 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
function processInput6(input) {
  var messages = input.messages, model = input.model, temperature = input.temperature, tools = input.tools, top_p = input.top_p;
  return __assign27(__assign27({}, input), { messages, model, tools, top_p, temperature });
}
var MoonshotSimpleModel = function() {
  function MoonshotSimpleModel2(req, baseUrl, subUrl) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = "moonshot/v1/chat/completions";
    if (subUrl != null) {
      this.subUrl = subUrl;
    }
  }
  Object.defineProperty(MoonshotSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  MoonshotSimpleModel2.prototype.doGenerate = function(data2, options) {
    return __awaiter27(this, void 0, void 0, function() {
      var res;
      return __generator27(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              url: this.url,
              data: __assign27(__assign27({}, processInput6(data2)), { stream: false }),
              stream: false,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, __assign27(__assign27({}, res), { rawResponse: res })];
        }
      });
    });
  };
  MoonshotSimpleModel2.prototype.doStream = function(data2, options) {
    return __awaiter27(this, void 0, void 0, function() {
      var isToolCall, _stream, stream, arkStream, streamWithRaw;
      return __generator27(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              data: __assign27(__assign27({}, processInput6(data2)), { stream: true }),
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            arkStream = intoStandardStream(stream);
            streamWithRaw = arkStream.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var newChoices = chunk.choices.map(function(choice) {
                  var message = choice.delta;
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign27(__assign27({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return choice;
                });
                var newChunk = __assign27(__assign27({}, chunk), { choices: newChoices });
                controller.enqueue(__assign27(__assign27({}, newChunk), { rawResponse: chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return MoonshotSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/HunYuanExp/index.js
var __assign28 = function() {
  __assign28 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign28.apply(this, arguments);
};
var __awaiter28 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator28 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var HunYuanExpSimpleModel = function() {
  function HunYuanExpSimpleModel2(req, baseUrl, subUrl) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = "hunyuan-exp/chat/completions";
    if (subUrl != null) {
      this.subUrl = subUrl;
    }
  }
  Object.defineProperty(HunYuanExpSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  HunYuanExpSimpleModel2.prototype.doGenerate = function(data2) {
    return __awaiter28(this, void 0, void 0, function() {
      var res;
      return __generator28(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              url: this.url,
              data: __assign28(__assign28({}, processInput2(data2)), { stream: false }),
              stream: false
            })];
          case 1:
            res = _a3.sent();
            return [2, __assign28(__assign28({}, res), { rawResponse: res })];
        }
      });
    });
  };
  HunYuanExpSimpleModel2.prototype.doStream = function(data2) {
    return __awaiter28(this, void 0, void 0, function() {
      var isToolCall, _stream, stream, hunyuanBetaStream, streamWithRaw;
      return __generator28(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              data: __assign28(__assign28({}, processInput2(data2)), { stream: true }),
              stream: true
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            hunyuanBetaStream = intoStandardStream(stream);
            streamWithRaw = hunyuanBetaStream.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var newChoices = chunk.choices.map(function(choice) {
                  var message = choice.delta;
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign28(__assign28({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return choice;
                });
                var newChunk = __assign28(__assign28({}, chunk), { choices: newChoices });
                controller.enqueue(__assign28(__assign28({}, newChunk), { rawResponse: chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return HunYuanExpSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/HunYuanOpen/index.js
var __assign29 = function() {
  __assign29 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign29.apply(this, arguments);
};
var __awaiter29 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator29 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var HunYuanOpenSimpleModel = function() {
  function HunYuanOpenSimpleModel2(req, baseUrl, subUrl) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = "hunyuan-open/v1/chat/completions";
    if (subUrl != null) {
      this.subUrl = subUrl;
    }
  }
  Object.defineProperty(HunYuanOpenSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  HunYuanOpenSimpleModel2.prototype.doGenerate = function(data2, options) {
    return __awaiter29(this, void 0, void 0, function() {
      var res;
      return __generator29(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              url: this.url,
              data: __assign29(__assign29({}, processInput2(data2)), { stream: false }),
              stream: false,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, __assign29(__assign29({}, res), { rawResponse: res })];
        }
      });
    });
  };
  HunYuanOpenSimpleModel2.prototype.doStream = function(data2, options) {
    return __awaiter29(this, void 0, void 0, function() {
      var isToolCall, _stream, stream, hunyuanBetaStream, streamWithRaw;
      return __generator29(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              data: __assign29(__assign29({}, processInput2(data2)), { stream: true }),
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            hunyuanBetaStream = intoStandardStream(stream);
            streamWithRaw = hunyuanBetaStream.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var newChoices = chunk.choices.map(function(choice) {
                  var message = choice.delta;
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign29(__assign29({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return choice;
                });
                var newChunk = __assign29(__assign29({}, chunk), { choices: newChoices });
                controller.enqueue(__assign29(__assign29({}, newChunk), { rawResponse: chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return HunYuanOpenSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/DeepSeek/index.js
var __assign30 = function() {
  __assign30 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign30.apply(this, arguments);
};
var __awaiter30 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator30 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var DeepSeekSimpleModel = function() {
  function DeepSeekSimpleModel2(req, baseUrl, subUrl) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = "deepseek/chat/completions";
    if (subUrl != null) {
      this.subUrl = subUrl;
    }
  }
  Object.defineProperty(DeepSeekSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  DeepSeekSimpleModel2.prototype.doGenerate = function(data2, options) {
    return __awaiter30(this, void 0, void 0, function() {
      var res;
      return __generator30(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              url: this.url,
              data: __assign30(__assign30({}, data2), { stream: false }),
              stream: false,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            res = _a3.sent();
            return [2, __assign30(__assign30({}, res), { rawResponse: res })];
        }
      });
    });
  };
  DeepSeekSimpleModel2.prototype.doStream = function(data2, options) {
    return __awaiter30(this, void 0, void 0, function() {
      var isToolCall, _stream, stream, standardStream, streamWithRaw;
      return __generator30(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              data: __assign30(__assign30({}, data2), { stream: true }),
              stream: true,
              timeout: options === null || options === void 0 ? void 0 : options.timeout
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            standardStream = intoStandardStream(stream);
            streamWithRaw = standardStream.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var newChoices = chunk.choices.map(function(choice) {
                  var message = choice.delta;
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign30(__assign30({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return choice;
                });
                var newChunk = __assign30(__assign30({}, chunk), { choices: newChoices });
                controller.enqueue(__assign30(__assign30({}, newChunk), { rawResponse: chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return DeepSeekSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/Default/index.js
var __assign31 = function() {
  __assign31 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign31.apply(this, arguments);
};
var __awaiter31 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator31 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var DefaultSimpleModel = function() {
  function DefaultSimpleModel2(req, baseUrl, subUrl) {
    if (subUrl === void 0) {
      subUrl = "";
    }
    this.req = req;
    this.baseUrl = baseUrl;
    this.subUrl = subUrl;
  }
  Object.defineProperty(DefaultSimpleModel2.prototype, "url", {
    get: function() {
      return "".concat(this.baseUrl, "/").concat(this.subUrl);
    },
    enumerable: false,
    configurable: true
  });
  DefaultSimpleModel2.prototype.doGenerate = function(data2) {
    return __awaiter31(this, void 0, void 0, function() {
      var res;
      return __generator31(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this.req({
              url: this.url,
              data: __assign31(__assign31({}, data2), { stream: false }),
              stream: false
            })];
          case 1:
            res = _a3.sent();
            return [2, __assign31(__assign31({}, res), { rawResponse: res })];
        }
      });
    });
  };
  DefaultSimpleModel2.prototype.doStream = function(data2) {
    return __awaiter31(this, void 0, void 0, function() {
      var isToolCall, _stream, stream, standardStream, streamWithRaw;
      return __generator31(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            isToolCall = null;
            return [4, this.req({
              url: this.url,
              data: __assign31(__assign31({}, data2), { stream: true }),
              stream: true
            })];
          case 1:
            _stream = _a3.sent();
            stream = toPolyfillReadable(_stream);
            standardStream = intoStandardStream(stream);
            streamWithRaw = standardStream.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var newChoices = chunk.choices.map(function(choice) {
                  var message = choice.delta;
                  if (isToolCall == null)
                    isToolCall = isToolCallAssistantMessage(message);
                  if (isToolCall) {
                    return __assign31(__assign31({}, choice), { finish_reason: "tool_calls", delta: message });
                  }
                  return choice;
                });
                var newChunk = __assign31(__assign31({}, chunk), { choices: newChoices });
                controller.enqueue(__assign31(__assign31({}, newChunk), { rawResponse: chunk }));
              }
            }));
            return [2, createAsyncIterable(streamWithRaw)];
        }
      });
    });
  };
  return DefaultSimpleModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/image-model.js
var __awaiter32 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator32 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var DefaultImageModel = function() {
  function DefaultImageModel2(req, baseUrl, provider) {
    this.req = req;
    this.baseUrl = baseUrl;
    this.provider = provider;
    this.defaultGenerateImageSubUrl = "images/generations";
    this.generateImageSubUrlConfig = {
      "hunyuan-image": {
        "hunyuan-image-v3.0-v1.0.4": "images/ar/generations",
        "hunyuan-image-v3.0-v1.0.1": "images/ar/generations"
      }
    };
    this.generateImage = this.generateImageImpl.bind(this);
  }
  DefaultImageModel2.prototype.generateImageImpl = function(input) {
    var _a3;
    return __awaiter32(this, void 0, void 0, function() {
      var subUrl, newSubUrl, res;
      return __generator32(this, function(_b) {
        switch (_b.label) {
          case 0:
            subUrl = this.defaultGenerateImageSubUrl;
            if (typeof input === "object" && input && "model" in input && typeof input.model === "string") {
              newSubUrl = (_a3 = this.generateImageSubUrlConfig[this.provider]) === null || _a3 === void 0 ? void 0 : _a3[input.model];
              if (newSubUrl)
                subUrl = newSubUrl;
            }
            return [4, this.req({
              url: this.getGenerateUrl(subUrl),
              data: input,
              stream: false
            })];
          case 1:
            res = _b.sent();
            return [2, res];
        }
      });
    });
  };
  DefaultImageModel2.prototype.getGenerateUrl = function(subUrl) {
    return "".concat(this.baseUrl, "/").concat(this.provider, "/").concat(subUrl);
  };
  return DefaultImageModel2;
}();

// node_modules/@cloudbase/ai/dist/esm/models/model.js
var __assign32 = function() {
  __assign32 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign32.apply(this, arguments);
};
var __awaiter33 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator33 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var __rest7 = function(s2, e3) {
  var t3 = {};
  for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e3.indexOf(p2) < 0)
    t3[p2] = s2[p2];
  if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
      if (e3.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
        t3[p2[i2]] = s2[p2[i2]];
    }
  return t3;
};
var __asyncValues2 = function(o2) {
  if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
  var m2 = o2[Symbol.asyncIterator], i2;
  return m2 ? m2.call(o2) : (o2 = typeof __values === "function" ? __values(o2) : o2[Symbol.iterator](), i2 = {}, verb("next"), verb("throw"), verb("return"), i2[Symbol.asyncIterator] = function() {
    return this;
  }, i2);
  function verb(n3) {
    i2[n3] = o2[n3] && function(v2) {
      return new Promise(function(resolve, reject) {
        v2 = o2[n3](v2), settle(resolve, reject, v2.done, v2.value);
      });
    };
  }
  function settle(resolve, reject, d2, v2) {
    Promise.resolve(v2).then(function(v3) {
      resolve({ value: v3, done: d2 });
    }, reject);
  }
};
var __spreadArray4 = function(to2, from2, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from2.length, ar2; i2 < l2; i2++) {
    if (ar2 || !(i2 in from2)) {
      if (!ar2) ar2 = Array.prototype.slice.call(from2, 0, i2);
      ar2[i2] = from2[i2];
    }
  }
  return to2.concat(ar2 || Array.prototype.slice.call(from2));
};
function processInput7(obj) {
  var _a3;
  var onStepFinish = obj.onStepFinish, abortSignal = obj.abortSignal, maxSteps = obj.maxSteps, topP = obj.topP, toolChoice = obj.toolChoice, b2 = __rest7(obj, ["onStepFinish", "abortSignal", "maxSteps", "topP", "toolChoice"]);
  if (maxSteps != null && maxSteps < 1) {
    throw new Error("`maxSteps` muse be greater than 0.");
  }
  return [
    { onStepFinish, abortSignal, maxSteps },
    __assign32(__assign32({}, b2), { tools: (_a3 = b2.tools) === null || _a3 === void 0 ? void 0 : _a3.map(function(tool) {
      if ("fn" in tool) {
        return functionToolToModelTool(tool);
      }
      return tool;
    }), top_p: topP != null ? topP : b2.top_p, tool_choice: toolChoice != null ? toolChoice : b2.tool_choice })
  ];
}
var ReactModel = function() {
  function ReactModel2(model) {
    this.model = model;
  }
  ReactModel2.prototype.generateText = function(_input, options) {
    var _a3, _b;
    return __awaiter33(this, void 0, void 0, function() {
      var rawResponses, totalUsage, _c, _d, onStepFinish, _e2, maxSteps, input, doGenerate, currentRes, currentStep, toolCall, stepUsage_1, toolCallResult, choice, e_1, lastChoice, lastMessage, text, messages, stepUsage;
      var _this = this;
      return __generator33(this, function(_f) {
        switch (_f.label) {
          case 0:
            rawResponses = [];
            totalUsage = { completion_tokens: 0, prompt_tokens: 0, total_tokens: 0 };
            _c = processInput7(_input), _d = _c[0], onStepFinish = _d.onStepFinish, _e2 = _d.maxSteps, maxSteps = _e2 === void 0 ? 10 : _e2, input = _c[1];
            doGenerate = function() {
              return _this.model.doGenerate(input, options);
            };
            return [4, doGenerate()];
          case 1:
            currentRes = _f.sent();
            currentStep = 1;
            currentRes.rawResponse && rawResponses.push(currentRes.rawResponse);
            toolCall = null;
            _f.label = 2;
          case 2:
            if (!(currentStep < maxSteps && (toolCall = getToolCallFromGenerate(currentRes)) != null)) return [3, 9];
            stepUsage_1 = createSolidUsage(currentRes.usage);
            addToUsage(totalUsage, stepUsage_1);
            _f.label = 3;
          case 3:
            _f.trys.push([3, 7, , 8]);
            return [4, callTool(toolCall)];
          case 4:
            toolCallResult = _f.sent();
            choice = currentRes.choices[0];
            return [4, onStepFinish === null || onStepFinish === void 0 ? void 0 : onStepFinish({
              finishReason: choice.finish_reason,
              messages: input.messages.slice(),
              text: choice.message.content,
              toolCall,
              toolResult: toolCallResult,
              stepUsage: stepUsage_1,
              totalUsage: Object.assign({}, totalUsage)
            })];
          case 5:
            _f.sent();
            pushNewMessages(input.messages, choice.message, toolCallResult);
            return [4, doGenerate()];
          case 6:
            currentRes = _f.sent();
            currentRes.rawResponse && rawResponses.push(currentRes.rawResponse);
            currentStep += 1;
            return [3, 8];
          case 7:
            e_1 = _f.sent();
            return [2, {
              text: "",
              messages: input.messages,
              usage: totalUsage,
              error: e_1,
              rawResponses
            }];
          case 8:
            return [3, 2];
          case 9:
            lastChoice = (_a3 = currentRes === null || currentRes === void 0 ? void 0 : currentRes.choices) === null || _a3 === void 0 ? void 0 : _a3[0];
            lastMessage = lastChoice === null || lastChoice === void 0 ? void 0 : lastChoice.message;
            text = (_b = lastMessage === null || lastMessage === void 0 ? void 0 : lastMessage.content) !== null && _b !== void 0 ? _b : "";
            messages = lastMessage ? __spreadArray4(__spreadArray4([], input.messages, true), [lastMessage], false) : input.messages;
            stepUsage = createSolidUsage(currentRes.usage);
            addToUsage(totalUsage, stepUsage);
            return [4, onStepFinish === null || onStepFinish === void 0 ? void 0 : onStepFinish({
              finishReason: lastChoice.finish_reason,
              messages: messages.slice(),
              text,
              toolCall: getToolCallFromGenerate(currentRes),
              toolResult: null,
              stepUsage,
              totalUsage: Object.assign({}, totalUsage)
            })];
          case 10:
            _f.sent();
            return [2, {
              text,
              messages,
              usage: totalUsage,
              rawResponses
            }];
        }
      });
    });
  };
  ReactModel2.prototype.streamText = function(_input, options) {
    var _a3;
    return __awaiter33(this, void 0, void 0, function() {
      var totalUsage, _b, _c, onStepFinish, _d, maxSteps, input, doStream, currentRes, currentStep, readResult, readCurrentStream, _e2, assistantMessage, stepUsage_2, toolCall, toolCallResult, e_2, _f, s1_1, s2_1, message_1, usage, messages, _g, s1_2, s2_2, messagePromise, usagePromise, message, finishReason, stepUsage, originStream, _h, s1, s2;
      var _this = this;
      return __generator33(this, function(_j) {
        switch (_j.label) {
          case 0:
            totalUsage = { completion_tokens: 0, prompt_tokens: 0, total_tokens: 0 };
            _b = processInput7(_input), _c = _b[0], onStepFinish = _c.onStepFinish, _d = _c.maxSteps, maxSteps = _d === void 0 ? 10 : _d, input = _b[1];
            doStream = function() {
              return _this.model.doStream(input, options);
            };
            return [4, doStream()];
          case 1:
            currentRes = _j.sent();
            currentStep = 1;
            readResult = null;
            readCurrentStream = function() {
              var _a4 = currentRes.tee(), oldStream = _a4[0], newStream = _a4[1];
              currentRes = createAsyncIterable(oldStream);
              return readFunctionCallStream(newStream);
            };
            _j.label = 2;
          case 2:
            _e2 = currentStep < maxSteps;
            if (!_e2) return [3, 4];
            return [4, readCurrentStream()];
          case 3:
            _e2 = (readResult = _j.sent()) != null;
            _j.label = 4;
          case 4:
            if (!_e2) return [3, 11];
            assistantMessage = readResult.message, stepUsage_2 = readResult.usage;
            addToUsage(totalUsage, stepUsage_2);
            toolCall = (_a3 = assistantMessage.tool_calls) === null || _a3 === void 0 ? void 0 : _a3[0];
            _j.label = 5;
          case 5:
            _j.trys.push([5, 9, , 10]);
            return [4, callTool(toolCall)];
          case 6:
            toolCallResult = _j.sent();
            return [4, onStepFinish === null || onStepFinish === void 0 ? void 0 : onStepFinish({
              finishReason: "tool_calls",
              messages: input.messages.slice(),
              text: assistantMessage.content,
              toolCall,
              toolResult: toolCallResult,
              stepUsage: stepUsage_2,
              totalUsage: Object.assign({}, totalUsage)
            })];
          case 7:
            _j.sent();
            pushNewMessages(input.messages, assistantMessage, toolCallResult);
            return [4, doStream()];
          case 8:
            currentRes = _j.sent();
            return [3, 10];
          case 9:
            e_2 = _j.sent();
            _f = currentRes.tee(), s1_1 = _f[0], s2_1 = _f[1];
            return [2, {
              messages: Promise.resolve(input.messages),
              dataStream: createAsyncIterable(s1_1),
              textStream: createAsyncIterable(s2_1.pipeThrough(new TransformStream2({
                transform: function(chunk, controller) {
                  var _a4, _b2, _c2;
                  var str = (_c2 = (_b2 = (_a4 = chunk === null || chunk === void 0 ? void 0 : chunk.choices) === null || _a4 === void 0 ? void 0 : _a4[0]) === null || _b2 === void 0 ? void 0 : _b2.delta) === null || _c2 === void 0 ? void 0 : _c2.content;
                  if (typeof str === "string")
                    controller.enqueue(str);
                }
              }))),
              usage: Promise.resolve(totalUsage),
              error: e_2
            }];
          case 10:
            return [3, 2];
          case 11:
            return [4, readCurrentStream()];
          case 12:
            readResult = _j.sent();
            if (readResult) {
              message_1 = readResult.message, usage = readResult.usage;
              addToUsage(totalUsage, usage);
              messages = __spreadArray4(__spreadArray4([], input.messages, true), [message_1], false);
              onStepFinish({
                messages: messages.slice(),
                finishReason: "tool_call",
                stepUsage: usage,
                text: message_1.content,
                toolCall: message_1.tool_calls[0],
                totalUsage: Object.assign({}, totalUsage)
              });
              _g = currentRes.tee(), s1_2 = _g[0], s2_2 = _g[1];
              return [2, {
                messages: Promise.resolve(__spreadArray4(__spreadArray4([], input.messages, true), [message_1], false)),
                dataStream: createAsyncIterable(s1_2),
                textStream: createAsyncIterable(s2_2.pipeThrough(new TransformStream2({
                  transform: function(chunk, controller) {
                    var _a4, _b2, _c2;
                    var str = (_c2 = (_b2 = (_a4 = chunk === null || chunk === void 0 ? void 0 : chunk.choices) === null || _a4 === void 0 ? void 0 : _a4[0]) === null || _b2 === void 0 ? void 0 : _b2.delta) === null || _c2 === void 0 ? void 0 : _c2.content;
                    if (typeof str === "string")
                      controller.enqueue(str);
                  }
                }))),
                usage: Promise.resolve(totalUsage)
              }];
            }
            messagePromise = createPromise();
            usagePromise = createPromise();
            message = {
              role: "assistant",
              content: ""
            };
            finishReason = "";
            stepUsage = { completion_tokens: 0, prompt_tokens: 0, total_tokens: 0 };
            originStream = currentRes.pipeThrough(new TransformStream2({
              transform: function(chunk, controller) {
                var _a4, _b2, _c2, _d2, _e3, _f2, _g2, _h2;
                var content = (_c2 = (_b2 = (_a4 = chunk === null || chunk === void 0 ? void 0 : chunk.choices) === null || _a4 === void 0 ? void 0 : _a4[0]) === null || _b2 === void 0 ? void 0 : _b2.delta) === null || _c2 === void 0 ? void 0 : _c2.content;
                if (typeof content === "string") {
                  message.content += content;
                }
                var reason = (_e3 = (_d2 = chunk === null || chunk === void 0 ? void 0 : chunk.choices) === null || _d2 === void 0 ? void 0 : _d2[0]) === null || _e3 === void 0 ? void 0 : _e3.finish_reason;
                if (reason)
                  finishReason = reason;
                if ((_f2 = chunk === null || chunk === void 0 ? void 0 : chunk.usage) === null || _f2 === void 0 ? void 0 : _f2.completion_tokens)
                  stepUsage.completion_tokens = chunk.usage.completion_tokens;
                if ((_g2 = chunk === null || chunk === void 0 ? void 0 : chunk.usage) === null || _g2 === void 0 ? void 0 : _g2.prompt_tokens)
                  stepUsage.prompt_tokens = chunk.usage.prompt_tokens;
                if ((_h2 = chunk === null || chunk === void 0 ? void 0 : chunk.usage) === null || _h2 === void 0 ? void 0 : _h2.total_tokens)
                  stepUsage.total_tokens = chunk.usage.total_tokens;
                controller.enqueue(chunk);
              },
              flush: function() {
                messagePromise.res(__spreadArray4(__spreadArray4([], input.messages, true), [message], false));
                addToUsage(totalUsage, stepUsage);
                usagePromise.res(Object.assign({}, totalUsage));
                onStepFinish === null || onStepFinish === void 0 ? void 0 : onStepFinish({
                  messages: __spreadArray4(__spreadArray4([], input.messages, true), [message], false),
                  finishReason,
                  text: message.content,
                  stepUsage,
                  totalUsage: Object.assign({}, totalUsage)
                });
              }
            }));
            _h = originStream.tee(), s1 = _h[0], s2 = _h[1];
            return [2, {
              messages: messagePromise.promise,
              dataStream: createAsyncIterable(s1),
              textStream: createAsyncIterable(s2.pipeThrough(new TransformStream2({
                transform: function(chunk, controller) {
                  var _a4, _b2, _c2;
                  var content = (_c2 = (_b2 = (_a4 = chunk === null || chunk === void 0 ? void 0 : chunk.choices) === null || _a4 === void 0 ? void 0 : _a4[0]) === null || _b2 === void 0 ? void 0 : _b2.delta) === null || _c2 === void 0 ? void 0 : _c2.content;
                  if (typeof content === "string") {
                    controller.enqueue(content);
                  }
                }
              }))),
              usage: usagePromise.promise
            }];
        }
      });
    });
  };
  return ReactModel2;
}();
function getToolCallFromGenerate(output) {
  var _a3;
  var choice = (_a3 = output === null || output === void 0 ? void 0 : output.choices) === null || _a3 === void 0 ? void 0 : _a3[0];
  if (!choice)
    return null;
  var finish_reason = choice.finish_reason, message = choice.message;
  if (finish_reason !== "tool_calls")
    return null;
  if (!message)
    return null;
  if (!isToolCallAssistantMessage(message))
    return null;
  return message.tool_calls[0];
}
function pushNewMessages(messages, assistantMessage, toolCallResult) {
  messages.push(assistantMessage, {
    role: "tool",
    tool_call_id: assistantMessage.tool_calls[0].id,
    content: JSON.stringify(toolCallResult)
  });
}
function readFunctionCallStream(stream) {
  var _a3, e_3, _b, _c;
  var _d, _e2, _f, _g, _h, _j;
  return __awaiter33(this, void 0, void 0, function() {
    var stepUsage, aStream, retToolCall, retMessage, _k, aStream_1, aStream_1_1, chunk, choice, finish_reason, delta, toolCall, e_3_1;
    return __generator33(this, function(_l) {
      switch (_l.label) {
        case 0:
          stepUsage = { completion_tokens: 0, prompt_tokens: 0, total_tokens: 0 };
          aStream = createAsyncIterable(stream);
          retToolCall = {
            id: "",
            function: {
              name: "",
              arguments: ""
            },
            type: ""
          };
          retMessage = {
            role: "assistant",
            content: "",
            tool_calls: [retToolCall]
          };
          _l.label = 1;
        case 1:
          _l.trys.push([1, 6, 7, 12]);
          _k = true, aStream_1 = __asyncValues2(aStream);
          _l.label = 2;
        case 2:
          return [4, aStream_1.next()];
        case 3:
          if (!(aStream_1_1 = _l.sent(), _a3 = aStream_1_1.done, !_a3)) return [3, 5];
          _c = aStream_1_1.value;
          _k = false;
          try {
            chunk = _c;
            choice = chunk === null || chunk === void 0 ? void 0 : chunk.choices[0];
            if (!choice)
              return [2, null];
            finish_reason = choice.finish_reason, delta = choice.delta;
            if (finish_reason !== "tool_calls")
              return [2, null];
            if (!delta)
              return [3, 4];
            if (delta.content)
              retMessage.content += delta.content;
            if (!("tool_calls" in delta))
              return [3, 4];
            toolCall = (_d = delta === null || delta === void 0 ? void 0 : delta.tool_calls) === null || _d === void 0 ? void 0 : _d[0];
            if (toolCall === null || toolCall === void 0 ? void 0 : toolCall.id)
              retToolCall.id = toolCall.id;
            if (toolCall === null || toolCall === void 0 ? void 0 : toolCall.type)
              retToolCall.type = toolCall.type;
            if ((_e2 = toolCall === null || toolCall === void 0 ? void 0 : toolCall.function) === null || _e2 === void 0 ? void 0 : _e2.name)
              retToolCall.function.name = toolCall.function.name;
            if ((_f = toolCall === null || toolCall === void 0 ? void 0 : toolCall.function) === null || _f === void 0 ? void 0 : _f.arguments)
              retToolCall.function.arguments += toolCall.function.arguments;
            if ((_g = chunk === null || chunk === void 0 ? void 0 : chunk.usage) === null || _g === void 0 ? void 0 : _g.completion_tokens)
              stepUsage.completion_tokens = chunk.usage.completion_tokens;
            if ((_h = chunk === null || chunk === void 0 ? void 0 : chunk.usage) === null || _h === void 0 ? void 0 : _h.prompt_tokens)
              stepUsage.prompt_tokens = chunk.usage.prompt_tokens;
            if ((_j = chunk === null || chunk === void 0 ? void 0 : chunk.usage) === null || _j === void 0 ? void 0 : _j.total_tokens)
              stepUsage.total_tokens = chunk.usage.total_tokens;
          } finally {
            _k = true;
          }
          _l.label = 4;
        case 4:
          return [3, 2];
        case 5:
          return [3, 12];
        case 6:
          e_3_1 = _l.sent();
          e_3 = { error: e_3_1 };
          return [3, 12];
        case 7:
          _l.trys.push([7, , 10, 11]);
          if (!(!_k && !_a3 && (_b = aStream_1.return))) return [3, 9];
          return [4, _b.call(aStream_1)];
        case 8:
          _l.sent();
          _l.label = 9;
        case 9:
          return [3, 11];
        case 10:
          if (e_3) throw e_3.error;
          return [7];
        case 11:
          return [7];
        case 12:
          return [2, {
            message: retMessage,
            usage: stepUsage
          }];
      }
    });
  });
}
var toolMap = /* @__PURE__ */ new Map();
function callTool(toolCall) {
  return toolMap.get(toolCall.function.name)(JSON.parse(toolCall.function.arguments));
}
function createSolidUsage(usage) {
  var _a3, _b, _c;
  return {
    completion_tokens: (_a3 = usage === null || usage === void 0 ? void 0 : usage.completion_tokens) !== null && _a3 !== void 0 ? _a3 : 0,
    prompt_tokens: (_b = usage === null || usage === void 0 ? void 0 : usage.prompt_tokens) !== null && _b !== void 0 ? _b : 0,
    total_tokens: (_c = usage === null || usage === void 0 ? void 0 : usage.total_tokens) !== null && _c !== void 0 ? _c : 0
  };
}
function addToUsage(targetUsage, sourceUsage) {
  targetUsage.completion_tokens += sourceUsage.completion_tokens;
  targetUsage.prompt_tokens += sourceUsage.prompt_tokens;
  targetUsage.total_tokens += sourceUsage.total_tokens;
}

// node_modules/@cloudbase/ai/dist/esm/models/index.js
var MODELS = {
  hunyuan: HunYuanSimpleModel,
  "hunyuan-beta": HunYuanBetaSimpleModel,
  ark: ArkSimpleModel,
  dashscope: DSSimpleModel,
  "01-ai": YiSimpleModel,
  moonshot: MoonshotSimpleModel,
  zhipu: ZhiPuSimpleModel,
  "hunyuan-exp": HunYuanExpSimpleModel,
  "hunyuan-open": HunYuanOpenSimpleModel,
  deepseek: DeepSeekSimpleModel
};

// node_modules/@cloudbase/ai/dist/esm/AI.js
var __assign33 = function() {
  __assign33 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign33.apply(this, arguments);
};
var __awaiter34 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator34 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var MODELS2 = MODELS;
var AI = function() {
  function AI2(req, baseUrl, i18n) {
    var _this = this;
    this.req = req;
    this.baseUrl = baseUrl;
    this.modelRequest = function(_a3) {
      var url2 = _a3.url, data2 = _a3.data, headers = _a3.headers, stream = _a3.stream, timeout = _a3.timeout;
      return __awaiter34(_this, void 0, void 0, function() {
        var fetchHeaders, _b, responseData, header;
        var _c;
        var _d, _e2;
        return __generator34(this, function(_f) {
          switch (_f.label) {
            case 0:
              fetchHeaders = {
                "Content-Type": "application/json"
              };
              stream && Object.assign(fetchHeaders, { Accept: "text/event-stream" });
              return [4, this.req.fetch({
                method: "post",
                headers: __assign33(__assign33((_c = {}, _c[(_d = this.i18n) === null || _d === void 0 ? void 0 : _d.LANG_HEADER_KEY] = (_e2 = this.i18n) === null || _e2 === void 0 ? void 0 : _e2.lang, _c), fetchHeaders), headers),
                body: JSON.stringify(data2),
                url: url2,
                stream,
                timeout
              })];
            case 1:
              _b = _f.sent(), responseData = _b.data, header = _b.header;
              return [2, this.handleResponseData(responseData, header)];
          }
        });
      });
    };
    this.botRequest = function(_a3) {
      var method = _a3.method, url2 = _a3.url, _b = _a3.data, data2 = _b === void 0 ? {} : _b, headers = _a3.headers, stream = _a3.stream, timeout = _a3.timeout;
      return __awaiter34(_this, void 0, void 0, function() {
        function objectToParam(obj) {
          return Object.entries(obj).map(function(_a4) {
            var key = _a4[0], value = _a4[1];
            return "".concat(key, "=").concat(value);
          }).join("&");
        }
        var _c, fetchHeaders, _d, responseData, header;
        var _e2;
        var _f, _g;
        return __generator34(this, function(_h) {
          switch (_h.label) {
            case 0:
              if (!(method === "get")) return [3, 2];
              _c = this.handleResponseData;
              return [4, this.req.fetch({ url: "".concat(url2, "?").concat(objectToParam(data2)), method, headers, stream, timeout })];
            case 1:
              return [2, _c.apply(this, [_h.sent().data])];
            case 2:
              fetchHeaders = {
                "Content-Type": "application/json"
              };
              stream && Object.assign(fetchHeaders, { Accept: "text/event-stream" });
              return [4, this.req.fetch({
                url: url2,
                body: JSON.stringify(data2),
                headers: __assign33(__assign33((_e2 = {}, _e2[(_f = this.i18n) === null || _f === void 0 ? void 0 : _f.LANG_HEADER_KEY] = (_g = this.i18n) === null || _g === void 0 ? void 0 : _g.lang, _e2), fetchHeaders), headers),
                stream,
                method,
                timeout
              })];
            case 3:
              _d = _h.sent(), responseData = _d.data, header = _d.header;
              return [2, this.handleResponseData(responseData, header)];
          }
        });
      });
    };
    this.aiBaseUrl = "".concat(baseUrl, "/ai");
    this.aiBotBaseUrl = "".concat(baseUrl, "/aibot");
    this.bot = new Bot(this.botRequest, this.aiBotBaseUrl);
    this.i18n = i18n;
    langEvent_exports.bus.on(langEvent_exports.LANG_CHANGE_EVENT, function(params) {
      var _a3;
      _this.i18n = ((_a3 = params.data) === null || _a3 === void 0 ? void 0 : _a3.i18n) || _this.i18n;
    });
  }
  AI2.prototype.handleResponseData = function(responseData, header) {
    var _a3, _b;
    return __awaiter34(this, void 0, void 0, function() {
      var GO_TO_AI_TEXT, json, json;
      return __generator34(this, function(_c) {
        switch (_c.label) {
          case 0:
            GO_TO_AI_TEXT = "".concat(this.i18n.t(" AI+ "), "https://tcb.cloud.tencent.com/dev#/ai");
            if (!(typeof responseData === "object" && responseData && "then" in responseData)) return [3, 2];
            return [4, responseData];
          case 1:
            json = _c.sent();
            if (typeof json === "object" && json && "code" in json && json.code !== "NORMAL") {
              throw new Error("".concat(this.i18n.t("AI+ "), "").concat(json.code, "").concat(this.i18n.t(""), "").concat(json.message, "\n").concat(GO_TO_AI_TEXT, "\n").concat(JSON.stringify(json, null, 2)));
            }
            return [2, responseData];
          case 2:
            if (!((_b = (_a3 = header === null || header === void 0 ? void 0 : header.get) === null || _a3 === void 0 ? void 0 : _a3.call(header, "content-type")) === null || _b === void 0 ? void 0 : _b.includes("application/json"))) return [3, 4];
            return [4, readableStream2JsonObject(responseData)];
          case 3:
            json = _c.sent();
            if (typeof json === "object" && json && "code" in json && json.code !== "NORMAL") {
              throw new Error("".concat(this.i18n.t("AI+ "), "").concat(json.code, "").concat(this.i18n.t(""), "").concat(json.message, "\n").concat(GO_TO_AI_TEXT, "\n").concat(JSON.stringify(json, null, 2)));
            }
            _c.label = 4;
          case 4:
            return [2, responseData];
        }
      });
    });
  };
  AI2.prototype.createModel = function(model, options) {
    var simpleModel;
    var SimpleModelConstructor = MODELS2[model];
    if (SimpleModelConstructor) {
      simpleModel = new SimpleModelConstructor(this.modelRequest, this.aiBaseUrl);
    } else {
      var subUrl = typeof (options === null || options === void 0 ? void 0 : options.defaultModelSubUrl) === "string" ? options.defaultModelSubUrl : "/chat/completions";
      simpleModel = new DefaultSimpleModel(this.modelRequest, this.aiBaseUrl, "".concat(model).concat(subUrl));
    }
    var reactModel = new ReactModel(simpleModel);
    return reactModel;
  };
  AI2.prototype.registerModel = function(name, model) {
    if (MODELS2[name] != null) {
      console.warn("AI model ".concat(name, " already exists!"));
      return;
    }
    MODELS2[name] = model;
  };
  AI2.prototype.createImageModel = function(provider) {
    return new DefaultImageModel(this.modelRequest, this.aiBaseUrl, provider);
  };
  AI2.prototype.registerFunctionTool = function(functionTool) {
    if (toolMap.has(functionTool.name)) {
      console.warn("AI function tool ".concat(functionTool.name, " already exists and will be overwritten!"));
    }
    toolMap.set(functionTool.name, functionTool.fn);
  };
  return AI2;
}();

// node_modules/@cloudbase/ai/dist/esm/index.js
var __assign34 = function() {
  __assign34 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign34.apply(this, arguments);
};
var __awaiter35 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator35 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var __rest8 = function(s2, e3) {
  var t3 = {};
  for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2) && e3.indexOf(p2) < 0)
    t3[p2] = s2[p2];
  if (s2 != null && typeof Object.getOwnPropertySymbols === "function")
    for (var i2 = 0, p2 = Object.getOwnPropertySymbols(s2); i2 < p2.length; i2++) {
      if (e3.indexOf(p2[i2]) < 0 && Object.prototype.propertyIsEnumerable.call(s2, p2[i2]))
        t3[p2[i2]] = s2[p2[i2]];
    }
  return t3;
};
var COMPONENT_NAME7 = "ai";
var restModels = __rest8(models_exports2, ["MODELS"]);
var createRequestInstanceWithAccessTokenHeader = function(_a3) {
  var getAccessToken = _a3.getAccessToken, req = _a3.req;
  var fetch2 = function(options) {
    return __awaiter35(void 0, void 0, void 0, function() {
      var token, _a4, headers, restOptions, accessToken;
      return __generator35(this, function(_b) {
        switch (_b.label) {
          case 0:
            if (typeof req.fetch !== "function") {
              throw new Error("req.fetch is not a function");
            }
            token = options.token, _a4 = options.headers, headers = _a4 === void 0 ? {} : _a4, restOptions = __rest8(options, ["token", "headers"]);
            if (!(token != null)) return [3, 1];
            accessToken = token;
            return [3, 3];
          case 1:
            return [4, getAccessToken()];
          case 2:
            accessToken = _b.sent().accessToken;
            _b.label = 3;
          case 3:
            return [2, req.fetch(__assign34({ headers: __assign34({ Authorization: "Bearer ".concat(accessToken) }, headers) }, restOptions))];
        }
      });
    });
  };
  return {
    download: req.download,
    post: req.post,
    upload: req.upload,
    fetch: fetch2
  };
};
function createAI(_a3) {
  var env = _a3.env, baseUrl = _a3.baseUrl, req = _a3.req, getAccessToken = _a3.getAccessToken, handleReqInstance = _a3.handleReqInstance, i18n = _a3.i18n;
  var getBaseUrl = function() {
    if (baseUrl != null) {
      return baseUrl;
    }
    if (env == null) {
      throw new Error("`env` is required when `baseUrl` is not provided!");
    }
    return "https://".concat(env, ".api.tcloudbasegateway.com/v1");
  };
  var getReq = function() {
    if (handleReqInstance == null) {
      if (getAccessToken == null) {
        throw new Error("`getAccessToken` is required when `handleReqInstance` is not provided!");
      }
      return createRequestInstanceWithAccessTokenHeader({ req, getAccessToken });
    }
    return handleReqInstance({ req });
  };
  return new AI(getReq(), getBaseUrl(), i18n);
}
function ai(options) {
  var _this = this;
  var _a3;
  var req = this.request;
  if (req.fetch == null) {
    throw new Error("cloudbase.request.fetch() unimplemented!");
  }
  var getUrlFromCloud = function() {
    var _a4 = _this.getEndPointWithKey("GATEWAY"), BASE_URL = _a4.BASE_URL, PROTOCOL2 = _a4.PROTOCOL;
    return "".concat(PROTOCOL2).concat(BASE_URL);
  };
  var baseUrl = (_a3 = options === null || options === void 0 ? void 0 : options.baseUrl) !== null && _a3 !== void 0 ? _a3 : getUrlFromCloud();
  return createAI({ req, baseUrl, handleReqInstance: function(_a4) {
    var req2 = _a4.req;
    return req2;
  }, i18n: this.config.i18n });
}
var component8 = {
  name: COMPONENT_NAME7,
  entity: { ai }
};
function registerAi(app) {
  try {
    app.registerComponent(component8);
  } catch (e3) {
    console.warn(e3);
  }
}
try {
  window.registerAi = registerAi;
} catch (e3) {
}

// node_modules/@cloudbase/mysql/dist/esm/index.js
var __assign35 = function() {
  __assign35 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign35.apply(this, arguments);
};
var __awaiter36 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator36 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
function getEntity2(cloudbase3, options) {
  var _this = this;
  var cloudbaseFetch = cloudbase3.request.fetch.bind(cloudbase3.request);
  var _a3 = options || {}, _b = _a3.instance, instance = _b === void 0 ? "default" : _b, _c = _a3.database, database2 = _c === void 0 ? cloudbase3.config.env : _c;
  var fetch2 = function(url2, options2) {
    return __awaiter36(_this, void 0, void 0, function() {
      var headers, result, data2, e_1, res;
      return __generator36(this, function(_a4) {
        switch (_a4.label) {
          case 0:
            headers = {};
            if (options2.headers instanceof Headers) {
              options2.headers.forEach(function(value, key) {
                headers[key] = value;
              });
            } else {
              headers = options2.headers || {};
            }
            return [4, cloudbaseFetch(__assign35(__assign35({ url: url2.toString() }, options2), { headers: __assign35({ "Content-Type": "application/json", "X-Db-Instance": instance, "Accept-Profile": database2, "Content-Profile": database2 }, headers), shouldThrowOnError: false }))];
          case 1:
            result = _a4.sent();
            data2 = {};
            _a4.label = 2;
          case 2:
            _a4.trys.push([2, 4, , 5]);
            return [4, result.data];
          case 3:
            data2 = _a4.sent();
            return [3, 5];
          case 4:
            e_1 = _a4.sent();
            if (!e_1.message.includes("Unexpected end of JSON input")) {
              throw e_1;
            }
            return [3, 5];
          case 5:
            res = {
              ok: (result === null || result === void 0 ? void 0 : result.statusCode) >= 200 && (result === null || result === void 0 ? void 0 : result.statusCode) < 300,
              status: (result === null || result === void 0 ? void 0 : result.statusCode) || 200,
              statusText: (result === null || result === void 0 ? void 0 : result.statusMessage) || "OK",
              json: function() {
                return Promise.resolve(data2 || {});
              },
              text: function() {
                return Promise.resolve(typeof data2 === "string" ? data2 : JSON.stringify(data2 || {}));
              },
              headers: result === null || result === void 0 ? void 0 : result.header
            };
            return [2, res];
        }
      });
    });
  };
  var _d = cloudbase3.getEndPointWithKey("GATEWAY"), BASE_URL = _d.BASE_URL, PROTOCOL2 = _d.PROTOCOL;
  var mysqlBaseUrl = "".concat(PROTOCOL2).concat(BASE_URL, "/rdb/rest");
  var entity = generateMySQLClient(cloudbase3, {
    mysqlBaseUrl,
    fetch: fetch2
  });
  return entity;
}
var component9 = {
  name: "mysql",
  entity: {
    mysql: function(options) {
      return getEntity2(this, options)(options);
    }
  }
};
var rdbComponent = {
  name: "rdb",
  entity: {
    rdb: function(options) {
      return getEntity2(this, options)(options);
    }
  }
};
try {
  cloudbase.registerComponent(component9);
  cloudbase.registerComponent(rdbComponent);
} catch (e3) {
}
function registerMySQL(app) {
  try {
    app.registerComponent(component9);
    app.registerComponent(rdbComponent);
  } catch (e3) {
    console.warn(e3);
  }
}
try {
  window.registerMySQL = registerMySQL;
} catch (e3) {
}

// node_modules/@cloudbase/apis/dist/esm/callApis.js
var import_constants5 = __toESM(require_constants());
var __assign36 = function() {
  __assign36 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign36.apply(this, arguments);
};
var __awaiter37 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator37 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
function callApi(callApiOptions, opts) {
  var _a3, _b, _c;
  return __awaiter37(this, void 0, void 0, function() {
    var _d, name, body, _e2, path2, _f, method, _g, headers, token, url2, _h, gatewayOrigin, getAccessToken, env, _j, BASE_URL, PROTOCOL2, endpoint, reqPath, accessToken, response;
    return __generator37(this, function(_k) {
      switch (_k.label) {
        case 0:
          _d = callApiOptions || {}, name = _d.name, body = _d.body, _e2 = _d.path, path2 = _e2 === void 0 ? "" : _e2, _f = _d.method, method = _f === void 0 ? "POST" : _f, _g = _d.headers, headers = _g === void 0 ? {} : _g;
          token = (callApiOptions || {}).token;
          if (!name) {
            throw new Error(JSON.stringify({
              code: import_constants5.ERRORS.INVALID_PARAMS,
              msg: "[apis] invalid api name"
            }));
          }
          url2 = "";
          _h = this, gatewayOrigin = _h.gatewayOrigin, getAccessToken = _h.getAccessToken, env = _h.env;
          if (gatewayOrigin) {
            url2 = "".concat(gatewayOrigin, "/v1");
          } else if (this.getEndPointWithKey) {
            _j = this.getEndPointWithKey("GATEWAY"), BASE_URL = _j.BASE_URL, PROTOCOL2 = _j.PROTOCOL;
            url2 = "".concat(PROTOCOL2).concat(BASE_URL);
          } else {
            url2 = "https://".concat(env, ".api.tcloudbasegateway.com/v1");
          }
          endpoint = "".concat(url2, "/apis/").concat(name);
          reqPath = path2.startsWith("/") ? path2 : "/".concat(path2);
          if (!getAccessToken) return [3, 2];
          return [4, getAccessToken()];
        case 1:
          accessToken = _k.sent().accessToken;
          headers.Authorization = "Bearer ".concat(accessToken);
          _k.label = 2;
        case 2:
          return [4, this.request.fetch(__assign36({ url: "".concat(endpoint).concat(reqPath), method: method || "POST", headers: __assign36({ "Content-Type": "application/json; charset=utf-8" }, headers), body, token: ((_a3 = token === null || token === void 0 ? void 0 : token.trim) === null || _a3 === void 0 ? void 0 : _a3.call(token)) || ((_c = (_b = headers.Authorization) === null || _b === void 0 ? void 0 : _b.replace) === null || _c === void 0 ? void 0 : _c.call(_b, /^Bearer /, "")) || null }, opts))];
        case 3:
          response = _k.sent();
          return [4, response.data];
        case 4:
          return [2, _k.sent()];
      }
    });
  });
}
var SUPPORT_METHODS = ["GET", "POST", "PUT", "DELETE", "HEAD", "OPTIONS", "PATCH", "REQUEST"];
function generateCallApis(apiName) {
  var _this = this;
  return new Proxy({}, {
    get: function(_2, method) {
      if (typeof method !== "string") {
        throw new Error("[apis] method must be string");
      }
      var upMethod = method.toLocaleUpperCase();
      if (!SUPPORT_METHODS.includes(upMethod)) {
        throw new Error("[apis] invalid method: ".concat(method));
      }
      return function(callApiOptions, opts) {
        return __awaiter37(_this, void 0, void 0, function() {
          return __generator37(this, function(_a3) {
            switch (_a3.label) {
              case 0:
                return [4, callApi.call(this, __assign36({ name: apiName, method: (upMethod === "REQUEST" ? callApiOptions.method : upMethod) || "POST" }, callApiOptions), opts)];
              case 1:
                return [2, _a3.sent()];
            }
          });
        });
      };
    }
  });
}
function generateApis(params) {
  var _this = this;
  Object.keys(params || {}).forEach(function(key) {
    if (params[key] !== void 0)
      _this[key] = params[key];
  });
  return new Proxy({}, {
    get: function(_2, apiName) {
      if (typeof apiName === "string") {
        return generateCallApis.call(_this, apiName);
      }
    }
  });
}

// node_modules/@cloudbase/apis/dist/esm/index.js
var COMPONENT_NAME8 = "apis";
var component10 = {
  name: COMPONENT_NAME8,
  IIFE: true,
  entity: function() {
    Object.defineProperty(this.prototype, COMPONENT_NAME8, {
      get: function() {
        return generateApis.call(this);
      },
      configurable: true,
      enumerable: true
    });
  }
};
function registerApis(app) {
  try {
    app.registerComponent(component10);
  } catch (e3) {
    console.warn(e3);
  }
}
try {
  cloudbase.registerComponent(component10);
} catch (e3) {
}
try {
  window.registerApis = registerApis;
} catch (e3) {
}

// node_modules/@cloudbase/database/dist/esm/geo/index.js
var geo_exports = {};
__export(geo_exports, {
  LineString: () => LineString,
  MultiLineString: () => MultiLineString,
  MultiPoint: () => MultiPoint,
  MultiPolygon: () => MultiPolygon,
  Point: () => Point,
  Polygon: () => Polygon
});

// node_modules/@cloudbase/database/dist/esm/constant.js
var _a2;
var ErrorCode;
(function(ErrorCode2) {
  ErrorCode2["DocIDError"] = "ID";
  ErrorCode2["CollNameError"] = "";
  ErrorCode2["OpStrError"] = "";
  ErrorCode2["DirectionError"] = "";
  ErrorCode2["IntergerError"] = "must be integer";
  ErrorCode2["QueryParamTypeError"] = "";
  ErrorCode2["QueryParamValueError"] = "undefined";
})(ErrorCode || (ErrorCode = {}));
var FieldType = {
  String: "String",
  Number: "Number",
  Object: "Object",
  Array: "Array",
  Boolean: "Boolean",
  Null: "Null",
  GeoPoint: "GeoPoint",
  GeoLineString: "GeoLineString",
  GeoPolygon: "GeoPolygon",
  GeoMultiPoint: "GeoMultiPoint",
  GeoMultiLineString: "GeoMultiLineString",
  GeoMultiPolygon: "GeoMultiPolygon",
  Timestamp: "Date",
  Command: "Command",
  ServerDate: "ServerDate",
  BsonDate: "BsonDate"
};
var OrderDirectionList = ["desc", "asc"];
var WhereFilterOpList = ["<", "<=", "==", ">=", ">"];
var Opeartor;
(function(Opeartor2) {
  Opeartor2["lt"] = "<";
  Opeartor2["gt"] = ">";
  Opeartor2["lte"] = "<=";
  Opeartor2["gte"] = ">=";
  Opeartor2["eq"] = "==";
})(Opeartor || (Opeartor = {}));
var OperatorMap = (_a2 = {}, _a2[Opeartor.eq] = "$eq", _a2[Opeartor.lt] = "$lt", _a2[Opeartor.lte] = "$lte", _a2[Opeartor.gt] = "$gt", _a2[Opeartor.gte] = "$gte", _a2);
var QueryType;
(function(QueryType2) {
  QueryType2["WHERE"] = "WHERE";
  QueryType2["DOC"] = "DOC";
})(QueryType || (QueryType = {}));

// node_modules/@cloudbase/database/dist/esm/utils/symbol.js
var __extends11 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var _symbols = [];
var __internalMark__ = {};
var HiddenSymbol = /* @__PURE__ */ function() {
  function HiddenSymbol2(target) {
    Object.defineProperties(this, {
      target: {
        enumerable: false,
        writable: false,
        configurable: false,
        value: target
      }
    });
  }
  return HiddenSymbol2;
}();
var InternalSymbol = function(_super) {
  __extends11(InternalSymbol2, _super);
  function InternalSymbol2(target, __mark__) {
    if (__mark__ !== __internalMark__) {
      throw new TypeError("InternalSymbol cannot be constructed with new operator");
    }
    return _super.call(this, target) || this;
  }
  InternalSymbol2.for = function(target) {
    for (var i2 = 0, len = _symbols.length; i2 < len; i2++) {
      if (_symbols[i2].target === target) {
        return _symbols[i2].instance;
      }
    }
    var symbol = new InternalSymbol2(target, __internalMark__);
    _symbols.push({
      target,
      instance: symbol
    });
    return symbol;
  };
  return InternalSymbol2;
}(HiddenSymbol);
var symbol_default = InternalSymbol;

// node_modules/@cloudbase/database/dist/esm/helper/symbol.js
var SYMBOL_UNSET_FIELD_NAME = symbol_default.for("UNSET_FIELD_NAME");
var SYMBOL_UPDATE_COMMAND = symbol_default.for("UPDATE_COMMAND");
var SYMBOL_QUERY_COMMAND = symbol_default.for("QUERY_COMMAND");
var SYMBOL_LOGIC_COMMAND = symbol_default.for("LOGIC_COMMAND");
var SYMBOL_GEO_POINT = symbol_default.for("GEO_POINT");
var SYMBOL_GEO_LINE_STRING = symbol_default.for("SYMBOL_GEO_LINE_STRING");
var SYMBOL_GEO_POLYGON = symbol_default.for("SYMBOL_GEO_POLYGON");
var SYMBOL_GEO_MULTI_POINT = symbol_default.for("SYMBOL_GEO_MULTI_POINT");
var SYMBOL_GEO_MULTI_LINE_STRING = symbol_default.for("SYMBOL_GEO_MULTI_LINE_STRING");
var SYMBOL_GEO_MULTI_POLYGON = symbol_default.for("SYMBOL_GEO_MULTI_POLYGON");
var SYMBOL_SERVER_DATE = symbol_default.for("SERVER_DATE");
var SYMBOL_REGEXP = symbol_default.for("REGEXP");

// node_modules/@cloudbase/database/dist/esm/serverDate/index.js
var ServerDate = function() {
  function ServerDate2(_a3) {
    var _b = _a3 === void 0 ? {} : _a3, _c = _b.offset, offset = _c === void 0 ? 0 : _c;
    this.offset = offset;
  }
  Object.defineProperty(ServerDate2.prototype, "_internalType", {
    get: function() {
      return SYMBOL_SERVER_DATE;
    },
    enumerable: false,
    configurable: true
  });
  ServerDate2.prototype.parse = function() {
    return {
      $date: {
        offset: this.offset
      }
    };
  };
  return ServerDate2;
}();
function ServerDateConstructor(opt) {
  return new ServerDate(opt);
}

// node_modules/@cloudbase/database/dist/esm/util.js
var __read = function(o2, n3) {
  var m2 = typeof Symbol === "function" && o2[Symbol.iterator];
  if (!m2) return o2;
  var i2 = m2.call(o2), r3, ar2 = [], e3;
  try {
    while ((n3 === void 0 || n3-- > 0) && !(r3 = i2.next()).done) ar2.push(r3.value);
  } catch (error) {
    e3 = { error };
  } finally {
    try {
      if (r3 && !r3.done && (m2 = i2["return"])) m2.call(i2);
    } finally {
      if (e3) throw e3.error;
    }
  }
  return ar2;
};
var Util = function() {
  function Util2() {
  }
  Util2.formatResDocumentData = function(documents) {
    return documents.map(function(document2) {
      return Util2.formatField(document2);
    });
  };
  Util2.formatField = function(document2) {
    var keys4 = Object.keys(document2);
    var protoField = {};
    if (Array.isArray(document2)) {
      protoField = [];
    }
    keys4.forEach(function(key) {
      var item = document2[key];
      var type = Util2.whichType(item);
      var realValue;
      switch (type) {
        case FieldType.GeoPoint:
          realValue = new Point(item.coordinates[0], item.coordinates[1]);
          break;
        case FieldType.GeoLineString:
          realValue = new LineString(item.coordinates.map(function(point) {
            return new Point(point[0], point[1]);
          }));
          break;
        case FieldType.GeoPolygon:
          realValue = new Polygon(item.coordinates.map(function(line) {
            return new LineString(line.map(function(_a3) {
              var _b = __read(_a3, 2), lng = _b[0], lat = _b[1];
              return new Point(lng, lat);
            }));
          }));
          break;
        case FieldType.GeoMultiPoint:
          realValue = new MultiPoint(item.coordinates.map(function(point) {
            return new Point(point[0], point[1]);
          }));
          break;
        case FieldType.GeoMultiLineString:
          realValue = new MultiLineString(item.coordinates.map(function(line) {
            return new LineString(line.map(function(_a3) {
              var _b = __read(_a3, 2), lng = _b[0], lat = _b[1];
              return new Point(lng, lat);
            }));
          }));
          break;
        case FieldType.GeoMultiPolygon:
          realValue = new MultiPolygon(item.coordinates.map(function(polygon) {
            return new Polygon(polygon.map(function(line) {
              return new LineString(line.map(function(_a3) {
                var _b = __read(_a3, 2), lng = _b[0], lat = _b[1];
                return new Point(lng, lat);
              }));
            }));
          }));
          break;
        case FieldType.Timestamp:
          realValue = new Date(item.$timestamp * 1e3);
          break;
        case FieldType.Object:
        case FieldType.Array:
          realValue = Util2.formatField(item);
          break;
        case FieldType.ServerDate:
          realValue = new Date(item.$date);
          break;
        default:
          realValue = item;
      }
      if (Array.isArray(protoField)) {
        protoField.push(realValue);
      } else {
        protoField[key] = realValue;
      }
    });
    return protoField;
  };
  Util2.whichType = function(obj) {
    var type = Object.prototype.toString.call(obj).slice(8, -1);
    if (type === FieldType.Timestamp) {
      return FieldType.BsonDate;
    }
    if (type === FieldType.Object) {
      if (obj instanceof Point) {
        return FieldType.GeoPoint;
      } else if (obj instanceof Date) {
        return FieldType.Timestamp;
      } else if (obj instanceof ServerDate) {
        return FieldType.ServerDate;
      }
      if (obj.$timestamp) {
        type = FieldType.Timestamp;
      } else if (obj.$date) {
        type = FieldType.ServerDate;
      } else if (Point.validate(obj)) {
        type = FieldType.GeoPoint;
      } else if (LineString.validate(obj)) {
        type = FieldType.GeoLineString;
      } else if (Polygon.validate(obj)) {
        type = FieldType.GeoPolygon;
      } else if (MultiPoint.validate(obj)) {
        type = FieldType.GeoMultiPoint;
      } else if (MultiLineString.validate(obj)) {
        type = FieldType.GeoMultiLineString;
      } else if (MultiPolygon.validate(obj)) {
        type = FieldType.GeoMultiPolygon;
      }
    }
    return type;
  };
  Util2.generateDocId = function() {
    var chars = "ABCDEFabcdef0123456789";
    var autoId = "";
    for (var i2 = 0; i2 < 24; i2++) {
      autoId += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return autoId;
  };
  return Util2;
}();

// node_modules/@cloudbase/database/dist/esm/validate.js
var Validate = function() {
  function Validate2() {
  }
  Validate2.isGeopoint = function(point, degree) {
    if (Util.whichType(degree) !== FieldType.Number) {
      throw new Error("Geo Point must be number type");
    }
    var degreeAbs = Math.abs(degree);
    if (point === "latitude" && degreeAbs > 90) {
      throw new Error("latitude should be a number ranges from -90 to 90");
    } else if (point === "longitude" && degreeAbs > 180) {
      throw new Error("longitude should be a number ranges from -180 to 180");
    }
    return true;
  };
  Validate2.isInteger = function(param, num) {
    if (!Number.isInteger(num)) {
      throw new Error(param + ErrorCode.IntergerError);
    }
    return true;
  };
  Validate2.isFieldOrder = function(direction) {
    if (OrderDirectionList.indexOf(direction) === -1) {
      throw new Error(ErrorCode.DirectionError);
    }
    return true;
  };
  Validate2.isFieldPath = function(path2) {
    if (!/^[a-zA-Z0-9-_\.]/.test(path2)) {
      throw new Error();
    }
    return true;
  };
  Validate2.isOperator = function(op) {
    if (WhereFilterOpList.indexOf(op) === -1) {
      throw new Error(ErrorCode.OpStrError);
    }
    return true;
  };
  Validate2.isCollName = function(name) {
    if (!/^[a-zA-Z0-9]([a-zA-Z0-9-_]){1,32}$/.test(name)) {
      throw new Error(ErrorCode.CollNameError);
    }
    return true;
  };
  Validate2.isDocID = function(docId) {
    if (!/^([a-fA-F0-9]){24}$/.test(docId)) {
      throw new Error(ErrorCode.DocIDError);
    }
    return true;
  };
  return Validate2;
}();

// node_modules/@cloudbase/database/dist/esm/utils/type.js
var getType = function(x2) {
  return Object.prototype.toString.call(x2).slice(8, -1).toLowerCase();
};
var isObject2 = function(x2) {
  return getType(x2) === "object";
};
var isString3 = function(x2) {
  return getType(x2) === "string";
};
var isNumber = function(x2) {
  return getType(x2) === "number";
};
var isArray3 = function(x2) {
  return Array.isArray(x2);
};
var isDate = function(x2) {
  return getType(x2) === "date";
};
var isRegExp = function(x2) {
  return getType(x2) === "regexp";
};
var isInternalObject = function(x2) {
  return x2 && x2._internalType instanceof InternalSymbol;
};

// node_modules/@cloudbase/database/dist/esm/geo/point.js
var Point = function() {
  function Point2(longitude, latitude) {
    Validate.isGeopoint("longitude", longitude);
    Validate.isGeopoint("latitude", latitude);
    this.longitude = longitude;
    this.latitude = latitude;
  }
  Point2.prototype.parse = function(key) {
    var _a3;
    return _a3 = {}, _a3[key] = {
      type: "Point",
      coordinates: [this.longitude, this.latitude]
    }, _a3;
  };
  Point2.prototype.toJSON = function() {
    return {
      type: "Point",
      coordinates: [
        this.longitude,
        this.latitude
      ]
    };
  };
  Point2.prototype.toReadableString = function() {
    return "[".concat(this.longitude, ",").concat(this.latitude, "]");
  };
  Point2.validate = function(point) {
    return point.type === "Point" && isArray3(point.coordinates) && Validate.isGeopoint("longitude", point.coordinates[0]) && Validate.isGeopoint("latitude", point.coordinates[1]);
  };
  Object.defineProperty(Point2.prototype, "_internalType", {
    get: function() {
      return SYMBOL_GEO_POINT;
    },
    enumerable: false,
    configurable: true
  });
  return Point2;
}();

// node_modules/@cloudbase/database/dist/esm/geo/lineString.js
var __values2 = function(o2) {
  var s2 = typeof Symbol === "function" && Symbol.iterator, m2 = s2 && o2[s2], i2 = 0;
  if (m2) return m2.call(o2);
  if (o2 && typeof o2.length === "number") return {
    next: function() {
      if (o2 && i2 >= o2.length) o2 = void 0;
      return { value: o2 && o2[i2++], done: !o2 };
    }
  };
  throw new TypeError(s2 ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var LineString = function() {
  function LineString2(points) {
    if (!isArray3(points)) {
      throw new TypeError('"points" must be of type Point[]. Received type '.concat(typeof points));
    }
    if (points.length < 2) {
      throw new Error('"points" must contain 2 points at least');
    }
    points.forEach(function(point) {
      if (!(point instanceof Point)) {
        throw new TypeError('"points" must be of type Point[]. Received type '.concat(typeof point, "[]"));
      }
    });
    this.points = points;
  }
  LineString2.prototype.parse = function(key) {
    var _a3;
    return _a3 = {}, _a3[key] = {
      type: "LineString",
      coordinates: this.points.map(function(point) {
        return point.toJSON().coordinates;
      })
    }, _a3;
  };
  LineString2.prototype.toJSON = function() {
    return {
      type: "LineString",
      coordinates: this.points.map(function(point) {
        return point.toJSON().coordinates;
      })
    };
  };
  LineString2.validate = function(lineString) {
    var e_1, _a3;
    if (lineString.type !== "LineString" || !isArray3(lineString.coordinates)) {
      return false;
    }
    try {
      for (var _b = __values2(lineString.coordinates), _c = _b.next(); !_c.done; _c = _b.next()) {
        var point = _c.value;
        if (!isNumber(point[0]) || !isNumber(point[1])) {
          return false;
        }
      }
    } catch (e_1_1) {
      e_1 = { error: e_1_1 };
    } finally {
      try {
        if (_c && !_c.done && (_a3 = _b.return)) _a3.call(_b);
      } finally {
        if (e_1) throw e_1.error;
      }
    }
    return true;
  };
  LineString2.isClosed = function(lineString) {
    var firstPoint = lineString.points[0];
    var lastPoint = lineString.points[lineString.points.length - 1];
    if (firstPoint.latitude === lastPoint.latitude && firstPoint.longitude === lastPoint.longitude) {
      return true;
    }
  };
  Object.defineProperty(LineString2.prototype, "_internalType", {
    get: function() {
      return SYMBOL_GEO_LINE_STRING;
    },
    enumerable: false,
    configurable: true
  });
  return LineString2;
}();

// node_modules/@cloudbase/database/dist/esm/geo/polygon.js
var __values3 = function(o2) {
  var s2 = typeof Symbol === "function" && Symbol.iterator, m2 = s2 && o2[s2], i2 = 0;
  if (m2) return m2.call(o2);
  if (o2 && typeof o2.length === "number") return {
    next: function() {
      if (o2 && i2 >= o2.length) o2 = void 0;
      return { value: o2 && o2[i2++], done: !o2 };
    }
  };
  throw new TypeError(s2 ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var Polygon = function() {
  function Polygon2(lines) {
    if (!isArray3(lines)) {
      throw new TypeError('"lines" must be of type LineString[]. Received type '.concat(typeof lines));
    }
    if (lines.length === 0) {
      throw new Error("Polygon must contain 1 linestring at least");
    }
    lines.forEach(function(line) {
      if (!(line instanceof LineString)) {
        throw new TypeError('"lines" must be of type LineString[]. Received type '.concat(typeof line, "[]"));
      }
      if (!LineString.isClosed(line)) {
        throw new Error("LineString ".concat(line.points.map(function(p2) {
          return p2.toReadableString();
        }), " is not a closed cycle"));
      }
    });
    this.lines = lines;
  }
  Polygon2.prototype.parse = function(key) {
    var _a3;
    return _a3 = {}, _a3[key] = {
      type: "Polygon",
      coordinates: this.lines.map(function(line) {
        return line.points.map(function(point) {
          return [point.longitude, point.latitude];
        });
      })
    }, _a3;
  };
  Polygon2.prototype.toJSON = function() {
    return {
      type: "Polygon",
      coordinates: this.lines.map(function(line) {
        return line.points.map(function(point) {
          return [point.longitude, point.latitude];
        });
      })
    };
  };
  Polygon2.validate = function(polygon) {
    var e_1, _a3, e_2, _b;
    if (polygon.type !== "Polygon" || !isArray3(polygon.coordinates)) {
      return false;
    }
    try {
      for (var _c = __values3(polygon.coordinates), _d = _c.next(); !_d.done; _d = _c.next()) {
        var line = _d.value;
        if (!this.isCloseLineString(line)) {
          return false;
        }
        try {
          for (var line_1 = (e_2 = void 0, __values3(line)), line_1_1 = line_1.next(); !line_1_1.done; line_1_1 = line_1.next()) {
            var point = line_1_1.value;
            if (!isNumber(point[0]) || !isNumber(point[1])) {
              return false;
            }
          }
        } catch (e_2_1) {
          e_2 = { error: e_2_1 };
        } finally {
          try {
            if (line_1_1 && !line_1_1.done && (_b = line_1.return)) _b.call(line_1);
          } finally {
            if (e_2) throw e_2.error;
          }
        }
      }
    } catch (e_1_1) {
      e_1 = { error: e_1_1 };
    } finally {
      try {
        if (_d && !_d.done && (_a3 = _c.return)) _a3.call(_c);
      } finally {
        if (e_1) throw e_1.error;
      }
    }
    return true;
  };
  Polygon2.isCloseLineString = function(lineString) {
    var firstPoint = lineString[0];
    var lastPoint = lineString[lineString.length - 1];
    if (firstPoint[0] !== lastPoint[0] || firstPoint[1] !== lastPoint[1]) {
      return false;
    }
    return true;
  };
  Object.defineProperty(Polygon2.prototype, "_internalType", {
    get: function() {
      return SYMBOL_GEO_MULTI_POLYGON;
    },
    enumerable: false,
    configurable: true
  });
  return Polygon2;
}();

// node_modules/@cloudbase/database/dist/esm/geo/multiPoint.js
var __values4 = function(o2) {
  var s2 = typeof Symbol === "function" && Symbol.iterator, m2 = s2 && o2[s2], i2 = 0;
  if (m2) return m2.call(o2);
  if (o2 && typeof o2.length === "number") return {
    next: function() {
      if (o2 && i2 >= o2.length) o2 = void 0;
      return { value: o2 && o2[i2++], done: !o2 };
    }
  };
  throw new TypeError(s2 ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var MultiPoint = function() {
  function MultiPoint2(points) {
    if (!isArray3(points)) {
      throw new TypeError('"points" must be of type Point[]. Received type '.concat(typeof points));
    }
    if (points.length === 0) {
      throw new Error('"points" must contain 1 point at least');
    }
    points.forEach(function(point) {
      if (!(point instanceof Point)) {
        throw new TypeError('"points" must be of type Point[]. Received type '.concat(typeof point, "[]"));
      }
    });
    this.points = points;
  }
  MultiPoint2.prototype.parse = function(key) {
    var _a3;
    return _a3 = {}, _a3[key] = {
      type: "MultiPoint",
      coordinates: this.points.map(function(point) {
        return point.toJSON().coordinates;
      })
    }, _a3;
  };
  MultiPoint2.prototype.toJSON = function() {
    return {
      type: "MultiPoint",
      coordinates: this.points.map(function(point) {
        return point.toJSON().coordinates;
      })
    };
  };
  MultiPoint2.validate = function(multiPoint) {
    var e_1, _a3;
    if (multiPoint.type !== "MultiPoint" || !isArray3(multiPoint.coordinates)) {
      return false;
    }
    try {
      for (var _b = __values4(multiPoint.coordinates), _c = _b.next(); !_c.done; _c = _b.next()) {
        var point = _c.value;
        if (!isNumber(point[0]) || !isNumber(point[1])) {
          return false;
        }
      }
    } catch (e_1_1) {
      e_1 = { error: e_1_1 };
    } finally {
      try {
        if (_c && !_c.done && (_a3 = _b.return)) _a3.call(_b);
      } finally {
        if (e_1) throw e_1.error;
      }
    }
    return true;
  };
  Object.defineProperty(MultiPoint2.prototype, "_internalType", {
    get: function() {
      return SYMBOL_GEO_MULTI_POINT;
    },
    enumerable: false,
    configurable: true
  });
  return MultiPoint2;
}();

// node_modules/@cloudbase/database/dist/esm/geo/multiLineString.js
var __values5 = function(o2) {
  var s2 = typeof Symbol === "function" && Symbol.iterator, m2 = s2 && o2[s2], i2 = 0;
  if (m2) return m2.call(o2);
  if (o2 && typeof o2.length === "number") return {
    next: function() {
      if (o2 && i2 >= o2.length) o2 = void 0;
      return { value: o2 && o2[i2++], done: !o2 };
    }
  };
  throw new TypeError(s2 ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var MultiLineString = function() {
  function MultiLineString2(lines) {
    if (!isArray3(lines)) {
      throw new TypeError('"lines" must be of type LineString[]. Received type '.concat(typeof lines));
    }
    if (lines.length === 0) {
      throw new Error("Polygon must contain 1 linestring at least");
    }
    lines.forEach(function(line) {
      if (!(line instanceof LineString)) {
        throw new TypeError('"lines" must be of type LineString[]. Received type '.concat(typeof line, "[]"));
      }
    });
    this.lines = lines;
  }
  MultiLineString2.prototype.parse = function(key) {
    var _a3;
    return _a3 = {}, _a3[key] = {
      type: "MultiLineString",
      coordinates: this.lines.map(function(line) {
        return line.points.map(function(point) {
          return [point.longitude, point.latitude];
        });
      })
    }, _a3;
  };
  MultiLineString2.prototype.toJSON = function() {
    return {
      type: "MultiLineString",
      coordinates: this.lines.map(function(line) {
        return line.points.map(function(point) {
          return [point.longitude, point.latitude];
        });
      })
    };
  };
  MultiLineString2.validate = function(multiLineString) {
    var e_1, _a3, e_2, _b;
    if (multiLineString.type !== "MultiLineString" || !isArray3(multiLineString.coordinates)) {
      return false;
    }
    try {
      for (var _c = __values5(multiLineString.coordinates), _d = _c.next(); !_d.done; _d = _c.next()) {
        var line = _d.value;
        try {
          for (var line_1 = (e_2 = void 0, __values5(line)), line_1_1 = line_1.next(); !line_1_1.done; line_1_1 = line_1.next()) {
            var point = line_1_1.value;
            if (!isNumber(point[0]) || !isNumber(point[1])) {
              return false;
            }
          }
        } catch (e_2_1) {
          e_2 = { error: e_2_1 };
        } finally {
          try {
            if (line_1_1 && !line_1_1.done && (_b = line_1.return)) _b.call(line_1);
          } finally {
            if (e_2) throw e_2.error;
          }
        }
      }
    } catch (e_1_1) {
      e_1 = { error: e_1_1 };
    } finally {
      try {
        if (_d && !_d.done && (_a3 = _c.return)) _a3.call(_c);
      } finally {
        if (e_1) throw e_1.error;
      }
    }
    return true;
  };
  Object.defineProperty(MultiLineString2.prototype, "_internalType", {
    get: function() {
      return SYMBOL_GEO_MULTI_LINE_STRING;
    },
    enumerable: false,
    configurable: true
  });
  return MultiLineString2;
}();

// node_modules/@cloudbase/database/dist/esm/geo/multiPolygon.js
var __values6 = function(o2) {
  var s2 = typeof Symbol === "function" && Symbol.iterator, m2 = s2 && o2[s2], i2 = 0;
  if (m2) return m2.call(o2);
  if (o2 && typeof o2.length === "number") return {
    next: function() {
      if (o2 && i2 >= o2.length) o2 = void 0;
      return { value: o2 && o2[i2++], done: !o2 };
    }
  };
  throw new TypeError(s2 ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var MultiPolygon = function() {
  function MultiPolygon2(polygons) {
    var e_1, _a3;
    if (!isArray3(polygons)) {
      throw new TypeError('"polygons" must be of type Polygon[]. Received type '.concat(typeof polygons));
    }
    if (polygons.length === 0) {
      throw new Error("MultiPolygon must contain 1 polygon at least");
    }
    try {
      for (var polygons_1 = __values6(polygons), polygons_1_1 = polygons_1.next(); !polygons_1_1.done; polygons_1_1 = polygons_1.next()) {
        var polygon = polygons_1_1.value;
        if (!(polygon instanceof Polygon)) {
          throw new TypeError('"polygon" must be of type Polygon[]. Received type '.concat(typeof polygon, "[]"));
        }
      }
    } catch (e_1_1) {
      e_1 = { error: e_1_1 };
    } finally {
      try {
        if (polygons_1_1 && !polygons_1_1.done && (_a3 = polygons_1.return)) _a3.call(polygons_1);
      } finally {
        if (e_1) throw e_1.error;
      }
    }
    this.polygons = polygons;
  }
  MultiPolygon2.prototype.parse = function(key) {
    var _a3;
    return _a3 = {}, _a3[key] = {
      type: "MultiPolygon",
      coordinates: this.polygons.map(function(polygon) {
        return polygon.lines.map(function(line) {
          return line.points.map(function(point) {
            return [point.longitude, point.latitude];
          });
        });
      })
    }, _a3;
  };
  MultiPolygon2.prototype.toJSON = function() {
    return {
      type: "MultiPolygon",
      coordinates: this.polygons.map(function(polygon) {
        return polygon.lines.map(function(line) {
          return line.points.map(function(point) {
            return [point.longitude, point.latitude];
          });
        });
      })
    };
  };
  MultiPolygon2.validate = function(multiPolygon) {
    var e_2, _a3, e_3, _b, e_4, _c;
    if (multiPolygon.type !== "MultiPolygon" || !isArray3(multiPolygon.coordinates)) {
      return false;
    }
    try {
      for (var _d = __values6(multiPolygon.coordinates), _e2 = _d.next(); !_e2.done; _e2 = _d.next()) {
        var polygon = _e2.value;
        try {
          for (var polygon_1 = (e_3 = void 0, __values6(polygon)), polygon_1_1 = polygon_1.next(); !polygon_1_1.done; polygon_1_1 = polygon_1.next()) {
            var line = polygon_1_1.value;
            try {
              for (var line_1 = (e_4 = void 0, __values6(line)), line_1_1 = line_1.next(); !line_1_1.done; line_1_1 = line_1.next()) {
                var point = line_1_1.value;
                if (!isNumber(point[0]) || !isNumber(point[1])) {
                  return false;
                }
              }
            } catch (e_4_1) {
              e_4 = { error: e_4_1 };
            } finally {
              try {
                if (line_1_1 && !line_1_1.done && (_c = line_1.return)) _c.call(line_1);
              } finally {
                if (e_4) throw e_4.error;
              }
            }
          }
        } catch (e_3_1) {
          e_3 = { error: e_3_1 };
        } finally {
          try {
            if (polygon_1_1 && !polygon_1_1.done && (_b = polygon_1.return)) _b.call(polygon_1);
          } finally {
            if (e_3) throw e_3.error;
          }
        }
      }
    } catch (e_2_1) {
      e_2 = { error: e_2_1 };
    } finally {
      try {
        if (_e2 && !_e2.done && (_a3 = _d.return)) _a3.call(_d);
      } finally {
        if (e_2) throw e_2.error;
      }
    }
    return true;
  };
  Object.defineProperty(MultiPolygon2.prototype, "_internalType", {
    get: function() {
      return SYMBOL_GEO_POLYGON;
    },
    enumerable: false,
    configurable: true
  });
  return MultiPolygon2;
}();

// node_modules/@cloudbase/database/dist/esm/lib/util.js
var createPromiseCallback2 = function() {
  var cb = function() {
  };
  if (!Promise) {
    cb.promise = {};
    var throwPromiseNotDefined = function() {
      throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.');
    };
    Object.defineProperty(cb.promise, "then", { get: throwPromiseNotDefined });
    Object.defineProperty(cb.promise, "catch", { get: throwPromiseNotDefined });
    return cb;
  }
  var promise = new Promise(function(resolve, reject) {
    cb = function(err, data2) {
      if (err)
        return reject(err);
      return resolve(data2);
    };
  });
  cb.promise = promise;
  return cb;
};

// node_modules/@cloudbase/database/dist/esm/commands/update.js
var UPDATE_COMMANDS_LITERAL;
(function(UPDATE_COMMANDS_LITERAL2) {
  UPDATE_COMMANDS_LITERAL2["SET"] = "set";
  UPDATE_COMMANDS_LITERAL2["REMOVE"] = "remove";
  UPDATE_COMMANDS_LITERAL2["INC"] = "inc";
  UPDATE_COMMANDS_LITERAL2["MUL"] = "mul";
  UPDATE_COMMANDS_LITERAL2["PUSH"] = "push";
  UPDATE_COMMANDS_LITERAL2["PULL"] = "pull";
  UPDATE_COMMANDS_LITERAL2["PULL_ALL"] = "pullAll";
  UPDATE_COMMANDS_LITERAL2["POP"] = "pop";
  UPDATE_COMMANDS_LITERAL2["SHIFT"] = "shift";
  UPDATE_COMMANDS_LITERAL2["UNSHIFT"] = "unshift";
  UPDATE_COMMANDS_LITERAL2["ADD_TO_SET"] = "addToSet";
  UPDATE_COMMANDS_LITERAL2["BIT"] = "bit";
  UPDATE_COMMANDS_LITERAL2["RENAME"] = "rename";
  UPDATE_COMMANDS_LITERAL2["MAX"] = "max";
  UPDATE_COMMANDS_LITERAL2["MIN"] = "min";
})(UPDATE_COMMANDS_LITERAL || (UPDATE_COMMANDS_LITERAL = {}));
var UpdateCommand = function() {
  function UpdateCommand2(operator, operands, fieldName) {
    this._internalType = SYMBOL_UPDATE_COMMAND;
    Object.defineProperties(this, {
      _internalType: {
        enumerable: false,
        configurable: false
      }
    });
    this.operator = operator;
    this.operands = operands;
    this.fieldName = fieldName || SYMBOL_UNSET_FIELD_NAME;
  }
  UpdateCommand2.prototype._setFieldName = function(fieldName) {
    var command = new UpdateCommand2(this.operator, this.operands, fieldName);
    return command;
  };
  return UpdateCommand2;
}();
function isUpdateCommand(object) {
  return object && object instanceof UpdateCommand && object._internalType === SYMBOL_UPDATE_COMMAND;
}

// node_modules/@cloudbase/database/dist/esm/commands/logic.js
var LOGIC_COMMANDS_LITERAL;
(function(LOGIC_COMMANDS_LITERAL2) {
  LOGIC_COMMANDS_LITERAL2["AND"] = "and";
  LOGIC_COMMANDS_LITERAL2["OR"] = "or";
  LOGIC_COMMANDS_LITERAL2["NOT"] = "not";
  LOGIC_COMMANDS_LITERAL2["NOR"] = "nor";
})(LOGIC_COMMANDS_LITERAL || (LOGIC_COMMANDS_LITERAL = {}));
var LogicCommand = function() {
  function LogicCommand2(operator, operands, fieldName) {
    this._internalType = SYMBOL_LOGIC_COMMAND;
    Object.defineProperties(this, {
      _internalType: {
        enumerable: false,
        configurable: false
      }
    });
    this.operator = operator;
    this.operands = operands;
    this.fieldName = fieldName || SYMBOL_UNSET_FIELD_NAME;
    if (this.fieldName !== SYMBOL_UNSET_FIELD_NAME) {
      if (Array.isArray(operands)) {
        operands = operands.slice();
        this.operands = operands;
        for (var i2 = 0, len = operands.length; i2 < len; i2++) {
          var query = operands[i2];
          if (isLogicCommand(query) || isQueryCommand(query)) {
            operands[i2] = query._setFieldName(this.fieldName);
          }
        }
      } else {
        var query = operands;
        if (isLogicCommand(query) || isQueryCommand(query)) {
          operands = query._setFieldName(this.fieldName);
        }
      }
    }
  }
  LogicCommand2.prototype._setFieldName = function(fieldName) {
    var operands = this.operands.map(function(operand) {
      if (operand instanceof LogicCommand2) {
        return operand._setFieldName(fieldName);
      } else {
        return operand;
      }
    });
    var command = new LogicCommand2(this.operator, operands, fieldName);
    return command;
  };
  LogicCommand2.prototype.and = function() {
    var __expressions__ = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      __expressions__[_i] = arguments[_i];
    }
    var expressions = Array.isArray(arguments[0]) ? arguments[0] : Array.from(arguments);
    expressions.unshift(this);
    return new LogicCommand2(LOGIC_COMMANDS_LITERAL.AND, expressions, this.fieldName);
  };
  LogicCommand2.prototype.or = function() {
    var __expressions__ = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      __expressions__[_i] = arguments[_i];
    }
    var expressions = Array.isArray(arguments[0]) ? arguments[0] : Array.from(arguments);
    expressions.unshift(this);
    return new LogicCommand2(LOGIC_COMMANDS_LITERAL.OR, expressions, this.fieldName);
  };
  return LogicCommand2;
}();
function isLogicCommand(object) {
  return object && object instanceof LogicCommand && object._internalType === SYMBOL_LOGIC_COMMAND;
}

// node_modules/@cloudbase/database/dist/esm/commands/query.js
var __extends12 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var QUERY_COMMANDS_LITERAL;
(function(QUERY_COMMANDS_LITERAL2) {
  QUERY_COMMANDS_LITERAL2["EQ"] = "eq";
  QUERY_COMMANDS_LITERAL2["NEQ"] = "neq";
  QUERY_COMMANDS_LITERAL2["GT"] = "gt";
  QUERY_COMMANDS_LITERAL2["GTE"] = "gte";
  QUERY_COMMANDS_LITERAL2["LT"] = "lt";
  QUERY_COMMANDS_LITERAL2["LTE"] = "lte";
  QUERY_COMMANDS_LITERAL2["IN"] = "in";
  QUERY_COMMANDS_LITERAL2["NIN"] = "nin";
  QUERY_COMMANDS_LITERAL2["ALL"] = "all";
  QUERY_COMMANDS_LITERAL2["ELEM_MATCH"] = "elemMatch";
  QUERY_COMMANDS_LITERAL2["EXISTS"] = "exists";
  QUERY_COMMANDS_LITERAL2["SIZE"] = "size";
  QUERY_COMMANDS_LITERAL2["MOD"] = "mod";
  QUERY_COMMANDS_LITERAL2["GEO_NEAR"] = "geoNear";
  QUERY_COMMANDS_LITERAL2["GEO_WITHIN"] = "geoWithin";
  QUERY_COMMANDS_LITERAL2["GEO_INTERSECTS"] = "geoIntersects";
})(QUERY_COMMANDS_LITERAL || (QUERY_COMMANDS_LITERAL = {}));
var QueryCommand = function(_super) {
  __extends12(QueryCommand2, _super);
  function QueryCommand2(operator, operands, fieldName) {
    var _this = _super.call(this, operator, operands, fieldName) || this;
    _this.operator = operator;
    _this._internalType = SYMBOL_QUERY_COMMAND;
    return _this;
  }
  QueryCommand2.prototype.toJSON = function() {
    var _a3, _b;
    switch (this.operator) {
      case QUERY_COMMANDS_LITERAL.IN:
      case QUERY_COMMANDS_LITERAL.NIN:
        return _a3 = {}, _a3["$" + this.operator] = this.operands, _a3;
      default:
        return _b = {}, _b["$" + this.operator] = this.operands[0], _b;
    }
  };
  QueryCommand2.prototype._setFieldName = function(fieldName) {
    var command = new QueryCommand2(this.operator, this.operands, fieldName);
    return command;
  };
  QueryCommand2.prototype.eq = function(val) {
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.EQ, [val], this.fieldName);
    return this.and(command);
  };
  QueryCommand2.prototype.neq = function(val) {
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.NEQ, [val], this.fieldName);
    return this.and(command);
  };
  QueryCommand2.prototype.gt = function(val) {
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.GT, [val], this.fieldName);
    return this.and(command);
  };
  QueryCommand2.prototype.gte = function(val) {
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.GTE, [val], this.fieldName);
    return this.and(command);
  };
  QueryCommand2.prototype.lt = function(val) {
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.LT, [val], this.fieldName);
    return this.and(command);
  };
  QueryCommand2.prototype.lte = function(val) {
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.LTE, [val], this.fieldName);
    return this.and(command);
  };
  QueryCommand2.prototype.in = function(list) {
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.IN, list, this.fieldName);
    return this.and(command);
  };
  QueryCommand2.prototype.nin = function(list) {
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.NIN, list, this.fieldName);
    return this.and(command);
  };
  QueryCommand2.prototype.geoNear = function(val) {
    if (!(val.geometry instanceof Point)) {
      throw new TypeError('"geometry" must be of type Point. Received type '.concat(typeof val.geometry));
    }
    if (val.maxDistance !== void 0 && !isNumber(val.maxDistance)) {
      throw new TypeError('"maxDistance" must be of type Number. Received type '.concat(typeof val.maxDistance));
    }
    if (val.minDistance !== void 0 && !isNumber(val.minDistance)) {
      throw new TypeError('"minDistance" must be of type Number. Received type '.concat(typeof val.minDistance));
    }
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.GEO_NEAR, [val], this.fieldName);
    return this.and(command);
  };
  QueryCommand2.prototype.geoWithin = function(val) {
    if (!(val.geometry instanceof MultiPolygon) && !(val.geometry instanceof Polygon)) {
      throw new TypeError('"geometry" must be of type Polygon or MultiPolygon. Received type '.concat(typeof val.geometry));
    }
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.GEO_WITHIN, [val], this.fieldName);
    return this.and(command);
  };
  QueryCommand2.prototype.geoIntersects = function(val) {
    if (!(val.geometry instanceof Point) && !(val.geometry instanceof LineString) && !(val.geometry instanceof Polygon) && !(val.geometry instanceof MultiPoint) && !(val.geometry instanceof MultiLineString) && !(val.geometry instanceof MultiPolygon)) {
      throw new TypeError('"geometry" must be of type Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon. Received type '.concat(typeof val.geometry));
    }
    var command = new QueryCommand2(QUERY_COMMANDS_LITERAL.GEO_INTERSECTS, [val], this.fieldName);
    return this.and(command);
  };
  return QueryCommand2;
}(LogicCommand);
function isQueryCommand(object) {
  return object && object instanceof QueryCommand && object._internalType === SYMBOL_QUERY_COMMAND;
}
function isComparisonCommand(object) {
  return isQueryCommand(object);
}

// node_modules/@cloudbase/database/dist/esm/operator-map.js
var OperatorMap2 = {};
for (key in QUERY_COMMANDS_LITERAL) {
  OperatorMap2[key] = "$" + key;
}
var key;
for (key in LOGIC_COMMANDS_LITERAL) {
  OperatorMap2[key] = "$" + key;
}
var key;
for (key in UPDATE_COMMANDS_LITERAL) {
  OperatorMap2[key] = "$" + key;
}
var key;
OperatorMap2[QUERY_COMMANDS_LITERAL.NEQ] = "$ne";
OperatorMap2[UPDATE_COMMANDS_LITERAL.REMOVE] = "$unset";
OperatorMap2[UPDATE_COMMANDS_LITERAL.SHIFT] = "$pop";
OperatorMap2[UPDATE_COMMANDS_LITERAL.UNSHIFT] = "$push";
function operatorToString(operator) {
  return OperatorMap2[operator] || "$" + operator;
}

// node_modules/@cloudbase/database/dist/esm/serializer/datatype.js
var __assign37 = function() {
  __assign37 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign37.apply(this, arguments);
};
var __read2 = function(o2, n3) {
  var m2 = typeof Symbol === "function" && o2[Symbol.iterator];
  if (!m2) return o2;
  var i2 = m2.call(o2), r3, ar2 = [], e3;
  try {
    while ((n3 === void 0 || n3-- > 0) && !(r3 = i2.next()).done) ar2.push(r3.value);
  } catch (error) {
    e3 = { error };
  } finally {
    try {
      if (r3 && !r3.done && (m2 = i2["return"])) m2.call(i2);
    } finally {
      if (e3) throw e3.error;
    }
  }
  return ar2;
};
var __spreadArray5 = function(to2, from2, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from2.length, ar2; i2 < l2; i2++) {
    if (ar2 || !(i2 in from2)) {
      if (!ar2) ar2 = Array.prototype.slice.call(from2, 0, i2);
      ar2[i2] = from2[i2];
    }
  }
  return to2.concat(ar2 || Array.prototype.slice.call(from2));
};
function serialize2(val) {
  return serializeHelper(val, [val]);
}
function serializeHelper(val, visited) {
  if (isInternalObject(val)) {
    switch (val._internalType) {
      case SYMBOL_GEO_POINT: {
        return val.toJSON();
      }
      case SYMBOL_SERVER_DATE: {
        return val.parse();
      }
      case SYMBOL_REGEXP: {
        return val.parse();
      }
      default: {
        return val.toJSON ? val.toJSON() : val;
      }
    }
  } else if (isDate(val)) {
    return {
      $date: +val
    };
  } else if (isRegExp(val)) {
    return {
      $regex: val.source,
      $options: val.flags
    };
  } else if (isArray3(val)) {
    return val.map(function(item) {
      if (visited.indexOf(item) > -1) {
        throw new Error("Cannot convert circular structure to JSON");
      }
      return serializeHelper(item, __spreadArray5(__spreadArray5([], __read2(visited), false), [
        item
      ], false));
    });
  } else if (isObject2(val)) {
    var ret = __assign37({}, val);
    for (var key in ret) {
      if (visited.indexOf(ret[key]) > -1) {
        throw new Error("Cannot convert circular structure to JSON");
      }
      ret[key] = serializeHelper(ret[key], __spreadArray5(__spreadArray5([], __read2(visited), false), [
        ret[key]
      ], false));
    }
    return ret;
  } else {
    return val;
  }
}

// node_modules/@cloudbase/database/dist/esm/serializer/common.js
var __assign38 = function() {
  __assign38 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign38.apply(this, arguments);
};
var __read3 = function(o2, n3) {
  var m2 = typeof Symbol === "function" && o2[Symbol.iterator];
  if (!m2) return o2;
  var i2 = m2.call(o2), r3, ar2 = [], e3;
  try {
    while ((n3 === void 0 || n3-- > 0) && !(r3 = i2.next()).done) ar2.push(r3.value);
  } catch (error) {
    e3 = { error };
  } finally {
    try {
      if (r3 && !r3.done && (m2 = i2["return"])) m2.call(i2);
    } finally {
      if (e3) throw e3.error;
    }
  }
  return ar2;
};
var __spreadArray6 = function(to2, from2, pack) {
  if (pack || arguments.length === 2) for (var i2 = 0, l2 = from2.length, ar2; i2 < l2; i2++) {
    if (ar2 || !(i2 in from2)) {
      if (!ar2) ar2 = Array.prototype.slice.call(from2, 0, i2);
      ar2[i2] = from2[i2];
    }
  }
  return to2.concat(ar2 || Array.prototype.slice.call(from2));
};
function flatten(query, shouldPreserverObject, parents, visited) {
  var cloned = __assign38({}, query);
  for (var key in query) {
    if (/^\$/.test(key))
      continue;
    var value = query[key];
    if (!value)
      continue;
    if (isObject2(value) && !shouldPreserverObject(value)) {
      if (visited.indexOf(value) > -1) {
        throw new Error("Cannot convert circular structure to JSON");
      }
      var newParents = __spreadArray6(__spreadArray6([], __read3(parents), false), [
        key
      ], false);
      var newVisited = __spreadArray6(__spreadArray6([], __read3(visited), false), [
        value
      ], false);
      var flattenedChild = flatten(value, shouldPreserverObject, newParents, newVisited);
      cloned[key] = flattenedChild;
      var hasKeyNotCombined = false;
      for (var childKey in flattenedChild) {
        if (!/^\$/.test(childKey)) {
          cloned["".concat(key, ".").concat(childKey)] = flattenedChild[childKey];
          delete cloned[key][childKey];
        } else {
          hasKeyNotCombined = true;
        }
      }
      if (!hasKeyNotCombined) {
        delete cloned[key];
      }
    }
  }
  return cloned;
}
function flattenQueryObject(query) {
  return flatten(query, isConversionRequired, [], [query]);
}
function mergeConditionAfterEncode(query, condition, key) {
  if (!condition[key]) {
    delete query[key];
  }
  for (var conditionKey in condition) {
    if (query[conditionKey]) {
      if (isArray3(query[conditionKey])) {
        query[conditionKey].push(condition[conditionKey]);
      } else if (isObject2(query[conditionKey])) {
        if (isObject2(condition[conditionKey])) {
          Object.assign(query[conditionKey], condition[conditionKey]);
        } else {
          console.warn("unmergable condition, query is object but condition is ".concat(getType(condition), ", can only overwrite"), condition, key);
          query[conditionKey] = condition[conditionKey];
        }
      } else {
        console.warn("to-merge query is of type ".concat(getType(query), ", can only overwrite"), query, condition, key);
        query[conditionKey] = condition[conditionKey];
      }
    } else {
      query[conditionKey] = condition[conditionKey];
    }
  }
}
function isConversionRequired(val) {
  return isInternalObject(val) || isDate(val) || isRegExp(val);
}
function encodeInternalDataType(val) {
  return serialize2(val);
}

// node_modules/@cloudbase/database/dist/esm/serializer/update.js
var UpdateSerializer = function() {
  function UpdateSerializer2() {
  }
  UpdateSerializer2.encode = function(query) {
    var stringifier = new UpdateSerializer2();
    return stringifier.encodeUpdate(query);
  };
  UpdateSerializer2.prototype.encodeUpdate = function(query) {
    if (isUpdateCommand(query)) {
      return this.encodeUpdateCommand(query);
    } else if (getType(query) === "object") {
      return this.encodeUpdateObject(query);
    } else {
      return query;
    }
  };
  UpdateSerializer2.prototype.encodeUpdateCommand = function(query) {
    if (query.fieldName === SYMBOL_UNSET_FIELD_NAME) {
      throw new Error("Cannot encode a comparison command with unset field name");
    }
    switch (query.operator) {
      case UPDATE_COMMANDS_LITERAL.PUSH:
      case UPDATE_COMMANDS_LITERAL.PULL:
      case UPDATE_COMMANDS_LITERAL.PULL_ALL:
      case UPDATE_COMMANDS_LITERAL.POP:
      case UPDATE_COMMANDS_LITERAL.SHIFT:
      case UPDATE_COMMANDS_LITERAL.UNSHIFT:
      case UPDATE_COMMANDS_LITERAL.ADD_TO_SET: {
        return this.encodeArrayUpdateCommand(query);
      }
      default: {
        return this.encodeFieldUpdateCommand(query);
      }
    }
  };
  UpdateSerializer2.prototype.encodeFieldUpdateCommand = function(query) {
    var _a3, _b, _c, _d;
    var $op = operatorToString(query.operator);
    switch (query.operator) {
      case UPDATE_COMMANDS_LITERAL.REMOVE: {
        return _a3 = {}, _a3[$op] = (_b = {}, _b[query.fieldName] = "", _b), _a3;
      }
      default: {
        return _c = {}, _c[$op] = (_d = {}, _d[query.fieldName] = query.operands[0], _d), _c;
      }
    }
  };
  UpdateSerializer2.prototype.encodeArrayUpdateCommand = function(query) {
    var _a3, _b, _c, _d, _e2, _f, _g, _h, _j, _k;
    var $op = operatorToString(query.operator);
    switch (query.operator) {
      case UPDATE_COMMANDS_LITERAL.PUSH: {
        var modifiers = void 0;
        if (isArray3(query.operands)) {
          modifiers = {
            $each: query.operands.map(encodeInternalDataType)
          };
        } else {
          modifiers = query.operands;
        }
        return _a3 = {}, _a3[$op] = (_b = {}, _b[query.fieldName] = modifiers, _b), _a3;
      }
      case UPDATE_COMMANDS_LITERAL.UNSHIFT: {
        var modifiers = {
          $each: query.operands.map(encodeInternalDataType),
          $position: 0
        };
        return _c = {}, _c[$op] = (_d = {}, _d[query.fieldName] = modifiers, _d), _c;
      }
      case UPDATE_COMMANDS_LITERAL.POP: {
        return _e2 = {}, _e2[$op] = (_f = {}, _f[query.fieldName] = 1, _f), _e2;
      }
      case UPDATE_COMMANDS_LITERAL.SHIFT: {
        return _g = {}, _g[$op] = (_h = {}, _h[query.fieldName] = -1, _h), _g;
      }
      default: {
        return _j = {}, _j[$op] = (_k = {}, _k[query.fieldName] = encodeInternalDataType(query.operands), _k), _j;
      }
    }
  };
  UpdateSerializer2.prototype.encodeUpdateObject = function(query) {
    var flattened = flattenQueryObject(query);
    for (var key in flattened) {
      if (/^\$/.test(key))
        continue;
      var val = flattened[key];
      if (isUpdateCommand(val)) {
        flattened[key] = val._setFieldName(key);
        var condition = this.encodeUpdateCommand(flattened[key]);
        mergeConditionAfterEncode(flattened, condition, key);
      } else {
        flattened[key] = val = encodeInternalDataType(val);
        var $setCommand = new UpdateCommand(UPDATE_COMMANDS_LITERAL.SET, [val], key);
        var condition = this.encodeUpdateCommand($setCommand);
        mergeConditionAfterEncode(flattened, condition, key);
      }
    }
    return flattened;
  };
  return UpdateSerializer2;
}();

// node_modules/@cloudbase/database/dist/esm/utils/utils.js
var wsList = {};
function getWsInstance(db) {
  if (!Db.wsClientClass) {
    throw new Error("to use realtime you must import realtime module first");
  }
  var env = db.config.env;
  if (!wsList[env]) {
    wsList[env] = new Db.wsClientClass({
      context: {
        appConfig: {
          docSizeLimit: 1e3,
          realtimePingInterval: 1e4,
          realtimePongWaitTimeout: 5e3,
          request: Db.createRequest(db.config)
        }
      }
    });
  }
  return wsList[env];
}

// node_modules/@cloudbase/database/dist/esm/document.js
var __assign39 = function() {
  __assign39 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign39.apply(this, arguments);
};
var DocumentReference = function() {
  function DocumentReference3(db, coll, docID, projection) {
    if (projection === void 0) {
      projection = {};
    }
    var _this = this;
    this.watch = function(options) {
      var ws = getWsInstance(_this._db);
      return ws.watch(__assign39(__assign39({}, options), { envId: _this._db.config.env, collectionName: _this._coll, query: JSON.stringify({
        _id: _this.id
      }) }));
    };
    this._db = db;
    this._coll = coll;
    this.id = docID;
    this.request = Db.createRequest(this._db.config);
    this.projection = projection;
  }
  DocumentReference3.prototype.create = function(data2, callback) {
    callback = callback || createPromiseCallback2();
    var params = {
      collectionName: this._coll,
      data: serialize2(data2)
    };
    if (this.id) {
      params["_id"] = this.id;
    }
    this.request.send("database.addDocument", params).then(function(res) {
      if (res.code) {
        callback(0, res);
      } else {
        callback(0, {
          id: res.data._id,
          requestId: res.requestId
        });
      }
    }).catch(function(err) {
      callback(err);
    });
    return callback.promise;
  };
  DocumentReference3.prototype.set = function(data2, callback) {
    callback = callback || createPromiseCallback2();
    if (!this.id) {
      return Promise.resolve({
        code: "INVALID_PARAM",
        message: "docId"
      });
    }
    if (!data2 || typeof data2 !== "object") {
      return Promise.resolve({
        code: "INVALID_PARAM",
        message: ""
      });
    }
    if (data2.hasOwnProperty("_id")) {
      return Promise.resolve({
        code: "INVALID_PARAM",
        message: "_id"
      });
    }
    var hasOperator = false;
    var checkMixed = function(objs) {
      if (typeof objs === "object") {
        for (var key in objs) {
          if (objs[key] instanceof UpdateCommand) {
            hasOperator = true;
          } else if (typeof objs[key] === "object") {
            checkMixed(objs[key]);
          }
        }
      }
    };
    checkMixed(data2);
    if (hasOperator) {
      return Promise.resolve({
        code: "DATABASE_REQUEST_FAILED",
        message: "update operator complicit"
      });
    }
    var merge = false;
    var param = {
      collectionName: this._coll,
      queryType: QueryType.DOC,
      data: serialize2(data2),
      multi: false,
      merge,
      upsert: true
    };
    if (this.id) {
      param["query"] = { _id: this.id };
    }
    this.request.send("database.updateDocument", param).then(function(res) {
      if (res.code) {
        callback(0, res);
      } else {
        callback(0, {
          updated: res.data.updated,
          upsertedId: res.data.upserted_id,
          requestId: res.requestId
        });
      }
    }).catch(function(err) {
      callback(err);
    });
    return callback.promise;
  };
  DocumentReference3.prototype.update = function(data2, callback) {
    callback = callback || createPromiseCallback2();
    if (!data2 || typeof data2 !== "object") {
      return Promise.resolve({
        code: "INVALID_PARAM",
        message: ""
      });
    }
    if (data2.hasOwnProperty("_id")) {
      return Promise.resolve({
        code: "INVALID_PARAM",
        message: "_id"
      });
    }
    var query = { _id: this.id };
    var merge = true;
    var param = {
      collectionName: this._coll,
      data: UpdateSerializer.encode(data2),
      query,
      queryType: QueryType.DOC,
      multi: false,
      merge,
      upsert: false
    };
    this.request.send("database.updateDocument", param).then(function(res) {
      if (res.code) {
        callback(0, res);
      } else {
        callback(0, {
          updated: res.data.updated,
          upsertedId: res.data.upserted_id,
          requestId: res.requestId
        });
      }
    }).catch(function(err) {
      callback(err);
    });
    return callback.promise;
  };
  DocumentReference3.prototype.remove = function(callback) {
    callback = callback || createPromiseCallback2();
    var query = { _id: this.id };
    var param = {
      collectionName: this._coll,
      query,
      queryType: QueryType.DOC,
      multi: false
    };
    this.request.send("database.deleteDocument", param).then(function(res) {
      if (res.code) {
        callback(0, res);
      } else {
        callback(0, {
          deleted: res.data.deleted,
          requestId: res.requestId
        });
      }
    }).catch(function(err) {
      callback(err);
    });
    return callback.promise;
  };
  DocumentReference3.prototype.get = function(callback) {
    callback = callback || createPromiseCallback2();
    var query = { _id: this.id };
    var param = {
      collectionName: this._coll,
      query,
      queryType: QueryType.DOC,
      multi: false,
      projection: this.projection
    };
    this.request.send("database.queryDocument", param).then(function(res) {
      if (res.code) {
        callback(0, res);
      } else {
        var documents = Util.formatResDocumentData(res.data.list);
        callback(0, {
          data: documents,
          requestId: res.requestId
        });
      }
    }).catch(function(err) {
      callback(err);
    });
    return callback.promise;
  };
  DocumentReference3.prototype.field = function(projection) {
    for (var k2 in projection) {
      if (projection[k2]) {
        projection[k2] = 1;
      } else {
        projection[k2] = 0;
      }
    }
    return new DocumentReference3(this._db, this._coll, this.id, projection);
  };
  return DocumentReference3;
}();

// node_modules/@cloudbase/database/dist/esm/serializer/query.js
var QuerySerializer = function() {
  function QuerySerializer2() {
  }
  QuerySerializer2.encode = function(query) {
    var encoder = new QueryEncoder();
    return encoder.encodeQuery(query);
  };
  return QuerySerializer2;
}();
var QueryEncoder = function() {
  function QueryEncoder2() {
  }
  QueryEncoder2.prototype.encodeQuery = function(query, key) {
    var _a3;
    if (isConversionRequired(query)) {
      if (isLogicCommand(query)) {
        return this.encodeLogicCommand(query);
      } else if (isQueryCommand(query)) {
        return this.encodeQueryCommand(query);
      } else {
        return _a3 = {}, _a3[key] = this.encodeQueryObject(query), _a3;
      }
    } else {
      if (isObject2(query)) {
        return this.encodeQueryObject(query);
      } else {
        return query;
      }
    }
  };
  QueryEncoder2.prototype.encodeRegExp = function(query) {
    return {
      $regex: query.source,
      $options: query.flags
    };
  };
  QueryEncoder2.prototype.encodeLogicCommand = function(query) {
    var _a3, _b, _c, _d, _e2, _f, _g;
    var _this = this;
    switch (query.operator) {
      case LOGIC_COMMANDS_LITERAL.NOR:
      case LOGIC_COMMANDS_LITERAL.AND:
      case LOGIC_COMMANDS_LITERAL.OR: {
        var $op = operatorToString(query.operator);
        var subqueries = query.operands.map(function(oprand) {
          return _this.encodeQuery(oprand, query.fieldName);
        });
        return _a3 = {}, _a3[$op] = subqueries, _a3;
      }
      case LOGIC_COMMANDS_LITERAL.NOT: {
        var $op = operatorToString(query.operator);
        var operatorExpression = query.operands[0];
        if (isRegExp(operatorExpression)) {
          return _b = {}, _b[query.fieldName] = (_c = {}, _c[$op] = this.encodeRegExp(operatorExpression), _c), _b;
        } else {
          var subqueries = this.encodeQuery(operatorExpression)[query.fieldName];
          return _d = {}, _d[query.fieldName] = (_e2 = {}, _e2[$op] = subqueries, _e2), _d;
        }
      }
      default: {
        var $op = operatorToString(query.operator);
        if (query.operands.length === 1) {
          var subquery = this.encodeQuery(query.operands[0]);
          return _f = {}, _f[$op] = subquery, _f;
        } else {
          var subqueries = query.operands.map(this.encodeQuery.bind(this));
          return _g = {}, _g[$op] = subqueries, _g;
        }
      }
    }
  };
  QueryEncoder2.prototype.encodeQueryCommand = function(query) {
    if (isComparisonCommand(query)) {
      return this.encodeComparisonCommand(query);
    } else {
      return this.encodeComparisonCommand(query);
    }
  };
  QueryEncoder2.prototype.encodeComparisonCommand = function(query) {
    var _a3, _b, _c, _d, _e2, _f, _g, _h, _j;
    if (query.fieldName === SYMBOL_UNSET_FIELD_NAME) {
      throw new Error("Cannot encode a comparison command with unset field name");
    }
    var $op = operatorToString(query.operator);
    switch (query.operator) {
      case QUERY_COMMANDS_LITERAL.EQ:
      case QUERY_COMMANDS_LITERAL.NEQ:
      case QUERY_COMMANDS_LITERAL.LT:
      case QUERY_COMMANDS_LITERAL.LTE:
      case QUERY_COMMANDS_LITERAL.GT:
      case QUERY_COMMANDS_LITERAL.GTE:
      case QUERY_COMMANDS_LITERAL.ELEM_MATCH:
      case QUERY_COMMANDS_LITERAL.EXISTS:
      case QUERY_COMMANDS_LITERAL.SIZE:
      case QUERY_COMMANDS_LITERAL.MOD: {
        return _a3 = {}, _a3[query.fieldName] = (_b = {}, _b[$op] = encodeInternalDataType(query.operands[0]), _b), _a3;
      }
      case QUERY_COMMANDS_LITERAL.IN:
      case QUERY_COMMANDS_LITERAL.NIN:
      case QUERY_COMMANDS_LITERAL.ALL: {
        return _c = {}, _c[query.fieldName] = (_d = {}, _d[$op] = encodeInternalDataType(query.operands), _d), _c;
      }
      case QUERY_COMMANDS_LITERAL.GEO_NEAR: {
        var options = query.operands[0];
        return _e2 = {}, _e2[query.fieldName] = {
          $nearSphere: {
            $geometry: options.geometry.toJSON(),
            $maxDistance: options.maxDistance,
            $minDistance: options.minDistance
          }
        }, _e2;
      }
      case QUERY_COMMANDS_LITERAL.GEO_WITHIN: {
        var options = query.operands[0];
        return _f = {}, _f[query.fieldName] = {
          $geoWithin: {
            $geometry: options.geometry.toJSON()
          }
        }, _f;
      }
      case QUERY_COMMANDS_LITERAL.GEO_INTERSECTS: {
        var options = query.operands[0];
        return _g = {}, _g[query.fieldName] = {
          $geoIntersects: {
            $geometry: options.geometry.toJSON()
          }
        }, _g;
      }
      default: {
        return _h = {}, _h[query.fieldName] = (_j = {}, _j[$op] = encodeInternalDataType(query.operands[0]), _j), _h;
      }
    }
  };
  QueryEncoder2.prototype.encodeQueryObject = function(query) {
    var flattened = flattenQueryObject(query);
    for (var key in flattened) {
      var val = flattened[key];
      if (isLogicCommand(val)) {
        flattened[key] = val._setFieldName(key);
        var condition = this.encodeLogicCommand(flattened[key]);
        this.mergeConditionAfterEncode(flattened, condition, key);
      } else if (isComparisonCommand(val)) {
        flattened[key] = val._setFieldName(key);
        var condition = this.encodeComparisonCommand(flattened[key]);
        this.mergeConditionAfterEncode(flattened, condition, key);
      } else if (isConversionRequired(val)) {
        flattened[key] = encodeInternalDataType(val);
      }
    }
    return flattened;
  };
  QueryEncoder2.prototype.mergeConditionAfterEncode = function(query, condition, key) {
    if (!condition[key]) {
      delete query[key];
    }
    for (var conditionKey in condition) {
      if (query[conditionKey]) {
        if (isArray3(query[conditionKey])) {
          query[conditionKey] = query[conditionKey].concat(condition[conditionKey]);
        } else if (isObject2(query[conditionKey])) {
          if (isObject2(condition[conditionKey])) {
            Object.assign(query, condition);
          } else {
            console.warn("unmergable condition, query is object but condition is ".concat(getType(condition), ", can only overwrite"), condition, key);
            query[conditionKey] = condition[conditionKey];
          }
        } else {
          console.warn("to-merge query is of type ".concat(getType(query), ", can only overwrite"), query, condition, key);
          query[conditionKey] = condition[conditionKey];
        }
      } else {
        query[conditionKey] = condition[conditionKey];
      }
    }
  };
  return QueryEncoder2;
}();

// node_modules/@cloudbase/database/dist/esm/query.js
var __assign40 = function() {
  __assign40 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign40.apply(this, arguments);
};
var Query = function() {
  function Query3(db, coll, fieldFilters, fieldOrders, queryOptions) {
    var _this = this;
    this.watch = function(options) {
      var ws = getWsInstance(_this._db);
      return ws.watch(__assign40(__assign40({}, options), { envId: _this._db.config.env, collectionName: _this._coll, query: JSON.stringify(_this._fieldFilters || {}), limit: _this._queryOptions.limit, orderBy: _this._fieldOrders ? _this._fieldOrders.reduce(function(acc, cur) {
        acc[cur.field] = cur.direction;
        return acc;
      }, {}) : void 0 }));
    };
    this._db = db;
    this._coll = coll;
    this._fieldFilters = fieldFilters;
    this._fieldOrders = fieldOrders || [];
    this._queryOptions = queryOptions || {};
    this._request = Db.createRequest(this._db.config);
  }
  Query3.prototype.get = function(callback) {
    callback = callback || createPromiseCallback2();
    var newOder = [];
    if (this._fieldOrders) {
      this._fieldOrders.forEach(function(order) {
        newOder.push(order);
      });
    }
    var param = {
      collectionName: this._coll,
      queryType: QueryType.WHERE
    };
    if (this._fieldFilters) {
      param.query = this._fieldFilters;
    }
    if (newOder.length > 0) {
      param.order = newOder;
    }
    if (this._queryOptions.offset) {
      param.offset = this._queryOptions.offset;
    }
    if (this._queryOptions.limit) {
      param.limit = this._queryOptions.limit < 1e3 ? this._queryOptions.limit : 1e3;
    } else {
      param.limit = 100;
    }
    if (this._queryOptions.projection) {
      param.projection = this._queryOptions.projection;
    }
    this._request.send("database.queryDocument", param).then(function(res) {
      if (res.code) {
        callback(0, res);
      } else {
        var documents = Util.formatResDocumentData(res.data.list);
        var result = {
          data: documents,
          requestId: res.requestId
        };
        if (res.total !== void 0)
          result.total = res.total;
        if (res.limit !== void 0)
          result.limit = res.limit;
        if (res.offset !== void 0)
          result.offset = res.offset;
        callback(0, result);
      }
    }).catch(function(err) {
      callback(err);
    });
    return callback.promise;
  };
  Query3.prototype.count = function(callback) {
    callback = callback || createPromiseCallback2();
    var param = {
      collectionName: this._coll,
      queryType: QueryType.WHERE
    };
    if (this._fieldFilters) {
      param.query = this._fieldFilters;
    }
    this._request.send("database.countDocument", param).then(function(res) {
      if (res.code) {
        callback(0, res);
      } else {
        callback(0, {
          requestId: res.requestId,
          total: res.data.total
        });
      }
    }).catch(function(e3) {
      callback(e3);
    });
    return callback.promise;
  };
  Query3.prototype.where = function(query) {
    if (Object.prototype.toString.call(query).slice(8, -1) !== "Object") {
      throw Error(ErrorCode.QueryParamTypeError);
    }
    var keys4 = Object.keys(query);
    var checkFlag = keys4.some(function(item) {
      return query[item] !== void 0;
    });
    if (keys4.length && !checkFlag) {
      throw Error(ErrorCode.QueryParamValueError);
    }
    return new Query3(this._db, this._coll, QuerySerializer.encode(query), this._fieldOrders, this._queryOptions);
  };
  Query3.prototype.orderBy = function(fieldPath, directionStr) {
    Validate.isFieldPath(fieldPath);
    Validate.isFieldOrder(directionStr);
    var newOrder = {
      field: fieldPath,
      direction: directionStr
    };
    var combinedOrders = this._fieldOrders.concat(newOrder);
    return new Query3(this._db, this._coll, this._fieldFilters, combinedOrders, this._queryOptions);
  };
  Query3.prototype.limit = function(limit) {
    Validate.isInteger("limit", limit);
    var option = __assign40({}, this._queryOptions);
    option.limit = limit;
    return new Query3(this._db, this._coll, this._fieldFilters, this._fieldOrders, option);
  };
  Query3.prototype.skip = function(offset) {
    Validate.isInteger("offset", offset);
    var option = __assign40({}, this._queryOptions);
    option.offset = offset;
    return new Query3(this._db, this._coll, this._fieldFilters, this._fieldOrders, option);
  };
  Query3.prototype.update = function(data2, callback) {
    callback = callback || createPromiseCallback2();
    if (!data2 || typeof data2 !== "object") {
      return Promise.resolve({
        code: "INVALID_PARAM",
        message: ""
      });
    }
    if (data2.hasOwnProperty("_id")) {
      return Promise.resolve({
        code: "INVALID_PARAM",
        message: "_id"
      });
    }
    var param = {
      collectionName: this._coll,
      query: this._fieldFilters,
      queryType: QueryType.WHERE,
      multi: true,
      merge: true,
      upsert: false,
      data: UpdateSerializer.encode(data2)
    };
    this._request.send("database.updateDocument", param).then(function(res) {
      if (res.code) {
        callback(0, res);
      } else {
        callback(0, {
          requestId: res.requestId,
          updated: res.data.updated,
          upsertId: res.data.upsert_id
        });
      }
    }).catch(function(e3) {
      callback(e3);
    });
    return callback.promise;
  };
  Query3.prototype.field = function(projection) {
    for (var k2 in projection) {
      if (projection[k2]) {
        if (typeof projection[k2] !== "object") {
          projection[k2] = 1;
        }
      } else {
        projection[k2] = 0;
      }
    }
    var option = __assign40({}, this._queryOptions);
    option.projection = projection;
    return new Query3(this._db, this._coll, this._fieldFilters, this._fieldOrders, option);
  };
  Query3.prototype.remove = function(callback) {
    callback = callback || createPromiseCallback2();
    if (Object.keys(this._queryOptions).length > 0) {
      console.warn("`offset`, `limit` and `projection` are not supported in remove() operation");
    }
    if (this._fieldOrders.length > 0) {
      console.warn("`orderBy` is not supported in remove() operation");
    }
    var param = {
      collectionName: this._coll,
      query: QuerySerializer.encode(this._fieldFilters),
      queryType: QueryType.WHERE,
      multi: true
    };
    this._request.send("database.deleteDocument", param).then(function(res) {
      if (res.code) {
        callback(0, res);
      } else {
        callback(0, {
          requestId: res.requestId,
          deleted: res.data.deleted
        });
      }
    }).catch(function(e3) {
      callback(e3);
    });
    return callback.promise;
  };
  return Query3;
}();

// node_modules/bson/dist/bson.browser.esm.js
function createCommonjsModule(fn, module) {
  return module = { exports: {} }, fn(module, module.exports), module.exports;
}
var byteLength_1 = byteLength;
var toByteArray_1 = toByteArray;
var fromByteArray_1 = fromByteArray;
var lookup = [];
var revLookup = [];
var Arr = typeof Uint8Array !== "undefined" ? Uint8Array : Array;
var code = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
for (i2 = 0, len = code.length; i2 < len; ++i2) {
  lookup[i2] = code[i2];
  revLookup[code.charCodeAt(i2)] = i2;
}
var i2;
var len;
revLookup["-".charCodeAt(0)] = 62;
revLookup["_".charCodeAt(0)] = 63;
function getLens(b642) {
  var len = b642.length;
  if (len % 4 > 0) {
    throw new Error("Invalid string. Length must be a multiple of 4");
  }
  var validLen = b642.indexOf("=");
  if (validLen === -1) validLen = len;
  var placeHoldersLen = validLen === len ? 0 : 4 - validLen % 4;
  return [validLen, placeHoldersLen];
}
function byteLength(b642) {
  var lens = getLens(b642);
  var validLen = lens[0];
  var placeHoldersLen = lens[1];
  return (validLen + placeHoldersLen) * 3 / 4 - placeHoldersLen;
}
function _byteLength(b642, validLen, placeHoldersLen) {
  return (validLen + placeHoldersLen) * 3 / 4 - placeHoldersLen;
}
function toByteArray(b642) {
  var tmp;
  var lens = getLens(b642);
  var validLen = lens[0];
  var placeHoldersLen = lens[1];
  var arr = new Arr(_byteLength(b642, validLen, placeHoldersLen));
  var curByte = 0;
  var len = placeHoldersLen > 0 ? validLen - 4 : validLen;
  var i2;
  for (i2 = 0; i2 < len; i2 += 4) {
    tmp = revLookup[b642.charCodeAt(i2)] << 18 | revLookup[b642.charCodeAt(i2 + 1)] << 12 | revLookup[b642.charCodeAt(i2 + 2)] << 6 | revLookup[b642.charCodeAt(i2 + 3)];
    arr[curByte++] = tmp >> 16 & 255;
    arr[curByte++] = tmp >> 8 & 255;
    arr[curByte++] = tmp & 255;
  }
  if (placeHoldersLen === 2) {
    tmp = revLookup[b642.charCodeAt(i2)] << 2 | revLookup[b642.charCodeAt(i2 + 1)] >> 4;
    arr[curByte++] = tmp & 255;
  }
  if (placeHoldersLen === 1) {
    tmp = revLookup[b642.charCodeAt(i2)] << 10 | revLookup[b642.charCodeAt(i2 + 1)] << 4 | revLookup[b642.charCodeAt(i2 + 2)] >> 2;
    arr[curByte++] = tmp >> 8 & 255;
    arr[curByte++] = tmp & 255;
  }
  return arr;
}
function tripletToBase64(num) {
  return lookup[num >> 18 & 63] + lookup[num >> 12 & 63] + lookup[num >> 6 & 63] + lookup[num & 63];
}
function encodeChunk(uint8, start, end) {
  var tmp;
  var output = [];
  for (var i2 = start; i2 < end; i2 += 3) {
    tmp = (uint8[i2] << 16 & 16711680) + (uint8[i2 + 1] << 8 & 65280) + (uint8[i2 + 2] & 255);
    output.push(tripletToBase64(tmp));
  }
  return output.join("");
}
function fromByteArray(uint8) {
  var tmp;
  var len = uint8.length;
  var extraBytes = len % 3;
  var parts = [];
  var maxChunkLength = 16383;
  for (var i2 = 0, len2 = len - extraBytes; i2 < len2; i2 += maxChunkLength) {
    parts.push(encodeChunk(uint8, i2, i2 + maxChunkLength > len2 ? len2 : i2 + maxChunkLength));
  }
  if (extraBytes === 1) {
    tmp = uint8[len - 1];
    parts.push(lookup[tmp >> 2] + lookup[tmp << 4 & 63] + "==");
  } else if (extraBytes === 2) {
    tmp = (uint8[len - 2] << 8) + uint8[len - 1];
    parts.push(lookup[tmp >> 10] + lookup[tmp >> 4 & 63] + lookup[tmp << 2 & 63] + "=");
  }
  return parts.join("");
}
var base64Js = {
  byteLength: byteLength_1,
  toByteArray: toByteArray_1,
  fromByteArray: fromByteArray_1
};
var read = function read2(buffer2, offset, isLE, mLen, nBytes) {
  var e3, m2;
  var eLen = nBytes * 8 - mLen - 1;
  var eMax = (1 << eLen) - 1;
  var eBias = eMax >> 1;
  var nBits = -7;
  var i2 = isLE ? nBytes - 1 : 0;
  var d2 = isLE ? -1 : 1;
  var s2 = buffer2[offset + i2];
  i2 += d2;
  e3 = s2 & (1 << -nBits) - 1;
  s2 >>= -nBits;
  nBits += eLen;
  for (; nBits > 0; e3 = e3 * 256 + buffer2[offset + i2], i2 += d2, nBits -= 8) {
  }
  m2 = e3 & (1 << -nBits) - 1;
  e3 >>= -nBits;
  nBits += mLen;
  for (; nBits > 0; m2 = m2 * 256 + buffer2[offset + i2], i2 += d2, nBits -= 8) {
  }
  if (e3 === 0) {
    e3 = 1 - eBias;
  } else if (e3 === eMax) {
    return m2 ? NaN : (s2 ? -1 : 1) * Infinity;
  } else {
    m2 = m2 + Math.pow(2, mLen);
    e3 = e3 - eBias;
  }
  return (s2 ? -1 : 1) * m2 * Math.pow(2, e3 - mLen);
};
var write = function write2(buffer2, value, offset, isLE, mLen, nBytes) {
  var e3, m2, c2;
  var eLen = nBytes * 8 - mLen - 1;
  var eMax = (1 << eLen) - 1;
  var eBias = eMax >> 1;
  var rt2 = mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0;
  var i2 = isLE ? 0 : nBytes - 1;
  var d2 = isLE ? 1 : -1;
  var s2 = value < 0 || value === 0 && 1 / value < 0 ? 1 : 0;
  value = Math.abs(value);
  if (isNaN(value) || value === Infinity) {
    m2 = isNaN(value) ? 1 : 0;
    e3 = eMax;
  } else {
    e3 = Math.floor(Math.log(value) / Math.LN2);
    if (value * (c2 = Math.pow(2, -e3)) < 1) {
      e3--;
      c2 *= 2;
    }
    if (e3 + eBias >= 1) {
      value += rt2 / c2;
    } else {
      value += rt2 * Math.pow(2, 1 - eBias);
    }
    if (value * c2 >= 2) {
      e3++;
      c2 /= 2;
    }
    if (e3 + eBias >= eMax) {
      m2 = 0;
      e3 = eMax;
    } else if (e3 + eBias >= 1) {
      m2 = (value * c2 - 1) * Math.pow(2, mLen);
      e3 = e3 + eBias;
    } else {
      m2 = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen);
      e3 = 0;
    }
  }
  for (; mLen >= 8; buffer2[offset + i2] = m2 & 255, i2 += d2, m2 /= 256, mLen -= 8) {
  }
  e3 = e3 << mLen | m2;
  eLen += mLen;
  for (; eLen > 0; buffer2[offset + i2] = e3 & 255, i2 += d2, e3 /= 256, eLen -= 8) {
  }
  buffer2[offset + i2 - d2] |= s2 * 128;
};
var ieee754 = {
  read,
  write
};
var buffer$1 = createCommonjsModule(function(module, exports) {
  var customInspectSymbol = typeof Symbol === "function" && typeof Symbol["for"] === "function" ? (
    // eslint-disable-line dot-notation
    Symbol["for"]("nodejs.util.inspect.custom")
  ) : null;
  exports.Buffer = Buffer2;
  exports.SlowBuffer = SlowBuffer;
  exports.INSPECT_MAX_BYTES = 50;
  var K_MAX_LENGTH = 2147483647;
  exports.kMaxLength = K_MAX_LENGTH;
  Buffer2.TYPED_ARRAY_SUPPORT = typedArraySupport();
  if (!Buffer2.TYPED_ARRAY_SUPPORT && typeof console !== "undefined" && typeof console.error === "function") {
    console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");
  }
  function typedArraySupport() {
    try {
      var arr = new Uint8Array(1);
      var proto = {
        foo: function foo() {
          return 42;
        }
      };
      Object.setPrototypeOf(proto, Uint8Array.prototype);
      Object.setPrototypeOf(arr, proto);
      return arr.foo() === 42;
    } catch (e3) {
      return false;
    }
  }
  Object.defineProperty(Buffer2.prototype, "parent", {
    enumerable: true,
    get: function get3() {
      if (!Buffer2.isBuffer(this)) return void 0;
      return this.buffer;
    }
  });
  Object.defineProperty(Buffer2.prototype, "offset", {
    enumerable: true,
    get: function get3() {
      if (!Buffer2.isBuffer(this)) return void 0;
      return this.byteOffset;
    }
  });
  function createBuffer(length) {
    if (length > K_MAX_LENGTH) {
      throw new RangeError('The value "' + length + '" is invalid for option "size"');
    }
    var buf = new Uint8Array(length);
    Object.setPrototypeOf(buf, Buffer2.prototype);
    return buf;
  }
  function Buffer2(arg, encodingOrOffset, length) {
    if (typeof arg === "number") {
      if (typeof encodingOrOffset === "string") {
        throw new TypeError('The "string" argument must be of type string. Received type number');
      }
      return allocUnsafe(arg);
    }
    return from2(arg, encodingOrOffset, length);
  }
  Buffer2.poolSize = 8192;
  function from2(value, encodingOrOffset, length) {
    if (typeof value === "string") {
      return fromString(value, encodingOrOffset);
    }
    if (ArrayBuffer.isView(value)) {
      return fromArrayView(value);
    }
    if (value == null) {
      throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type " + babelHelpers["typeof"](value));
    }
    if (isInstance(value, ArrayBuffer) || value && isInstance(value.buffer, ArrayBuffer)) {
      return fromArrayBuffer(value, encodingOrOffset, length);
    }
    if (typeof SharedArrayBuffer !== "undefined" && (isInstance(value, SharedArrayBuffer) || value && isInstance(value.buffer, SharedArrayBuffer))) {
      return fromArrayBuffer(value, encodingOrOffset, length);
    }
    if (typeof value === "number") {
      throw new TypeError('The "value" argument must not be of type number. Received type number');
    }
    var valueOf = value.valueOf && value.valueOf();
    if (valueOf != null && valueOf !== value) {
      return Buffer2.from(valueOf, encodingOrOffset, length);
    }
    var b2 = fromObject(value);
    if (b2) return b2;
    if (typeof Symbol !== "undefined" && Symbol.toPrimitive != null && typeof value[Symbol.toPrimitive] === "function") {
      return Buffer2.from(value[Symbol.toPrimitive]("string"), encodingOrOffset, length);
    }
    throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type " + babelHelpers["typeof"](value));
  }
  Buffer2.from = function(value, encodingOrOffset, length) {
    return from2(value, encodingOrOffset, length);
  };
  Object.setPrototypeOf(Buffer2.prototype, Uint8Array.prototype);
  Object.setPrototypeOf(Buffer2, Uint8Array);
  function assertSize(size2) {
    if (typeof size2 !== "number") {
      throw new TypeError('"size" argument must be of type number');
    } else if (size2 < 0) {
      throw new RangeError('The value "' + size2 + '" is invalid for option "size"');
    }
  }
  function alloc(size2, fill, encoding) {
    assertSize(size2);
    if (size2 <= 0) {
      return createBuffer(size2);
    }
    if (fill !== void 0) {
      return typeof encoding === "string" ? createBuffer(size2).fill(fill, encoding) : createBuffer(size2).fill(fill);
    }
    return createBuffer(size2);
  }
  Buffer2.alloc = function(size2, fill, encoding) {
    return alloc(size2, fill, encoding);
  };
  function allocUnsafe(size2) {
    assertSize(size2);
    return createBuffer(size2 < 0 ? 0 : checked(size2) | 0);
  }
  Buffer2.allocUnsafe = function(size2) {
    return allocUnsafe(size2);
  };
  Buffer2.allocUnsafeSlow = function(size2) {
    return allocUnsafe(size2);
  };
  function fromString(string, encoding) {
    if (typeof encoding !== "string" || encoding === "") {
      encoding = "utf8";
    }
    if (!Buffer2.isEncoding(encoding)) {
      throw new TypeError("Unknown encoding: " + encoding);
    }
    var length = byteLength2(string, encoding) | 0;
    var buf = createBuffer(length);
    var actual = buf.write(string, encoding);
    if (actual !== length) {
      buf = buf.slice(0, actual);
    }
    return buf;
  }
  function fromArrayLike(array) {
    var length = array.length < 0 ? 0 : checked(array.length) | 0;
    var buf = createBuffer(length);
    for (var i2 = 0; i2 < length; i2 += 1) {
      buf[i2] = array[i2] & 255;
    }
    return buf;
  }
  function fromArrayView(arrayView) {
    if (isInstance(arrayView, Uint8Array)) {
      var copy = new Uint8Array(arrayView);
      return fromArrayBuffer(copy.buffer, copy.byteOffset, copy.byteLength);
    }
    return fromArrayLike(arrayView);
  }
  function fromArrayBuffer(array, byteOffset, length) {
    if (byteOffset < 0 || array.byteLength < byteOffset) {
      throw new RangeError('"offset" is outside of buffer bounds');
    }
    if (array.byteLength < byteOffset + (length || 0)) {
      throw new RangeError('"length" is outside of buffer bounds');
    }
    var buf;
    if (byteOffset === void 0 && length === void 0) {
      buf = new Uint8Array(array);
    } else if (length === void 0) {
      buf = new Uint8Array(array, byteOffset);
    } else {
      buf = new Uint8Array(array, byteOffset, length);
    }
    Object.setPrototypeOf(buf, Buffer2.prototype);
    return buf;
  }
  function fromObject(obj) {
    if (Buffer2.isBuffer(obj)) {
      var len = checked(obj.length) | 0;
      var buf = createBuffer(len);
      if (buf.length === 0) {
        return buf;
      }
      obj.copy(buf, 0, 0, len);
      return buf;
    }
    if (obj.length !== void 0) {
      if (typeof obj.length !== "number" || numberIsNaN(obj.length)) {
        return createBuffer(0);
      }
      return fromArrayLike(obj);
    }
    if (obj.type === "Buffer" && Array.isArray(obj.data)) {
      return fromArrayLike(obj.data);
    }
  }
  function checked(length) {
    if (length >= K_MAX_LENGTH) {
      throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x" + K_MAX_LENGTH.toString(16) + " bytes");
    }
    return length | 0;
  }
  function SlowBuffer(length) {
    if (+length != length) {
      length = 0;
    }
    return Buffer2.alloc(+length);
  }
  Buffer2.isBuffer = function isBuffer(b2) {
    return b2 != null && b2._isBuffer === true && b2 !== Buffer2.prototype;
  };
  Buffer2.compare = function compare(a2, b2) {
    if (isInstance(a2, Uint8Array)) a2 = Buffer2.from(a2, a2.offset, a2.byteLength);
    if (isInstance(b2, Uint8Array)) b2 = Buffer2.from(b2, b2.offset, b2.byteLength);
    if (!Buffer2.isBuffer(a2) || !Buffer2.isBuffer(b2)) {
      throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');
    }
    if (a2 === b2) return 0;
    var x2 = a2.length;
    var y2 = b2.length;
    for (var i2 = 0, len = Math.min(x2, y2); i2 < len; ++i2) {
      if (a2[i2] !== b2[i2]) {
        x2 = a2[i2];
        y2 = b2[i2];
        break;
      }
    }
    if (x2 < y2) return -1;
    if (y2 < x2) return 1;
    return 0;
  };
  Buffer2.isEncoding = function isEncoding(encoding) {
    switch (String(encoding).toLowerCase()) {
      case "hex":
      case "utf8":
      case "utf-8":
      case "ascii":
      case "latin1":
      case "binary":
      case "base64":
      case "ucs2":
      case "ucs-2":
      case "utf16le":
      case "utf-16le":
        return true;
      default:
        return false;
    }
  };
  Buffer2.concat = function concat2(list, length) {
    if (!Array.isArray(list)) {
      throw new TypeError('"list" argument must be an Array of Buffers');
    }
    if (list.length === 0) {
      return Buffer2.alloc(0);
    }
    var i2;
    if (length === void 0) {
      length = 0;
      for (i2 = 0; i2 < list.length; ++i2) {
        length += list[i2].length;
      }
    }
    var buffer2 = Buffer2.allocUnsafe(length);
    var pos = 0;
    for (i2 = 0; i2 < list.length; ++i2) {
      var buf = list[i2];
      if (isInstance(buf, Uint8Array)) {
        if (pos + buf.length > buffer2.length) {
          Buffer2.from(buf).copy(buffer2, pos);
        } else {
          Uint8Array.prototype.set.call(buffer2, buf, pos);
        }
      } else if (!Buffer2.isBuffer(buf)) {
        throw new TypeError('"list" argument must be an Array of Buffers');
      } else {
        buf.copy(buffer2, pos);
      }
      pos += buf.length;
    }
    return buffer2;
  };
  function byteLength2(string, encoding) {
    if (Buffer2.isBuffer(string)) {
      return string.length;
    }
    if (ArrayBuffer.isView(string) || isInstance(string, ArrayBuffer)) {
      return string.byteLength;
    }
    if (typeof string !== "string") {
      throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type ' + babelHelpers["typeof"](string));
    }
    var len = string.length;
    var mustMatch = arguments.length > 2 && arguments[2] === true;
    if (!mustMatch && len === 0) return 0;
    var loweredCase = false;
    for (; ; ) {
      switch (encoding) {
        case "ascii":
        case "latin1":
        case "binary":
          return len;
        case "utf8":
        case "utf-8":
          return utf8ToBytes(string).length;
        case "ucs2":
        case "ucs-2":
        case "utf16le":
        case "utf-16le":
          return len * 2;
        case "hex":
          return len >>> 1;
        case "base64":
          return base64ToBytes(string).length;
        default:
          if (loweredCase) {
            return mustMatch ? -1 : utf8ToBytes(string).length;
          }
          encoding = ("" + encoding).toLowerCase();
          loweredCase = true;
      }
    }
  }
  Buffer2.byteLength = byteLength2;
  function slowToString(encoding, start, end) {
    var loweredCase = false;
    if (start === void 0 || start < 0) {
      start = 0;
    }
    if (start > this.length) {
      return "";
    }
    if (end === void 0 || end > this.length) {
      end = this.length;
    }
    if (end <= 0) {
      return "";
    }
    end >>>= 0;
    start >>>= 0;
    if (end <= start) {
      return "";
    }
    if (!encoding) encoding = "utf8";
    while (true) {
      switch (encoding) {
        case "hex":
          return hexSlice(this, start, end);
        case "utf8":
        case "utf-8":
          return utf8Slice(this, start, end);
        case "ascii":
          return asciiSlice(this, start, end);
        case "latin1":
        case "binary":
          return latin1Slice(this, start, end);
        case "base64":
          return base64Slice(this, start, end);
        case "ucs2":
        case "ucs-2":
        case "utf16le":
        case "utf-16le":
          return utf16leSlice(this, start, end);
        default:
          if (loweredCase) throw new TypeError("Unknown encoding: " + encoding);
          encoding = (encoding + "").toLowerCase();
          loweredCase = true;
      }
    }
  }
  Buffer2.prototype._isBuffer = true;
  function swap(b2, n3, m2) {
    var i2 = b2[n3];
    b2[n3] = b2[m2];
    b2[m2] = i2;
  }
  Buffer2.prototype.swap16 = function swap16() {
    var len = this.length;
    if (len % 2 !== 0) {
      throw new RangeError("Buffer size must be a multiple of 16-bits");
    }
    for (var i2 = 0; i2 < len; i2 += 2) {
      swap(this, i2, i2 + 1);
    }
    return this;
  };
  Buffer2.prototype.swap32 = function swap32() {
    var len = this.length;
    if (len % 4 !== 0) {
      throw new RangeError("Buffer size must be a multiple of 32-bits");
    }
    for (var i2 = 0; i2 < len; i2 += 4) {
      swap(this, i2, i2 + 3);
      swap(this, i2 + 1, i2 + 2);
    }
    return this;
  };
  Buffer2.prototype.swap64 = function swap64() {
    var len = this.length;
    if (len % 8 !== 0) {
      throw new RangeError("Buffer size must be a multiple of 64-bits");
    }
    for (var i2 = 0; i2 < len; i2 += 8) {
      swap(this, i2, i2 + 7);
      swap(this, i2 + 1, i2 + 6);
      swap(this, i2 + 2, i2 + 5);
      swap(this, i2 + 3, i2 + 4);
    }
    return this;
  };
  Buffer2.prototype.toString = function toString5() {
    var length = this.length;
    if (length === 0) return "";
    if (arguments.length === 0) return utf8Slice(this, 0, length);
    return slowToString.apply(this, arguments);
  };
  Buffer2.prototype.toLocaleString = Buffer2.prototype.toString;
  Buffer2.prototype.equals = function equals(b2) {
    if (!Buffer2.isBuffer(b2)) throw new TypeError("Argument must be a Buffer");
    if (this === b2) return true;
    return Buffer2.compare(this, b2) === 0;
  };
  Buffer2.prototype.inspect = function inspect() {
    var str = "";
    var max2 = exports.INSPECT_MAX_BYTES;
    str = this.toString("hex", 0, max2).replace(/(.{2})/g, "$1 ").trim();
    if (this.length > max2) str += " ... ";
    return "<Buffer " + str + ">";
  };
  if (customInspectSymbol) {
    Buffer2.prototype[customInspectSymbol] = Buffer2.prototype.inspect;
  }
  Buffer2.prototype.compare = function compare(target, start, end, thisStart, thisEnd) {
    if (isInstance(target, Uint8Array)) {
      target = Buffer2.from(target, target.offset, target.byteLength);
    }
    if (!Buffer2.isBuffer(target)) {
      throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type ' + babelHelpers["typeof"](target));
    }
    if (start === void 0) {
      start = 0;
    }
    if (end === void 0) {
      end = target ? target.length : 0;
    }
    if (thisStart === void 0) {
      thisStart = 0;
    }
    if (thisEnd === void 0) {
      thisEnd = this.length;
    }
    if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {
      throw new RangeError("out of range index");
    }
    if (thisStart >= thisEnd && start >= end) {
      return 0;
    }
    if (thisStart >= thisEnd) {
      return -1;
    }
    if (start >= end) {
      return 1;
    }
    start >>>= 0;
    end >>>= 0;
    thisStart >>>= 0;
    thisEnd >>>= 0;
    if (this === target) return 0;
    var x2 = thisEnd - thisStart;
    var y2 = end - start;
    var len = Math.min(x2, y2);
    var thisCopy = this.slice(thisStart, thisEnd);
    var targetCopy = target.slice(start, end);
    for (var i2 = 0; i2 < len; ++i2) {
      if (thisCopy[i2] !== targetCopy[i2]) {
        x2 = thisCopy[i2];
        y2 = targetCopy[i2];
        break;
      }
    }
    if (x2 < y2) return -1;
    if (y2 < x2) return 1;
    return 0;
  };
  function bidirectionalIndexOf(buffer2, val, byteOffset, encoding, dir) {
    if (buffer2.length === 0) return -1;
    if (typeof byteOffset === "string") {
      encoding = byteOffset;
      byteOffset = 0;
    } else if (byteOffset > 2147483647) {
      byteOffset = 2147483647;
    } else if (byteOffset < -2147483648) {
      byteOffset = -2147483648;
    }
    byteOffset = +byteOffset;
    if (numberIsNaN(byteOffset)) {
      byteOffset = dir ? 0 : buffer2.length - 1;
    }
    if (byteOffset < 0) byteOffset = buffer2.length + byteOffset;
    if (byteOffset >= buffer2.length) {
      if (dir) return -1;
      else byteOffset = buffer2.length - 1;
    } else if (byteOffset < 0) {
      if (dir) byteOffset = 0;
      else return -1;
    }
    if (typeof val === "string") {
      val = Buffer2.from(val, encoding);
    }
    if (Buffer2.isBuffer(val)) {
      if (val.length === 0) {
        return -1;
      }
      return arrayIndexOf(buffer2, val, byteOffset, encoding, dir);
    } else if (typeof val === "number") {
      val = val & 255;
      if (typeof Uint8Array.prototype.indexOf === "function") {
        if (dir) {
          return Uint8Array.prototype.indexOf.call(buffer2, val, byteOffset);
        } else {
          return Uint8Array.prototype.lastIndexOf.call(buffer2, val, byteOffset);
        }
      }
      return arrayIndexOf(buffer2, [val], byteOffset, encoding, dir);
    }
    throw new TypeError("val must be string, number or Buffer");
  }
  function arrayIndexOf(arr, val, byteOffset, encoding, dir) {
    var indexSize = 1;
    var arrLength = arr.length;
    var valLength = val.length;
    if (encoding !== void 0) {
      encoding = String(encoding).toLowerCase();
      if (encoding === "ucs2" || encoding === "ucs-2" || encoding === "utf16le" || encoding === "utf-16le") {
        if (arr.length < 2 || val.length < 2) {
          return -1;
        }
        indexSize = 2;
        arrLength /= 2;
        valLength /= 2;
        byteOffset /= 2;
      }
    }
    function read3(buf, i3) {
      if (indexSize === 1) {
        return buf[i3];
      } else {
        return buf.readUInt16BE(i3 * indexSize);
      }
    }
    var i2;
    if (dir) {
      var foundIndex = -1;
      for (i2 = byteOffset; i2 < arrLength; i2++) {
        if (read3(arr, i2) === read3(val, foundIndex === -1 ? 0 : i2 - foundIndex)) {
          if (foundIndex === -1) foundIndex = i2;
          if (i2 - foundIndex + 1 === valLength) return foundIndex * indexSize;
        } else {
          if (foundIndex !== -1) i2 -= i2 - foundIndex;
          foundIndex = -1;
        }
      }
    } else {
      if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength;
      for (i2 = byteOffset; i2 >= 0; i2--) {
        var found = true;
        for (var j2 = 0; j2 < valLength; j2++) {
          if (read3(arr, i2 + j2) !== read3(val, j2)) {
            found = false;
            break;
          }
        }
        if (found) return i2;
      }
    }
    return -1;
  }
  Buffer2.prototype.includes = function includes(val, byteOffset, encoding) {
    return this.indexOf(val, byteOffset, encoding) !== -1;
  };
  Buffer2.prototype.indexOf = function indexOf2(val, byteOffset, encoding) {
    return bidirectionalIndexOf(this, val, byteOffset, encoding, true);
  };
  Buffer2.prototype.lastIndexOf = function lastIndexOf(val, byteOffset, encoding) {
    return bidirectionalIndexOf(this, val, byteOffset, encoding, false);
  };
  function hexWrite(buf, string, offset, length) {
    offset = Number(offset) || 0;
    var remaining = buf.length - offset;
    if (!length) {
      length = remaining;
    } else {
      length = Number(length);
      if (length > remaining) {
        length = remaining;
      }
    }
    var strLen = string.length;
    if (length > strLen / 2) {
      length = strLen / 2;
    }
    for (var i2 = 0; i2 < length; ++i2) {
      var parsed = parseInt(string.substr(i2 * 2, 2), 16);
      if (numberIsNaN(parsed)) return i2;
      buf[offset + i2] = parsed;
    }
    return i2;
  }
  function utf8Write(buf, string, offset, length) {
    return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length);
  }
  function asciiWrite(buf, string, offset, length) {
    return blitBuffer(asciiToBytes(string), buf, offset, length);
  }
  function base64Write(buf, string, offset, length) {
    return blitBuffer(base64ToBytes(string), buf, offset, length);
  }
  function ucs2Write(buf, string, offset, length) {
    return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length);
  }
  Buffer2.prototype.write = function write3(string, offset, length, encoding) {
    if (offset === void 0) {
      encoding = "utf8";
      length = this.length;
      offset = 0;
    } else if (length === void 0 && typeof offset === "string") {
      encoding = offset;
      length = this.length;
      offset = 0;
    } else if (isFinite(offset)) {
      offset = offset >>> 0;
      if (isFinite(length)) {
        length = length >>> 0;
        if (encoding === void 0) encoding = "utf8";
      } else {
        encoding = length;
        length = void 0;
      }
    } else {
      throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");
    }
    var remaining = this.length - offset;
    if (length === void 0 || length > remaining) length = remaining;
    if (string.length > 0 && (length < 0 || offset < 0) || offset > this.length) {
      throw new RangeError("Attempt to write outside buffer bounds");
    }
    if (!encoding) encoding = "utf8";
    var loweredCase = false;
    for (; ; ) {
      switch (encoding) {
        case "hex":
          return hexWrite(this, string, offset, length);
        case "utf8":
        case "utf-8":
          return utf8Write(this, string, offset, length);
        case "ascii":
        case "latin1":
        case "binary":
          return asciiWrite(this, string, offset, length);
        case "base64":
          return base64Write(this, string, offset, length);
        case "ucs2":
        case "ucs-2":
        case "utf16le":
        case "utf-16le":
          return ucs2Write(this, string, offset, length);
        default:
          if (loweredCase) throw new TypeError("Unknown encoding: " + encoding);
          encoding = ("" + encoding).toLowerCase();
          loweredCase = true;
      }
    }
  };
  Buffer2.prototype.toJSON = function toJSON2() {
    return {
      type: "Buffer",
      data: Array.prototype.slice.call(this._arr || this, 0)
    };
  };
  function base64Slice(buf, start, end) {
    if (start === 0 && end === buf.length) {
      return base64Js.fromByteArray(buf);
    } else {
      return base64Js.fromByteArray(buf.slice(start, end));
    }
  }
  function utf8Slice(buf, start, end) {
    end = Math.min(buf.length, end);
    var res = [];
    var i2 = start;
    while (i2 < end) {
      var firstByte = buf[i2];
      var codePoint = null;
      var bytesPerSequence = firstByte > 239 ? 4 : firstByte > 223 ? 3 : firstByte > 191 ? 2 : 1;
      if (i2 + bytesPerSequence <= end) {
        var secondByte, thirdByte, fourthByte, tempCodePoint;
        switch (bytesPerSequence) {
          case 1:
            if (firstByte < 128) {
              codePoint = firstByte;
            }
            break;
          case 2:
            secondByte = buf[i2 + 1];
            if ((secondByte & 192) === 128) {
              tempCodePoint = (firstByte & 31) << 6 | secondByte & 63;
              if (tempCodePoint > 127) {
                codePoint = tempCodePoint;
              }
            }
            break;
          case 3:
            secondByte = buf[i2 + 1];
            thirdByte = buf[i2 + 2];
            if ((secondByte & 192) === 128 && (thirdByte & 192) === 128) {
              tempCodePoint = (firstByte & 15) << 12 | (secondByte & 63) << 6 | thirdByte & 63;
              if (tempCodePoint > 2047 && (tempCodePoint < 55296 || tempCodePoint > 57343)) {
                codePoint = tempCodePoint;
              }
            }
            break;
          case 4:
            secondByte = buf[i2 + 1];
            thirdByte = buf[i2 + 2];
            fourthByte = buf[i2 + 3];
            if ((secondByte & 192) === 128 && (thirdByte & 192) === 128 && (fourthByte & 192) === 128) {
              tempCodePoint = (firstByte & 15) << 18 | (secondByte & 63) << 12 | (thirdByte & 63) << 6 | fourthByte & 63;
              if (tempCodePoint > 65535 && tempCodePoint < 1114112) {
                codePoint = tempCodePoint;
              }
            }
        }
      }
      if (codePoint === null) {
        codePoint = 65533;
        bytesPerSequence = 1;
      } else if (codePoint > 65535) {
        codePoint -= 65536;
        res.push(codePoint >>> 10 & 1023 | 55296);
        codePoint = 56320 | codePoint & 1023;
      }
      res.push(codePoint);
      i2 += bytesPerSequence;
    }
    return decodeCodePointsArray(res);
  }
  var MAX_ARGUMENTS_LENGTH = 4096;
  function decodeCodePointsArray(codePoints) {
    var len = codePoints.length;
    if (len <= MAX_ARGUMENTS_LENGTH) {
      return String.fromCharCode.apply(String, codePoints);
    }
    var res = "";
    var i2 = 0;
    while (i2 < len) {
      res += String.fromCharCode.apply(String, codePoints.slice(i2, i2 += MAX_ARGUMENTS_LENGTH));
    }
    return res;
  }
  function asciiSlice(buf, start, end) {
    var ret = "";
    end = Math.min(buf.length, end);
    for (var i2 = start; i2 < end; ++i2) {
      ret += String.fromCharCode(buf[i2] & 127);
    }
    return ret;
  }
  function latin1Slice(buf, start, end) {
    var ret = "";
    end = Math.min(buf.length, end);
    for (var i2 = start; i2 < end; ++i2) {
      ret += String.fromCharCode(buf[i2]);
    }
    return ret;
  }
  function hexSlice(buf, start, end) {
    var len = buf.length;
    if (!start || start < 0) start = 0;
    if (!end || end < 0 || end > len) end = len;
    var out = "";
    for (var i2 = start; i2 < end; ++i2) {
      out += hexSliceLookupTable[buf[i2]];
    }
    return out;
  }
  function utf16leSlice(buf, start, end) {
    var bytes = buf.slice(start, end);
    var res = "";
    for (var i2 = 0; i2 < bytes.length - 1; i2 += 2) {
      res += String.fromCharCode(bytes[i2] + bytes[i2 + 1] * 256);
    }
    return res;
  }
  Buffer2.prototype.slice = function slice(start, end) {
    var len = this.length;
    start = ~~start;
    end = end === void 0 ? len : ~~end;
    if (start < 0) {
      start += len;
      if (start < 0) start = 0;
    } else if (start > len) {
      start = len;
    }
    if (end < 0) {
      end += len;
      if (end < 0) end = 0;
    } else if (end > len) {
      end = len;
    }
    if (end < start) end = start;
    var newBuf = this.subarray(start, end);
    Object.setPrototypeOf(newBuf, Buffer2.prototype);
    return newBuf;
  };
  function checkOffset(offset, ext, length) {
    if (offset % 1 !== 0 || offset < 0) throw new RangeError("offset is not uint");
    if (offset + ext > length) throw new RangeError("Trying to access beyond buffer length");
  }
  Buffer2.prototype.readUintLE = Buffer2.prototype.readUIntLE = function readUIntLE(offset, byteLength3, noAssert) {
    offset = offset >>> 0;
    byteLength3 = byteLength3 >>> 0;
    if (!noAssert) checkOffset(offset, byteLength3, this.length);
    var val = this[offset];
    var mul = 1;
    var i2 = 0;
    while (++i2 < byteLength3 && (mul *= 256)) {
      val += this[offset + i2] * mul;
    }
    return val;
  };
  Buffer2.prototype.readUintBE = Buffer2.prototype.readUIntBE = function readUIntBE(offset, byteLength3, noAssert) {
    offset = offset >>> 0;
    byteLength3 = byteLength3 >>> 0;
    if (!noAssert) {
      checkOffset(offset, byteLength3, this.length);
    }
    var val = this[offset + --byteLength3];
    var mul = 1;
    while (byteLength3 > 0 && (mul *= 256)) {
      val += this[offset + --byteLength3] * mul;
    }
    return val;
  };
  Buffer2.prototype.readUint8 = Buffer2.prototype.readUInt8 = function readUInt8(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 1, this.length);
    return this[offset];
  };
  Buffer2.prototype.readUint16LE = Buffer2.prototype.readUInt16LE = function readUInt16LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 2, this.length);
    return this[offset] | this[offset + 1] << 8;
  };
  Buffer2.prototype.readUint16BE = Buffer2.prototype.readUInt16BE = function readUInt16BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 2, this.length);
    return this[offset] << 8 | this[offset + 1];
  };
  Buffer2.prototype.readUint32LE = Buffer2.prototype.readUInt32LE = function readUInt32LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return (this[offset] | this[offset + 1] << 8 | this[offset + 2] << 16) + this[offset + 3] * 16777216;
  };
  Buffer2.prototype.readUint32BE = Buffer2.prototype.readUInt32BE = function readUInt32BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return this[offset] * 16777216 + (this[offset + 1] << 16 | this[offset + 2] << 8 | this[offset + 3]);
  };
  Buffer2.prototype.readIntLE = function readIntLE(offset, byteLength3, noAssert) {
    offset = offset >>> 0;
    byteLength3 = byteLength3 >>> 0;
    if (!noAssert) checkOffset(offset, byteLength3, this.length);
    var val = this[offset];
    var mul = 1;
    var i2 = 0;
    while (++i2 < byteLength3 && (mul *= 256)) {
      val += this[offset + i2] * mul;
    }
    mul *= 128;
    if (val >= mul) val -= Math.pow(2, 8 * byteLength3);
    return val;
  };
  Buffer2.prototype.readIntBE = function readIntBE(offset, byteLength3, noAssert) {
    offset = offset >>> 0;
    byteLength3 = byteLength3 >>> 0;
    if (!noAssert) checkOffset(offset, byteLength3, this.length);
    var i2 = byteLength3;
    var mul = 1;
    var val = this[offset + --i2];
    while (i2 > 0 && (mul *= 256)) {
      val += this[offset + --i2] * mul;
    }
    mul *= 128;
    if (val >= mul) val -= Math.pow(2, 8 * byteLength3);
    return val;
  };
  Buffer2.prototype.readInt8 = function readInt8(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 1, this.length);
    if (!(this[offset] & 128)) return this[offset];
    return (255 - this[offset] + 1) * -1;
  };
  Buffer2.prototype.readInt16LE = function readInt16LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 2, this.length);
    var val = this[offset] | this[offset + 1] << 8;
    return val & 32768 ? val | 4294901760 : val;
  };
  Buffer2.prototype.readInt16BE = function readInt16BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 2, this.length);
    var val = this[offset + 1] | this[offset] << 8;
    return val & 32768 ? val | 4294901760 : val;
  };
  Buffer2.prototype.readInt32LE = function readInt32LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return this[offset] | this[offset + 1] << 8 | this[offset + 2] << 16 | this[offset + 3] << 24;
  };
  Buffer2.prototype.readInt32BE = function readInt32BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return this[offset] << 24 | this[offset + 1] << 16 | this[offset + 2] << 8 | this[offset + 3];
  };
  Buffer2.prototype.readFloatLE = function readFloatLE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return ieee754.read(this, offset, true, 23, 4);
  };
  Buffer2.prototype.readFloatBE = function readFloatBE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 4, this.length);
    return ieee754.read(this, offset, false, 23, 4);
  };
  Buffer2.prototype.readDoubleLE = function readDoubleLE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 8, this.length);
    return ieee754.read(this, offset, true, 52, 8);
  };
  Buffer2.prototype.readDoubleBE = function readDoubleBE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) checkOffset(offset, 8, this.length);
    return ieee754.read(this, offset, false, 52, 8);
  };
  function checkInt(buf, value, offset, ext, max2, min2) {
    if (!Buffer2.isBuffer(buf)) throw new TypeError('"buffer" argument must be a Buffer instance');
    if (value > max2 || value < min2) throw new RangeError('"value" argument is out of bounds');
    if (offset + ext > buf.length) throw new RangeError("Index out of range");
  }
  Buffer2.prototype.writeUintLE = Buffer2.prototype.writeUIntLE = function writeUIntLE(value, offset, byteLength3, noAssert) {
    value = +value;
    offset = offset >>> 0;
    byteLength3 = byteLength3 >>> 0;
    if (!noAssert) {
      var maxBytes = Math.pow(2, 8 * byteLength3) - 1;
      checkInt(this, value, offset, byteLength3, maxBytes, 0);
    }
    var mul = 1;
    var i2 = 0;
    this[offset] = value & 255;
    while (++i2 < byteLength3 && (mul *= 256)) {
      this[offset + i2] = value / mul & 255;
    }
    return offset + byteLength3;
  };
  Buffer2.prototype.writeUintBE = Buffer2.prototype.writeUIntBE = function writeUIntBE(value, offset, byteLength3, noAssert) {
    value = +value;
    offset = offset >>> 0;
    byteLength3 = byteLength3 >>> 0;
    if (!noAssert) {
      var maxBytes = Math.pow(2, 8 * byteLength3) - 1;
      checkInt(this, value, offset, byteLength3, maxBytes, 0);
    }
    var i2 = byteLength3 - 1;
    var mul = 1;
    this[offset + i2] = value & 255;
    while (--i2 >= 0 && (mul *= 256)) {
      this[offset + i2] = value / mul & 255;
    }
    return offset + byteLength3;
  };
  Buffer2.prototype.writeUint8 = Buffer2.prototype.writeUInt8 = function writeUInt8(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 1, 255, 0);
    this[offset] = value & 255;
    return offset + 1;
  };
  Buffer2.prototype.writeUint16LE = Buffer2.prototype.writeUInt16LE = function writeUInt16LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 2, 65535, 0);
    this[offset] = value & 255;
    this[offset + 1] = value >>> 8;
    return offset + 2;
  };
  Buffer2.prototype.writeUint16BE = Buffer2.prototype.writeUInt16BE = function writeUInt16BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 2, 65535, 0);
    this[offset] = value >>> 8;
    this[offset + 1] = value & 255;
    return offset + 2;
  };
  Buffer2.prototype.writeUint32LE = Buffer2.prototype.writeUInt32LE = function writeUInt32LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 4, 4294967295, 0);
    this[offset + 3] = value >>> 24;
    this[offset + 2] = value >>> 16;
    this[offset + 1] = value >>> 8;
    this[offset] = value & 255;
    return offset + 4;
  };
  Buffer2.prototype.writeUint32BE = Buffer2.prototype.writeUInt32BE = function writeUInt32BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 4, 4294967295, 0);
    this[offset] = value >>> 24;
    this[offset + 1] = value >>> 16;
    this[offset + 2] = value >>> 8;
    this[offset + 3] = value & 255;
    return offset + 4;
  };
  Buffer2.prototype.writeIntLE = function writeIntLE(value, offset, byteLength3, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) {
      var limit = Math.pow(2, 8 * byteLength3 - 1);
      checkInt(this, value, offset, byteLength3, limit - 1, -limit);
    }
    var i2 = 0;
    var mul = 1;
    var sub = 0;
    this[offset] = value & 255;
    while (++i2 < byteLength3 && (mul *= 256)) {
      if (value < 0 && sub === 0 && this[offset + i2 - 1] !== 0) {
        sub = 1;
      }
      this[offset + i2] = (value / mul >> 0) - sub & 255;
    }
    return offset + byteLength3;
  };
  Buffer2.prototype.writeIntBE = function writeIntBE(value, offset, byteLength3, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) {
      var limit = Math.pow(2, 8 * byteLength3 - 1);
      checkInt(this, value, offset, byteLength3, limit - 1, -limit);
    }
    var i2 = byteLength3 - 1;
    var mul = 1;
    var sub = 0;
    this[offset + i2] = value & 255;
    while (--i2 >= 0 && (mul *= 256)) {
      if (value < 0 && sub === 0 && this[offset + i2 + 1] !== 0) {
        sub = 1;
      }
      this[offset + i2] = (value / mul >> 0) - sub & 255;
    }
    return offset + byteLength3;
  };
  Buffer2.prototype.writeInt8 = function writeInt8(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 1, 127, -128);
    if (value < 0) value = 255 + value + 1;
    this[offset] = value & 255;
    return offset + 1;
  };
  Buffer2.prototype.writeInt16LE = function writeInt16LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 2, 32767, -32768);
    this[offset] = value & 255;
    this[offset + 1] = value >>> 8;
    return offset + 2;
  };
  Buffer2.prototype.writeInt16BE = function writeInt16BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 2, 32767, -32768);
    this[offset] = value >>> 8;
    this[offset + 1] = value & 255;
    return offset + 2;
  };
  Buffer2.prototype.writeInt32LE = function writeInt32LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 4, 2147483647, -2147483648);
    this[offset] = value & 255;
    this[offset + 1] = value >>> 8;
    this[offset + 2] = value >>> 16;
    this[offset + 3] = value >>> 24;
    return offset + 4;
  };
  Buffer2.prototype.writeInt32BE = function writeInt32BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) checkInt(this, value, offset, 4, 2147483647, -2147483648);
    if (value < 0) value = 4294967295 + value + 1;
    this[offset] = value >>> 24;
    this[offset + 1] = value >>> 16;
    this[offset + 2] = value >>> 8;
    this[offset + 3] = value & 255;
    return offset + 4;
  };
  function checkIEEE754(buf, value, offset, ext, max2, min2) {
    if (offset + ext > buf.length) throw new RangeError("Index out of range");
    if (offset < 0) throw new RangeError("Index out of range");
  }
  function writeFloat(buf, value, offset, littleEndian, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) {
      checkIEEE754(buf, value, offset, 4);
    }
    ieee754.write(buf, value, offset, littleEndian, 23, 4);
    return offset + 4;
  }
  Buffer2.prototype.writeFloatLE = function writeFloatLE(value, offset, noAssert) {
    return writeFloat(this, value, offset, true, noAssert);
  };
  Buffer2.prototype.writeFloatBE = function writeFloatBE(value, offset, noAssert) {
    return writeFloat(this, value, offset, false, noAssert);
  };
  function writeDouble(buf, value, offset, littleEndian, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) {
      checkIEEE754(buf, value, offset, 8);
    }
    ieee754.write(buf, value, offset, littleEndian, 52, 8);
    return offset + 8;
  }
  Buffer2.prototype.writeDoubleLE = function writeDoubleLE(value, offset, noAssert) {
    return writeDouble(this, value, offset, true, noAssert);
  };
  Buffer2.prototype.writeDoubleBE = function writeDoubleBE(value, offset, noAssert) {
    return writeDouble(this, value, offset, false, noAssert);
  };
  Buffer2.prototype.copy = function copy(target, targetStart, start, end) {
    if (!Buffer2.isBuffer(target)) throw new TypeError("argument should be a Buffer");
    if (!start) start = 0;
    if (!end && end !== 0) end = this.length;
    if (targetStart >= target.length) targetStart = target.length;
    if (!targetStart) targetStart = 0;
    if (end > 0 && end < start) end = start;
    if (end === start) return 0;
    if (target.length === 0 || this.length === 0) return 0;
    if (targetStart < 0) {
      throw new RangeError("targetStart out of bounds");
    }
    if (start < 0 || start >= this.length) throw new RangeError("Index out of range");
    if (end < 0) throw new RangeError("sourceEnd out of bounds");
    if (end > this.length) end = this.length;
    if (target.length - targetStart < end - start) {
      end = target.length - targetStart + start;
    }
    var len = end - start;
    if (this === target && typeof Uint8Array.prototype.copyWithin === "function") {
      this.copyWithin(targetStart, start, end);
    } else {
      Uint8Array.prototype.set.call(target, this.subarray(start, end), targetStart);
    }
    return len;
  };
  Buffer2.prototype.fill = function fill(val, start, end, encoding) {
    if (typeof val === "string") {
      if (typeof start === "string") {
        encoding = start;
        start = 0;
        end = this.length;
      } else if (typeof end === "string") {
        encoding = end;
        end = this.length;
      }
      if (encoding !== void 0 && typeof encoding !== "string") {
        throw new TypeError("encoding must be a string");
      }
      if (typeof encoding === "string" && !Buffer2.isEncoding(encoding)) {
        throw new TypeError("Unknown encoding: " + encoding);
      }
      if (val.length === 1) {
        var code2 = val.charCodeAt(0);
        if (encoding === "utf8" && code2 < 128 || encoding === "latin1") {
          val = code2;
        }
      }
    } else if (typeof val === "number") {
      val = val & 255;
    } else if (typeof val === "boolean") {
      val = Number(val);
    }
    if (start < 0 || this.length < start || this.length < end) {
      throw new RangeError("Out of range index");
    }
    if (end <= start) {
      return this;
    }
    start = start >>> 0;
    end = end === void 0 ? this.length : end >>> 0;
    if (!val) val = 0;
    var i2;
    if (typeof val === "number") {
      for (i2 = start; i2 < end; ++i2) {
        this[i2] = val;
      }
    } else {
      var bytes = Buffer2.isBuffer(val) ? val : Buffer2.from(val, encoding);
      var len = bytes.length;
      if (len === 0) {
        throw new TypeError('The value "' + val + '" is invalid for argument "value"');
      }
      for (i2 = 0; i2 < end - start; ++i2) {
        this[i2 + start] = bytes[i2 % len];
      }
    }
    return this;
  };
  var INVALID_BASE64_RE = /[^+/0-9A-Za-z-_]/g;
  function base64clean(str) {
    str = str.split("=")[0];
    str = str.trim().replace(INVALID_BASE64_RE, "");
    if (str.length < 2) return "";
    while (str.length % 4 !== 0) {
      str = str + "=";
    }
    return str;
  }
  function utf8ToBytes(string, units) {
    units = units || Infinity;
    var codePoint;
    var length = string.length;
    var leadSurrogate = null;
    var bytes = [];
    for (var i2 = 0; i2 < length; ++i2) {
      codePoint = string.charCodeAt(i2);
      if (codePoint > 55295 && codePoint < 57344) {
        if (!leadSurrogate) {
          if (codePoint > 56319) {
            if ((units -= 3) > -1) bytes.push(239, 191, 189);
            continue;
          } else if (i2 + 1 === length) {
            if ((units -= 3) > -1) bytes.push(239, 191, 189);
            continue;
          }
          leadSurrogate = codePoint;
          continue;
        }
        if (codePoint < 56320) {
          if ((units -= 3) > -1) bytes.push(239, 191, 189);
          leadSurrogate = codePoint;
          continue;
        }
        codePoint = (leadSurrogate - 55296 << 10 | codePoint - 56320) + 65536;
      } else if (leadSurrogate) {
        if ((units -= 3) > -1) bytes.push(239, 191, 189);
      }
      leadSurrogate = null;
      if (codePoint < 128) {
        if ((units -= 1) < 0) break;
        bytes.push(codePoint);
      } else if (codePoint < 2048) {
        if ((units -= 2) < 0) break;
        bytes.push(codePoint >> 6 | 192, codePoint & 63 | 128);
      } else if (codePoint < 65536) {
        if ((units -= 3) < 0) break;
        bytes.push(codePoint >> 12 | 224, codePoint >> 6 & 63 | 128, codePoint & 63 | 128);
      } else if (codePoint < 1114112) {
        if ((units -= 4) < 0) break;
        bytes.push(codePoint >> 18 | 240, codePoint >> 12 & 63 | 128, codePoint >> 6 & 63 | 128, codePoint & 63 | 128);
      } else {
        throw new Error("Invalid code point");
      }
    }
    return bytes;
  }
  function asciiToBytes(str) {
    var byteArray = [];
    for (var i2 = 0; i2 < str.length; ++i2) {
      byteArray.push(str.charCodeAt(i2) & 255);
    }
    return byteArray;
  }
  function utf16leToBytes(str, units) {
    var c2, hi, lo;
    var byteArray = [];
    for (var i2 = 0; i2 < str.length; ++i2) {
      if ((units -= 2) < 0) break;
      c2 = str.charCodeAt(i2);
      hi = c2 >> 8;
      lo = c2 % 256;
      byteArray.push(lo);
      byteArray.push(hi);
    }
    return byteArray;
  }
  function base64ToBytes(str) {
    return base64Js.toByteArray(base64clean(str));
  }
  function blitBuffer(src, dst, offset, length) {
    for (var i2 = 0; i2 < length; ++i2) {
      if (i2 + offset >= dst.length || i2 >= src.length) break;
      dst[i2 + offset] = src[i2];
    }
    return i2;
  }
  function isInstance(obj, type) {
    return obj instanceof type || obj != null && obj.constructor != null && obj.constructor.name != null && obj.constructor.name === type.name;
  }
  function numberIsNaN(obj) {
    return obj !== obj;
  }
  var hexSliceLookupTable = function() {
    var alphabet = "0123456789abcdef";
    var table = new Array(256);
    for (var i2 = 0; i2 < 16; ++i2) {
      var i16 = i2 * 16;
      for (var j2 = 0; j2 < 16; ++j2) {
        table[i16 + j2] = alphabet[i2] + alphabet[j2];
      }
    }
    return table;
  }();
});
var buffer_1 = buffer$1.Buffer;
buffer$1.SlowBuffer;
buffer$1.INSPECT_MAX_BYTES;
buffer$1.kMaxLength;
var _extendStatics = function extendStatics3(d2, b2) {
  _extendStatics = Object.setPrototypeOf || {
    __proto__: []
  } instanceof Array && function(d3, b3) {
    d3.__proto__ = b3;
  } || function(d3, b3) {
    for (var p2 in b3) {
      if (b3.hasOwnProperty(p2)) d3[p2] = b3[p2];
    }
  };
  return _extendStatics(d2, b2);
};
function __extends13(d2, b2) {
  _extendStatics(d2, b2);
  function __() {
    this.constructor = d2;
  }
  d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
}
var BSONError = (
  /** @class */
  function(_super) {
    __extends13(BSONError2, _super);
    function BSONError2(message) {
      var _this = _super.call(this, message) || this;
      Object.setPrototypeOf(_this, BSONError2.prototype);
      return _this;
    }
    Object.defineProperty(BSONError2.prototype, "name", {
      get: function() {
        return "BSONError";
      },
      enumerable: false,
      configurable: true
    });
    return BSONError2;
  }(Error)
);
var BSONTypeError = (
  /** @class */
  function(_super) {
    __extends13(BSONTypeError2, _super);
    function BSONTypeError2(message) {
      var _this = _super.call(this, message) || this;
      Object.setPrototypeOf(_this, BSONTypeError2.prototype);
      return _this;
    }
    Object.defineProperty(BSONTypeError2.prototype, "name", {
      get: function() {
        return "BSONTypeError";
      },
      enumerable: false,
      configurable: true
    });
    return BSONTypeError2;
  }(TypeError)
);
function checkForMath(potentialGlobal) {
  return potentialGlobal && potentialGlobal.Math == Math && potentialGlobal;
}
function getGlobal() {
  return checkForMath(typeof globalThis === "object" && globalThis) || checkForMath(typeof window === "object" && window) || checkForMath(typeof self === "object" && self) || checkForMath(typeof global === "object" && global) || // eslint-disable-next-line @typescript-eslint/no-implied-eval
  Function("return this")();
}
function isReactNative() {
  var g2 = getGlobal();
  return typeof g2.navigator === "object" && g2.navigator.product === "ReactNative";
}
var insecureRandomBytes = function insecureRandomBytes2(size2) {
  var insecureWarning = isReactNative() ? "BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values." : "BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";
  console.warn(insecureWarning);
  var result = buffer_1.alloc(size2);
  for (var i2 = 0; i2 < size2; ++i2)
    result[i2] = Math.floor(Math.random() * 256);
  return result;
};
var detectRandomBytes = function() {
  {
    if (typeof window !== "undefined") {
      var target_1 = window.crypto || window.msCrypto;
      if (target_1 && target_1.getRandomValues) {
        return function(size2) {
          return target_1.getRandomValues(buffer_1.alloc(size2));
        };
      }
    }
    if (typeof global !== "undefined" && global.crypto && global.crypto.getRandomValues) {
      return function(size2) {
        return global.crypto.getRandomValues(buffer_1.alloc(size2));
      };
    }
    return insecureRandomBytes;
  }
};
var randomBytes = detectRandomBytes();
function isAnyArrayBuffer(value) {
  return ["[object ArrayBuffer]", "[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(value));
}
function isUint8Array(value) {
  return Object.prototype.toString.call(value) === "[object Uint8Array]";
}
function isRegExp2(d2) {
  return Object.prototype.toString.call(d2) === "[object RegExp]";
}
function isDate2(d2) {
  return isObjectLike(d2) && Object.prototype.toString.call(d2) === "[object Date]";
}
function isObjectLike(candidate) {
  return typeof candidate === "object" && candidate !== null;
}
function deprecate(fn, message) {
  var warned = false;
  function deprecated() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      args[_i] = arguments[_i];
    }
    if (!warned) {
      console.warn(message);
      warned = true;
    }
    return fn.apply(this, args);
  }
  return deprecated;
}
function ensureBuffer(potentialBuffer) {
  if (ArrayBuffer.isView(potentialBuffer)) {
    return buffer_1.from(potentialBuffer.buffer, potentialBuffer.byteOffset, potentialBuffer.byteLength);
  }
  if (isAnyArrayBuffer(potentialBuffer)) {
    return buffer_1.from(potentialBuffer);
  }
  throw new BSONTypeError("Must use either Buffer or TypedArray");
}
var VALIDATION_REGEX = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i;
var uuidValidateString = function(str) {
  return typeof str === "string" && VALIDATION_REGEX.test(str);
};
var uuidHexStringToBuffer = function(hexString) {
  if (!uuidValidateString(hexString)) {
    throw new BSONTypeError('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');
  }
  var sanitizedHexString = hexString.replace(/-/g, "");
  return buffer_1.from(sanitizedHexString, "hex");
};
var bufferToUuidHexString = function(buffer2, includeDashes) {
  if (includeDashes === void 0) {
    includeDashes = true;
  }
  return includeDashes ? buffer2.toString("hex", 0, 4) + "-" + buffer2.toString("hex", 4, 6) + "-" + buffer2.toString("hex", 6, 8) + "-" + buffer2.toString("hex", 8, 10) + "-" + buffer2.toString("hex", 10, 16) : buffer2.toString("hex");
};
var BSON_INT64_MAX$1 = Math.pow(2, 63) - 1;
var BSON_INT64_MIN$1 = -Math.pow(2, 63);
var JS_INT_MAX = Math.pow(2, 53);
var JS_INT_MIN = -Math.pow(2, 53);
var BSON_BINARY_SUBTYPE_UUID_NEW = 4;
var Binary = (
  /** @class */
  function() {
    function Binary2(buffer2, subType) {
      if (!(this instanceof Binary2))
        return new Binary2(buffer2, subType);
      if (!(buffer2 == null) && !(typeof buffer2 === "string") && !ArrayBuffer.isView(buffer2) && !(buffer2 instanceof ArrayBuffer) && !Array.isArray(buffer2)) {
        throw new BSONTypeError("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");
      }
      this.sub_type = subType !== null && subType !== void 0 ? subType : Binary2.BSON_BINARY_SUBTYPE_DEFAULT;
      if (buffer2 == null) {
        this.buffer = buffer_1.alloc(Binary2.BUFFER_SIZE);
        this.position = 0;
      } else {
        if (typeof buffer2 === "string") {
          this.buffer = buffer_1.from(buffer2, "binary");
        } else if (Array.isArray(buffer2)) {
          this.buffer = buffer_1.from(buffer2);
        } else {
          this.buffer = ensureBuffer(buffer2);
        }
        this.position = this.buffer.byteLength;
      }
    }
    Binary2.prototype.put = function(byteValue) {
      if (typeof byteValue === "string" && byteValue.length !== 1) {
        throw new BSONTypeError("only accepts single character String");
      } else if (typeof byteValue !== "number" && byteValue.length !== 1)
        throw new BSONTypeError("only accepts single character Uint8Array or Array");
      var decodedByte;
      if (typeof byteValue === "string") {
        decodedByte = byteValue.charCodeAt(0);
      } else if (typeof byteValue === "number") {
        decodedByte = byteValue;
      } else {
        decodedByte = byteValue[0];
      }
      if (decodedByte < 0 || decodedByte > 255) {
        throw new BSONTypeError("only accepts number in a valid unsigned byte range 0-255");
      }
      if (this.buffer.length > this.position) {
        this.buffer[this.position++] = decodedByte;
      } else {
        var buffer2 = buffer_1.alloc(Binary2.BUFFER_SIZE + this.buffer.length);
        this.buffer.copy(buffer2, 0, 0, this.buffer.length);
        this.buffer = buffer2;
        this.buffer[this.position++] = decodedByte;
      }
    };
    Binary2.prototype.write = function(sequence, offset) {
      offset = typeof offset === "number" ? offset : this.position;
      if (this.buffer.length < offset + sequence.length) {
        var buffer2 = buffer_1.alloc(this.buffer.length + sequence.length);
        this.buffer.copy(buffer2, 0, 0, this.buffer.length);
        this.buffer = buffer2;
      }
      if (ArrayBuffer.isView(sequence)) {
        this.buffer.set(ensureBuffer(sequence), offset);
        this.position = offset + sequence.byteLength > this.position ? offset + sequence.length : this.position;
      } else if (typeof sequence === "string") {
        this.buffer.write(sequence, offset, sequence.length, "binary");
        this.position = offset + sequence.length > this.position ? offset + sequence.length : this.position;
      }
    };
    Binary2.prototype.read = function(position, length) {
      length = length && length > 0 ? length : this.position;
      return this.buffer.slice(position, position + length);
    };
    Binary2.prototype.value = function(asRaw) {
      asRaw = !!asRaw;
      if (asRaw && this.buffer.length === this.position) {
        return this.buffer;
      }
      if (asRaw) {
        return this.buffer.slice(0, this.position);
      }
      return this.buffer.toString("binary", 0, this.position);
    };
    Binary2.prototype.length = function() {
      return this.position;
    };
    Binary2.prototype.toJSON = function() {
      return this.buffer.toString("base64");
    };
    Binary2.prototype.toString = function(format) {
      return this.buffer.toString(format);
    };
    Binary2.prototype.toExtendedJSON = function(options) {
      options = options || {};
      var base64String = this.buffer.toString("base64");
      var subType = Number(this.sub_type).toString(16);
      if (options.legacy) {
        return {
          $binary: base64String,
          $type: subType.length === 1 ? "0" + subType : subType
        };
      }
      return {
        $binary: {
          base64: base64String,
          subType: subType.length === 1 ? "0" + subType : subType
        }
      };
    };
    Binary2.prototype.toUUID = function() {
      if (this.sub_type === Binary2.SUBTYPE_UUID) {
        return new UUID(this.buffer.slice(0, this.position));
      }
      throw new BSONError('Binary sub_type "'.concat(this.sub_type, '" is not supported for converting to UUID. Only "').concat(Binary2.SUBTYPE_UUID, '" is currently supported.'));
    };
    Binary2.fromExtendedJSON = function(doc, options) {
      options = options || {};
      var data2;
      var type;
      if ("$binary" in doc) {
        if (options.legacy && typeof doc.$binary === "string" && "$type" in doc) {
          type = doc.$type ? parseInt(doc.$type, 16) : 0;
          data2 = buffer_1.from(doc.$binary, "base64");
        } else {
          if (typeof doc.$binary !== "string") {
            type = doc.$binary.subType ? parseInt(doc.$binary.subType, 16) : 0;
            data2 = buffer_1.from(doc.$binary.base64, "base64");
          }
        }
      } else if ("$uuid" in doc) {
        type = 4;
        data2 = uuidHexStringToBuffer(doc.$uuid);
      }
      if (!data2) {
        throw new BSONTypeError("Unexpected Binary Extended JSON format ".concat(JSON.stringify(doc)));
      }
      return type === BSON_BINARY_SUBTYPE_UUID_NEW ? new UUID(data2) : new Binary2(data2, type);
    };
    Binary2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    Binary2.prototype.inspect = function() {
      var asBuffer = this.value(true);
      return 'new Binary(Buffer.from("'.concat(asBuffer.toString("hex"), '", "hex"), ').concat(this.sub_type, ")");
    };
    Binary2.BSON_BINARY_SUBTYPE_DEFAULT = 0;
    Binary2.BUFFER_SIZE = 256;
    Binary2.SUBTYPE_DEFAULT = 0;
    Binary2.SUBTYPE_FUNCTION = 1;
    Binary2.SUBTYPE_BYTE_ARRAY = 2;
    Binary2.SUBTYPE_UUID_OLD = 3;
    Binary2.SUBTYPE_UUID = 4;
    Binary2.SUBTYPE_MD5 = 5;
    Binary2.SUBTYPE_ENCRYPTED = 6;
    Binary2.SUBTYPE_COLUMN = 7;
    Binary2.SUBTYPE_USER_DEFINED = 128;
    return Binary2;
  }()
);
Object.defineProperty(Binary.prototype, "_bsontype", { value: "Binary" });
var UUID_BYTE_LENGTH = 16;
var UUID = (
  /** @class */
  function(_super) {
    __extends13(UUID2, _super);
    function UUID2(input) {
      var _this = this;
      var bytes;
      var hexStr;
      if (input == null) {
        bytes = UUID2.generate();
      } else if (input instanceof UUID2) {
        bytes = buffer_1.from(input.buffer);
        hexStr = input.__id;
      } else if (ArrayBuffer.isView(input) && input.byteLength === UUID_BYTE_LENGTH) {
        bytes = ensureBuffer(input);
      } else if (typeof input === "string") {
        bytes = uuidHexStringToBuffer(input);
      } else {
        throw new BSONTypeError("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");
      }
      _this = _super.call(this, bytes, BSON_BINARY_SUBTYPE_UUID_NEW) || this;
      _this.__id = hexStr;
      return _this;
    }
    Object.defineProperty(UUID2.prototype, "id", {
      /**
       * The UUID bytes
       * @readonly
       */
      get: function() {
        return this.buffer;
      },
      set: function(value) {
        this.buffer = value;
        if (UUID2.cacheHexString) {
          this.__id = bufferToUuidHexString(value);
        }
      },
      enumerable: false,
      configurable: true
    });
    UUID2.prototype.toHexString = function(includeDashes) {
      if (includeDashes === void 0) {
        includeDashes = true;
      }
      if (UUID2.cacheHexString && this.__id) {
        return this.__id;
      }
      var uuidHexString = bufferToUuidHexString(this.id, includeDashes);
      if (UUID2.cacheHexString) {
        this.__id = uuidHexString;
      }
      return uuidHexString;
    };
    UUID2.prototype.toString = function(encoding) {
      return encoding ? this.id.toString(encoding) : this.toHexString();
    };
    UUID2.prototype.toJSON = function() {
      return this.toHexString();
    };
    UUID2.prototype.equals = function(otherId) {
      if (!otherId) {
        return false;
      }
      if (otherId instanceof UUID2) {
        return otherId.id.equals(this.id);
      }
      try {
        return new UUID2(otherId).id.equals(this.id);
      } catch (_a3) {
        return false;
      }
    };
    UUID2.prototype.toBinary = function() {
      return new Binary(this.id, Binary.SUBTYPE_UUID);
    };
    UUID2.generate = function() {
      var bytes = randomBytes(UUID_BYTE_LENGTH);
      bytes[6] = bytes[6] & 15 | 64;
      bytes[8] = bytes[8] & 63 | 128;
      return buffer_1.from(bytes);
    };
    UUID2.isValid = function(input) {
      if (!input) {
        return false;
      }
      if (input instanceof UUID2) {
        return true;
      }
      if (typeof input === "string") {
        return uuidValidateString(input);
      }
      if (isUint8Array(input)) {
        if (input.length !== UUID_BYTE_LENGTH) {
          return false;
        }
        return (input[6] & 240) === 64 && (input[8] & 128) === 128;
      }
      return false;
    };
    UUID2.createFromHexString = function(hexString) {
      var buffer2 = uuidHexStringToBuffer(hexString);
      return new UUID2(buffer2);
    };
    UUID2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    UUID2.prototype.inspect = function() {
      return 'new UUID("'.concat(this.toHexString(), '")');
    };
    return UUID2;
  }(Binary)
);
var Code = (
  /** @class */
  function() {
    function Code2(code2, scope) {
      if (!(this instanceof Code2))
        return new Code2(code2, scope);
      this.code = code2;
      this.scope = scope;
    }
    Code2.prototype.toJSON = function() {
      return { code: this.code, scope: this.scope };
    };
    Code2.prototype.toExtendedJSON = function() {
      if (this.scope) {
        return { $code: this.code, $scope: this.scope };
      }
      return { $code: this.code };
    };
    Code2.fromExtendedJSON = function(doc) {
      return new Code2(doc.$code, doc.$scope);
    };
    Code2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    Code2.prototype.inspect = function() {
      var codeJson = this.toJSON();
      return 'new Code("'.concat(String(codeJson.code), '"').concat(codeJson.scope ? ", ".concat(JSON.stringify(codeJson.scope)) : "", ")");
    };
    return Code2;
  }()
);
Object.defineProperty(Code.prototype, "_bsontype", { value: "Code" });
function isDBRefLike(value) {
  return isObjectLike(value) && value.$id != null && typeof value.$ref === "string" && (value.$db == null || typeof value.$db === "string");
}
var DBRef = (
  /** @class */
  function() {
    function DBRef2(collection, oid, db, fields) {
      if (!(this instanceof DBRef2))
        return new DBRef2(collection, oid, db, fields);
      var parts = collection.split(".");
      if (parts.length === 2) {
        db = parts.shift();
        collection = parts.shift();
      }
      this.collection = collection;
      this.oid = oid;
      this.db = db;
      this.fields = fields || {};
    }
    Object.defineProperty(DBRef2.prototype, "namespace", {
      // Property provided for compatibility with the 1.x parser
      // the 1.x parser used a "namespace" property, while 4.x uses "collection"
      /** @internal */
      get: function() {
        return this.collection;
      },
      set: function(value) {
        this.collection = value;
      },
      enumerable: false,
      configurable: true
    });
    DBRef2.prototype.toJSON = function() {
      var o2 = Object.assign({
        $ref: this.collection,
        $id: this.oid
      }, this.fields);
      if (this.db != null)
        o2.$db = this.db;
      return o2;
    };
    DBRef2.prototype.toExtendedJSON = function(options) {
      options = options || {};
      var o2 = {
        $ref: this.collection,
        $id: this.oid
      };
      if (options.legacy) {
        return o2;
      }
      if (this.db)
        o2.$db = this.db;
      o2 = Object.assign(o2, this.fields);
      return o2;
    };
    DBRef2.fromExtendedJSON = function(doc) {
      var copy = Object.assign({}, doc);
      delete copy.$ref;
      delete copy.$id;
      delete copy.$db;
      return new DBRef2(doc.$ref, doc.$id, doc.$db, copy);
    };
    DBRef2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    DBRef2.prototype.inspect = function() {
      var oid = this.oid === void 0 || this.oid.toString === void 0 ? this.oid : this.oid.toString();
      return 'new DBRef("'.concat(this.namespace, '", new ObjectId("').concat(String(oid), '")').concat(this.db ? ', "'.concat(this.db, '"') : "", ")");
    };
    return DBRef2;
  }()
);
Object.defineProperty(DBRef.prototype, "_bsontype", { value: "DBRef" });
var wasm = void 0;
try {
  wasm = new WebAssembly.Instance(new WebAssembly.Module(
    // prettier-ignore
    new Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 13, 2, 96, 0, 1, 127, 96, 4, 127, 127, 127, 127, 1, 127, 3, 7, 6, 0, 1, 1, 1, 1, 1, 6, 6, 1, 127, 1, 65, 0, 11, 7, 50, 6, 3, 109, 117, 108, 0, 1, 5, 100, 105, 118, 95, 115, 0, 2, 5, 100, 105, 118, 95, 117, 0, 3, 5, 114, 101, 109, 95, 115, 0, 4, 5, 114, 101, 109, 95, 117, 0, 5, 8, 103, 101, 116, 95, 104, 105, 103, 104, 0, 0, 10, 191, 1, 6, 4, 0, 35, 0, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 126, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 127, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 128, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 129, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11, 36, 1, 1, 126, 32, 0, 173, 32, 1, 173, 66, 32, 134, 132, 32, 2, 173, 32, 3, 173, 66, 32, 134, 132, 130, 34, 4, 66, 32, 135, 167, 36, 0, 32, 4, 167, 11])
  ), {}).exports;
} catch (_a3) {
}
var TWO_PWR_16_DBL = 1 << 16;
var TWO_PWR_24_DBL = 1 << 24;
var TWO_PWR_32_DBL = TWO_PWR_16_DBL * TWO_PWR_16_DBL;
var TWO_PWR_64_DBL = TWO_PWR_32_DBL * TWO_PWR_32_DBL;
var TWO_PWR_63_DBL = TWO_PWR_64_DBL / 2;
var INT_CACHE = {};
var UINT_CACHE = {};
var Long = (
  /** @class */
  function() {
    function Long2(low, high, unsigned) {
      if (low === void 0) {
        low = 0;
      }
      if (!(this instanceof Long2))
        return new Long2(low, high, unsigned);
      if (typeof low === "bigint") {
        Object.assign(this, Long2.fromBigInt(low, !!high));
      } else if (typeof low === "string") {
        Object.assign(this, Long2.fromString(low, !!high));
      } else {
        this.low = low | 0;
        this.high = high | 0;
        this.unsigned = !!unsigned;
      }
      Object.defineProperty(this, "__isLong__", {
        value: true,
        configurable: false,
        writable: false,
        enumerable: false
      });
    }
    Long2.fromBits = function(lowBits, highBits, unsigned) {
      return new Long2(lowBits, highBits, unsigned);
    };
    Long2.fromInt = function(value, unsigned) {
      var obj, cachedObj, cache;
      if (unsigned) {
        value >>>= 0;
        if (cache = 0 <= value && value < 256) {
          cachedObj = UINT_CACHE[value];
          if (cachedObj)
            return cachedObj;
        }
        obj = Long2.fromBits(value, (value | 0) < 0 ? -1 : 0, true);
        if (cache)
          UINT_CACHE[value] = obj;
        return obj;
      } else {
        value |= 0;
        if (cache = -128 <= value && value < 128) {
          cachedObj = INT_CACHE[value];
          if (cachedObj)
            return cachedObj;
        }
        obj = Long2.fromBits(value, value < 0 ? -1 : 0, false);
        if (cache)
          INT_CACHE[value] = obj;
        return obj;
      }
    };
    Long2.fromNumber = function(value, unsigned) {
      if (isNaN(value))
        return unsigned ? Long2.UZERO : Long2.ZERO;
      if (unsigned) {
        if (value < 0)
          return Long2.UZERO;
        if (value >= TWO_PWR_64_DBL)
          return Long2.MAX_UNSIGNED_VALUE;
      } else {
        if (value <= -TWO_PWR_63_DBL)
          return Long2.MIN_VALUE;
        if (value + 1 >= TWO_PWR_63_DBL)
          return Long2.MAX_VALUE;
      }
      if (value < 0)
        return Long2.fromNumber(-value, unsigned).neg();
      return Long2.fromBits(value % TWO_PWR_32_DBL | 0, value / TWO_PWR_32_DBL | 0, unsigned);
    };
    Long2.fromBigInt = function(value, unsigned) {
      return Long2.fromString(value.toString(), unsigned);
    };
    Long2.fromString = function(str, unsigned, radix) {
      if (str.length === 0)
        throw Error("empty string");
      if (str === "NaN" || str === "Infinity" || str === "+Infinity" || str === "-Infinity")
        return Long2.ZERO;
      if (typeof unsigned === "number") {
        radix = unsigned, unsigned = false;
      } else {
        unsigned = !!unsigned;
      }
      radix = radix || 10;
      if (radix < 2 || 36 < radix)
        throw RangeError("radix");
      var p2;
      if ((p2 = str.indexOf("-")) > 0)
        throw Error("interior hyphen");
      else if (p2 === 0) {
        return Long2.fromString(str.substring(1), unsigned, radix).neg();
      }
      var radixToPower = Long2.fromNumber(Math.pow(radix, 8));
      var result = Long2.ZERO;
      for (var i2 = 0; i2 < str.length; i2 += 8) {
        var size2 = Math.min(8, str.length - i2), value = parseInt(str.substring(i2, i2 + size2), radix);
        if (size2 < 8) {
          var power = Long2.fromNumber(Math.pow(radix, size2));
          result = result.mul(power).add(Long2.fromNumber(value));
        } else {
          result = result.mul(radixToPower);
          result = result.add(Long2.fromNumber(value));
        }
      }
      result.unsigned = unsigned;
      return result;
    };
    Long2.fromBytes = function(bytes, unsigned, le2) {
      return le2 ? Long2.fromBytesLE(bytes, unsigned) : Long2.fromBytesBE(bytes, unsigned);
    };
    Long2.fromBytesLE = function(bytes, unsigned) {
      return new Long2(bytes[0] | bytes[1] << 8 | bytes[2] << 16 | bytes[3] << 24, bytes[4] | bytes[5] << 8 | bytes[6] << 16 | bytes[7] << 24, unsigned);
    };
    Long2.fromBytesBE = function(bytes, unsigned) {
      return new Long2(bytes[4] << 24 | bytes[5] << 16 | bytes[6] << 8 | bytes[7], bytes[0] << 24 | bytes[1] << 16 | bytes[2] << 8 | bytes[3], unsigned);
    };
    Long2.isLong = function(value) {
      return isObjectLike(value) && value["__isLong__"] === true;
    };
    Long2.fromValue = function(val, unsigned) {
      if (typeof val === "number")
        return Long2.fromNumber(val, unsigned);
      if (typeof val === "string")
        return Long2.fromString(val, unsigned);
      return Long2.fromBits(val.low, val.high, typeof unsigned === "boolean" ? unsigned : val.unsigned);
    };
    Long2.prototype.add = function(addend) {
      if (!Long2.isLong(addend))
        addend = Long2.fromValue(addend);
      var a48 = this.high >>> 16;
      var a32 = this.high & 65535;
      var a16 = this.low >>> 16;
      var a00 = this.low & 65535;
      var b48 = addend.high >>> 16;
      var b32 = addend.high & 65535;
      var b16 = addend.low >>> 16;
      var b00 = addend.low & 65535;
      var c48 = 0, c32 = 0, c16 = 0, c00 = 0;
      c00 += a00 + b00;
      c16 += c00 >>> 16;
      c00 &= 65535;
      c16 += a16 + b16;
      c32 += c16 >>> 16;
      c16 &= 65535;
      c32 += a32 + b32;
      c48 += c32 >>> 16;
      c32 &= 65535;
      c48 += a48 + b48;
      c48 &= 65535;
      return Long2.fromBits(c16 << 16 | c00, c48 << 16 | c32, this.unsigned);
    };
    Long2.prototype.and = function(other) {
      if (!Long2.isLong(other))
        other = Long2.fromValue(other);
      return Long2.fromBits(this.low & other.low, this.high & other.high, this.unsigned);
    };
    Long2.prototype.compare = function(other) {
      if (!Long2.isLong(other))
        other = Long2.fromValue(other);
      if (this.eq(other))
        return 0;
      var thisNeg = this.isNegative(), otherNeg = other.isNegative();
      if (thisNeg && !otherNeg)
        return -1;
      if (!thisNeg && otherNeg)
        return 1;
      if (!this.unsigned)
        return this.sub(other).isNegative() ? -1 : 1;
      return other.high >>> 0 > this.high >>> 0 || other.high === this.high && other.low >>> 0 > this.low >>> 0 ? -1 : 1;
    };
    Long2.prototype.comp = function(other) {
      return this.compare(other);
    };
    Long2.prototype.divide = function(divisor) {
      if (!Long2.isLong(divisor))
        divisor = Long2.fromValue(divisor);
      if (divisor.isZero())
        throw Error("division by zero");
      if (wasm) {
        if (!this.unsigned && this.high === -2147483648 && divisor.low === -1 && divisor.high === -1) {
          return this;
        }
        var low = (this.unsigned ? wasm.div_u : wasm.div_s)(this.low, this.high, divisor.low, divisor.high);
        return Long2.fromBits(low, wasm.get_high(), this.unsigned);
      }
      if (this.isZero())
        return this.unsigned ? Long2.UZERO : Long2.ZERO;
      var approx, rem, res;
      if (!this.unsigned) {
        if (this.eq(Long2.MIN_VALUE)) {
          if (divisor.eq(Long2.ONE) || divisor.eq(Long2.NEG_ONE))
            return Long2.MIN_VALUE;
          else if (divisor.eq(Long2.MIN_VALUE))
            return Long2.ONE;
          else {
            var halfThis = this.shr(1);
            approx = halfThis.div(divisor).shl(1);
            if (approx.eq(Long2.ZERO)) {
              return divisor.isNegative() ? Long2.ONE : Long2.NEG_ONE;
            } else {
              rem = this.sub(divisor.mul(approx));
              res = approx.add(rem.div(divisor));
              return res;
            }
          }
        } else if (divisor.eq(Long2.MIN_VALUE))
          return this.unsigned ? Long2.UZERO : Long2.ZERO;
        if (this.isNegative()) {
          if (divisor.isNegative())
            return this.neg().div(divisor.neg());
          return this.neg().div(divisor).neg();
        } else if (divisor.isNegative())
          return this.div(divisor.neg()).neg();
        res = Long2.ZERO;
      } else {
        if (!divisor.unsigned)
          divisor = divisor.toUnsigned();
        if (divisor.gt(this))
          return Long2.UZERO;
        if (divisor.gt(this.shru(1)))
          return Long2.UONE;
        res = Long2.UZERO;
      }
      rem = this;
      while (rem.gte(divisor)) {
        approx = Math.max(1, Math.floor(rem.toNumber() / divisor.toNumber()));
        var log2 = Math.ceil(Math.log(approx) / Math.LN2);
        var delta = log2 <= 48 ? 1 : Math.pow(2, log2 - 48);
        var approxRes = Long2.fromNumber(approx);
        var approxRem = approxRes.mul(divisor);
        while (approxRem.isNegative() || approxRem.gt(rem)) {
          approx -= delta;
          approxRes = Long2.fromNumber(approx, this.unsigned);
          approxRem = approxRes.mul(divisor);
        }
        if (approxRes.isZero())
          approxRes = Long2.ONE;
        res = res.add(approxRes);
        rem = rem.sub(approxRem);
      }
      return res;
    };
    Long2.prototype.div = function(divisor) {
      return this.divide(divisor);
    };
    Long2.prototype.equals = function(other) {
      if (!Long2.isLong(other))
        other = Long2.fromValue(other);
      if (this.unsigned !== other.unsigned && this.high >>> 31 === 1 && other.high >>> 31 === 1)
        return false;
      return this.high === other.high && this.low === other.low;
    };
    Long2.prototype.eq = function(other) {
      return this.equals(other);
    };
    Long2.prototype.getHighBits = function() {
      return this.high;
    };
    Long2.prototype.getHighBitsUnsigned = function() {
      return this.high >>> 0;
    };
    Long2.prototype.getLowBits = function() {
      return this.low;
    };
    Long2.prototype.getLowBitsUnsigned = function() {
      return this.low >>> 0;
    };
    Long2.prototype.getNumBitsAbs = function() {
      if (this.isNegative()) {
        return this.eq(Long2.MIN_VALUE) ? 64 : this.neg().getNumBitsAbs();
      }
      var val = this.high !== 0 ? this.high : this.low;
      var bit;
      for (bit = 31; bit > 0; bit--)
        if ((val & 1 << bit) !== 0)
          break;
      return this.high !== 0 ? bit + 33 : bit + 1;
    };
    Long2.prototype.greaterThan = function(other) {
      return this.comp(other) > 0;
    };
    Long2.prototype.gt = function(other) {
      return this.greaterThan(other);
    };
    Long2.prototype.greaterThanOrEqual = function(other) {
      return this.comp(other) >= 0;
    };
    Long2.prototype.gte = function(other) {
      return this.greaterThanOrEqual(other);
    };
    Long2.prototype.ge = function(other) {
      return this.greaterThanOrEqual(other);
    };
    Long2.prototype.isEven = function() {
      return (this.low & 1) === 0;
    };
    Long2.prototype.isNegative = function() {
      return !this.unsigned && this.high < 0;
    };
    Long2.prototype.isOdd = function() {
      return (this.low & 1) === 1;
    };
    Long2.prototype.isPositive = function() {
      return this.unsigned || this.high >= 0;
    };
    Long2.prototype.isZero = function() {
      return this.high === 0 && this.low === 0;
    };
    Long2.prototype.lessThan = function(other) {
      return this.comp(other) < 0;
    };
    Long2.prototype.lt = function(other) {
      return this.lessThan(other);
    };
    Long2.prototype.lessThanOrEqual = function(other) {
      return this.comp(other) <= 0;
    };
    Long2.prototype.lte = function(other) {
      return this.lessThanOrEqual(other);
    };
    Long2.prototype.modulo = function(divisor) {
      if (!Long2.isLong(divisor))
        divisor = Long2.fromValue(divisor);
      if (wasm) {
        var low = (this.unsigned ? wasm.rem_u : wasm.rem_s)(this.low, this.high, divisor.low, divisor.high);
        return Long2.fromBits(low, wasm.get_high(), this.unsigned);
      }
      return this.sub(this.div(divisor).mul(divisor));
    };
    Long2.prototype.mod = function(divisor) {
      return this.modulo(divisor);
    };
    Long2.prototype.rem = function(divisor) {
      return this.modulo(divisor);
    };
    Long2.prototype.multiply = function(multiplier) {
      if (this.isZero())
        return Long2.ZERO;
      if (!Long2.isLong(multiplier))
        multiplier = Long2.fromValue(multiplier);
      if (wasm) {
        var low = wasm.mul(this.low, this.high, multiplier.low, multiplier.high);
        return Long2.fromBits(low, wasm.get_high(), this.unsigned);
      }
      if (multiplier.isZero())
        return Long2.ZERO;
      if (this.eq(Long2.MIN_VALUE))
        return multiplier.isOdd() ? Long2.MIN_VALUE : Long2.ZERO;
      if (multiplier.eq(Long2.MIN_VALUE))
        return this.isOdd() ? Long2.MIN_VALUE : Long2.ZERO;
      if (this.isNegative()) {
        if (multiplier.isNegative())
          return this.neg().mul(multiplier.neg());
        else
          return this.neg().mul(multiplier).neg();
      } else if (multiplier.isNegative())
        return this.mul(multiplier.neg()).neg();
      if (this.lt(Long2.TWO_PWR_24) && multiplier.lt(Long2.TWO_PWR_24))
        return Long2.fromNumber(this.toNumber() * multiplier.toNumber(), this.unsigned);
      var a48 = this.high >>> 16;
      var a32 = this.high & 65535;
      var a16 = this.low >>> 16;
      var a00 = this.low & 65535;
      var b48 = multiplier.high >>> 16;
      var b32 = multiplier.high & 65535;
      var b16 = multiplier.low >>> 16;
      var b00 = multiplier.low & 65535;
      var c48 = 0, c32 = 0, c16 = 0, c00 = 0;
      c00 += a00 * b00;
      c16 += c00 >>> 16;
      c00 &= 65535;
      c16 += a16 * b00;
      c32 += c16 >>> 16;
      c16 &= 65535;
      c16 += a00 * b16;
      c32 += c16 >>> 16;
      c16 &= 65535;
      c32 += a32 * b00;
      c48 += c32 >>> 16;
      c32 &= 65535;
      c32 += a16 * b16;
      c48 += c32 >>> 16;
      c32 &= 65535;
      c32 += a00 * b32;
      c48 += c32 >>> 16;
      c32 &= 65535;
      c48 += a48 * b00 + a32 * b16 + a16 * b32 + a00 * b48;
      c48 &= 65535;
      return Long2.fromBits(c16 << 16 | c00, c48 << 16 | c32, this.unsigned);
    };
    Long2.prototype.mul = function(multiplier) {
      return this.multiply(multiplier);
    };
    Long2.prototype.negate = function() {
      if (!this.unsigned && this.eq(Long2.MIN_VALUE))
        return Long2.MIN_VALUE;
      return this.not().add(Long2.ONE);
    };
    Long2.prototype.neg = function() {
      return this.negate();
    };
    Long2.prototype.not = function() {
      return Long2.fromBits(~this.low, ~this.high, this.unsigned);
    };
    Long2.prototype.notEquals = function(other) {
      return !this.equals(other);
    };
    Long2.prototype.neq = function(other) {
      return this.notEquals(other);
    };
    Long2.prototype.ne = function(other) {
      return this.notEquals(other);
    };
    Long2.prototype.or = function(other) {
      if (!Long2.isLong(other))
        other = Long2.fromValue(other);
      return Long2.fromBits(this.low | other.low, this.high | other.high, this.unsigned);
    };
    Long2.prototype.shiftLeft = function(numBits) {
      if (Long2.isLong(numBits))
        numBits = numBits.toInt();
      if ((numBits &= 63) === 0)
        return this;
      else if (numBits < 32)
        return Long2.fromBits(this.low << numBits, this.high << numBits | this.low >>> 32 - numBits, this.unsigned);
      else
        return Long2.fromBits(0, this.low << numBits - 32, this.unsigned);
    };
    Long2.prototype.shl = function(numBits) {
      return this.shiftLeft(numBits);
    };
    Long2.prototype.shiftRight = function(numBits) {
      if (Long2.isLong(numBits))
        numBits = numBits.toInt();
      if ((numBits &= 63) === 0)
        return this;
      else if (numBits < 32)
        return Long2.fromBits(this.low >>> numBits | this.high << 32 - numBits, this.high >> numBits, this.unsigned);
      else
        return Long2.fromBits(this.high >> numBits - 32, this.high >= 0 ? 0 : -1, this.unsigned);
    };
    Long2.prototype.shr = function(numBits) {
      return this.shiftRight(numBits);
    };
    Long2.prototype.shiftRightUnsigned = function(numBits) {
      if (Long2.isLong(numBits))
        numBits = numBits.toInt();
      numBits &= 63;
      if (numBits === 0)
        return this;
      else {
        var high = this.high;
        if (numBits < 32) {
          var low = this.low;
          return Long2.fromBits(low >>> numBits | high << 32 - numBits, high >>> numBits, this.unsigned);
        } else if (numBits === 32)
          return Long2.fromBits(high, 0, this.unsigned);
        else
          return Long2.fromBits(high >>> numBits - 32, 0, this.unsigned);
      }
    };
    Long2.prototype.shr_u = function(numBits) {
      return this.shiftRightUnsigned(numBits);
    };
    Long2.prototype.shru = function(numBits) {
      return this.shiftRightUnsigned(numBits);
    };
    Long2.prototype.subtract = function(subtrahend) {
      if (!Long2.isLong(subtrahend))
        subtrahend = Long2.fromValue(subtrahend);
      return this.add(subtrahend.neg());
    };
    Long2.prototype.sub = function(subtrahend) {
      return this.subtract(subtrahend);
    };
    Long2.prototype.toInt = function() {
      return this.unsigned ? this.low >>> 0 : this.low;
    };
    Long2.prototype.toNumber = function() {
      if (this.unsigned)
        return (this.high >>> 0) * TWO_PWR_32_DBL + (this.low >>> 0);
      return this.high * TWO_PWR_32_DBL + (this.low >>> 0);
    };
    Long2.prototype.toBigInt = function() {
      return BigInt(this.toString());
    };
    Long2.prototype.toBytes = function(le2) {
      return le2 ? this.toBytesLE() : this.toBytesBE();
    };
    Long2.prototype.toBytesLE = function() {
      var hi = this.high, lo = this.low;
      return [
        lo & 255,
        lo >>> 8 & 255,
        lo >>> 16 & 255,
        lo >>> 24,
        hi & 255,
        hi >>> 8 & 255,
        hi >>> 16 & 255,
        hi >>> 24
      ];
    };
    Long2.prototype.toBytesBE = function() {
      var hi = this.high, lo = this.low;
      return [
        hi >>> 24,
        hi >>> 16 & 255,
        hi >>> 8 & 255,
        hi & 255,
        lo >>> 24,
        lo >>> 16 & 255,
        lo >>> 8 & 255,
        lo & 255
      ];
    };
    Long2.prototype.toSigned = function() {
      if (!this.unsigned)
        return this;
      return Long2.fromBits(this.low, this.high, false);
    };
    Long2.prototype.toString = function(radix) {
      radix = radix || 10;
      if (radix < 2 || 36 < radix)
        throw RangeError("radix");
      if (this.isZero())
        return "0";
      if (this.isNegative()) {
        if (this.eq(Long2.MIN_VALUE)) {
          var radixLong = Long2.fromNumber(radix), div = this.div(radixLong), rem1 = div.mul(radixLong).sub(this);
          return div.toString(radix) + rem1.toInt().toString(radix);
        } else
          return "-" + this.neg().toString(radix);
      }
      var radixToPower = Long2.fromNumber(Math.pow(radix, 6), this.unsigned);
      var rem = this;
      var result = "";
      while (true) {
        var remDiv = rem.div(radixToPower);
        var intval = rem.sub(remDiv.mul(radixToPower)).toInt() >>> 0;
        var digits = intval.toString(radix);
        rem = remDiv;
        if (rem.isZero()) {
          return digits + result;
        } else {
          while (digits.length < 6)
            digits = "0" + digits;
          result = "" + digits + result;
        }
      }
    };
    Long2.prototype.toUnsigned = function() {
      if (this.unsigned)
        return this;
      return Long2.fromBits(this.low, this.high, true);
    };
    Long2.prototype.xor = function(other) {
      if (!Long2.isLong(other))
        other = Long2.fromValue(other);
      return Long2.fromBits(this.low ^ other.low, this.high ^ other.high, this.unsigned);
    };
    Long2.prototype.eqz = function() {
      return this.isZero();
    };
    Long2.prototype.le = function(other) {
      return this.lessThanOrEqual(other);
    };
    Long2.prototype.toExtendedJSON = function(options) {
      if (options && options.relaxed)
        return this.toNumber();
      return { $numberLong: this.toString() };
    };
    Long2.fromExtendedJSON = function(doc, options) {
      var result = Long2.fromString(doc.$numberLong);
      return options && options.relaxed ? result.toNumber() : result;
    };
    Long2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    Long2.prototype.inspect = function() {
      return 'new Long("'.concat(this.toString(), '"').concat(this.unsigned ? ", true" : "", ")");
    };
    Long2.TWO_PWR_24 = Long2.fromInt(TWO_PWR_24_DBL);
    Long2.MAX_UNSIGNED_VALUE = Long2.fromBits(4294967295 | 0, 4294967295 | 0, true);
    Long2.ZERO = Long2.fromInt(0);
    Long2.UZERO = Long2.fromInt(0, true);
    Long2.ONE = Long2.fromInt(1);
    Long2.UONE = Long2.fromInt(1, true);
    Long2.NEG_ONE = Long2.fromInt(-1);
    Long2.MAX_VALUE = Long2.fromBits(4294967295 | 0, 2147483647 | 0, false);
    Long2.MIN_VALUE = Long2.fromBits(0, 2147483648 | 0, false);
    return Long2;
  }()
);
Object.defineProperty(Long.prototype, "__isLong__", { value: true });
Object.defineProperty(Long.prototype, "_bsontype", { value: "Long" });
var PARSE_STRING_REGEXP = /^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/;
var PARSE_INF_REGEXP = /^(\+|-)?(Infinity|inf)$/i;
var PARSE_NAN_REGEXP = /^(\+|-)?NaN$/i;
var EXPONENT_MAX = 6111;
var EXPONENT_MIN = -6176;
var EXPONENT_BIAS = 6176;
var MAX_DIGITS = 34;
var NAN_BUFFER = [
  124,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
].reverse();
var INF_NEGATIVE_BUFFER = [
  248,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
].reverse();
var INF_POSITIVE_BUFFER = [
  120,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
].reverse();
var EXPONENT_REGEX = /^([-+])?(\d+)?$/;
var COMBINATION_MASK = 31;
var EXPONENT_MASK = 16383;
var COMBINATION_INFINITY = 30;
var COMBINATION_NAN = 31;
function isDigit(value) {
  return !isNaN(parseInt(value, 10));
}
function divideu128(value) {
  var DIVISOR = Long.fromNumber(1e3 * 1e3 * 1e3);
  var _rem = Long.fromNumber(0);
  if (!value.parts[0] && !value.parts[1] && !value.parts[2] && !value.parts[3]) {
    return { quotient: value, rem: _rem };
  }
  for (var i2 = 0; i2 <= 3; i2++) {
    _rem = _rem.shiftLeft(32);
    _rem = _rem.add(new Long(value.parts[i2], 0));
    value.parts[i2] = _rem.div(DIVISOR).low;
    _rem = _rem.modulo(DIVISOR);
  }
  return { quotient: value, rem: _rem };
}
function multiply64x2(left, right) {
  if (!left && !right) {
    return { high: Long.fromNumber(0), low: Long.fromNumber(0) };
  }
  var leftHigh = left.shiftRightUnsigned(32);
  var leftLow = new Long(left.getLowBits(), 0);
  var rightHigh = right.shiftRightUnsigned(32);
  var rightLow = new Long(right.getLowBits(), 0);
  var productHigh = leftHigh.multiply(rightHigh);
  var productMid = leftHigh.multiply(rightLow);
  var productMid2 = leftLow.multiply(rightHigh);
  var productLow = leftLow.multiply(rightLow);
  productHigh = productHigh.add(productMid.shiftRightUnsigned(32));
  productMid = new Long(productMid.getLowBits(), 0).add(productMid2).add(productLow.shiftRightUnsigned(32));
  productHigh = productHigh.add(productMid.shiftRightUnsigned(32));
  productLow = productMid.shiftLeft(32).add(new Long(productLow.getLowBits(), 0));
  return { high: productHigh, low: productLow };
}
function lessThan(left, right) {
  var uhleft = left.high >>> 0;
  var uhright = right.high >>> 0;
  if (uhleft < uhright) {
    return true;
  } else if (uhleft === uhright) {
    var ulleft = left.low >>> 0;
    var ulright = right.low >>> 0;
    if (ulleft < ulright)
      return true;
  }
  return false;
}
function invalidErr(string, message) {
  throw new BSONTypeError('"'.concat(string, '" is not a valid Decimal128 string - ').concat(message));
}
var Decimal128 = (
  /** @class */
  function() {
    function Decimal1282(bytes) {
      if (!(this instanceof Decimal1282))
        return new Decimal1282(bytes);
      if (typeof bytes === "string") {
        this.bytes = Decimal1282.fromString(bytes).bytes;
      } else if (isUint8Array(bytes)) {
        if (bytes.byteLength !== 16) {
          throw new BSONTypeError("Decimal128 must take a Buffer of 16 bytes");
        }
        this.bytes = bytes;
      } else {
        throw new BSONTypeError("Decimal128 must take a Buffer or string");
      }
    }
    Decimal1282.fromString = function(representation) {
      var isNegative = false;
      var sawRadix = false;
      var foundNonZero = false;
      var significantDigits = 0;
      var nDigitsRead = 0;
      var nDigits = 0;
      var radixPosition = 0;
      var firstNonZero = 0;
      var digits = [0];
      var nDigitsStored = 0;
      var digitsInsert = 0;
      var firstDigit = 0;
      var lastDigit = 0;
      var exponent = 0;
      var i2 = 0;
      var significandHigh = new Long(0, 0);
      var significandLow = new Long(0, 0);
      var biasedExponent = 0;
      var index = 0;
      if (representation.length >= 7e3) {
        throw new BSONTypeError("" + representation + " not a valid Decimal128 string");
      }
      var stringMatch = representation.match(PARSE_STRING_REGEXP);
      var infMatch = representation.match(PARSE_INF_REGEXP);
      var nanMatch = representation.match(PARSE_NAN_REGEXP);
      if (!stringMatch && !infMatch && !nanMatch || representation.length === 0) {
        throw new BSONTypeError("" + representation + " not a valid Decimal128 string");
      }
      if (stringMatch) {
        var unsignedNumber = stringMatch[2];
        var e3 = stringMatch[4];
        var expSign = stringMatch[5];
        var expNumber = stringMatch[6];
        if (e3 && expNumber === void 0)
          invalidErr(representation, "missing exponent power");
        if (e3 && unsignedNumber === void 0)
          invalidErr(representation, "missing exponent base");
        if (e3 === void 0 && (expSign || expNumber)) {
          invalidErr(representation, "missing e before exponent");
        }
      }
      if (representation[index] === "+" || representation[index] === "-") {
        isNegative = representation[index++] === "-";
      }
      if (!isDigit(representation[index]) && representation[index] !== ".") {
        if (representation[index] === "i" || representation[index] === "I") {
          return new Decimal1282(buffer_1.from(isNegative ? INF_NEGATIVE_BUFFER : INF_POSITIVE_BUFFER));
        } else if (representation[index] === "N") {
          return new Decimal1282(buffer_1.from(NAN_BUFFER));
        }
      }
      while (isDigit(representation[index]) || representation[index] === ".") {
        if (representation[index] === ".") {
          if (sawRadix)
            invalidErr(representation, "contains multiple periods");
          sawRadix = true;
          index = index + 1;
          continue;
        }
        if (nDigitsStored < 34) {
          if (representation[index] !== "0" || foundNonZero) {
            if (!foundNonZero) {
              firstNonZero = nDigitsRead;
            }
            foundNonZero = true;
            digits[digitsInsert++] = parseInt(representation[index], 10);
            nDigitsStored = nDigitsStored + 1;
          }
        }
        if (foundNonZero)
          nDigits = nDigits + 1;
        if (sawRadix)
          radixPosition = radixPosition + 1;
        nDigitsRead = nDigitsRead + 1;
        index = index + 1;
      }
      if (sawRadix && !nDigitsRead)
        throw new BSONTypeError("" + representation + " not a valid Decimal128 string");
      if (representation[index] === "e" || representation[index] === "E") {
        var match2 = representation.substr(++index).match(EXPONENT_REGEX);
        if (!match2 || !match2[2])
          return new Decimal1282(buffer_1.from(NAN_BUFFER));
        exponent = parseInt(match2[0], 10);
        index = index + match2[0].length;
      }
      if (representation[index])
        return new Decimal1282(buffer_1.from(NAN_BUFFER));
      firstDigit = 0;
      if (!nDigitsStored) {
        firstDigit = 0;
        lastDigit = 0;
        digits[0] = 0;
        nDigits = 1;
        nDigitsStored = 1;
        significantDigits = 0;
      } else {
        lastDigit = nDigitsStored - 1;
        significantDigits = nDigits;
        if (significantDigits !== 1) {
          while (digits[firstNonZero + significantDigits - 1] === 0) {
            significantDigits = significantDigits - 1;
          }
        }
      }
      if (exponent <= radixPosition && radixPosition - exponent > 1 << 14) {
        exponent = EXPONENT_MIN;
      } else {
        exponent = exponent - radixPosition;
      }
      while (exponent > EXPONENT_MAX) {
        lastDigit = lastDigit + 1;
        if (lastDigit - firstDigit > MAX_DIGITS) {
          var digitsString = digits.join("");
          if (digitsString.match(/^0+$/)) {
            exponent = EXPONENT_MAX;
            break;
          }
          invalidErr(representation, "overflow");
        }
        exponent = exponent - 1;
      }
      while (exponent < EXPONENT_MIN || nDigitsStored < nDigits) {
        if (lastDigit === 0 && significantDigits < nDigitsStored) {
          exponent = EXPONENT_MIN;
          significantDigits = 0;
          break;
        }
        if (nDigitsStored < nDigits) {
          nDigits = nDigits - 1;
        } else {
          lastDigit = lastDigit - 1;
        }
        if (exponent < EXPONENT_MAX) {
          exponent = exponent + 1;
        } else {
          var digitsString = digits.join("");
          if (digitsString.match(/^0+$/)) {
            exponent = EXPONENT_MAX;
            break;
          }
          invalidErr(representation, "overflow");
        }
      }
      if (lastDigit - firstDigit + 1 < significantDigits) {
        var endOfString = nDigitsRead;
        if (sawRadix) {
          firstNonZero = firstNonZero + 1;
          endOfString = endOfString + 1;
        }
        if (isNegative) {
          firstNonZero = firstNonZero + 1;
          endOfString = endOfString + 1;
        }
        var roundDigit = parseInt(representation[firstNonZero + lastDigit + 1], 10);
        var roundBit = 0;
        if (roundDigit >= 5) {
          roundBit = 1;
          if (roundDigit === 5) {
            roundBit = digits[lastDigit] % 2 === 1 ? 1 : 0;
            for (i2 = firstNonZero + lastDigit + 2; i2 < endOfString; i2++) {
              if (parseInt(representation[i2], 10)) {
                roundBit = 1;
                break;
              }
            }
          }
        }
        if (roundBit) {
          var dIdx = lastDigit;
          for (; dIdx >= 0; dIdx--) {
            if (++digits[dIdx] > 9) {
              digits[dIdx] = 0;
              if (dIdx === 0) {
                if (exponent < EXPONENT_MAX) {
                  exponent = exponent + 1;
                  digits[dIdx] = 1;
                } else {
                  return new Decimal1282(buffer_1.from(isNegative ? INF_NEGATIVE_BUFFER : INF_POSITIVE_BUFFER));
                }
              }
            }
          }
        }
      }
      significandHigh = Long.fromNumber(0);
      significandLow = Long.fromNumber(0);
      if (significantDigits === 0) {
        significandHigh = Long.fromNumber(0);
        significandLow = Long.fromNumber(0);
      } else if (lastDigit - firstDigit < 17) {
        var dIdx = firstDigit;
        significandLow = Long.fromNumber(digits[dIdx++]);
        significandHigh = new Long(0, 0);
        for (; dIdx <= lastDigit; dIdx++) {
          significandLow = significandLow.multiply(Long.fromNumber(10));
          significandLow = significandLow.add(Long.fromNumber(digits[dIdx]));
        }
      } else {
        var dIdx = firstDigit;
        significandHigh = Long.fromNumber(digits[dIdx++]);
        for (; dIdx <= lastDigit - 17; dIdx++) {
          significandHigh = significandHigh.multiply(Long.fromNumber(10));
          significandHigh = significandHigh.add(Long.fromNumber(digits[dIdx]));
        }
        significandLow = Long.fromNumber(digits[dIdx++]);
        for (; dIdx <= lastDigit; dIdx++) {
          significandLow = significandLow.multiply(Long.fromNumber(10));
          significandLow = significandLow.add(Long.fromNumber(digits[dIdx]));
        }
      }
      var significand = multiply64x2(significandHigh, Long.fromString("100000000000000000"));
      significand.low = significand.low.add(significandLow);
      if (lessThan(significand.low, significandLow)) {
        significand.high = significand.high.add(Long.fromNumber(1));
      }
      biasedExponent = exponent + EXPONENT_BIAS;
      var dec = { low: Long.fromNumber(0), high: Long.fromNumber(0) };
      if (significand.high.shiftRightUnsigned(49).and(Long.fromNumber(1)).equals(Long.fromNumber(1))) {
        dec.high = dec.high.or(Long.fromNumber(3).shiftLeft(61));
        dec.high = dec.high.or(Long.fromNumber(biasedExponent).and(Long.fromNumber(16383).shiftLeft(47)));
        dec.high = dec.high.or(significand.high.and(Long.fromNumber(140737488355327)));
      } else {
        dec.high = dec.high.or(Long.fromNumber(biasedExponent & 16383).shiftLeft(49));
        dec.high = dec.high.or(significand.high.and(Long.fromNumber(562949953421311)));
      }
      dec.low = significand.low;
      if (isNegative) {
        dec.high = dec.high.or(Long.fromString("9223372036854775808"));
      }
      var buffer2 = buffer_1.alloc(16);
      index = 0;
      buffer2[index++] = dec.low.low & 255;
      buffer2[index++] = dec.low.low >> 8 & 255;
      buffer2[index++] = dec.low.low >> 16 & 255;
      buffer2[index++] = dec.low.low >> 24 & 255;
      buffer2[index++] = dec.low.high & 255;
      buffer2[index++] = dec.low.high >> 8 & 255;
      buffer2[index++] = dec.low.high >> 16 & 255;
      buffer2[index++] = dec.low.high >> 24 & 255;
      buffer2[index++] = dec.high.low & 255;
      buffer2[index++] = dec.high.low >> 8 & 255;
      buffer2[index++] = dec.high.low >> 16 & 255;
      buffer2[index++] = dec.high.low >> 24 & 255;
      buffer2[index++] = dec.high.high & 255;
      buffer2[index++] = dec.high.high >> 8 & 255;
      buffer2[index++] = dec.high.high >> 16 & 255;
      buffer2[index++] = dec.high.high >> 24 & 255;
      return new Decimal1282(buffer2);
    };
    Decimal1282.prototype.toString = function() {
      var biased_exponent;
      var significand_digits = 0;
      var significand = new Array(36);
      for (var i2 = 0; i2 < significand.length; i2++)
        significand[i2] = 0;
      var index = 0;
      var is_zero = false;
      var significand_msb;
      var significand128 = { parts: [0, 0, 0, 0] };
      var j2, k2;
      var string = [];
      index = 0;
      var buffer2 = this.bytes;
      var low = buffer2[index++] | buffer2[index++] << 8 | buffer2[index++] << 16 | buffer2[index++] << 24;
      var midl = buffer2[index++] | buffer2[index++] << 8 | buffer2[index++] << 16 | buffer2[index++] << 24;
      var midh = buffer2[index++] | buffer2[index++] << 8 | buffer2[index++] << 16 | buffer2[index++] << 24;
      var high = buffer2[index++] | buffer2[index++] << 8 | buffer2[index++] << 16 | buffer2[index++] << 24;
      index = 0;
      var dec = {
        low: new Long(low, midl),
        high: new Long(midh, high)
      };
      if (dec.high.lessThan(Long.ZERO)) {
        string.push("-");
      }
      var combination = high >> 26 & COMBINATION_MASK;
      if (combination >> 3 === 3) {
        if (combination === COMBINATION_INFINITY) {
          return string.join("") + "Infinity";
        } else if (combination === COMBINATION_NAN) {
          return "NaN";
        } else {
          biased_exponent = high >> 15 & EXPONENT_MASK;
          significand_msb = 8 + (high >> 14 & 1);
        }
      } else {
        significand_msb = high >> 14 & 7;
        biased_exponent = high >> 17 & EXPONENT_MASK;
      }
      var exponent = biased_exponent - EXPONENT_BIAS;
      significand128.parts[0] = (high & 16383) + ((significand_msb & 15) << 14);
      significand128.parts[1] = midh;
      significand128.parts[2] = midl;
      significand128.parts[3] = low;
      if (significand128.parts[0] === 0 && significand128.parts[1] === 0 && significand128.parts[2] === 0 && significand128.parts[3] === 0) {
        is_zero = true;
      } else {
        for (k2 = 3; k2 >= 0; k2--) {
          var least_digits = 0;
          var result = divideu128(significand128);
          significand128 = result.quotient;
          least_digits = result.rem.low;
          if (!least_digits)
            continue;
          for (j2 = 8; j2 >= 0; j2--) {
            significand[k2 * 9 + j2] = least_digits % 10;
            least_digits = Math.floor(least_digits / 10);
          }
        }
      }
      if (is_zero) {
        significand_digits = 1;
        significand[index] = 0;
      } else {
        significand_digits = 36;
        while (!significand[index]) {
          significand_digits = significand_digits - 1;
          index = index + 1;
        }
      }
      var scientific_exponent = significand_digits - 1 + exponent;
      if (scientific_exponent >= 34 || scientific_exponent <= -7 || exponent > 0) {
        if (significand_digits > 34) {
          string.push("".concat(0));
          if (exponent > 0)
            string.push("E+".concat(exponent));
          else if (exponent < 0)
            string.push("E".concat(exponent));
          return string.join("");
        }
        string.push("".concat(significand[index++]));
        significand_digits = significand_digits - 1;
        if (significand_digits) {
          string.push(".");
        }
        for (var i2 = 0; i2 < significand_digits; i2++) {
          string.push("".concat(significand[index++]));
        }
        string.push("E");
        if (scientific_exponent > 0) {
          string.push("+".concat(scientific_exponent));
        } else {
          string.push("".concat(scientific_exponent));
        }
      } else {
        if (exponent >= 0) {
          for (var i2 = 0; i2 < significand_digits; i2++) {
            string.push("".concat(significand[index++]));
          }
        } else {
          var radix_position = significand_digits + exponent;
          if (radix_position > 0) {
            for (var i2 = 0; i2 < radix_position; i2++) {
              string.push("".concat(significand[index++]));
            }
          } else {
            string.push("0");
          }
          string.push(".");
          while (radix_position++ < 0) {
            string.push("0");
          }
          for (var i2 = 0; i2 < significand_digits - Math.max(radix_position - 1, 0); i2++) {
            string.push("".concat(significand[index++]));
          }
        }
      }
      return string.join("");
    };
    Decimal1282.prototype.toJSON = function() {
      return { $numberDecimal: this.toString() };
    };
    Decimal1282.prototype.toExtendedJSON = function() {
      return { $numberDecimal: this.toString() };
    };
    Decimal1282.fromExtendedJSON = function(doc) {
      return Decimal1282.fromString(doc.$numberDecimal);
    };
    Decimal1282.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    Decimal1282.prototype.inspect = function() {
      return 'new Decimal128("'.concat(this.toString(), '")');
    };
    return Decimal1282;
  }()
);
Object.defineProperty(Decimal128.prototype, "_bsontype", { value: "Decimal128" });
var Double = (
  /** @class */
  function() {
    function Double2(value) {
      if (!(this instanceof Double2))
        return new Double2(value);
      if (value instanceof Number) {
        value = value.valueOf();
      }
      this.value = +value;
    }
    Double2.prototype.valueOf = function() {
      return this.value;
    };
    Double2.prototype.toJSON = function() {
      return this.value;
    };
    Double2.prototype.toString = function(radix) {
      return this.value.toString(radix);
    };
    Double2.prototype.toExtendedJSON = function(options) {
      if (options && (options.legacy || options.relaxed && isFinite(this.value))) {
        return this.value;
      }
      if (Object.is(Math.sign(this.value), -0)) {
        return { $numberDouble: "-".concat(this.value.toFixed(1)) };
      }
      return {
        $numberDouble: Number.isInteger(this.value) ? this.value.toFixed(1) : this.value.toString()
      };
    };
    Double2.fromExtendedJSON = function(doc, options) {
      var doubleValue = parseFloat(doc.$numberDouble);
      return options && options.relaxed ? doubleValue : new Double2(doubleValue);
    };
    Double2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    Double2.prototype.inspect = function() {
      var eJSON = this.toExtendedJSON();
      return "new Double(".concat(eJSON.$numberDouble, ")");
    };
    return Double2;
  }()
);
Object.defineProperty(Double.prototype, "_bsontype", { value: "Double" });
var Int32 = (
  /** @class */
  function() {
    function Int322(value) {
      if (!(this instanceof Int322))
        return new Int322(value);
      if (value instanceof Number) {
        value = value.valueOf();
      }
      this.value = +value | 0;
    }
    Int322.prototype.valueOf = function() {
      return this.value;
    };
    Int322.prototype.toString = function(radix) {
      return this.value.toString(radix);
    };
    Int322.prototype.toJSON = function() {
      return this.value;
    };
    Int322.prototype.toExtendedJSON = function(options) {
      if (options && (options.relaxed || options.legacy))
        return this.value;
      return { $numberInt: this.value.toString() };
    };
    Int322.fromExtendedJSON = function(doc, options) {
      return options && options.relaxed ? parseInt(doc.$numberInt, 10) : new Int322(doc.$numberInt);
    };
    Int322.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    Int322.prototype.inspect = function() {
      return "new Int32(".concat(this.valueOf(), ")");
    };
    return Int322;
  }()
);
Object.defineProperty(Int32.prototype, "_bsontype", { value: "Int32" });
var MaxKey = (
  /** @class */
  function() {
    function MaxKey2() {
      if (!(this instanceof MaxKey2))
        return new MaxKey2();
    }
    MaxKey2.prototype.toExtendedJSON = function() {
      return { $maxKey: 1 };
    };
    MaxKey2.fromExtendedJSON = function() {
      return new MaxKey2();
    };
    MaxKey2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    MaxKey2.prototype.inspect = function() {
      return "new MaxKey()";
    };
    return MaxKey2;
  }()
);
Object.defineProperty(MaxKey.prototype, "_bsontype", { value: "MaxKey" });
var MinKey = (
  /** @class */
  function() {
    function MinKey2() {
      if (!(this instanceof MinKey2))
        return new MinKey2();
    }
    MinKey2.prototype.toExtendedJSON = function() {
      return { $minKey: 1 };
    };
    MinKey2.fromExtendedJSON = function() {
      return new MinKey2();
    };
    MinKey2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    MinKey2.prototype.inspect = function() {
      return "new MinKey()";
    };
    return MinKey2;
  }()
);
Object.defineProperty(MinKey.prototype, "_bsontype", { value: "MinKey" });
var checkForHexRegExp = new RegExp("^[0-9a-fA-F]{24}$");
var PROCESS_UNIQUE = null;
var kId = Symbol("id");
var ObjectId = (
  /** @class */
  function() {
    function ObjectId2(inputId) {
      if (!(this instanceof ObjectId2))
        return new ObjectId2(inputId);
      var workingId;
      if (typeof inputId === "object" && inputId && "id" in inputId) {
        if (typeof inputId.id !== "string" && !ArrayBuffer.isView(inputId.id)) {
          throw new BSONTypeError("Argument passed in must have an id that is of type string or Buffer");
        }
        if ("toHexString" in inputId && typeof inputId.toHexString === "function") {
          workingId = buffer_1.from(inputId.toHexString(), "hex");
        } else {
          workingId = inputId.id;
        }
      } else {
        workingId = inputId;
      }
      if (workingId == null || typeof workingId === "number") {
        this[kId] = ObjectId2.generate(typeof workingId === "number" ? workingId : void 0);
      } else if (ArrayBuffer.isView(workingId) && workingId.byteLength === 12) {
        this[kId] = workingId instanceof buffer_1 ? workingId : ensureBuffer(workingId);
      } else if (typeof workingId === "string") {
        if (workingId.length === 12) {
          var bytes = buffer_1.from(workingId);
          if (bytes.byteLength === 12) {
            this[kId] = bytes;
          } else {
            throw new BSONTypeError("Argument passed in must be a string of 12 bytes");
          }
        } else if (workingId.length === 24 && checkForHexRegExp.test(workingId)) {
          this[kId] = buffer_1.from(workingId, "hex");
        } else {
          throw new BSONTypeError("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");
        }
      } else {
        throw new BSONTypeError("Argument passed in does not match the accepted types");
      }
      if (ObjectId2.cacheHexString) {
        this.__id = this.id.toString("hex");
      }
    }
    Object.defineProperty(ObjectId2.prototype, "id", {
      /**
       * The ObjectId bytes
       * @readonly
       */
      get: function() {
        return this[kId];
      },
      set: function(value) {
        this[kId] = value;
        if (ObjectId2.cacheHexString) {
          this.__id = value.toString("hex");
        }
      },
      enumerable: false,
      configurable: true
    });
    Object.defineProperty(ObjectId2.prototype, "generationTime", {
      /**
       * The generation time of this ObjectId instance
       * @deprecated Please use getTimestamp / createFromTime which returns an int32 epoch
       */
      get: function() {
        return this.id.readInt32BE(0);
      },
      set: function(value) {
        this.id.writeUInt32BE(value, 0);
      },
      enumerable: false,
      configurable: true
    });
    ObjectId2.prototype.toHexString = function() {
      if (ObjectId2.cacheHexString && this.__id) {
        return this.__id;
      }
      var hexString = this.id.toString("hex");
      if (ObjectId2.cacheHexString && !this.__id) {
        this.__id = hexString;
      }
      return hexString;
    };
    ObjectId2.getInc = function() {
      return ObjectId2.index = (ObjectId2.index + 1) % 16777215;
    };
    ObjectId2.generate = function(time) {
      if ("number" !== typeof time) {
        time = Math.floor(Date.now() / 1e3);
      }
      var inc = ObjectId2.getInc();
      var buffer2 = buffer_1.alloc(12);
      buffer2.writeUInt32BE(time, 0);
      if (PROCESS_UNIQUE === null) {
        PROCESS_UNIQUE = randomBytes(5);
      }
      buffer2[4] = PROCESS_UNIQUE[0];
      buffer2[5] = PROCESS_UNIQUE[1];
      buffer2[6] = PROCESS_UNIQUE[2];
      buffer2[7] = PROCESS_UNIQUE[3];
      buffer2[8] = PROCESS_UNIQUE[4];
      buffer2[11] = inc & 255;
      buffer2[10] = inc >> 8 & 255;
      buffer2[9] = inc >> 16 & 255;
      return buffer2;
    };
    ObjectId2.prototype.toString = function(format) {
      if (format)
        return this.id.toString(format);
      return this.toHexString();
    };
    ObjectId2.prototype.toJSON = function() {
      return this.toHexString();
    };
    ObjectId2.prototype.equals = function(otherId) {
      if (otherId === void 0 || otherId === null) {
        return false;
      }
      if (otherId instanceof ObjectId2) {
        return this[kId][11] === otherId[kId][11] && this[kId].equals(otherId[kId]);
      }
      if (typeof otherId === "string" && ObjectId2.isValid(otherId) && otherId.length === 12 && isUint8Array(this.id)) {
        return otherId === buffer_1.prototype.toString.call(this.id, "latin1");
      }
      if (typeof otherId === "string" && ObjectId2.isValid(otherId) && otherId.length === 24) {
        return otherId.toLowerCase() === this.toHexString();
      }
      if (typeof otherId === "string" && ObjectId2.isValid(otherId) && otherId.length === 12) {
        return buffer_1.from(otherId).equals(this.id);
      }
      if (typeof otherId === "object" && "toHexString" in otherId && typeof otherId.toHexString === "function") {
        var otherIdString = otherId.toHexString();
        var thisIdString = this.toHexString().toLowerCase();
        return typeof otherIdString === "string" && otherIdString.toLowerCase() === thisIdString;
      }
      return false;
    };
    ObjectId2.prototype.getTimestamp = function() {
      var timestamp = /* @__PURE__ */ new Date();
      var time = this.id.readUInt32BE(0);
      timestamp.setTime(Math.floor(time) * 1e3);
      return timestamp;
    };
    ObjectId2.createPk = function() {
      return new ObjectId2();
    };
    ObjectId2.createFromTime = function(time) {
      var buffer2 = buffer_1.from([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
      buffer2.writeUInt32BE(time, 0);
      return new ObjectId2(buffer2);
    };
    ObjectId2.createFromHexString = function(hexString) {
      if (typeof hexString === "undefined" || hexString != null && hexString.length !== 24) {
        throw new BSONTypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");
      }
      return new ObjectId2(buffer_1.from(hexString, "hex"));
    };
    ObjectId2.isValid = function(id2) {
      if (id2 == null)
        return false;
      try {
        new ObjectId2(id2);
        return true;
      } catch (_a3) {
        return false;
      }
    };
    ObjectId2.prototype.toExtendedJSON = function() {
      if (this.toHexString)
        return { $oid: this.toHexString() };
      return { $oid: this.toString("hex") };
    };
    ObjectId2.fromExtendedJSON = function(doc) {
      return new ObjectId2(doc.$oid);
    };
    ObjectId2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    ObjectId2.prototype.inspect = function() {
      return 'new ObjectId("'.concat(this.toHexString(), '")');
    };
    ObjectId2.index = Math.floor(Math.random() * 16777215);
    return ObjectId2;
  }()
);
Object.defineProperty(ObjectId.prototype, "generate", {
  value: deprecate(function(time) {
    return ObjectId.generate(time);
  }, "Please use the static `ObjectId.generate(time)` instead")
});
Object.defineProperty(ObjectId.prototype, "getInc", {
  value: deprecate(function() {
    return ObjectId.getInc();
  }, "Please use the static `ObjectId.getInc()` instead")
});
Object.defineProperty(ObjectId.prototype, "get_inc", {
  value: deprecate(function() {
    return ObjectId.getInc();
  }, "Please use the static `ObjectId.getInc()` instead")
});
Object.defineProperty(ObjectId, "get_inc", {
  value: deprecate(function() {
    return ObjectId.getInc();
  }, "Please use the static `ObjectId.getInc()` instead")
});
Object.defineProperty(ObjectId.prototype, "_bsontype", { value: "ObjectID" });
function alphabetize(str) {
  return str.split("").sort().join("");
}
var BSONRegExp = (
  /** @class */
  function() {
    function BSONRegExp2(pattern, options) {
      if (!(this instanceof BSONRegExp2))
        return new BSONRegExp2(pattern, options);
      this.pattern = pattern;
      this.options = alphabetize(options !== null && options !== void 0 ? options : "");
      if (this.pattern.indexOf("\0") !== -1) {
        throw new BSONError("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));
      }
      if (this.options.indexOf("\0") !== -1) {
        throw new BSONError("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));
      }
      for (var i2 = 0; i2 < this.options.length; i2++) {
        if (!(this.options[i2] === "i" || this.options[i2] === "m" || this.options[i2] === "x" || this.options[i2] === "l" || this.options[i2] === "s" || this.options[i2] === "u")) {
          throw new BSONError("The regular expression option [".concat(this.options[i2], "] is not supported"));
        }
      }
    }
    BSONRegExp2.parseOptions = function(options) {
      return options ? options.split("").sort().join("") : "";
    };
    BSONRegExp2.prototype.toExtendedJSON = function(options) {
      options = options || {};
      if (options.legacy) {
        return { $regex: this.pattern, $options: this.options };
      }
      return { $regularExpression: { pattern: this.pattern, options: this.options } };
    };
    BSONRegExp2.fromExtendedJSON = function(doc) {
      if ("$regex" in doc) {
        if (typeof doc.$regex !== "string") {
          if (doc.$regex._bsontype === "BSONRegExp") {
            return doc;
          }
        } else {
          return new BSONRegExp2(doc.$regex, BSONRegExp2.parseOptions(doc.$options));
        }
      }
      if ("$regularExpression" in doc) {
        return new BSONRegExp2(doc.$regularExpression.pattern, BSONRegExp2.parseOptions(doc.$regularExpression.options));
      }
      throw new BSONTypeError("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(doc)));
    };
    return BSONRegExp2;
  }()
);
Object.defineProperty(BSONRegExp.prototype, "_bsontype", { value: "BSONRegExp" });
var BSONSymbol = (
  /** @class */
  function() {
    function BSONSymbol2(value) {
      if (!(this instanceof BSONSymbol2))
        return new BSONSymbol2(value);
      this.value = value;
    }
    BSONSymbol2.prototype.valueOf = function() {
      return this.value;
    };
    BSONSymbol2.prototype.toString = function() {
      return this.value;
    };
    BSONSymbol2.prototype.inspect = function() {
      return 'new BSONSymbol("'.concat(this.value, '")');
    };
    BSONSymbol2.prototype.toJSON = function() {
      return this.value;
    };
    BSONSymbol2.prototype.toExtendedJSON = function() {
      return { $symbol: this.value };
    };
    BSONSymbol2.fromExtendedJSON = function(doc) {
      return new BSONSymbol2(doc.$symbol);
    };
    BSONSymbol2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    return BSONSymbol2;
  }()
);
Object.defineProperty(BSONSymbol.prototype, "_bsontype", { value: "Symbol" });
var LongWithoutOverridesClass = Long;
var Timestamp = (
  /** @class */
  function(_super) {
    __extends13(Timestamp2, _super);
    function Timestamp2(low, high) {
      var _this = this;
      if (!(_this instanceof Timestamp2))
        return new Timestamp2(low, high);
      if (Long.isLong(low)) {
        _this = _super.call(this, low.low, low.high, true) || this;
      } else if (isObjectLike(low) && typeof low.t !== "undefined" && typeof low.i !== "undefined") {
        _this = _super.call(this, low.i, low.t, true) || this;
      } else {
        _this = _super.call(this, low, high, true) || this;
      }
      Object.defineProperty(_this, "_bsontype", {
        value: "Timestamp",
        writable: false,
        configurable: false,
        enumerable: false
      });
      return _this;
    }
    Timestamp2.prototype.toJSON = function() {
      return {
        $timestamp: this.toString()
      };
    };
    Timestamp2.fromInt = function(value) {
      return new Timestamp2(Long.fromInt(value, true));
    };
    Timestamp2.fromNumber = function(value) {
      return new Timestamp2(Long.fromNumber(value, true));
    };
    Timestamp2.fromBits = function(lowBits, highBits) {
      return new Timestamp2(lowBits, highBits);
    };
    Timestamp2.fromString = function(str, optRadix) {
      return new Timestamp2(Long.fromString(str, true, optRadix));
    };
    Timestamp2.prototype.toExtendedJSON = function() {
      return { $timestamp: { t: this.high >>> 0, i: this.low >>> 0 } };
    };
    Timestamp2.fromExtendedJSON = function(doc) {
      return new Timestamp2(doc.$timestamp);
    };
    Timestamp2.prototype[Symbol.for("nodejs.util.inspect.custom")] = function() {
      return this.inspect();
    };
    Timestamp2.prototype.inspect = function() {
      return "new Timestamp({ t: ".concat(this.getHighBits(), ", i: ").concat(this.getLowBits(), " })");
    };
    Timestamp2.MAX_VALUE = Long.MAX_UNSIGNED_VALUE;
    return Timestamp2;
  }(LongWithoutOverridesClass)
);
function isBSONType(value) {
  return isObjectLike(value) && Reflect.has(value, "_bsontype") && typeof value._bsontype === "string";
}
var BSON_INT32_MAX = 2147483647;
var BSON_INT32_MIN = -2147483648;
var BSON_INT64_MAX = 9223372036854776e3;
var BSON_INT64_MIN = -9223372036854776e3;
var keysToCodecs = {
  $oid: ObjectId,
  $binary: Binary,
  $uuid: Binary,
  $symbol: BSONSymbol,
  $numberInt: Int32,
  $numberDecimal: Decimal128,
  $numberDouble: Double,
  $numberLong: Long,
  $minKey: MinKey,
  $maxKey: MaxKey,
  $regex: BSONRegExp,
  $regularExpression: BSONRegExp,
  $timestamp: Timestamp
};
function deserializeValue(value, options) {
  if (options === void 0) {
    options = {};
  }
  if (typeof value === "number") {
    if (options.relaxed || options.legacy) {
      return value;
    }
    if (Math.floor(value) === value) {
      if (value >= BSON_INT32_MIN && value <= BSON_INT32_MAX)
        return new Int32(value);
      if (value >= BSON_INT64_MIN && value <= BSON_INT64_MAX)
        return Long.fromNumber(value);
    }
    return new Double(value);
  }
  if (value == null || typeof value !== "object")
    return value;
  if (value.$undefined)
    return null;
  var keys4 = Object.keys(value).filter(function(k2) {
    return k2.startsWith("$") && value[k2] != null;
  });
  for (var i2 = 0; i2 < keys4.length; i2++) {
    var c2 = keysToCodecs[keys4[i2]];
    if (c2)
      return c2.fromExtendedJSON(value, options);
  }
  if (value.$date != null) {
    var d2 = value.$date;
    var date = /* @__PURE__ */ new Date();
    if (options.legacy) {
      if (typeof d2 === "number")
        date.setTime(d2);
      else if (typeof d2 === "string")
        date.setTime(Date.parse(d2));
    } else {
      if (typeof d2 === "string")
        date.setTime(Date.parse(d2));
      else if (Long.isLong(d2))
        date.setTime(d2.toNumber());
      else if (typeof d2 === "number" && options.relaxed)
        date.setTime(d2);
    }
    return date;
  }
  if (value.$code != null) {
    var copy = Object.assign({}, value);
    if (value.$scope) {
      copy.$scope = deserializeValue(value.$scope);
    }
    return Code.fromExtendedJSON(value);
  }
  if (isDBRefLike(value) || value.$dbPointer) {
    var v2 = value.$ref ? value : value.$dbPointer;
    if (v2 instanceof DBRef)
      return v2;
    var dollarKeys = Object.keys(v2).filter(function(k2) {
      return k2.startsWith("$");
    });
    var valid_1 = true;
    dollarKeys.forEach(function(k2) {
      if (["$ref", "$id", "$db"].indexOf(k2) === -1)
        valid_1 = false;
    });
    if (valid_1)
      return DBRef.fromExtendedJSON(v2);
  }
  return value;
}
function serializeArray(array, options) {
  return array.map(function(v2, index) {
    options.seenObjects.push({ propertyName: "index ".concat(index), obj: null });
    try {
      return serializeValue(v2, options);
    } finally {
      options.seenObjects.pop();
    }
  });
}
function getISOString(date) {
  var isoStr = date.toISOString();
  return date.getUTCMilliseconds() !== 0 ? isoStr : isoStr.slice(0, -5) + "Z";
}
function serializeValue(value, options) {
  if ((typeof value === "object" || typeof value === "function") && value !== null) {
    var index = options.seenObjects.findIndex(function(entry) {
      return entry.obj === value;
    });
    if (index !== -1) {
      var props = options.seenObjects.map(function(entry) {
        return entry.propertyName;
      });
      var leadingPart = props.slice(0, index).map(function(prop) {
        return "".concat(prop, " -> ");
      }).join("");
      var alreadySeen = props[index];
      var circularPart = " -> " + props.slice(index + 1, props.length - 1).map(function(prop) {
        return "".concat(prop, " -> ");
      }).join("");
      var current = props[props.length - 1];
      var leadingSpace = " ".repeat(leadingPart.length + alreadySeen.length / 2);
      var dashes = "-".repeat(circularPart.length + (alreadySeen.length + current.length) / 2 - 1);
      throw new BSONTypeError("Converting circular structure to EJSON:\n" + "    ".concat(leadingPart).concat(alreadySeen).concat(circularPart).concat(current, "\n") + "    ".concat(leadingSpace, "\\").concat(dashes, "/"));
    }
    options.seenObjects[options.seenObjects.length - 1].obj = value;
  }
  if (Array.isArray(value))
    return serializeArray(value, options);
  if (value === void 0)
    return null;
  if (value instanceof Date || isDate2(value)) {
    var dateNum = value.getTime(), inRange = dateNum > -1 && dateNum < 2534023188e5;
    if (options.legacy) {
      return options.relaxed && inRange ? { $date: value.getTime() } : { $date: getISOString(value) };
    }
    return options.relaxed && inRange ? { $date: getISOString(value) } : { $date: { $numberLong: value.getTime().toString() } };
  }
  if (typeof value === "number" && (!options.relaxed || !isFinite(value))) {
    if (Math.floor(value) === value) {
      var int32Range = value >= BSON_INT32_MIN && value <= BSON_INT32_MAX, int64Range = value >= BSON_INT64_MIN && value <= BSON_INT64_MAX;
      if (int32Range)
        return { $numberInt: value.toString() };
      if (int64Range)
        return { $numberLong: value.toString() };
    }
    return { $numberDouble: value.toString() };
  }
  if (value instanceof RegExp || isRegExp2(value)) {
    var flags = value.flags;
    if (flags === void 0) {
      var match2 = value.toString().match(/[gimuy]*$/);
      if (match2) {
        flags = match2[0];
      }
    }
    var rx = new BSONRegExp(value.source, flags);
    return rx.toExtendedJSON(options);
  }
  if (value != null && typeof value === "object")
    return serializeDocument(value, options);
  return value;
}
var BSON_TYPE_MAPPINGS = {
  Binary: function(o2) {
    return new Binary(o2.value(), o2.sub_type);
  },
  Code: function(o2) {
    return new Code(o2.code, o2.scope);
  },
  DBRef: function(o2) {
    return new DBRef(o2.collection || o2.namespace, o2.oid, o2.db, o2.fields);
  },
  Decimal128: function(o2) {
    return new Decimal128(o2.bytes);
  },
  Double: function(o2) {
    return new Double(o2.value);
  },
  Int32: function(o2) {
    return new Int32(o2.value);
  },
  Long: function(o2) {
    return Long.fromBits(
      // underscore variants for 1.x backwards compatibility
      o2.low != null ? o2.low : o2.low_,
      o2.low != null ? o2.high : o2.high_,
      o2.low != null ? o2.unsigned : o2.unsigned_
    );
  },
  MaxKey: function() {
    return new MaxKey();
  },
  MinKey: function() {
    return new MinKey();
  },
  ObjectID: function(o2) {
    return new ObjectId(o2);
  },
  ObjectId: function(o2) {
    return new ObjectId(o2);
  },
  BSONRegExp: function(o2) {
    return new BSONRegExp(o2.pattern, o2.options);
  },
  Symbol: function(o2) {
    return new BSONSymbol(o2.value);
  },
  Timestamp: function(o2) {
    return Timestamp.fromBits(o2.low, o2.high);
  }
};
function serializeDocument(doc, options) {
  if (doc == null || typeof doc !== "object")
    throw new BSONError("not an object instance");
  var bsontype = doc._bsontype;
  if (typeof bsontype === "undefined") {
    var _doc = {};
    for (var name in doc) {
      options.seenObjects.push({ propertyName: name, obj: null });
      try {
        var value = serializeValue(doc[name], options);
        if (name === "__proto__") {
          Object.defineProperty(_doc, name, {
            value,
            writable: true,
            enumerable: true,
            configurable: true
          });
        } else {
          _doc[name] = value;
        }
      } finally {
        options.seenObjects.pop();
      }
    }
    return _doc;
  } else if (isBSONType(doc)) {
    var outDoc = doc;
    if (typeof outDoc.toExtendedJSON !== "function") {
      var mapper = BSON_TYPE_MAPPINGS[doc._bsontype];
      if (!mapper) {
        throw new BSONTypeError("Unrecognized or invalid _bsontype: " + doc._bsontype);
      }
      outDoc = mapper(outDoc);
    }
    if (bsontype === "Code" && outDoc.scope) {
      outDoc = new Code(outDoc.code, serializeValue(outDoc.scope, options));
    } else if (bsontype === "DBRef" && outDoc.oid) {
      outDoc = new DBRef(serializeValue(outDoc.collection, options), serializeValue(outDoc.oid, options), serializeValue(outDoc.db, options), serializeValue(outDoc.fields, options));
    }
    return outDoc.toExtendedJSON(options);
  } else {
    throw new BSONError("_bsontype must be a string, but was: " + typeof bsontype);
  }
}
var EJSON;
(function(EJSON2) {
  function parse2(text, options) {
    var finalOptions = Object.assign({}, { relaxed: true, legacy: false }, options);
    if (typeof finalOptions.relaxed === "boolean")
      finalOptions.strict = !finalOptions.relaxed;
    if (typeof finalOptions.strict === "boolean")
      finalOptions.relaxed = !finalOptions.strict;
    return JSON.parse(text, function(key, value) {
      if (key.indexOf("\0") !== -1) {
        throw new BSONError("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(key)));
      }
      return deserializeValue(value, finalOptions);
    });
  }
  EJSON2.parse = parse2;
  function stringify(value, replacer2, space, options) {
    if (space != null && typeof space === "object") {
      options = space;
      space = 0;
    }
    if (replacer2 != null && typeof replacer2 === "object" && !Array.isArray(replacer2)) {
      options = replacer2;
      replacer2 = void 0;
      space = 0;
    }
    var serializeOptions = Object.assign({ relaxed: true, legacy: false }, options, {
      seenObjects: [{ propertyName: "(root)", obj: null }]
    });
    var doc = serializeValue(value, serializeOptions);
    return JSON.stringify(doc, replacer2, space);
  }
  EJSON2.stringify = stringify;
  function serialize3(value, options) {
    options = options || {};
    return JSON.parse(stringify(value, options));
  }
  EJSON2.serialize = serialize3;
  function deserialize2(ejson, options) {
    options = options || {};
    return parse2(JSON.stringify(ejson), options);
  }
  EJSON2.deserialize = deserialize2;
})(EJSON || (EJSON = {}));
var bsonMap;
var bsonGlobal = getGlobal();
if (bsonGlobal.Map) {
  bsonMap = bsonGlobal.Map;
} else {
  bsonMap = /** @class */
  function() {
    function Map2(array) {
      if (array === void 0) {
        array = [];
      }
      this._keys = [];
      this._values = {};
      for (var i2 = 0; i2 < array.length; i2++) {
        if (array[i2] == null)
          continue;
        var entry = array[i2];
        var key = entry[0];
        var value = entry[1];
        this._keys.push(key);
        this._values[key] = { v: value, i: this._keys.length - 1 };
      }
    }
    Map2.prototype.clear = function() {
      this._keys = [];
      this._values = {};
    };
    Map2.prototype.delete = function(key) {
      var value = this._values[key];
      if (value == null)
        return false;
      delete this._values[key];
      this._keys.splice(value.i, 1);
      return true;
    };
    Map2.prototype.entries = function() {
      var _this = this;
      var index = 0;
      return {
        next: function() {
          var key = _this._keys[index++];
          return {
            value: key !== void 0 ? [key, _this._values[key].v] : void 0,
            done: key !== void 0 ? false : true
          };
        }
      };
    };
    Map2.prototype.forEach = function(callback, self2) {
      self2 = self2 || this;
      for (var i2 = 0; i2 < this._keys.length; i2++) {
        var key = this._keys[i2];
        callback.call(self2, this._values[key].v, key, self2);
      }
    };
    Map2.prototype.get = function(key) {
      return this._values[key] ? this._values[key].v : void 0;
    };
    Map2.prototype.has = function(key) {
      return this._values[key] != null;
    };
    Map2.prototype.keys = function() {
      var _this = this;
      var index = 0;
      return {
        next: function() {
          var key = _this._keys[index++];
          return {
            value: key !== void 0 ? key : void 0,
            done: key !== void 0 ? false : true
          };
        }
      };
    };
    Map2.prototype.set = function(key, value) {
      if (this._values[key]) {
        this._values[key].v = value;
        return this;
      }
      this._keys.push(key);
      this._values[key] = { v: value, i: this._keys.length - 1 };
      return this;
    };
    Map2.prototype.values = function() {
      var _this = this;
      var index = 0;
      return {
        next: function() {
          var key = _this._keys[index++];
          return {
            value: key !== void 0 ? _this._values[key].v : void 0,
            done: key !== void 0 ? false : true
          };
        }
      };
    };
    Object.defineProperty(Map2.prototype, "size", {
      get: function() {
        return this._keys.length;
      },
      enumerable: false,
      configurable: true
    });
    return Map2;
  }();
}
var JS_INT_MAX_LONG = Long.fromNumber(JS_INT_MAX);
var JS_INT_MIN_LONG = Long.fromNumber(JS_INT_MIN);
var SPACE_FOR_FLOAT64 = new Uint8Array(8);
var DV_FOR_FLOAT64 = new DataView(SPACE_FOR_FLOAT64.buffer, SPACE_FOR_FLOAT64.byteOffset, SPACE_FOR_FLOAT64.byteLength);
var MAXSIZE = 1024 * 1024 * 17;
var buffer = buffer_1.alloc(MAXSIZE);

// node_modules/@cloudbase/database/dist/esm/aggregate.js
var __awaiter38 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator38 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var Aggregation = function() {
  function Aggregation2(db, collectionName) {
    this._stages = [];
    if (db && collectionName) {
      this._db = db;
      this._request = Db.createRequest(this._db.config);
      this._collectionName = collectionName;
    }
  }
  Aggregation2.prototype.end = function() {
    return __awaiter38(this, void 0, void 0, function() {
      var result;
      return __generator38(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            if (!this._collectionName || !this._db) {
              throw new Error("Aggregation pipeline cannot send request");
            }
            return [4, this._request.send("database.aggregate", {
              collectionName: this._collectionName,
              stages: this._stages
            })];
          case 1:
            result = _a3.sent();
            if (result && result.data && result.data.list) {
              return [2, {
                requestId: result.requestId,
                data: JSON.parse(result.data.list).map(EJSON.parse)
              }];
            }
            return [2, result];
        }
      });
    });
  };
  Aggregation2.prototype.unwrap = function() {
    return this._stages;
  };
  Aggregation2.prototype.done = function() {
    return this._stages.map(function(_a3) {
      var _b;
      var stageKey = _a3.stageKey, stageValue = _a3.stageValue;
      return _b = {}, _b[stageKey] = JSON.parse(stageValue), _b;
    });
  };
  Aggregation2.prototype._pipe = function(stage, param) {
    this._stages.push({
      stageKey: "$".concat(stage),
      stageValue: JSON.stringify(param)
    });
    return this;
  };
  Aggregation2.prototype.addFields = function(param) {
    return this._pipe("addFields", param);
  };
  Aggregation2.prototype.bucket = function(param) {
    return this._pipe("bucket", param);
  };
  Aggregation2.prototype.bucketAuto = function(param) {
    return this._pipe("bucketAuto", param);
  };
  Aggregation2.prototype.count = function(param) {
    return this._pipe("count", param);
  };
  Aggregation2.prototype.geoNear = function(param) {
    if (param.query) {
      param.query = QuerySerializer.encode(param.query);
    }
    if (param.distanceMultiplier && typeof param.distanceMultiplier === "number") {
      param.distanceMultiplier = param.distanceMultiplier;
    }
    if (param.near) {
      param.near = new Point(param.near.longitude, param.near.latitude).toJSON();
    }
    return this._pipe("geoNear", param);
  };
  Aggregation2.prototype.group = function(param) {
    return this._pipe("group", param);
  };
  Aggregation2.prototype.limit = function(param) {
    return this._pipe("limit", param);
  };
  Aggregation2.prototype.match = function(param) {
    return this._pipe("match", QuerySerializer.encode(param));
  };
  Aggregation2.prototype.project = function(param) {
    return this._pipe("project", param);
  };
  Aggregation2.prototype.lookup = function(param) {
    return this._pipe("lookup", param);
  };
  Aggregation2.prototype.replaceRoot = function(param) {
    return this._pipe("replaceRoot", param);
  };
  Aggregation2.prototype.sample = function(param) {
    return this._pipe("sample", param);
  };
  Aggregation2.prototype.skip = function(param) {
    return this._pipe("skip", param);
  };
  Aggregation2.prototype.sort = function(param) {
    return this._pipe("sort", param);
  };
  Aggregation2.prototype.sortByCount = function(param) {
    return this._pipe("sortByCount", param);
  };
  Aggregation2.prototype.unwind = function(param) {
    return this._pipe("unwind", param);
  };
  return Aggregation2;
}();
var aggregate_default = Aggregation;

// node_modules/@cloudbase/database/dist/esm/collection.js
var __extends14 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var CollectionReference = function(_super) {
  __extends14(CollectionReference3, _super);
  function CollectionReference3(db, coll) {
    return _super.call(this, db, coll) || this;
  }
  Object.defineProperty(CollectionReference3.prototype, "name", {
    get: function() {
      return this._coll;
    },
    enumerable: false,
    configurable: true
  });
  CollectionReference3.prototype.doc = function(docID) {
    if (typeof docID !== "string" && typeof docID !== "number") {
      throw new Error("docId");
    }
    return new DocumentReference(this._db, this._coll, docID);
  };
  CollectionReference3.prototype.add = function(data2, callback) {
    var docRef = new DocumentReference(this._db, this._coll, void 0);
    return docRef.create(data2, callback);
  };
  CollectionReference3.prototype.aggregate = function() {
    return new aggregate_default(this._db, this._coll);
  };
  return CollectionReference3;
}(Query);

// node_modules/@cloudbase/database/dist/esm/command.js
var Command = {
  eq: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.EQ, [val]);
  },
  neq: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.NEQ, [val]);
  },
  lt: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.LT, [val]);
  },
  lte: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.LTE, [val]);
  },
  gt: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.GT, [val]);
  },
  gte: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.GTE, [val]);
  },
  in: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.IN, val);
  },
  nin: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.NIN, val);
  },
  all: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.ALL, val);
  },
  elemMatch: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.ELEM_MATCH, [val]);
  },
  exists: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.EXISTS, [val]);
  },
  size: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.SIZE, [val]);
  },
  mod: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.MOD, [val]);
  },
  geoNear: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.GEO_NEAR, [val]);
  },
  geoWithin: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.GEO_WITHIN, [val]);
  },
  geoIntersects: function(val) {
    return new QueryCommand(QUERY_COMMANDS_LITERAL.GEO_INTERSECTS, [val]);
  },
  and: function() {
    var __expressions__ = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      __expressions__[_i] = arguments[_i];
    }
    var expressions = isArray3(arguments[0]) ? arguments[0] : Array.from(arguments);
    return new LogicCommand(LOGIC_COMMANDS_LITERAL.AND, expressions);
  },
  nor: function() {
    var __expressions__ = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      __expressions__[_i] = arguments[_i];
    }
    var expressions = isArray3(arguments[0]) ? arguments[0] : Array.from(arguments);
    return new LogicCommand(LOGIC_COMMANDS_LITERAL.NOR, expressions);
  },
  or: function() {
    var __expressions__ = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      __expressions__[_i] = arguments[_i];
    }
    var expressions = isArray3(arguments[0]) ? arguments[0] : Array.from(arguments);
    return new LogicCommand(LOGIC_COMMANDS_LITERAL.OR, expressions);
  },
  not: function() {
    var __expressions__ = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      __expressions__[_i] = arguments[_i];
    }
    var expressions = isArray3(arguments[0]) ? arguments[0] : Array.from(arguments);
    return new LogicCommand(LOGIC_COMMANDS_LITERAL.NOT, expressions);
  },
  set: function(val) {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.SET, [val]);
  },
  remove: function() {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.REMOVE, []);
  },
  inc: function(val) {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.INC, [val]);
  },
  mul: function(val) {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.MUL, [val]);
  },
  push: function() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      args[_i] = arguments[_i];
    }
    var values2;
    if (isObject2(args[0]) && args[0].hasOwnProperty("each")) {
      var options = args[0];
      values2 = {
        $each: options.each,
        $position: options.position,
        $sort: options.sort,
        $slice: options.slice
      };
    } else if (isArray3(args[0])) {
      values2 = args[0];
    } else {
      values2 = Array.from(args);
    }
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.PUSH, values2);
  },
  pull: function(values2) {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.PULL, values2);
  },
  pullAll: function(values2) {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.PULL_ALL, values2);
  },
  pop: function() {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.POP, []);
  },
  shift: function() {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.SHIFT, []);
  },
  unshift: function() {
    var __values__ = [];
    for (var _i = 0; _i < arguments.length; _i++) {
      __values__[_i] = arguments[_i];
    }
    var values2 = isArray3(arguments[0]) ? arguments[0] : Array.from(arguments);
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.UNSHIFT, values2);
  },
  addToSet: function(values2) {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.ADD_TO_SET, values2);
  },
  rename: function(values2) {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.RENAME, [values2]);
  },
  bit: function(values2) {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.BIT, [values2]);
  },
  max: function(values2) {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.MAX, [values2]);
  },
  min: function(values2) {
    return new UpdateCommand(UPDATE_COMMANDS_LITERAL.MIN, [values2]);
  },
  expr: function(values2) {
    return {
      $expr: values2
    };
  },
  jsonSchema: function(schema) {
    return {
      $jsonSchema: schema
    };
  },
  text: function(values2) {
    if (isString3(values2)) {
      return {
        $search: values2.search
      };
    } else {
      return {
        $search: values2.search,
        $language: values2.language,
        $caseSensitive: values2.caseSensitive,
        $diacriticSensitive: values2.diacriticSensitive
      };
    }
  },
  aggregate: {
    pipeline: function() {
      return new aggregate_default();
    },
    abs: function(param) {
      return new AggregationOperator("abs", param);
    },
    add: function(param) {
      return new AggregationOperator("add", param);
    },
    ceil: function(param) {
      return new AggregationOperator("ceil", param);
    },
    divide: function(param) {
      return new AggregationOperator("divide", param);
    },
    exp: function(param) {
      return new AggregationOperator("exp", param);
    },
    floor: function(param) {
      return new AggregationOperator("floor", param);
    },
    ln: function(param) {
      return new AggregationOperator("ln", param);
    },
    log: function(param) {
      return new AggregationOperator("log", param);
    },
    log10: function(param) {
      return new AggregationOperator("log10", param);
    },
    mod: function(param) {
      return new AggregationOperator("mod", param);
    },
    multiply: function(param) {
      return new AggregationOperator("multiply", param);
    },
    pow: function(param) {
      return new AggregationOperator("pow", param);
    },
    sqrt: function(param) {
      return new AggregationOperator("sqrt", param);
    },
    subtract: function(param) {
      return new AggregationOperator("subtract", param);
    },
    trunc: function(param) {
      return new AggregationOperator("trunc", param);
    },
    arrayElemAt: function(param) {
      return new AggregationOperator("arrayElemAt", param);
    },
    arrayToObject: function(param) {
      return new AggregationOperator("arrayToObject", param);
    },
    concatArrays: function(param) {
      return new AggregationOperator("concatArrays", param);
    },
    filter: function(param) {
      return new AggregationOperator("filter", param);
    },
    in: function(param) {
      return new AggregationOperator("in", param);
    },
    indexOfArray: function(param) {
      return new AggregationOperator("indexOfArray", param);
    },
    isArray: function(param) {
      return new AggregationOperator("isArray", param);
    },
    map: function(param) {
      return new AggregationOperator("map", param);
    },
    range: function(param) {
      return new AggregationOperator("range", param);
    },
    reduce: function(param) {
      return new AggregationOperator("reduce", param);
    },
    reverseArray: function(param) {
      return new AggregationOperator("reverseArray", param);
    },
    size: function(param) {
      return new AggregationOperator("size", param);
    },
    slice: function(param) {
      return new AggregationOperator("slice", param);
    },
    zip: function(param) {
      return new AggregationOperator("zip", param);
    },
    and: function(param) {
      return new AggregationOperator("and", param);
    },
    not: function(param) {
      return new AggregationOperator("not", param);
    },
    or: function(param) {
      return new AggregationOperator("or", param);
    },
    cmp: function(param) {
      return new AggregationOperator("cmp", param);
    },
    eq: function(param) {
      return new AggregationOperator("eq", param);
    },
    gt: function(param) {
      return new AggregationOperator("gt", param);
    },
    gte: function(param) {
      return new AggregationOperator("gte", param);
    },
    lt: function(param) {
      return new AggregationOperator("lt", param);
    },
    lte: function(param) {
      return new AggregationOperator("lte", param);
    },
    neq: function(param) {
      return new AggregationOperator("ne", param);
    },
    cond: function(param) {
      return new AggregationOperator("cond", param);
    },
    ifNull: function(param) {
      return new AggregationOperator("ifNull", param);
    },
    switch: function(param) {
      return new AggregationOperator("switch", param);
    },
    dateFromParts: function(param) {
      return new AggregationOperator("dateFromParts", param);
    },
    dateFromString: function(param) {
      return new AggregationOperator("dateFromString", param);
    },
    dayOfMonth: function(param) {
      return new AggregationOperator("dayOfMonth", param);
    },
    dayOfWeek: function(param) {
      return new AggregationOperator("dayOfWeek", param);
    },
    dayOfYear: function(param) {
      return new AggregationOperator("dayOfYear", param);
    },
    isoDayOfWeek: function(param) {
      return new AggregationOperator("isoDayOfWeek", param);
    },
    isoWeek: function(param) {
      return new AggregationOperator("isoWeek", param);
    },
    isoWeekYear: function(param) {
      return new AggregationOperator("isoWeekYear", param);
    },
    millisecond: function(param) {
      return new AggregationOperator("millisecond", param);
    },
    minute: function(param) {
      return new AggregationOperator("minute", param);
    },
    month: function(param) {
      return new AggregationOperator("month", param);
    },
    second: function(param) {
      return new AggregationOperator("second", param);
    },
    hour: function(param) {
      return new AggregationOperator("hour", param);
    },
    week: function(param) {
      return new AggregationOperator("week", param);
    },
    year: function(param) {
      return new AggregationOperator("year", param);
    },
    literal: function(param) {
      return new AggregationOperator("literal", param);
    },
    mergeObjects: function(param) {
      return new AggregationOperator("mergeObjects", param);
    },
    objectToArray: function(param) {
      return new AggregationOperator("objectToArray", param);
    },
    allElementsTrue: function(param) {
      return new AggregationOperator("allElementsTrue", param);
    },
    anyElementTrue: function(param) {
      return new AggregationOperator("anyElementTrue", param);
    },
    setDifference: function(param) {
      return new AggregationOperator("setDifference", param);
    },
    setEquals: function(param) {
      return new AggregationOperator("setEquals", param);
    },
    setIntersection: function(param) {
      return new AggregationOperator("setIntersection", param);
    },
    setIsSubset: function(param) {
      return new AggregationOperator("setIsSubset", param);
    },
    setUnion: function(param) {
      return new AggregationOperator("setUnion", param);
    },
    concat: function(param) {
      return new AggregationOperator("concat", param);
    },
    dateToString: function(param) {
      return new AggregationOperator("dateToString", param);
    },
    indexOfBytes: function(param) {
      return new AggregationOperator("indexOfBytes", param);
    },
    indexOfCP: function(param) {
      return new AggregationOperator("indexOfCP", param);
    },
    split: function(param) {
      return new AggregationOperator("split", param);
    },
    strLenBytes: function(param) {
      return new AggregationOperator("strLenBytes", param);
    },
    strLenCP: function(param) {
      return new AggregationOperator("strLenCP", param);
    },
    strcasecmp: function(param) {
      return new AggregationOperator("strcasecmp", param);
    },
    substr: function(param) {
      return new AggregationOperator("substr", param);
    },
    substrBytes: function(param) {
      return new AggregationOperator("substrBytes", param);
    },
    substrCP: function(param) {
      return new AggregationOperator("substrCP", param);
    },
    toLower: function(param) {
      return new AggregationOperator("toLower", param);
    },
    toUpper: function(param) {
      return new AggregationOperator("toUpper", param);
    },
    meta: function(param) {
      return new AggregationOperator("meta", param);
    },
    addToSet: function(param) {
      return new AggregationOperator("addToSet", param);
    },
    avg: function(param) {
      return new AggregationOperator("avg", param);
    },
    first: function(param) {
      return new AggregationOperator("first", param);
    },
    last: function(param) {
      return new AggregationOperator("last", param);
    },
    max: function(param) {
      return new AggregationOperator("max", param);
    },
    min: function(param) {
      return new AggregationOperator("min", param);
    },
    push: function(param) {
      return new AggregationOperator("push", param);
    },
    stdDevPop: function(param) {
      return new AggregationOperator("stdDevPop", param);
    },
    stdDevSamp: function(param) {
      return new AggregationOperator("stdDevSamp", param);
    },
    sum: function(param) {
      return new AggregationOperator("sum", param);
    },
    let: function(param) {
      return new AggregationOperator("let", param);
    }
  },
  project: {
    slice: function(param) {
      return new ProjectionOperator("slice", param);
    },
    elemMatch: function(param) {
      return new ProjectionOperator("elemMatch", param);
    }
  }
};
var AggregationOperator = /* @__PURE__ */ function() {
  function AggregationOperator2(name, param) {
    this["$" + name] = param;
  }
  return AggregationOperator2;
}();
var ProjectionOperator = /* @__PURE__ */ function() {
  function ProjectionOperator2(name, param) {
    this["$" + name] = param;
  }
  return ProjectionOperator2;
}();

// node_modules/@cloudbase/database/dist/esm/regexp/index.js
var RegExp2 = function() {
  function RegExp3(_a3) {
    var regexp = _a3.regexp, options = _a3.options;
    if (!regexp) {
      throw new TypeError("regexp must be a string");
    }
    this.$regex = regexp;
    this.$options = options;
  }
  RegExp3.prototype.parse = function() {
    return {
      $regex: this.$regex,
      $options: this.$options
    };
  };
  Object.defineProperty(RegExp3.prototype, "_internalType", {
    get: function() {
      return SYMBOL_REGEXP;
    },
    enumerable: false,
    configurable: true
  });
  return RegExp3;
}();
function RegExpConstructor(param) {
  return new RegExp2(param);
}

// node_modules/@cloudbase/database/dist/esm/const/code.js
var ERRORS12 = {
  CREATE_WATCH_NET_ERROR: {
    code: "CREATE_WATCH_NET_ERROR",
    message: "create watch network error"
  },
  CREATE_WACTH_EXCEED_ERROR: {
    code: "CREATE_WACTH_EXCEED_ERROR",
    message: "maximum connections exceed"
  },
  CREATE_WATCH_SERVER_ERROR: {
    code: "CREATE_WATCH_SERVER_ERROR",
    message: "create watch server error"
  },
  CONN_ERROR: {
    code: "CONN_ERROR",
    message: "connection error"
  },
  INVALID_PARAM: {
    code: "INVALID_PARAM",
    message: "Invalid request param"
  },
  INSERT_DOC_FAIL: {
    code: "INSERT_DOC_FAIL",
    message: "insert document failed"
  },
  DATABASE_TRANSACTION_CONFLICT: {
    code: "DATABASE_TRANSACTION_CONFLICT",
    message: "database transaction conflict"
  }
};

// node_modules/@cloudbase/database/dist/esm/transaction/document.js
var __assign41 = function() {
  __assign41 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign41.apply(this, arguments);
};
var __awaiter39 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator39 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var GET_DOC = "database.getInTransaction";
var UPDATE_DOC = "database.updateDocInTransaction";
var DELETE_DOC = "database.deleteDocInTransaction";
var INSERT_DOC = "database.insertDocInTransaction";
var DocumentReference2 = function() {
  function DocumentReference3(transaction, coll, docID) {
    this._coll = coll;
    this.id = docID;
    this._transaction = transaction;
    this._request = this._transaction.getRequestMethod();
    this._transactionId = this._transaction.getTransactionId();
  }
  DocumentReference3.prototype.create = function(data2) {
    return __awaiter39(this, void 0, void 0, function() {
      var params, res, inserted, ok;
      return __generator39(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            params = {
              collectionName: this._coll,
              transactionId: this._transactionId,
              data: EJSON.stringify(serialize2(data2), { relaxed: false })
            };
            if (this.id) {
              params["_id"] = this.id;
            }
            return [4, this._request.send(INSERT_DOC, params)];
          case 1:
            res = _a3.sent();
            if (res.code) {
              throw res;
            }
            inserted = EJSON.parse(res.inserted);
            ok = EJSON.parse(res.ok);
            if (ok == 1 && inserted == 1) {
              return [2, __assign41(__assign41({}, res), { ok, inserted })];
            } else {
              throw new Error(ERRORS12.INSERT_DOC_FAIL.message);
            }
            return [2];
        }
      });
    });
  };
  DocumentReference3.prototype.get = function() {
    return __awaiter39(this, void 0, void 0, function() {
      var param, res;
      return __generator39(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            param = {
              collectionName: this._coll,
              transactionId: this._transactionId,
              query: {
                _id: { $eq: this.id }
              }
            };
            return [4, this._request.send(GET_DOC, param)];
          case 1:
            res = _a3.sent();
            if (res.code)
              throw res;
            return [2, {
              data: res.data !== "null" ? Util.formatField(EJSON.parse(res.data)) : EJSON.parse(res.data),
              requestId: res.requestId
            }];
        }
      });
    });
  };
  DocumentReference3.prototype.set = function(data2) {
    return __awaiter39(this, void 0, void 0, function() {
      var param, res;
      return __generator39(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            param = {
              collectionName: this._coll,
              transactionId: this._transactionId,
              query: {
                _id: { $eq: this.id }
              },
              data: EJSON.stringify(serialize2(data2), { relaxed: false }),
              upsert: true
            };
            return [4, this._request.send(UPDATE_DOC, param)];
          case 1:
            res = _a3.sent();
            if (res.code)
              throw res;
            return [2, __assign41(__assign41({}, res), { updated: EJSON.parse(res.updated), upserted: res.upserted ? JSON.parse(res.upserted) : null })];
        }
      });
    });
  };
  DocumentReference3.prototype.update = function(data2) {
    return __awaiter39(this, void 0, void 0, function() {
      var param, res;
      return __generator39(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            param = {
              collectionName: this._coll,
              transactionId: this._transactionId,
              query: {
                _id: { $eq: this.id }
              },
              data: EJSON.stringify(UpdateSerializer.encode(data2), {
                relaxed: false
              })
            };
            return [4, this._request.send(UPDATE_DOC, param)];
          case 1:
            res = _a3.sent();
            if (res.code)
              throw res;
            return [2, __assign41(__assign41({}, res), { updated: EJSON.parse(res.updated) })];
        }
      });
    });
  };
  DocumentReference3.prototype.delete = function() {
    return __awaiter39(this, void 0, void 0, function() {
      var param, res;
      return __generator39(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            param = {
              collectionName: this._coll,
              transactionId: this._transactionId,
              query: {
                _id: { $eq: this.id }
              }
            };
            return [4, this._request.send(DELETE_DOC, param)];
          case 1:
            res = _a3.sent();
            if (res.code)
              throw res;
            return [2, __assign41(__assign41({}, res), { deleted: EJSON.parse(res.deleted) })];
        }
      });
    });
  };
  return DocumentReference3;
}();

// node_modules/@cloudbase/database/dist/esm/transaction/query.js
var Query2 = /* @__PURE__ */ function() {
  function Query3(transaction, coll) {
    this._coll = coll;
    this._transaction = transaction;
  }
  return Query3;
}();

// node_modules/@cloudbase/database/dist/esm/transaction/collection.js
var __extends15 = /* @__PURE__ */ function() {
  var extendStatics4 = function(d2, b2) {
    extendStatics4 = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(d3, b3) {
      d3.__proto__ = b3;
    } || function(d3, b3) {
      for (var p2 in b3) if (Object.prototype.hasOwnProperty.call(b3, p2)) d3[p2] = b3[p2];
    };
    return extendStatics4(d2, b2);
  };
  return function(d2, b2) {
    if (typeof b2 !== "function" && b2 !== null)
      throw new TypeError("Class extends value " + String(b2) + " is not a constructor or null");
    extendStatics4(d2, b2);
    function __() {
      this.constructor = d2;
    }
    d2.prototype = b2 === null ? Object.create(b2) : (__.prototype = b2.prototype, new __());
  };
}();
var CollectionReference2 = function(_super) {
  __extends15(CollectionReference3, _super);
  function CollectionReference3(transaction, coll) {
    return _super.call(this, transaction, coll) || this;
  }
  Object.defineProperty(CollectionReference3.prototype, "name", {
    get: function() {
      return this._coll;
    },
    enumerable: false,
    configurable: true
  });
  CollectionReference3.prototype.doc = function(docID) {
    if (typeof docID !== "string" && typeof docID !== "number") {
      throw new Error("docId");
    }
    return new DocumentReference2(this._transaction, this._coll, docID);
  };
  CollectionReference3.prototype.add = function(data2) {
    var docID;
    if (data2._id !== void 0) {
      docID = data2._id;
    }
    var docRef = new DocumentReference2(this._transaction, this._coll, docID);
    return docRef.create(data2);
  };
  return CollectionReference3;
}(Query2);

// node_modules/@cloudbase/database/dist/esm/transaction/index.js
var __awaiter40 = function(thisArg, _arguments, P2, generator) {
  function adopt(value) {
    return value instanceof P2 ? value : new P2(function(resolve) {
      resolve(value);
    });
  }
  return new (P2 || (P2 = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e3) {
        reject(e3);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e3) {
        reject(e3);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var __generator40 = function(thisArg, body) {
  var _2 = { label: 0, sent: function() {
    if (t3[0] & 1) throw t3[1];
    return t3[1];
  }, trys: [], ops: [] }, f2, y2, t3, g2;
  return g2 = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g2[Symbol.iterator] = function() {
    return this;
  }), g2;
  function verb(n3) {
    return function(v2) {
      return step([n3, v2]);
    };
  }
  function step(op) {
    if (f2) throw new TypeError("Generator is already executing.");
    while (g2 && (g2 = 0, op[0] && (_2 = 0)), _2) try {
      if (f2 = 1, y2 && (t3 = op[0] & 2 ? y2["return"] : op[0] ? y2["throw"] || ((t3 = y2["return"]) && t3.call(y2), 0) : y2.next) && !(t3 = t3.call(y2, op[1])).done) return t3;
      if (y2 = 0, t3) op = [op[0] & 2, t3.value];
      switch (op[0]) {
        case 0:
        case 1:
          t3 = op;
          break;
        case 4:
          _2.label++;
          return { value: op[1], done: false };
        case 5:
          _2.label++;
          y2 = op[1];
          op = [0];
          continue;
        case 7:
          op = _2.ops.pop();
          _2.trys.pop();
          continue;
        default:
          if (!(t3 = _2.trys, t3 = t3.length > 0 && t3[t3.length - 1]) && (op[0] === 6 || op[0] === 2)) {
            _2 = 0;
            continue;
          }
          if (op[0] === 3 && (!t3 || op[1] > t3[0] && op[1] < t3[3])) {
            _2.label = op[1];
            break;
          }
          if (op[0] === 6 && _2.label < t3[1]) {
            _2.label = t3[1];
            t3 = op;
            break;
          }
          if (t3 && _2.label < t3[2]) {
            _2.label = t3[2];
            _2.ops.push(op);
            break;
          }
          if (t3[2]) _2.ops.pop();
          _2.trys.pop();
          continue;
      }
      op = body.call(thisArg, _2);
    } catch (e3) {
      op = [6, e3];
      y2 = 0;
    } finally {
      f2 = t3 = 0;
    }
    if (op[0] & 5) throw op[1];
    return { value: op[0] ? op[1] : void 0, done: true };
  }
};
var START = "database.startTransaction";
var COMMIT = "database.commitTransaction";
var ABORT = "database.abortTransaction";
var Transaction = function() {
  function Transaction2(db) {
    this._db = db;
    this._request = Db.createRequest(this._db.config);
    this.aborted = false;
    this.commited = false;
    this.inited = false;
  }
  Transaction2.prototype.init = function() {
    return __awaiter40(this, void 0, void 0, function() {
      var res;
      return __generator40(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            return [4, this._request.send(START)];
          case 1:
            res = _a3.sent();
            if (res.code) {
              throw res;
            }
            this.inited = true;
            this._id = res.transactionId;
            return [2];
        }
      });
    });
  };
  Transaction2.prototype.collection = function(collName) {
    if (!collName) {
      throw new Error("Collection name is required");
    }
    return new CollectionReference2(this, collName);
  };
  Transaction2.prototype.getTransactionId = function() {
    return this._id;
  };
  Transaction2.prototype.getRequestMethod = function() {
    return this._request;
  };
  Transaction2.prototype.commit = function() {
    return __awaiter40(this, void 0, void 0, function() {
      var param, res;
      return __generator40(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            param = {
              transactionId: this._id
            };
            return [4, this._request.send(COMMIT, param)];
          case 1:
            res = _a3.sent();
            if (res.code)
              throw res;
            this.commited = true;
            return [2, res];
        }
      });
    });
  };
  Transaction2.prototype.rollback = function(customRollbackRes) {
    return __awaiter40(this, void 0, void 0, function() {
      var param, res;
      return __generator40(this, function(_a3) {
        switch (_a3.label) {
          case 0:
            param = {
              transactionId: this._id
            };
            return [4, this._request.send(ABORT, param)];
          case 1:
            res = _a3.sent();
            if (res.code)
              throw res;
            this.aborted = true;
            this.abortReason = customRollbackRes;
            return [2, res];
        }
      });
    });
  };
  return Transaction2;
}();
function startTransaction() {
  return __awaiter40(this, void 0, void 0, function() {
    var transaction;
    return __generator40(this, function(_a3) {
      switch (_a3.label) {
        case 0:
          transaction = new Transaction(this);
          return [4, transaction.init()];
        case 1:
          _a3.sent();
          return [2, transaction];
      }
    });
  });
}
function runTransaction(callback, times) {
  if (times === void 0) {
    times = 3;
  }
  return __awaiter40(this, void 0, void 0, function() {
    var transaction, callbackRes, error_1, throwWithRollback;
    var _this = this;
    return __generator40(this, function(_a3) {
      switch (_a3.label) {
        case 0:
          _a3.trys.push([0, 4, , 10]);
          transaction = new Transaction(this);
          return [4, transaction.init()];
        case 1:
          _a3.sent();
          return [4, callback(transaction)];
        case 2:
          callbackRes = _a3.sent();
          if (transaction.aborted === true) {
            throw transaction.abortReason;
          }
          return [4, transaction.commit()];
        case 3:
          _a3.sent();
          return [2, callbackRes];
        case 4:
          error_1 = _a3.sent();
          if (transaction.inited === false) {
            throw error_1;
          }
          throwWithRollback = function(error) {
            return __awaiter40(_this, void 0, void 0, function() {
              var err_1;
              return __generator40(this, function(_a4) {
                switch (_a4.label) {
                  case 0:
                    if (!(!transaction.aborted && !transaction.commited)) return [3, 5];
                    _a4.label = 1;
                  case 1:
                    _a4.trys.push([1, 3, , 4]);
                    return [4, transaction.rollback()];
                  case 2:
                    _a4.sent();
                    return [3, 4];
                  case 3:
                    err_1 = _a4.sent();
                    return [3, 4];
                  case 4:
                    throw error;
                  case 5:
                    if (transaction.aborted === true) {
                      throw transaction.abortReason;
                    }
                    throw error;
                }
              });
            });
          };
          if (!(times <= 0)) return [3, 6];
          return [4, throwWithRollback(error_1)];
        case 5:
          _a3.sent();
          _a3.label = 6;
        case 6:
          if (!(error_1 && error_1.code === ERRORS12.DATABASE_TRANSACTION_CONFLICT.code)) return [3, 8];
          return [4, runTransaction.bind(this)(callback, --times)];
        case 7:
          return [2, _a3.sent()];
        case 8:
          return [4, throwWithRollback(error_1)];
        case 9:
          _a3.sent();
          return [3, 10];
        case 10:
          return [2];
      }
    });
  });
}

// node_modules/@cloudbase/database/dist/esm/index.js
var Db = function() {
  function Db2(config) {
    this.config = config;
    this.Geo = geo_exports;
    this.serverDate = ServerDateConstructor;
    this.command = Command;
    this.RegExp = RegExpConstructor;
    this.startTransaction = startTransaction;
    this.runTransaction = runTransaction;
    this.logicCommand = LogicCommand;
    this.updateCommand = UpdateCommand;
    this.queryCommand = QueryCommand;
  }
  Db2.createRequest = function(config) {
    var request = new Db2.reqClass(config);
    var originalSend = request.send;
    request.send = function(action, data2) {
      if (config.instance) {
        data2.instance = config.instance;
      }
      if (config.database) {
        data2.database = config.database;
      }
      return originalSend.call(this, action, data2);
    };
    return request;
  };
  Db2.prototype.collection = function(collName) {
    if (!collName) {
      throw new Error("Collection name is required");
    }
    return new CollectionReference(this, collName);
  };
  Db2.prototype.createCollection = function(collName) {
    var request = Db2.createRequest(this.config);
    var params = {
      collectionName: collName
    };
    return request.send("database.addCollection", params);
  };
  return Db2;
}();

// node_modules/@cloudbase/js-sdk/database/dist/index.esm.js
var __assign42 = function() {
  __assign42 = Object.assign || function(t3) {
    for (var s2, i2 = 1, n3 = arguments.length; i2 < n3; i2++) {
      s2 = arguments[i2];
      for (var p2 in s2) if (Object.prototype.hasOwnProperty.call(s2, p2))
        t3[p2] = s2[p2];
    }
    return t3;
  };
  return __assign42.apply(this, arguments);
};
var COMPONENT_NAME9 = "database";
function database(dbConfig) {
  var _a3 = this.platform, adapter2 = _a3.adapter, runtime2 = _a3.runtime;
  Db.reqClass = this.request.constructor;
  Db.getAccessToken = this.authInstance ? this.authInstance.getAccessToken.bind(this.authInstance) : function() {
    return "";
  };
  Db.runtime = runtime2;
  if (this.wsClientClass) {
    Db.wsClass = adapter2.wsClass;
    Db.wsClientClass = this.wsClientClass;
  }
  if (!Db.ws) {
    Db.ws = null;
  }
  return new Db(__assign42(__assign42(__assign42({}, this.config), { _fromApp: this }), dbConfig));
}
var component11 = {
  name: COMPONENT_NAME9,
  entity: {
    database
  }
};
try {
  cloudbase.registerComponent(component11);
} catch (e3) {
}
function registerDatabase(app) {
  try {
    app.registerComponent(component11);
  } catch (e3) {
    console.warn(e3);
  }
}
try {
  window.registerDatabase = registerDatabase;
} catch (e3) {
}

// node_modules/@cloudbase/js-sdk/package.json
var package_default = {
  name: "@cloudbase/js-sdk",
  version: "2.24.10",
  description: "cloudbase javascript sdk",
  main: "dist/index.cjs.js",
  module: "dist/index.esm.js",
  miniprogram: "miniprogram_dist",
  typings: "./index.d.ts",
  scripts: {
    lint: 'eslint --fix "./src/**/*.ts"',
    build: "rm -rf dist/ && gulp build",
    "build:cdn": "gulp cdn",
    "build:e2e": "rm -rf dist/ && NODE_ENV=e2e gulp e2e",
    precommit: "npm run lint"
  },
  publishConfig: {
    access: "public"
  },
  repository: {
    type: "git",
    url: "https://github.com/TencentCloudBase/cloudbase-js-sdk"
  },
  keywords: [
    "tcb",
    "cloudbase",
    "Cloudbase",
    "serverless",
    "Serverless",
    "javascript",
    "JavaScript"
  ],
  files: [
    "miniprogram_dist",
    "**/dist/",
    "/index.d.ts",
    "**/package.json"
  ],
  components: [
    "app",
    "auth",
    "database",
    "functions",
    "storage"
  ],
  author: "",
  license: "Apache-2.0",
  dependencies: {
    "@cloudbase/adapter-interface": "^0.7.1",
    "@cloudbase/ai": "2.24.10",
    "@cloudbase/analytics": "2.24.10",
    "@cloudbase/apis": "2.24.10",
    "@cloudbase/app": "2.24.10",
    "@cloudbase/auth": "2.24.10",
    "@cloudbase/cloudrun": "2.24.10",
    "@cloudbase/database": "0.10.0",
    "@cloudbase/functions": "2.24.10",
    "@cloudbase/model": "2.24.10",
    "@cloudbase/mysql": "2.24.10",
    "@cloudbase/realtime": "2.24.10",
    "@cloudbase/storage": "2.24.10",
    "@cloudbase/types": "2.24.10",
    "@cloudbase/utilities": "2.24.10"
  },
  browserslist: [
    "last 2 version",
    "> 1%",
    "chrome 53"
  ],
  gitHead: "1295166f18177e01052fb4c058483a8cd0f2f969"
};

// node_modules/@cloudbase/js-sdk/dist/index.esm.js
var version2 = package_default.version;
esm_default2.registerVersion(version2);
try {
  registerAuth(esm_default2);
  registerFunctions(esm_default2);
  registerStorage(esm_default2);
  registerDatabase(esm_default2);
  registerRealtime(esm_default2);
  registerAnalytics(esm_default2);
  registerModel(esm_default2);
  registerAi(esm_default2);
  registerCloudrun(esm_default2);
  registerMySQL(esm_default2);
  registerApis(esm_default2);
} catch (e3) {
}
try {
  window.cloudbase = esm_default2;
} catch (e3) {
}
var index_esm_default = esm_default2;
export {
  index_esm_default as default
};
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.mjs:
  (**
   * @license
   * web-streams-polyfill v4.2.0
   * Copyright 2025 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

@mattiasbuelens/web-streams-adapter/dist/web-streams-adapter.mjs:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

bson/dist/bson.browser.esm.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
//# sourceMappingURL=@cloudbase_js-sdk.js.map
